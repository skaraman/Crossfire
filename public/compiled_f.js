(function e$$0(l,r,b){function a(c,h){if(!r[c]){if(!l[c]){var g="function"==typeof require&&require;if(!h&&g)return g(c,!0);if(d)return d(c,!0);g=Error("Cannot find module '"+c+"'");throw g.code="MODULE_NOT_FOUND",g;}g=r[c]={exports:{}};l[c][0].call(g.exports,function(b){var d=l[c][1][b];return a(d?d:b)},g,g.exports,e$$0,l,r,b)}return r[c].exports}for(var d="function"==typeof require&&require,c=0;c<b.length;c++)a(b[c]);return a})({1:[function(f,l,r){function b(a){this._node=a;this._projectionType=
b.ORTHOGRAPHIC_PROJECTION;this._far=this._near=this._focalDepth=0;this._requestingUpdate=!1;this._id=a.addComponent(this);this._viewTransform=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this._perspectiveDirty=this._viewDirty=!1;this.setFlat()}var a=f("../core/Commands");b.FRUSTUM_PROJECTION=0;b.PINHOLE_PROJECTION=1;b.ORTHOGRAPHIC_PROJECTION=2;b.prototype.toString=function(){return"Camera"};b.prototype.getValue=function(){return{component:this.toString(),projectionType:this._projectionType,
focalDepth:this._focalDepth,near:this._near,far:this._far}};b.prototype.setValue=function(a){return this.toString()===a.component?(this.set(a.projectionType,a.focalDepth,a.near,a.far),!0):!1};b.prototype.set=function(a,b,e,h){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);this._projectionType=a;this._focalDepth=b;this._near=e;this._far=h;return this};b.prototype.setDepth=function(a){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=
!0);this._perspectiveDirty=!0;this._projectionType=b.PINHOLE_PROJECTION;this._focalDepth=a;this._far=this._near=0;return this};b.prototype.setFrustum=function(a,c){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);this._perspectiveDirty=!0;this._projectionType=b.FRUSTUM_PROJECTION;this._focalDepth=0;this._near=a;this._far=c;return this};b.prototype.setFlat=function(){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);this._perspectiveDirty=
!0;this._projectionType=b.ORTHOGRAPHIC_PROJECTION;this._far=this._near=this._focalDepth=0;return this};b.prototype.onUpdate=function(){this._requestingUpdate=!1;var d=this._node.getLocation();this._node.sendDrawCommand(a.WITH).sendDrawCommand(d);if(this._perspectiveDirty)switch(this._perspectiveDirty=!1,this._projectionType){case b.FRUSTUM_PROJECTION:this._node.sendDrawCommand(a.FRUSTRUM_PROJECTION);this._node.sendDrawCommand(this._near);this._node.sendDrawCommand(this._far);break;case b.PINHOLE_PROJECTION:this._node.sendDrawCommand(a.PINHOLE_PROJECTION);
this._node.sendDrawCommand(this._focalDepth);break;case b.ORTHOGRAPHIC_PROJECTION:this._node.sendDrawCommand(a.ORTHOGRAPHIC_PROJECTION)}this._viewDirty&&(this._viewDirty=!1,this._node.sendDrawCommand(a.CHANGE_VIEW_TRANSFORM),this._node.sendDrawCommand(this._viewTransform[0]),this._node.sendDrawCommand(this._viewTransform[1]),this._node.sendDrawCommand(this._viewTransform[2]),this._node.sendDrawCommand(this._viewTransform[3]),this._node.sendDrawCommand(this._viewTransform[4]),this._node.sendDrawCommand(this._viewTransform[5]),
this._node.sendDrawCommand(this._viewTransform[6]),this._node.sendDrawCommand(this._viewTransform[7]),this._node.sendDrawCommand(this._viewTransform[8]),this._node.sendDrawCommand(this._viewTransform[9]),this._node.sendDrawCommand(this._viewTransform[10]),this._node.sendDrawCommand(this._viewTransform[11]),this._node.sendDrawCommand(this._viewTransform[12]),this._node.sendDrawCommand(this._viewTransform[13]),this._node.sendDrawCommand(this._viewTransform[14]),this._node.sendDrawCommand(this._viewTransform[15]))};
b.prototype.onTransformChange=function(a){this._viewDirty=!0;this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);var b=a[0],e=a[1],h=a[2],g=a[3],u=a[4],k=a[5],p=a[6],q=a[7],w=a[8],t=a[9],B=a[10],m=a[11],v=a[12],x=a[13],I=a[14];a=a[15];var f=b*k-e*u,y=b*p-h*u,A=b*q-g*u,F=e*p-h*k,Q=e*q-g*k,J=h*q-g*p,D=w*x-t*v,O=w*I-B*v,l=w*a-m*v,K=t*I-B*x,E=t*a-m*x,G=B*a-m*I,C=1/(f*G-y*E+A*K+F*l-Q*O+J*D);this._viewTransform[0]=(k*G-p*E+q*K)*C;this._viewTransform[1]=(h*E-e*G-g*K)*C;
this._viewTransform[2]=(x*J-I*Q+a*F)*C;this._viewTransform[3]=(B*Q-t*J-m*F)*C;this._viewTransform[4]=(p*l-u*G-q*O)*C;this._viewTransform[5]=(b*G-h*l+g*O)*C;this._viewTransform[6]=(I*A-v*J-a*y)*C;this._viewTransform[7]=(w*J-B*A+m*y)*C;this._viewTransform[8]=(u*E-k*l+q*D)*C;this._viewTransform[9]=(e*l-b*E-g*D)*C;this._viewTransform[10]=(v*Q-x*A+a*f)*C;this._viewTransform[11]=(t*A-w*Q-m*f)*C;this._viewTransform[12]=(k*O-u*K-p*D)*C;this._viewTransform[13]=(b*K-e*O+h*D)*C;this._viewTransform[14]=(x*y-
v*F-I*f)*C;this._viewTransform[15]=(w*F-t*y+B*f)*C};l.exports=b},{"../core/Commands":5}],2:[function(f,l,r){function b(b){this._node=b;this._id=b.addComponent(this);this._requestingUpdate=!1;b=b.getPosition();this._x=new a(b[0]);this._y=new a(b[1]);this._z=new a(b[2])}var a=f("../transitions/Transitionable");b.prototype.toString=function(){return"Position"};b.prototype.getValue=function(){return{component:this.toString(),x:this._x.get(),y:this._y.get(),z:this._z.get()}};b.prototype.setValue=function(a){return this.toString()===
a.component?(this.set(a.x,a.y,a.z),!0):!1};b.prototype.getX=function(){return this._x.get()};b.prototype.getY=function(){return this._y.get()};b.prototype.getZ=function(){return this._z.get()};b.prototype.isActive=function(){return this._x.isActive()||this._y.isActive()||this._z.isActive()};b.prototype._checkUpdate=function(){this.isActive()?this._node.requestUpdateOnNextTick(this._id):this._requestingUpdate=!1};b.prototype.update=function(){this._node.setPosition(this._x.get(),this._y.get(),this._z.get());
this._checkUpdate()};b.prototype.onUpdate=b.prototype.update;b.prototype.setX=function(a,b,e){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);this._x.set(a,b,e);return this};b.prototype.setY=function(a,b,e){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);this._y.set(a,b,e);return this};b.prototype.setZ=function(a,b,e){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);this._z.set(a,b,
e);return this};b.prototype.set=function(a,b,e,h,g){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);var u,k,p;null!=e?p=g:null!=b?k=g:null!=a&&(u=g);null!=a&&this._x.set(a,h,u);null!=b&&this._y.set(b,h,k);null!=e&&this._z.set(e,h,p);return this};b.prototype.halt=function(){this._x.halt();this._y.halt();this._z.halt();return this};l.exports=b},{"../transitions/Transitionable":73}],3:[function(f,l,r){function b(){"undefined"!==typeof self&&self.window!==self&&
this._enterWorkerMode()}b.prototype._enterWorkerMode=function(){this._workerMode=!0;var a=this;self.addEventListener("message",function(b){a.onMessage(b.data)})};b.prototype.onMessage=null;b.prototype.sendMessage=function(a){if(this._workerMode)self.postMessage(a);else this.onmessage(a)};b.prototype.onmessage=null;b.prototype.postMessage=function(a){return this.onMessage(a)};l.exports=b},{}],4:[function(f,l,r){function b(){this._frame=this._time=0;this._timerQueue=[];this._updatingIndex=0;this._scale=
1;this._scaledTime=this._time}b.prototype.setScale=function(a){this._scale=a;return this};b.prototype.getScale=function(){return this._scale};b.prototype.step=function(a){this._frame++;this._scaledTime+=(a-this._time)*this._scale;this._time=a;for(a=0;a<this._timerQueue.length;a++)this._timerQueue[a](this._scaledTime)&&this._timerQueue.splice(a,1);return this};b.prototype.now=function(){return this._scaledTime};b.prototype.getTime=b.prototype.now;b.prototype.getFrame=function(){return this._frame};
b.prototype.setTimeout=function(a,b){var c=Array.prototype.slice.call(arguments,2),e=this._time,h=function(g){return g-e>=b?(a.apply(null,c),!0):!1};this._timerQueue.push(h);return h};b.prototype.setInterval=function(a,b){var c=Array.prototype.slice.call(arguments,2),e=this._time,h=function(g){g-e>=b&&(a.apply(null,c),e=g);return!1};this._timerQueue.push(h);return h};b.prototype.clearTimer=function(a){a=this._timerQueue.indexOf(a);-1!==a&&this._timerQueue.splice(a,1);return this};l.exports=b},{}],
5:[function(f,l,r){l.exports={INIT_DOM:0,DOM_RENDER_SIZE:1,CHANGE_TRANSFORM:2,CHANGE_SIZE:3,CHANGE_PROPERTY:4,CHANGE_CONTENT:5,CHANGE_ATTRIBUTE:6,ADD_CLASS:7,REMOVE_CLASS:8,SUBSCRIBE:9,GL_SET_DRAW_OPTIONS:10,GL_AMBIENT_LIGHT:11,GL_LIGHT_POSITION:12,GL_LIGHT_COLOR:13,MATERIAL_INPUT:14,GL_SET_GEOMETRY:15,GL_UNIFORMS:16,GL_BUFFER_DATA:17,GL_CUTOUT_STATE:18,GL_MESH_VISIBILITY:19,GL_REMOVE_MESH:20,PINHOLE_PROJECTION:21,ORTHOGRAPHIC_PROJECTION:22,CHANGE_VIEW_TRANSFORM:23,WITH:24,FRAME:25,ENGINE:26,START:27,
STOP:28,TIME:29,TRIGGER:30,NEED_SIZE_FOR:31,DOM:32,READY:33,ALLOW_DEFAULT:34,PREVENT_DEFAULT:35}},{}],6:[function(f,l,r){function b(){this._nodes={};this._queue=[]}var a=f("./Event"),d=f("./Path");b.prototype._setUpdater=function(a){this._updater=a;for(var b in this._nodes)this._nodes[b]._setUpdater(a)};b.prototype.addChildrenToQueue=function(a){a=a.getChildren();for(var b,d=0,g=a.length;d<g;d++)(b=a[d])&&this._queue.push(b)};b.prototype.next=function(){return this._queue.shift()};b.prototype.breadthFirstNext=
function(){var a=this._queue.shift();if(a)return this.addChildrenToQueue(a),a};b.prototype.mount=function(a,b){if(!b)throw Error("Dispatch: no node passed to mount at: "+a);if(this._nodes[a])throw Error("Dispatch: there is a node already registered at: "+a);b._setUpdater(this._updater);this._nodes[a]=b;var h=d.parent(a),g=h?this._nodes[h]:b;if(!g)throw Error("Parent to path: "+a+" doesn't exist at expected path: "+h);var h=b.getChildren(),u=b.getComponents(),k,p;g.isMounted()&&b._setMounted(!0,a);
g.isShown()&&b._setShown(!0);if(g.isMounted()){b._setParent(g);if(b.onMount)b.onMount(a);k=0;for(p=u.length;k<p;k++)if(u[k]&&u[k].onMount)u[k].onMount(b,k);k=0;for(p=h.length;k<p;k++)h[k]&&h[k].mount?h[k].mount(a+"/"+k):h[k]&&this.mount(a+"/"+k,h[k])}if(g.isShown()){if(b.onShow)b.onShow();k=0;for(p=u.length;k<p;k++)if(u[k]&&u[k].onShow)u[k].onShow()}};b.prototype.dismount=function(a){var b=this._nodes[a];if(!b)throw Error("No node registered to path: "+a);var d=b.getChildren(),g=b.getComponents(),
u,k;if(b.isShown()){b._setShown(!1);if(b.onHide)b.onHide();u=0;for(k=g.length;u<k;u++)if(g[u]&&g[u].onHide)g[u].onHide()}if(b.isMounted()){if(b.onDismount)b.onDismount(a);u=0;for(k=d.length;u<k;u++)d[u]&&d[u].dismount?d[u].dismount():d[u]&&this.dismount(a+"/"+u);u=0;for(k=g.length;u<k;u++)if(g[u]&&g[u].onDismount)g[u].onDismount();b._setMounted(!1);b._setParent(null)}delete this._nodes[a]};b.prototype.getNode=function(a){return this._nodes[a]};b.prototype.show=function(a){var b=this._nodes[a];if(!b)throw Error("No node registered to path: "+
a);if(b.onShow)b.onShow();for(this.addChildrenToQueue(b);a=this.breadthFirstNext();)this.show(a.getLocation())};b.prototype.hide=function(a){var b=this._nodes[a];if(!b)throw Error("No node registered to path: "+a);if(b.onHide)b.onHide();for(this.addChildrenToQueue(b);a=this.breadthFirstNext();)this.hide(a.getLocation())};b.prototype.lookupNode=function(a){if(!a)throw Error("lookupNode must be called with a path");this._queue.length=0;var b=this._queue,d=b.length=0,g,u=a.length;for(g=0;g<u;g++)"/"===
a[g]&&(b.push(a.substring(d,g)),d=g+1);0<g-d&&b.push(a.substring(d,g));a=0;for(d=b.length;a<d;a++)b[a]=this._nodes[b[a]];return b[b.length-1]};b.prototype.dispatch=function(a,b,d){if(!a)throw Error("dispatch requires a path as it's first argument");if(!b)throw Error("dispatch requires an event name as it's second argument");var g=this._nodes[a];if(!g)throw Error("No node registered at path: "+a);for(this.addChildrenToQueue(g);a=this.breadthFirstNext();)if(a&&a.onReceive)a.onReceive(b,d);else if(a)for(g=
0;g<a.getComponents().length;g++)if(a._components[g].onReceive)a._components[g].onReceive(b,d)};b.prototype.dispatchUIEvent=function(b,d,h){if(!b)throw Error("dispatchUIEvent needs a valid path to dispatch to");if(!d)throw Error("dispatchUIEvent needs an event name as its second argument");a.call(h);if(b=this.getNode(b)){var g,u,k;for(h.node=b;b;){if(b.onReceive)b.onReceive(d,h);g=b.getComponents();u=0;for(k=g.length;u<k;u++)if(g[u]&&g[u].onReceive)g[u].onReceive(d,h);if(h.propagationStopped)break;
g=b.getParent();if(g===b)break;b=g}}};l.exports=new b},{"./Event":7,"./Path":10}],7:[function(f,l,r){function b(){this.propagationStopped=!0}l.exports=function(){this.propagationStopped=!1;this.stopPropagation=b}},{}],8:[function(f,l,r){function b(){var b=this;e._setUpdater(this);this._updateQueue=[];this._nextUpdateQueue=[];this._scenes={};this._messages=B;this._inUpdate=!1;this._clock=new a;this._channel=new c;this._channel.onMessage=function(a){b.handleMessage(a)}}var a=f("./Clock"),d=f("./Scene"),
c=f("./Channel"),e=f("./Dispatch"),h=f("../renderers/UIManager"),g=f("../renderers/Compositor"),u=f("../render-loops/RequestAnimationFrameLoop"),k=f("./TransformSystem"),p=f("./SizeSystem"),q=f("./Commands"),w=[q.ENGINE,q.START],t=[q.ENGINE,q.STOP],B=[q.TIME,null];b.prototype.init=function(a){this.compositor=a&&a.compositor||new g;this.renderLoop=a&&a.renderLoop||new u;this.uiManager=new h(this.getChannel(),this.compositor,this.renderLoop);return this};b.prototype.setChannel=function(a){this._channel=
a;return this};b.prototype.getChannel=function(){return this._channel};b.prototype._update=function(){this._inUpdate=!0;var a=this._clock.now(),b=this._nextUpdateQueue,g=this._updateQueue;this._messages[1]=a;p.update();for(k.onUpdate();b.length;)g.unshift(b.pop());for(;g.length;)if((b=g.shift())&&b.update&&b.update(a),b&&b.onUpdate)b.onUpdate(a);this._inUpdate=!1};b.prototype.requestUpdate=function(a){if(!a)throw Error("requestUpdate must be called with a class to be updated");this._inUpdate?this.requestUpdateOnNextTick(a):
this._updateQueue.push(a)};b.prototype.requestUpdateOnNextTick=function(a){this._nextUpdateQueue.push(a)};b.prototype.handleMessage=function(a){if(!a)throw Error("onMessage must be called with an array of messages");for(var b;0<a.length;)switch(b=a.shift(),b){case q.WITH:this.handleWith(a);break;case q.FRAME:this.handleFrame(a);break;default:throw Error("received unknown command: "+b);}return this};b.prototype.handleWith=function(a){var b=a.shift(),g=a.shift();switch(g){case q.TRIGGER:g=a.shift();
a=a.shift();e.dispatchUIEvent(b,g,a);break;default:throw Error("received unknown command: "+g);}return this};b.prototype.handleFrame=function(a){if(!a)throw Error("handleFrame must be called with an array of messages");if(!a.length)throw Error("FRAME must be sent with a time");this.step(a.shift());return this};b.prototype.step=function(a){if(null==a)throw Error("step must be called with a time");this._clock.step(a);this._update();if(this._messages.length)for(this._channel.sendMessage(this._messages);2<
this._messages.length;)this._messages.pop();return this};b.prototype.getContext=function(a){if(!a)throw Error("getContext must be called with a selector");var b=a.indexOf("/");a=-1===b?a:a.substring(0,b);return this._scenes[a]};b.prototype.getClock=function(){return this._clock};b.prototype.message=function(a){this._messages.push(a);return this};b.prototype.createScene=function(a){a=a||"body";this._scenes[a]&&this._scenes[a].dismount();this._scenes[a]=new d(a,this);return this._scenes[a]};b.prototype.addScene=
function(a){var b=a._selector,g=this._scenes[b];g&&g!==a&&g.dismount();a.isMounted()||a.mount();this._scenes[b]=a;return this};b.prototype.removeScene=function(a){var b=a._selector,g=this._scenes[b];g&&g===a&&(a.isMounted()&&a.dismount(),delete this._scenes[b]);return this};b.prototype.startRenderLoop=function(){this._channel.sendMessage(w);return this};b.prototype.stopRenderLoop=function(){this._channel.sendMessage(t);return this};b.prototype.startEngine=function(){console.warn("FamousEngine.startEngine is deprecated! Use FamousEngine.startRenderLoop instead!");
return this.startRenderLoop()};b.prototype.stopEngine=function(){console.warn("FamousEngine.stopEngine is deprecated! Use FamousEngine.stopRenderLoop instead!");return this.stopRenderLoop()};l.exports=new b},{"../render-loops/RequestAnimationFrameLoop":67,"../renderers/Compositor":68,"../renderers/UIManager":70,"./Channel":3,"./Clock":4,"./Commands":5,"./Dispatch":6,"./Scene":12,"./SizeSystem":14,"./TransformSystem":16}],9:[function(f,l,r){function b(){this._shown=this._mounted=this._inUpdate=this._requestingUpdate=
!1;this._updater=null;this._opacity=1;this._UIEvents=[];this._updateQueue=[];this._nextUpdateQueue=[];this._freedComponentIndicies=[];this._components=[];this._freedChildIndicies=[];this._children=[];this._sizeID=this._transformID=this._id=this._parent=null;this.constructor.INIT_DEFAULT_COMPONENTS&&this._init()}var a=f("./SizeSystem"),d=f("./Dispatch"),c=f("./TransformSystem"),e=f("./Size"),h=f("./Transform");b.RELATIVE_SIZE=0;b.ABSOLUTE_SIZE=1;b.RENDER_SIZE=2;b.DEFAULT_SIZE=0;b.INIT_DEFAULT_COMPONENTS=
!0;b.prototype._init=function(){this._transformID=this.addComponent(new h);this._sizeID=this.addComponent(new e)};b.prototype._setParent=function(a){this._parent&&-1!==this._parent.getChildren().indexOf(this)&&this._parent.removeChild(this);this._parent=a};b.prototype._setMounted=function(a,b){this._mounted=a;this._id=b?b:null};b.prototype._setShown=function(a){this._shown=a};b.prototype._setUpdater=function(a){this._updater=a;this._requestingUpdate&&this._updater.requestUpdate(this)};b.prototype.getLocation=
function(){return this._id};b.prototype.getId=b.prototype.getLocation;b.prototype.emit=function(a,b){d.dispatch(this.getLocation(),a,b);return this};b.prototype.sendDrawCommand=function(a){this._updater.message(a);return this};b.prototype.getValue=function(){var b=this._children.length,d=this._components.length,k=0,e={location:this.getId(),spec:{location:this.getId(),showState:{mounted:this.isMounted(),shown:this.isShown(),opacity:this.getOpacity()||null},offsets:{mountPoint:[0,0,0],align:[0,0,0],
origin:[0,0,0]},vectors:{position:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1]},size:{sizeMode:[0,0,0],proportional:[1,1,1],differential:[0,0,0],absolute:[0,0,0],render:[0,0,0]}},UIEvents:this._UIEvents,components:[],children:[]};if(e.location){for(var h=c.get(this.getId()),w=a.get(this.getId()),k=0;3>k;k++)e.spec.offsets.mountPoint[k]=h.offsets.mountPoint[k],e.spec.offsets.align[k]=h.offsets.align[k],e.spec.offsets.origin[k]=h.offsets.origin[k],e.spec.vectors.position[k]=h.vectors.position[k],e.spec.vectors.rotation[k]=
h.vectors.rotation[k],e.spec.vectors.scale[k]=h.vectors.scale[k],e.spec.size.sizeMode[k]=w.sizeMode[k],e.spec.size.proportional[k]=w.proportionalSize[k],e.spec.size.differential[k]=w.differentialSize[k],e.spec.size.absolute[k]=w.absoluteSize[k],e.spec.size.render[k]=w.renderSize[k];e.spec.vectors.rotation[3]=h.vectors.rotation[3]}for(k=0;k<b;k++)this._children[k]&&this._children[k].getValue&&e.children.push(this._children[k].getValue());for(k=0;k<d;k++)this._components[k]&&this._components[k].getValue&&
e.components.push(this._components[k].getValue());return e};b.prototype.getComputedValue=function(){console.warn("Node.getComputedValue is depricated. Use Node.getValue instead");for(var b=this._children.length,d={location:this.getId(),computedValues:{transform:this.isMounted()?c.get(this.getLocation()).getLocalTransform():null,size:this.isMounted()?a.get(this.getLocation()).get():null},children:[]},k=0;k<b;k++)this._children[k]&&this._children[k].getComputedValue&&d.children.push(this._children[k].getComputedValue());
return d};b.prototype.getChildren=function(){return this._children};b.prototype.getParent=function(){return this._parent};b.prototype.requestUpdate=function(a){if(this._inUpdate||!this.isMounted())return this.requestUpdateOnNextTick(a);this._updateQueue.push(a);this._requestingUpdate||this._requestUpdate();return this};b.prototype.requestUpdateOnNextTick=function(a){-1==this._nextUpdateQueue.indexOf(a)&&this._nextUpdateQueue.push(a);return this};b.prototype.isMounted=function(){return this._mounted};
b.prototype.isShown=function(){return this._shown};b.prototype.getOpacity=function(){return this._opacity};b.prototype.getMountPoint=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._transformID).getMountPoint();if(this.isMounted())return c.get(this.getLocation()).getMountPoint();throw Error("This node does not have access to a transform component");};b.prototype.getAlign=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._transformID).getAlign();
if(this.isMounted())return c.get(this.getLocation()).getAlign();throw Error("This node does not have access to a transform component");};b.prototype.getOrigin=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._transformID).getOrigin();if(this.isMounted())return c.get(this.getLocation()).getOrigin();throw Error("This node does not have access to a transform component");};b.prototype.getPosition=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._transformID).getPosition();
if(this.isMounted())return c.get(this.getLocation()).getPosition();throw Error("This node does not have access to a transform component");};b.prototype.getRotation=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._transformID).getRotation();if(this.isMounted())return c.get(this.getLocation()).getRotation();throw Error("This node does not have access to a transform component");};b.prototype.getScale=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._transformID).getScale();
if(this.isMounted())return c.get(this.getLocation()).getScale();throw Error("This node does not have access to a transform component");};b.prototype.getSizeMode=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._sizeID).getSizeMode();if(this.isMounted())return a.get(this.getLocation()).getSizeMode();throw Error("This node does not have access to a size component");};b.prototype.getProportionalSize=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._sizeID).getProportional();
if(this.isMounted())return a.get(this.getLocation()).getProportional();throw Error("This node does not have access to a size component");};b.prototype.getDifferentialSize=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._sizeID).getDifferential();if(this.isMounted())return a.get(this.getLocation()).getDifferential();throw Error("This node does not have access to a size component");};b.prototype.getAbsoluteSize=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._sizeID).getAbsolute();
if(this.isMounted())return a.get(this.getLocation()).getAbsolute();throw Error("This node does not have access to a size component");};b.prototype.getRenderSize=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._sizeID).getRender();if(this.isMounted())return a.get(this.getLocation()).getRender();throw Error("This node does not have access to a size component");};b.prototype.getSize=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._sizeID).get();
if(this.isMounted())return a.get(this.getLocation()).get();throw Error("This node does not have access to a size component");};b.prototype.getTransform=function(){return c.get(this.getLocation())};b.prototype.getUIEvents=function(){return this._UIEvents};b.prototype.addChild=function(a){var d=a?this._children.indexOf(a):-1;a=a?a:new b;-1===d&&(d=this._freedChildIndicies.length?this._freedChildIndicies.pop():this._children.length,this._children[d]=a);this.isMounted()&&a.mount(this.getLocation()+"/"+
d);return a};b.prototype.removeChild=function(a){var b=this._children.indexOf(a);if(-1<b)return this._freedChildIndicies.push(b),this._children[b]=null,a.isMounted()&&a.dismount(),!0;throw Error("Node is not a child of this node");};b.prototype.addComponent=function(a){var b=this._components.indexOf(a);if(-1===b){b=this._freedComponentIndicies.length?this._freedComponentIndicies.pop():this._components.length;this._components[b]=a;if(this.isMounted()&&a.onMount)a.onMount(this,b);if(this.isShown()&&
a.onShow)a.onShow()}return b};b.prototype.getComponent=function(a){return this._components[a]};b.prototype.removeComponent=function(a){var b=this._components.indexOf(a);if(-1!==b){this._freedComponentIndicies.push(b);if(this.isShown()&&a.onHide)a.onHide();if(this.isMounted()&&a.onDismount)a.onDismount();this._components.splice(b,1)}return a};b.prototype.removeUIEvent=function(a){var b=this.getUIEvents(),d=this._components,e=b.indexOf(a);if(-1!==e){b.splice(e,1);for(var e=0,c=d.length;e<c;e++)if((b=
d[e])&&b.onRemoveUIEvent)b.onRemoveUIEvent(a)}};b.prototype.addUIEvent=function(a){var b=this.getUIEvents(),d=this._components;if(-1===b.indexOf(a)){b.push(a);for(var e=0,c=d.length;e<c;e++)if((b=d[e])&&b.onAddUIEvent)b.onAddUIEvent(a)}};b.prototype._requestUpdate=function(a){if(a||!this._requestingUpdate)this._updater&&this._updater.requestUpdate(this),this._requestingUpdate=!0};b.prototype._vecOptionalSet=function(a,b,d){return null!=d&&a[b]!==d?(a[b]=d,this._requestingUpdate||this._requestUpdate(),
!0):!1};b.prototype.show=function(){d.show(this.getLocation());this._shown=!0;return this};b.prototype.hide=function(){d.hide(this.getLocation());this._shown=!1;return this};b.prototype.setAlign=function(a,b,d){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._transformID).setAlign(a,b,d);else if(this.isMounted())c.get(this.getLocation()).setAlign(a,b,d);else throw Error("This node does not have access to a transform component");return this};b.prototype.setMountPoint=function(a,
b,d){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._transformID).setMountPoint(a,b,d);else if(this.isMounted())c.get(this.getLocation()).setMountPoint(a,b,d);else throw Error("This node does not have access to a transform component");return this};b.prototype.setOrigin=function(a,b,d){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._transformID).setOrigin(a,b,d);else if(this.isMounted())c.get(this.getLocation()).setOrigin(a,b,d);else throw Error("This node does not have access to a transform component");
return this};b.prototype.setPosition=function(a,b,d){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._transformID).setPosition(a,b,d);else if(this.isMounted())c.get(this.getLocation()).setPosition(a,b,d);else throw Error("This node does not have access to a transform component");return this};b.prototype.setRotation=function(a,b,d,e){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._transformID).setRotation(a,b,d,e);else if(this.isMounted())c.get(this.getLocation()).setRotation(a,
b,d,e);else throw Error("This node does not have access to a transform component");return this};b.prototype.setScale=function(a,b,d){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._transformID).setScale(a,b,d);else if(this.isMounted())c.get(this.getLocation()).setScale(a,b,d);else throw Error("This node does not have access to a transform component");return this};b.prototype.setOpacity=function(a){if(a!==this._opacity){this._opacity=a;this._requestingUpdate||this._requestUpdate();
for(var b=0,d=this._components,e=d.length,c;b<e;b++)if((c=d[b])&&c.onOpacityChange)c.onOpacityChange(a)}return this};b.prototype.setSizeMode=function(b,d,e){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._sizeID).setSizeMode(b,d,e);else if(this.isMounted())a.get(this.getLocation()).setSizeMode(b,d,e);else throw Error("This node does not have access to a size component");return this};b.prototype.setProportionalSize=function(b,d,e){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._sizeID).setProportional(b,
d,e);else if(this.isMounted())a.get(this.getLocation()).setProportional(b,d,e);else throw Error("This node does not have access to a size component");return this};b.prototype.setDifferentialSize=function(b,d,e){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._sizeID).setDifferential(b,d,e);else if(this.isMounted())a.get(this.getLocation()).setDifferential(b,d,e);else throw Error("This node does not have access to a size component");return this};b.prototype.setAbsoluteSize=function(b,
d,e){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._sizeID).setAbsolute(b,d,e);else if(this.isMounted())a.get(this.getLocation()).setAbsolute(b,d,e);else throw Error("This node does not have access to a size component");return this};b.prototype.getFrame=function(){return this._updater.getFrame()};b.prototype.getComponents=function(){return this._components};b.prototype.update=function(a){this._inUpdate=!0;var b;if(this.onUpdate)this.onUpdate();for(;this._nextUpdateQueue&&this._nextUpdateQueue.length;)this._updateQueue.unshift(this._nextUpdateQueue.pop());
for(;this._updateQueue&&this._updateQueue.length;)if((b=this._components[this._updateQueue.shift()])&&b.onUpdate)b.onUpdate(a);this._requestingUpdate=this._inUpdate=!1;this.isMounted()?this._nextUpdateQueue.length&&(this._updater.requestUpdateOnNextTick(this),this._requestingUpdate=!0):this._id=this._parent=null;return this};b.prototype.mount=function(b){if(this.isMounted())throw Error("Node is already mounted at: "+this.getLocation());this.constructor.INIT_DEFAULT_COMPONENTS?(c.registerTransformAtPath(b,
this.getComponent(this._transformID)),a.registerSizeAtPath(b,this.getComponent(this._sizeID))):(c.registerTransformAtPath(b),a.registerSizeAtPath(b));d.mount(b,this);this._requestingUpdate||this._requestUpdate();return this};b.prototype.dismount=function(){if(!this.isMounted())throw Error("Node is not mounted");var b=this.getLocation();c.deregisterTransformAtPath(b);a.deregisterSizeAtPath(b);d.dismount(b);this._requestingUpdate||this._requestUpdate();return this};l.exports=b},{"./Dispatch":6,"./Size":13,
"./SizeSystem":14,"./Transform":15,"./TransformSystem":16}],10:[function(f,l,r){function b(){}b.prototype.hasTrailingSlash=function(a){return"/"===a[a.length-1]};b.prototype.depth=function(a){for(var b=0,c=a.length,c=this.hasTrailingSlash(a)?c-1:c,e=0;e<c;e++)b+="/"===a[e]?1:0;return b};b.prototype.index=function(a){for(var b=this.hasTrailingSlash(a)?a.length-1:a.length;b--&&"/"!==a[b];);a=parseInt(a.substring(b+1));return isNaN(a)?0:a};b.prototype.indexAtDepth=function(a,b){for(var c=0,e=a.length,
h=0;c<e;c++)if("/"===a[c]&&h++,h===b){a=a.substring(c?c+1:c);h=a.indexOf("/");a=-1===h?a:a.substring(0,h);h=parseInt(a);break}return isNaN(h)?a:h};b.prototype.parent=function(a){return a.substring(0,a.lastIndexOf("/",a.length-2))};b.prototype.isChildOf=function(a,b){return this.isDescendentOf(a,b)&&this.depth(a)===this.depth(b)+1};b.prototype.isDescendentOf=function(a,b){if(a===b)return!1;a=this.hasTrailingSlash(a)?a:a+"/";b=this.hasTrailingSlash(b)?b:b+"/";return this.depth(b)<this.depth(a)&&0===
a.indexOf(b)};b.prototype.getSelector=function(a){var b=a.indexOf("/");return-1===b?a:a.substring(0,b)};l.exports=new b},{}],11:[function(f,l,r){function b(){this.items=[];this.paths=[];this.memo={}}var a=f("./Path");b.prototype.insert=function(b,c){var e=this.paths;if(-1!==e.indexOf(b))throw Error("item already exists at path: "+b);for(var h=0,g=a.depth(b),u=a.index(b);e[h]&&g>=a.depth(e[h]);)h++;for(;e[h]&&g===a.depth(e[h])&&u<a.index(e[h]);)h++;e.splice(h,0,b);this.items.splice(h,0,c);this.memo[b]=
h;for(e=this.paths.length;h<e;h++)this.memo[this.paths[h]]=null};b.prototype.remove=function(a){var b=this.paths,e=this.memo[a]?this.memo[a]:b.indexOf(a);if(-1===e)throw Error("Cannot remove. No item exists at path: "+a);b.splice(e,1);this.items.splice(e,1);this.memo[a]=null;for(a=this.paths.length;e<a;e++)this.memo[this.paths[e]]=null};b.prototype.get=function(a){if(this.memo[a])return this.items[this.memo[a]];var b=this.paths.indexOf(a);if(-1!==b)return this.memo[a]=b,this.items[b]};b.prototype.getItems=
function(){return this.items};b.prototype.getPaths=function(){return this.paths};l.exports=b},{"./Path":10}],12:[function(f,l,r){function b(b,d){if(!b)throw Error("Scene needs to be created with a DOM selector");if(!d)throw Error("Scene needs to be created with a class like Famous");a.call(this);this._globalUpdater=d;this._selector=b;this.mount(b);this._globalUpdater.message(c.NEED_SIZE_FOR).message(b);this.show()}var a=f("./Node"),d=f("./Dispatch"),c=f("./Commands"),e=f("./TransformSystem"),h=f("./SizeSystem");
b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.getUpdater=function(){return this._updater};b.prototype.getSelector=function(){return this._selector};b.prototype.getDispatch=function(){console.warn("Scene#getDispatch is deprecated, require the dispatch directly");return d};b.prototype.onReceive=function(a,b){if("CONTEXT_RESIZE"===a){if(2>b.length)throw Error("CONTEXT_RESIZE's payload needs to be at least a pair of pixel sizes");this.setSizeMode("absolute","absolute","absolute");
this.setAbsoluteSize(b[0],b[1],b[2]?b[2]:0);this._updater.message(c.WITH).message(this._selector).message(c.READY)}};b.prototype.mount=function(a){if(this.isMounted())throw Error("Scene is already mounted at: "+this.getLocation());d.mount(a,this);this._id=a;this._mounted=!0;this._parent=this;e.registerTransformAtPath(a);h.registerSizeAtPath(a)};l.exports=b},{"./Commands":5,"./Dispatch":6,"./Node":9,"./SizeSystem":14,"./TransformSystem":16}],13:[function(f,l,r){function b(a){this.finalSize=new Float32Array(3);
this.sizeChanged=!1;this.sizeMode=new Uint8Array(3);this.sizeModeChanged=!1;this.absoluteSize=new Float32Array(3);this.absoluteSizeChanged=!1;this.proportionalSize=new Float32Array(e);this.proportionalSizeChanged=!1;this.differentialSize=new Float32Array(3);this.differentialSizeChanged=!1;this.renderSize=new Float32Array(3);this.renderSizeChanged=!1;this.parent=null!=a?a:null}function a(a,b,d){return null!=d&&a[b]!==d?(a[b]=d,!0):!1}function d(b,d,e,c){var h=!1,h=a(b,0,d)||h,h=a(b,1,e)||h;return h=
a(b,2,c)||h}function c(a){if(a.constructor===String)switch(a.toLowerCase()){case "relative":case "default":return b.RELATIVE;case "absolute":return b.ABSOLUTE;case "render":return b.RENDER;default:throw Error("unknown size mode: "+a);}else if(0>a||a>b.RENDER)throw Error("unknown size mode: "+a);return a}var e=[1,1,1],h=[0,0,0];b.RELATIVE=0;b.ABSOLUTE=1;b.RENDER=2;b.DEFAULT=b.RELATIVE;b.prototype.setParent=function(a){this.parent=a;return this};b.prototype.getParent=function(){return this.parent};
b.prototype.setSizeMode=function(a,b,e){null!=a&&(a=c(a));null!=b&&(b=c(b));null!=e&&(e=c(e));this.sizeModeChanged=d(this.sizeMode,a,b,e);return this};b.prototype.getSizeMode=function(){return this.sizeMode};b.prototype.setAbsolute=function(a,b,e){this.absoluteSizeChanged=d(this.absoluteSize,a,b,e);return this};b.prototype.getAbsolute=function(){return this.absoluteSize};b.prototype.setProportional=function(a,b,e){this.proportionalSizeChanged=d(this.proportionalSize,a,b,e);return this};b.prototype.getProportional=
function(){return this.proportionalSize};b.prototype.setDifferential=function(a,b,e){this.differentialSizeChanged=d(this.differentialSize,a,b,e);return this};b.prototype.getDifferential=function(){return this.differentialSize};b.prototype.get=function(){return this.finalSize};b.prototype.fromComponents=function(a){for(var d=this.sizeMode,e=this.finalSize,c=this.parent?this.parent.get():h,q,w=!1,t=a.length,B,m=0;3>m;m++){q=e[m];switch(d[m]){case b.RELATIVE:e[m]=c[m]*this.proportionalSize[m]+this.differentialSize[m];
break;case b.ABSOLUTE:e[m]=this.absoluteSize[m];break;case b.RENDER:var v;for(B=0;B<t;B++)(v=a[B])&&v.getRenderSize&&(v=v.getRenderSize()[m],e[m]=e[m]<v||0===e[m]?v:e[m])}w=w||q!==e[m]}return this.sizeChanged=w};l.exports=b},{}],14:[function(f,l,r){function b(){this.pathStore=new a}var a=f("./PathStore"),d=f("./Size"),c=f("./Dispatch"),e=f("./Path");b.prototype.registerSizeAtPath=function(a,b){if(!e.depth(a))return this.pathStore.insert(a,b?b:new d);var u=this.pathStore.get(e.parent(a));if(!u)throw Error("No parent size registered at expected path: "+
e.parent(a));b&&b.setParent(u);this.pathStore.insert(a,b?b:new d(u))};b.prototype.deregisterSizeAtPath=function(a){this.pathStore.remove(a)};b.prototype.get=function(a){return this.pathStore.get(a)};b.prototype.update=function(){var a=this.pathStore.getItems(),b=this.pathStore.getPaths(),d,e,p,q,w;p=0;for(q=a.length;p<q;p++)if(d=c.getNode(b[p]),w=d.getComponents(),d){e=a[p];if(e.sizeModeChanged){var t=d,B=w,m=e,v=m.getSizeMode(),x=v[0],f=v[1],v=v[2];if(t.onSizeModeChange)t.onSizeModeChange(x,f,v);
for(var t=0,z=B.length;t<z;t++)if(B[t]&&B[t].onSizeModeChange)B[t].onSizeModeChange(x,f,v);m.sizeModeChanged=!1}if(e.absoluteSizeChanged){t=d;B=w;m=e;v=m.getAbsolute();x=v[0];f=v[1];v=v[2];if(t.onAbsoluteSizeChange)t.onAbsoluteSizeChange(x,f,v);t=0;for(z=B.length;t<z;t++)if(B[t]&&B[t].onAbsoluteSizeChange)B[t].onAbsoluteSizeChange(x,f,v);m.absoluteSizeChanged=!1}if(e.proportionalSizeChanged){t=d;B=w;m=e;v=m.getProportional();x=v[0];f=v[1];v=v[2];if(t.onProportionalSizeChange)t.onProportionalSizeChange(x,
f,v);t=0;for(z=B.length;t<z;t++)if(B[t]&&B[t].onProportionalSizeChange)B[t].onProportionalSizeChange(x,f,v);m.proportionalSizeChanged=!1}if(e.differentialSizeChanged){t=d;B=w;m=e;v=m.getDifferential();x=v[0];f=v[1];v=v[2];if(t.onDifferentialSizeChange)t.onDifferentialSizeChange(x,f,v);t=0;for(z=B.length;t<z;t++)if(B[t]&&B[t].onDifferentialSizeChange)B[t].onDifferentialSizeChange(x,f,v);m.differentialSizeChanged=!1}if(e.renderSizeChanged){t=d;B=w;m=e;v=m.getRenderSize();x=v[0];f=v[1];v=v[2];if(t.onRenderSizeChange)t.onRenderSizeChange(x,
f,v);t=0;for(z=B.length;t<z;t++)if(B[t]&&B[t].onRenderSizeChange)B[t].onRenderSizeChange(x,f,v);m.renderSizeChanged=!1}if(e.fromComponents(w)){x=e.get();B=x[0];m=x[1];x=x[2];if(d.onSizeChange)d.onSizeChange(B,m,x);d=0;for(f=w.length;d<f;d++)if(w[d]&&w[d].onSizeChange)w[d].onSizeChange(B,m,x);e.sizeChanged=!1}}};l.exports=new b},{"./Dispatch":6,"./Path":10,"./PathStore":11,"./Size":13}],15:[function(f,l,r){function b(a){this.local=new Float32Array(b.IDENT);this.global=new Float32Array(b.IDENT);this.offsets=
{align:new Float32Array(3),alignChanged:!1,mountPoint:new Float32Array(3),mountPointChanged:!1,origin:new Float32Array(3),originChanged:!1};this.vectors={position:new Float32Array(3),positionChanged:!1,rotation:new Float32Array(c),rotationChanged:!1,scale:new Float32Array(e),scaleChanged:!1};this._lastEulerVals=[0,0,0];this._lastEuler=!1;this.parent=a?a:null;this.breakPoint=!1}function a(a,b,d){return null!=d&&a[b]!==d?(a[b]=d,!0):!1}function d(b,d,e,c,p){var q=!1,q=a(b,0,d)||q,q=a(b,1,e)||q,q=a(b,
2,c)||q;null!=p&&(q=a(b,3,p)||q);return q}var c=[0,0,0,1],e=[1,1,1];b.IDENT=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];b.WORLD_CHANGED=1;b.LOCAL_CHANGED=2;b.prototype.reset=function(){this.parent=null;this.breakPoint=!1};b.prototype.setParent=function(a){this.parent=a};b.prototype.getParent=function(){return this.parent};b.prototype.setBreakPoint=function(){this.breakPoint=!0};b.prototype.isBreakPoint=function(){return this.breakPoint};b.prototype.getLocalTransform=function(){return this.local};b.prototype.getWorldTransform=
function(){if(!this.isBreakPoint())throw Error("This transform is not calculating world transforms");return this.global};b.prototype.calculate=function(a){if(!this.parent||this.parent.isBreakPoint()){var d=this.getLocalTransform(),e=a.getSize(),c=this.vectors,p=this.offsets,q=a.getParent().getSize(),w=0,t=d[0],B=d[1],m=d[2],v=d[4],x=d[5],f=d[6],z=d[8],y=d[9],A=d[10],F=d[12],Q=d[13],J=d[14],D=c.position[0],O=c.position[1],l=c.position[2],K=c.rotation[0],E=c.rotation[1],G=c.rotation[2],C=c.rotation[3],
L=c.scale[0],n=c.scale[1],H=c.scale[2],M=p.align[0]*q[0],R=p.align[1]*q[1],r=p.align[2]*q[2],W=p.mountPoint[0]*e[0],T=p.mountPoint[1]*e[1],V=p.mountPoint[2]*e[2],aa=p.origin[0]*e[0],S=p.origin[1]*e[1],U=p.origin[2]*e[2],da=C*K,ea=C*E,Ma=C*G,Na=K*K,Oa=E*E,Pa=G*G,Qa=K*E,Ra=K*G,Sa=E*G;d[0]=(1-2*(Oa+Pa))*L;d[1]=2*(Qa+Ma)*L;d[2]=2*(Ra-ea)*L;d[3]=0;d[4]=2*(Qa-Ma)*n;d[5]=(1-2*(Na+Pa))*n;d[6]=2*(Sa+da)*n;d[7]=0;d[8]=2*(Ra+ea)*H;d[9]=2*(Sa-da)*H;d[10]=(1-2*(Na+Oa))*H;d[11]=0;d[12]=M+D-W+aa-(d[0]*aa+d[4]*S+
d[8]*U);d[13]=R+O-T+S-(d[1]*aa+d[5]*S+d[9]*U);d[14]=r+l-V+U-(d[2]*aa+d[6]*S+d[10]*U);d[15]=1;this.isBreakPoint()&&this.calculateWorldMatrix()&&(w|=b.WORLD_CHANGED);if(t!==d[0]||B!==d[1]||m!==d[2]||v!==d[4]||x!==d[5]||f!==d[6]||z!==d[8]||y!==d[9]||A!==d[10]||F!==d[12]||Q!==d[13]||J!==d[14])w|=b.LOCAL_CHANGED;return w}var P=this.getLocalTransform(),X=this.parent.getLocalTransform(),ca=a.getSize(),Z=this.vectors,ba=this.offsets,Ea=a.getParent().getSize(),fa=!1,bb=P[0],cb=P[1],db=P[2],eb=P[4],fb=P[5],
gb=P[6],hb=P[8],ib=P[9],jb=P[10],kb=P[12],lb=P[13],mb=P[14],ja=X[0],ka=X[1],la=X[2],ma=X[4],na=X[5],oa=X[6],pa=X[8],qa=X[9],ra=X[10],nb=X[12],ob=X[13],pb=X[14],ga=Z.rotation[0],ha=Z.rotation[1],ia=Z.rotation[2],Fa=Z.rotation[3],Ga=Z.scale[0],Ha=Z.scale[1],Ia=Z.scale[2],sa=ba.origin[0]*ca[0],ta=ba.origin[1]*ca[1],ua=ba.origin[2]*ca[2],Ta=Fa*ga,Ua=Fa*ha,Va=Fa*ia,Wa=ga*ga,Xa=ha*ha,Ya=ia*ia,Za=ga*ha,$a=ga*ia,ab=ha*ia,va=(1-2*(Xa+Ya))*Ga,wa=2*(Za+Va)*Ga,xa=2*($a-Ua)*Ga,ya=2*(Za-Va)*Ha,za=(1-2*(Wa+Ya))*
Ha,Aa=2*(ab+Ta)*Ha,Ba=2*($a+Ua)*Ia,Ca=2*(ab-Ta)*Ia,Da=(1-2*(Wa+Xa))*Ia,Ja=ba.align[0]*Ea[0]+Z.position[0]-ba.mountPoint[0]*ca[0]+sa-(va*sa+ya*ta+Ba*ua),Ka=ba.align[1]*Ea[1]+Z.position[1]-ba.mountPoint[1]*ca[1]+ta-(wa*sa+za*ta+Ca*ua),La=ba.align[2]*Ea[2]+Z.position[2]-ba.mountPoint[2]*ca[2]+ua-(xa*sa+Aa*ta+Da*ua);P[0]=ja*va+ma*wa+pa*xa;P[1]=ka*va+na*wa+qa*xa;P[2]=la*va+oa*wa+ra*xa;P[3]=0;P[4]=ja*ya+ma*za+pa*Aa;P[5]=ka*ya+na*za+qa*Aa;P[6]=la*ya+oa*za+ra*Aa;P[7]=0;P[8]=ja*Ba+ma*Ca+pa*Da;P[9]=ka*Ba+na*
Ca+qa*Da;P[10]=la*Ba+oa*Ca+ra*Da;P[11]=0;P[12]=ja*Ja+ma*Ka+pa*La+nb;P[13]=ka*Ja+na*Ka+qa*La+ob;P[14]=la*Ja+oa*Ka+ra*La+pb;P[15]=1;this.isBreakPoint()&&this.calculateWorldMatrix()&&(fa|=b.WORLD_CHANGED);if(bb!==P[0]||cb!==P[1]||db!==P[2]||eb!==P[4]||fb!==P[5]||gb!==P[6]||hb!==P[8]||ib!==P[9]||jb!==P[10]||kb!==P[12]||lb!==P[13]||mb!==P[14])fa|=b.LOCAL_CHANGED;return fa};b.prototype.getPosition=function(){return this.vectors.position};b.prototype.setPosition=function(a,b,e){this.vectors.positionChanged=
d(this.vectors.position,a,b,e)};b.prototype.getRotation=function(){return this.vectors.rotation};b.prototype.setRotation=function(a,b,e,c){var p=this.vectors.rotation,q,w,t;if(null!=c)q=a,w=b,t=e,this._lastEulerVals[0]=null,this._lastEulerVals[1]=null,this._lastEulerVals[2]=null,this._lastEuler=!1;else{if(null==a||null==b||null==e)this._lastEuler?(a=null==a?this._lastEulerVals[0]:a,b=null==b?this._lastEulerVals[1]:b,e=null==e?this._lastEulerVals[2]:e):(c=-2*(p[1]*p[2]-p[3]*p[0]),.99999<Math.abs(c)?
(b=null==b?.5*Math.PI*c:b,a=null==a?Math.atan2(-p[0]*p[2]+p[3]*p[1],.5-p[1]*p[1]-p[2]*p[2]):a,e=null==e?0:e):(b=null==b?Math.asin(c):b,a=null==a?Math.atan2(p[0]*p[2]+p[3]*p[1],.5-p[0]*p[0]-p[1]*p[1]):a,e=null==e?Math.atan2(p[0]*p[1]+p[3]*p[2],.5-p[0]*p[0]-p[2]*p[2]):e));var B=.5*a;t=.5*b;var m=.5*e;c=Math.sin(B);q=Math.sin(t);w=Math.sin(m);var B=Math.cos(B),v=Math.cos(t),x=Math.cos(m),m=q*w;t=v*w;var f=q*x,v=v*x;q=c*v+B*m;w=B*f-c*t;t=B*t+c*f;c=B*v-c*m;this._lastEuler=!0;this._lastEulerVals[0]=a;this._lastEulerVals[1]=
b;this._lastEulerVals[2]=e}this.vectors.rotationChanged=d(p,q,w,t,c)};b.prototype.getScale=function(){return this.vectors.scale};b.prototype.setScale=function(a,b,e){this.vectors.scaleChanged=d(this.vectors.scale,a,b,e)};b.prototype.getAlign=function(){return this.offsets.align};b.prototype.setAlign=function(a,b,e){this.offsets.alignChanged=d(this.offsets.align,a,b,null!=e?e-.5:e)};b.prototype.getMountPoint=function(){return this.offsets.mountPoint};b.prototype.setMountPoint=function(a,b,e){this.offsets.mountPointChanged=
d(this.offsets.mountPoint,a,b,null!=e?e-.5:e)};b.prototype.getOrigin=function(){return this.offsets.origin};b.prototype.setOrigin=function(a,b,e){this.offsets.originChanged=d(this.offsets.origin,a,b,null!=e?e-.5:e)};b.prototype.calculateWorldMatrix=function(){for(var a=this.parent;a&&!a.isBreakPoint();)a=a.parent;if(a){var b=this.global,d=a.getWorldTransform(),a=this.local,e=d[0],c=d[1],q=d[2],w=d[4],t=d[5],B=d[6],m=d[8],v=d[9],x=d[10],f=d[12],z=d[13],d=d[14],y=!1,A,F=a[0],l=a[1],J=a[2],D=a[3];A=
F*e+l*w+J*m+D*f;y=y?y:b[0]===A;b[0]=A;A=F*c+l*t+J*v+D*z;y=y?y:b[1]===A;b[1]=A;A=F*q+l*B+J*x+D*d;y=y?y:b[2]===A;b[2]=A;b[3]=0;F=a[4];l=a[5];J=a[6];D=a[7];A=F*e+l*w+J*m+D*f;y=y?y:b[4]===A;b[4]=A;A=F*c+l*t+J*v+D*z;y=y?y:b[5]===A;b[5]=A;A=F*q+l*B+J*x+D*d;y=y?y:b[6]===A;b[6]=A;b[7]=0;F=a[8];l=a[9];J=a[10];D=a[11];A=F*e+l*w+J*m+D*f;y=y?y:b[8]===A;b[8]=A;A=F*c+l*t+J*v+D*z;y=y?y:b[9]===A;b[9]=A;A=F*q+l*B+J*x+D*d;y=y?y:b[10]===A;b[10]=A;b[11]=0;F=a[12];l=a[13];J=a[14];D=a[15];A=F*e+l*w+J*m+D*f;y=y?y:b[12]===
A;b[12]=A;A=F*c+l*t+J*v+D*z;y=y?y:b[13]===A;b[13]=A;A=F*q+l*B+J*x+D*d;y=y?y:b[14]===A;b[14]=A;b[15]=1;return y}for(b=0;16>b;b++)this.global[b]=this.local[b];return!1};l.exports=b},{}],16:[function(f,l,r){function b(){this.pathStore=new e}var a=f("./Path"),d=f("./Transform"),c=f("./Dispatch"),e=f("./PathStore");b.prototype.registerTransformAtPath=function(b,e){if(!a.depth(b))return this.pathStore.insert(b,e?e:new d);var c=this.pathStore.get(a.parent(b));if(!c)throw Error("No parent transform registered at expected path: "+
a.parent(b));e&&e.setParent(c);this.pathStore.insert(b,e?e:new d(c))};b.prototype.deregisterTransformAtPath=function(a){this.pathStore.remove(a)};b.prototype.makeBreakPointAt=function(a){var b=this.pathStore.get(a);if(!b)throw Error("No transform Registered at path: "+a);b.setBreakPoint()};b.prototype.get=function(a){return this.pathStore.get(a)};b.prototype.onUpdate=function(){for(var a=this.pathStore.getItems(),b=this.pathStore.getPaths(),e,k,p,q,w,t=0,f=a.length;t<f;t++)if(p=c.getNode(b[t])){w=
p.getComponents();e=a[t];k=e.vectors;q=e.offsets;if(q.alignChanged){var m=w,v=q,x=v.align[0],I=v.align[1],z=v.align[2];if(p.onAlignChange)p.onAlignChange(x,I,z);for(var y=0,A=m.length;y<A;y++)if(m[y]&&m[y].onAlignChange)m[y].onAlignChange(x,I,z);v.alignChanged=!1}if(q.mountPointChanged){m=w;v=q;x=v.mountPoint[0];I=v.mountPoint[1];z=v.mountPoint[2];if(p.onMountPointChange)p.onMountPointChange(x,I,z);y=0;for(A=m.length;y<A;y++)if(m[y]&&m[y].onMountPointChange)m[y].onMountPointChange(x,I,z);v.mountPointChanged=
!1}if(q.originChanged){m=w;v=q.origin[0];x=q.origin[1];I=q.origin[2];if(p.onOriginChange)p.onOriginChange(v,x,I);z=0;for(y=m.length;z<y;z++)if(m[z]&&m[z].onOriginChange)m[z].onOriginChange(v,x,I);q.originChanged=!1}if(k.positionChanged){q=w;m=k;v=m.position[0];x=m.position[1];I=m.position[2];if(p.onPositionChange)p.onPositionChange(v,x,I);z=0;for(y=q.length;z<y;z++)if(q[z]&&q[z].onPositionChange)q[z].onPositionChange(v,x,I);m.positionChanged=!1}if(k.rotationChanged){q=w;m=k;v=m.rotation[0];x=m.rotation[1];
I=m.rotation[2];z=m.rotation[3];if(p.onRotationChange)p.onRotationChange(v,x,I,z);y=0;for(A=q.length;y<A;y++)if(q[y]&&q[y].onRotationChange)q[y].onRotationChange(v,x,I,z);m.rotationChanged=!1}if(k.scaleChanged){q=w;m=k.scale[0];v=k.scale[1];x=k.scale[2];if(p.onScaleChange)p.onScaleChange(m,v,x);I=0;for(z=q.length;I<z;I++)if(q[I]&&q[I].onScaleChange)q[I].onScaleChange(m,v,x);k.scaleChanged=!1}if(k=e.calculate(p)){q=w;m=e;if(p.onTransformChange)p.onTransformChange(m);v=0;for(x=q.length;v<x;v++)if(q[v]&&
q[v].onTransformChange)q[v].onTransformChange(m);if(k&d.LOCAL_CHANGED){q=w;m=e.getLocalTransform();if(p.onLocalTransformChange)p.onLocalTransformChange(m);v=0;for(x=q.length;v<x;v++)if(q[v]&&q[v].onLocalTransformChange)q[v].onLocalTransformChange(m)}if(k&d.WORLD_CHANGED){e=e.getWorldTransform();if(p.onWorldTransformChange)p.onWorldTransformChange(e);p=0;for(k=w.length;p<k;p++)if(w[p]&&w[p].onWorldTransformChange)w[p].onWorldTransformChange(e)}}}};l.exports=new b},{"./Dispatch":6,"./Path":10,"./PathStore":11,
"./Transform":15}],17:[function(f,l,r){function b(b,d){if(!b)throw Error("DOMElement must be instantiated on a node");this._changeQueue=[];this._requestRenderSize=this._renderSized=this._requestingUpdate=!1;this._UIEvents=b.getUIEvents().slice(0);this._classes=["famous-dom-element"];this._requestingEventListeners=[];this._styles={};this._attributes={};this._content="";this._tagName=d&&d.tagName?d.tagName:"div";this._renderSize=[0,0,0];this._id=b?b.addComponent(this):null;this._node=b;this.onSizeModeChange.apply(this,
b.getSizeMode());this._callbacks=new a;this.setProperty("display",b.isShown()?"block":"none");this.onOpacityChange(b.getOpacity());if(d){var c,u;if(d.classes)for(c=0;c<d.classes.length;c++)this.addClass(d.classes[c]);if(d.attributes)for(u in d.attributes)this.setAttribute(u,d.attributes[u]);if(d.properties)for(u in d.properties)this.setProperty(u,d.properties[u]);d.id&&this.setId(d.id);d.content&&this.setContent(d.content);!1===d.cutout&&this.setCutoutState(d.cutout)}}var a=f("../utilities/CallbackStore"),
d=f("../core/TransformSystem"),c=f("../core/Commands");b.prototype.getValue=function(){return{classes:this._classes,styles:this._styles,attributes:this._attributes,content:this._content,id:this._attributes.id,tagName:this._tagName}};b.prototype.onUpdate=function(){var a=this._node,b=this._changeQueue,d=b.length;if(d&&a){a.sendDrawCommand(c.WITH);for(a.sendDrawCommand(a.getLocation());d--;)a.sendDrawCommand(b.shift());this._requestRenderSize&&(a.sendDrawCommand(c.DOM_RENDER_SIZE),a.sendDrawCommand(a.getLocation()),
this._requestRenderSize=!1)}this._requestingUpdate=!1};b.prototype.onMount=function(a,b){this._node=a;this._id=b;this._UIEvents=a.getUIEvents().slice(0);d.makeBreakPointAt(a.getLocation());this.draw();this.setAttribute("data-fa-path",a.getLocation())};b.prototype.onDismount=function(){this.setProperty("display","none");this.setAttribute("data-fa-path","");this.setCutoutState(!1);this.onUpdate();this._initialized=!1};b.prototype.remove=function(){var a=document.querySelector('[data-fa-path="'+this._attributes["data-fa-path"]+
'"');a&&a.remove();this.setCutoutState(!1);this.onUpdate();this._initialized=!1};b.prototype.onShow=function(){this.setProperty("display","block")};b.prototype.onHide=function(){this.setProperty("display","none")};b.prototype.setCutoutState=function(a){this._initialized&&this._changeQueue.push(c.GL_CUTOUT_STATE,a);this._requestingUpdate||this._requestUpdate();return this};b.prototype.onTransformChange=function(a){this._changeQueue.push(c.CHANGE_TRANSFORM);a=a.getLocalTransform();for(var b=0,d=a.length;b<
d;b++)this._changeQueue.push(a[b]);this._requestingUpdate||this._requestUpdate()};b.prototype.onSizeChange=function(a,b){var d=this._node.getSizeMode(),u=2!==d[0],d=2!==d[1];this._initialized&&this._changeQueue.push(c.CHANGE_SIZE,u?a:u,d?b:d);this._requestingUpdate||this._requestUpdate();return this};b.prototype.onOpacityChange=function(a){return this.setProperty("opacity",a)};b.prototype.onAddUIEvent=function(a){-1===this._UIEvents.indexOf(a)?(this._subscribe(a),this._UIEvents.push(a)):this._inDraw&&
this._subscribe(a);return this};b.prototype.onRemoveUIEvent=function(a){var b=this._UIEvents.indexOf(a);-1!==b?(this._unsubscribe(a),this._UIEvents.splice(b,1)):this._inDraw&&this._unsubscribe(a);return this};b.prototype._subscribe=function(a){this._initialized&&this._changeQueue.push(c.SUBSCRIBE,a);this._requestingUpdate||this._requestUpdate()};b.prototype.preventDefault=function(a){this._initialized&&this._changeQueue.push(c.PREVENT_DEFAULT,a);this._requestingUpdate||this._requestUpdate()};b.prototype.allowDefault=
function(a){this._initialized&&this._changeQueue.push(c.ALLOW_DEFAULT,a);this._requestingUpdate||this._requestUpdate()};b.prototype._unsubscribe=function(a){this._initialized&&this._changeQueue.push("UNSUBSCRIBE",a);this._requestingUpdate||this._requestUpdate()};b.prototype.onSizeModeChange=function(a,b,d){if(2===a||2===b||2===d)this._requestRenderSize=this._renderSized=!0;a=this._node.getSize();this.onSizeChange(a[0],a[1])};b.prototype.getRenderSize=function(){return this._renderSize};b.prototype._requestUpdate=
function(){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0)};b.prototype.init=function(){this._changeQueue.push(c.INIT_DOM,this._tagName);this._initialized=!0;this.onTransformChange(d.get(this._node.getLocation()));var a=this._node.getSize();this.onSizeChange(a[0],a[1]);this._requestingUpdate||this._requestUpdate()};b.prototype.setId=function(a){this.setAttribute("id",a);return this};b.prototype.addClass=function(a){if(0>this._classes.indexOf(a))return this._initialized&&
this._changeQueue.push(c.ADD_CLASS,a),this._classes.push(a),this._requestingUpdate||this._requestUpdate(),this._renderSized&&(this._requestRenderSize=!0),this;this._inDraw&&(this._initialized&&this._changeQueue.push(c.ADD_CLASS,a),this._requestingUpdate||this._requestUpdate());return this};b.prototype.removeClass=function(a){var b=this._classes.indexOf(a);if(0>b)return this;this._changeQueue.push(c.REMOVE_CLASS,a);this._classes.splice(b,1);this._requestingUpdate||this._requestUpdate();return this};
b.prototype.hasClass=function(a){return-1!==this._classes.indexOf(a)};b.prototype.setAttribute=function(a,b){if(this._attributes[a]!==b||this._inDraw)this._attributes[a]=b,this._initialized&&this._changeQueue.push(c.CHANGE_ATTRIBUTE,a,b),this._requestUpdate||this._requestUpdate();return this};b.prototype.setProperty=function(a,b){if(this._styles[a]!==b||this._inDraw)this._styles[a]=b,this._initialized&&this._changeQueue.push(c.CHANGE_PROPERTY,a,b),this._requestingUpdate||this._requestUpdate(),this._renderSized&&
(this._requestRenderSize=!0);return this};b.prototype.setContent=function(a){if(this._content!==a||this._inDraw)this._content=a,this._initialized&&this._changeQueue.push(c.CHANGE_CONTENT,a),this._requestingUpdate||this._requestUpdate(),this._renderSized&&(this._requestRenderSize=!0);return this};b.prototype.on=function(a,b){return this._callbacks.on(a,b)};b.prototype.onReceive=function(a,b){"resize"===a&&(this._renderSize[0]=b.val[0],this._renderSize[1]=b.val[1],this._requestingUpdate||this._requestUpdate());
this._callbacks.trigger(a,b)};b.prototype.draw=function(){var a,b,d;this._inDraw=!0;this.init();b=0;for(d=this._classes.length;b<d;b++)this.addClass(this._classes[b]);this._content&&this.setContent(this._content);for(a in this._styles)null!=this._styles[a]&&this.setProperty(a,this._styles[a]);for(a in this._attributes)null!=this._attributes[a]&&this.setAttribute(a,this._attributes[a]);b=0;for(d=this._UIEvents.length;b<d;b++)this.onAddUIEvent(this._UIEvents[b]);this._inDraw=!1};Element.prototype.remove=
function(){this.parentElement.removeChild(this)};NodeList.prototype.remove=HTMLCollection.prototype.remove=function(){for(var a=this.length-1;0<=a;a--)this[a]&&this[a].parentElement&&this[a].parentElement.removeChild(this[a])};l.exports=b},{"../core/Commands":5,"../core/TransformSystem":16,"../utilities/CallbackStore":74}],18:[function(f,l,r){function b(b,d,c){var h=this;b.classList.add("famous-dom-renderer");g=g||e("transform");this._compositor=c;this._path=this._parent=this._target=null;this._children=
[];this._root=new a(b,d);this._boundTriggerEvent=function(a){return h._triggerEvent(a)};this._selector=d;this._elements={};this._elements[d]=this._root;this.perspectiveTransform=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this._VPtransform=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this._lastEv=null}var a=f("./ElementCache"),d=f("./Math"),c=f("../core/Path"),e=f("../utilities/vendorPrefix"),h=f("./events/EventMap"),g=null;b.prototype.subscribe=function(a){this._assertTargetLoaded();
this._listen(a);this._target.subscribe[a]=!0};b.prototype.preventDefault=function(a){this._assertTargetLoaded();this._listen(a);this._target.preventDefault[a]=!0};b.prototype.allowDefault=function(a){this._assertTargetLoaded();this._listen(a);this._target.preventDefault[a]=!1};b.prototype._listen=function(a){this._assertTargetLoaded();if(!this._target.listeners[a]&&!this._root.listeners[a]){var b=h[a][1]?this._root:this._target;b.listeners[a]=this._boundTriggerEvent;b.element.addEventListener(a,this._boundTriggerEvent)}};
b.prototype.unsubscribe=function(a){this._assertTargetLoaded();this._target.subscribe[a]=!1};b.prototype._triggerEvent=function(a){if(this._lastEv!==a){var b;if(a.path)b=a.path;else{b=[];for(var d=a.target;d!==document.body;)b.push(d),d=d.parentNode}for(d=0;d<b.length;d++)if(b[d].dataset){var c=b[d].dataset.faPath;if(c&&(this._elements[c].preventDefault[a.type]&&a.preventDefault(),this._elements[c]&&this._elements[c].subscribe[a.type])){this._lastEv=a;this._compositor.sendEvent(c,a.type,new h[a.type][0](a));
break}}}};b.prototype.getSizeOf=function(a){var b=this._elements[a];if(!b)return null;b={val:b.size};this._compositor.sendEvent(a,"resize",b);return b};b.prototype.draw=function(a){a.perspectiveDirty&&(this.perspectiveDirty=!0,this.perspectiveTransform[0]=a.perspectiveTransform[0],this.perspectiveTransform[1]=a.perspectiveTransform[1],this.perspectiveTransform[2]=a.perspectiveTransform[2],this.perspectiveTransform[3]=a.perspectiveTransform[3],this.perspectiveTransform[4]=a.perspectiveTransform[4],
this.perspectiveTransform[5]=a.perspectiveTransform[5],this.perspectiveTransform[6]=a.perspectiveTransform[6],this.perspectiveTransform[7]=a.perspectiveTransform[7],this.perspectiveTransform[8]=a.perspectiveTransform[8],this.perspectiveTransform[9]=a.perspectiveTransform[9],this.perspectiveTransform[10]=a.perspectiveTransform[10],this.perspectiveTransform[11]=a.perspectiveTransform[11],this.perspectiveTransform[12]=a.perspectiveTransform[12],this.perspectiveTransform[13]=a.perspectiveTransform[13],
this.perspectiveTransform[14]=a.perspectiveTransform[14],this.perspectiveTransform[15]=a.perspectiveTransform[15]);if(a.viewDirty||a.perspectiveDirty)d.multiply(this._VPtransform,this.perspectiveTransform,a.viewTransform),this._root.element.style[g]=this._stringifyMatrix(this._VPtransform)};b.prototype._assertPathLoaded=function(){if(!this._path)throw Error("path not loaded");};b.prototype._assertParentLoaded=function(){if(!this._parent)throw Error("parent not loaded");};b.prototype._assertChildrenLoaded=
function(){if(!this._children)throw Error("children not loaded");};b.prototype._assertTargetLoaded=function(){if(!this._target)throw Error("No target loaded");};b.prototype.findParent=function(){this._assertPathLoaded();for(var a=this._path,b;!b&&a.length;)a=a.substring(0,a.lastIndexOf("/")),b=this._elements[a];return this._parent=b};b.prototype.findTarget=function(){return this._target=this._elements[this._path]};b.prototype.loadPath=function(a){return this._path=a};b.prototype.resolveChildren=function(a,
b){for(var d=0,e,g=this._path,h;e=b.childNodes[d];)e.dataset?(h=e.dataset.faPath)?c.isDescendentOf(h,g)?a.appendChild(e):d++:d++:d++};b.prototype.insertEl=function(b){if(!this._target||this._target.element.tagName.toLowerCase()!==b.toLowerCase()){this.findParent();this._assertParentLoaded();if(this._parent["void"])throw Error(this._parent.path+" is a void element. Void elements are not allowed to have children.");this._target&&this._parent.element.removeChild(this._target.element);this._target=new a(document.createElement(b),
this._path);this.resolveChildren(this._target.element,this._parent.element);this._parent.element.appendChild(this._target.element);this._elements[this._path]=this._target}};b.prototype.setProperty=function(a,b){this._assertTargetLoaded();this._target.element.style[a]=b};b.prototype.setSize=function(a,b){this._assertTargetLoaded();this.setWidth(a);this.setHeight(b)};b.prototype.setWidth=function(a){this._assertTargetLoaded();var b=this._target.content;!1===a?(this._target.explicitWidth=!0,b&&(b.style.width=
""),a=b?b.offsetWidth:0):(this._target.explicitWidth=!1,b&&(b.style.width=a+"px"));this._target.element.style.width=a+"px";this._target.size[0]=a};b.prototype.setHeight=function(a){this._assertTargetLoaded();var b=this._target.content;!1===a?(this._target.explicitHeight=!0,b&&(b.style.height=""),a=b?b.offsetHeight:0):(this._target.explicitHeight=!1,b&&(b.style.height=a+"px"));this._target.element.style.height=a+"px";this._target.size[1]=a};b.prototype.setAttribute=function(a,b){this._assertTargetLoaded();
this._target.element.setAttribute(a,b)};b.prototype.setContent=function(a){this._assertTargetLoaded();this._target.formElement?this._target.element.value=a:(this._target.content||(this._target.content=document.createElement("div"),this._target.content.classList.add("famous-dom-element-content"),this._target.element.insertBefore(this._target.content,this._target.element.firstChild)),this._target.content.innerHTML=a);this.setSize(this._target.explicitWidth?!1:this._target.size[0],this._target.explicitHeight?
!1:this._target.size[1])};b.prototype.setMatrix=function(a){this._assertTargetLoaded();this._target.element.style[g]=this._stringifyMatrix(a)};b.prototype.addClass=function(a){this._assertTargetLoaded();this._target.element.classList.add(a)};b.prototype.removeClass=function(a){this._assertTargetLoaded();this._target.element.classList.remove(a)};b.prototype._stringifyMatrix=function(a){var b;b="matrix3d("+(1E-6>a[0]&&-1E-6<a[0]?"0,":a[0]+",");b+=1E-6>a[1]&&-1E-6<a[1]?"0,":a[1]+",";b+=1E-6>a[2]&&-1E-6<
a[2]?"0,":a[2]+",";b+=1E-6>a[3]&&-1E-6<a[3]?"0,":a[3]+",";b+=1E-6>a[4]&&-1E-6<a[4]?"0,":a[4]+",";b+=1E-6>a[5]&&-1E-6<a[5]?"0,":a[5]+",";b+=1E-6>a[6]&&-1E-6<a[6]?"0,":a[6]+",";b+=1E-6>a[7]&&-1E-6<a[7]?"0,":a[7]+",";b+=1E-6>a[8]&&-1E-6<a[8]?"0,":a[8]+",";b+=1E-6>a[9]&&-1E-6<a[9]?"0,":a[9]+",";b+=1E-6>a[10]&&-1E-6<a[10]?"0,":a[10]+",";b+=1E-6>a[11]&&-1E-6<a[11]?"0,":a[11]+",";b+=1E-6>a[12]&&-1E-6<a[12]?"0,":a[12]+",";b+=1E-6>a[13]&&-1E-6<a[13]?"0,":a[13]+",";b+=1E-6>a[14]&&-1E-6<a[14]?"0,":a[14]+",";
return b+=a[15]+")"};l.exports=b},{"../core/Path":10,"../utilities/vendorPrefix":78,"./ElementCache":19,"./Math":20,"./events/EventMap":24}],19:[function(f,l,r){var b=f("./VoidElements");l.exports=function(a,d){this.tagName=a.tagName.toLowerCase();this["void"]=b[this.tagName];var c=a.constructor;this.formElement=c===HTMLInputElement||c===HTMLTextAreaElement||c===HTMLSelectElement;this.element=a;this.path=d;this.content=null;this.size=new Int16Array(3);this.explicitWidth=this.explicitHeight=!1;this.postRenderSize=
new Float32Array(2);this.listeners={};this.preventDefault={};this.subscribe={}}},{"./VoidElements":21}],20:[function(f,l,r){l.exports={multiply:function(b,a,d){var c=a[0],e=a[1],h=a[2],g=a[3],u=a[4],k=a[5],p=a[6],q=a[7],w=a[8],t=a[9],f=a[10],m=a[11],v=a[12],x=a[13],I=a[14];a=a[15];var z=d[0],y=d[1],A=d[2],F=d[3],l=d[4],J=d[5],D=d[6],O=d[7],N=d[8],K=d[9],E=d[10],G=d[11],C=d[12],L=d[13],n=d[14];d=d[15];b[0]=z*c+y*u+A*w+F*v;b[1]=z*e+y*k+A*t+F*x;b[2]=z*h+y*p+A*f+F*I;b[3]=z*g+y*q+A*m+F*a;z=l;y=J;A=D;F=
O;b[4]=z*c+y*u+A*w+F*v;b[5]=z*e+y*k+A*t+F*x;b[6]=z*h+y*p+A*f+F*I;b[7]=z*g+y*q+A*m+F*a;z=N;y=K;A=E;F=G;b[8]=z*c+y*u+A*w+F*v;b[9]=z*e+y*k+A*t+F*x;b[10]=z*h+y*p+A*f+F*I;b[11]=z*g+y*q+A*m+F*a;z=C;y=L;A=n;F=d;b[12]=z*c+y*u+A*w+F*v;b[13]=z*e+y*k+A*t+F*x;b[14]=z*h+y*p+A*f+F*I;b[15]=z*g+y*q+A*m+F*a;return b},invert:function(b,a){var d=a[0],c=a[1],e=a[2],h=a[3],g=a[4],u=a[5],k=a[6],p=a[7],q=a[8],w=a[9],t=a[10],f=a[11],m=a[12],v=a[13],x=a[14],I=a[15],z=d*u-c*g,y=d*k-e*g,A=d*p-h*g,F=c*k-e*u,l=c*p-h*u,J=e*p-
h*k,D=q*v-w*m,O=q*x-t*m,N=q*I-f*m,K=w*x-t*v,E=w*I-f*v,G=t*I-f*x,C=z*G-y*E+A*K+F*N-l*O+J*D;if(!C)return null;C=1/C;b[0]=(u*G-k*E+p*K)*C;b[1]=(e*E-c*G-h*K)*C;b[2]=(v*J-x*l+I*F)*C;b[3]=(t*l-w*J-f*F)*C;b[4]=(k*N-g*G-p*O)*C;b[5]=(d*G-e*N+h*O)*C;b[6]=(x*A-m*J-I*y)*C;b[7]=(q*J-t*A+f*y)*C;b[8]=(g*E-u*N+p*D)*C;b[9]=(c*N-d*E-h*D)*C;b[10]=(m*l-v*A+I*z)*C;b[11]=(w*A-q*l-f*z)*C;b[12]=(u*O-g*K-k*D)*C;b[13]=(d*K-c*O+e*D)*C;b[14]=(v*y-m*F-x*z)*C;b[15]=(q*F-w*y+t*z)*C;return b}}},{}],21:[function(f,l,r){l.exports=
{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}},{}],22:[function(f,l,r){function b(b){a.call(this,b);this.data=b.data}var a=f("./UIEvent");b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.toString=function(){return"CompositionEvent"};l.exports=b},{"./UIEvent":30}],23:[function(f,l,r){function b(a){this.type=a.type;this.defaultPrevented=a.defaultPrevented;this.timeStamp=a.timeStamp;var b=a.target.constructor;
if(b===HTMLInputElement||b===HTMLTextAreaElement||b===HTMLSelectElement)this.value=a.target.value}b.prototype.toString=function(){return"Event"};l.exports=b},{}],24:[function(f,l,r){r=f("./CompositionEvent");var b=f("./Event"),a=f("./FocusEvent"),d=f("./InputEvent"),c=f("./KeyboardEvent"),e=f("./MouseEvent"),h=f("./TouchEvent"),g=f("./UIEvent");f=f("./WheelEvent");l.exports={change:[b,!0],submit:[b,!0],abort:[b,!1],beforeinput:[d,!0],blur:[a,!1],click:[e,!0],compositionend:[r,!0],compositionstart:[r,
!0],compositionupdate:[r,!0],dblclick:[e,!0],focus:[a,!1],focusin:[a,!0],focusout:[a,!0],input:[d,!0],keydown:[c,!0],keyup:[c,!0],load:[b,!1],mousedown:[e,!0],mouseenter:[e,!1],mouseleave:[e,!1],mousemove:[e,!1],mouseout:[e,!0],mouseover:[e,!0],mouseup:[e,!0],resize:[g,!1],scroll:[g,!1],select:[b,!0],unload:[b,!1],wheel:[f,!0],touchcancel:[h,!0],touchend:[h,!0],touchmove:[h,!0],touchstart:[h,!0]}},{"./CompositionEvent":22,"./Event":23,"./FocusEvent":25,"./InputEvent":26,"./KeyboardEvent":27,"./MouseEvent":28,
"./TouchEvent":29,"./UIEvent":30,"./WheelEvent":31}],25:[function(f,l,r){function b(b){a.call(this,b)}var a=f("./UIEvent");b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.toString=function(){return"FocusEvent"};l.exports=b},{"./UIEvent":30}],26:[function(f,l,r){function b(b){a.call(this,b);this.inputType=b.inputType;this.data=b.data;this.isComposing=b.isComposing;this.targetRange=b.targetRange}var a=f("./UIEvent");b.prototype=Object.create(a.prototype);b.prototype.constructor=
b;b.prototype.toString=function(){return"InputEvent"};l.exports=b},{"./UIEvent":30}],27:[function(f,l,r){function b(b){a.call(this,b);this.DOM_KEY_LOCATION_STANDARD=0;this.DOM_KEY_LOCATION_LEFT=1;this.DOM_KEY_LOCATION_RIGHT=2;this.DOM_KEY_LOCATION_NUMPAD=3;this.key=b.key;this.code=b.code;this.location=b.location;this.ctrlKey=b.ctrlKey;this.shiftKey=b.shiftKey;this.altKey=b.altKey;this.metaKey=b.metaKey;this.repeat=b.repeat;this.isComposing=b.isComposing;this.keyCode=b.keyCode}var a=f("./UIEvent");
b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.toString=function(){return"KeyboardEvent"};l.exports=b},{"./UIEvent":30}],28:[function(f,l,r){function b(b){a.call(this,b);this.screenX=b.screenX;this.screenY=b.screenY;this.clientX=b.clientX;this.clientY=b.clientY;this.ctrlKey=b.ctrlKey;this.shiftKey=b.shiftKey;this.altKey=b.altKey;this.metaKey=b.metaKey;this.button=b.button;this.buttons=b.buttons;this.pageX=b.pageX;this.pageY=b.pageY;this.x=b.x;this.y=b.y;this.offsetX=
b.offsetX;this.offsetY=b.offsetY}var a=f("./UIEvent");b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.toString=function(){return"MouseEvent"};l.exports=b},{"./UIEvent":30}],29:[function(f,l,r){function b(a){this.identifier=a.identifier;this.screenX=a.screenX;this.screenY=a.screenY;this.clientX=a.clientX;this.clientY=a.clientY;this.pageX=a.pageX;this.pageY=a.pageY}function a(a){if(!a)return e;for(var d=[],c=0;c<a.length;c++)d[c]=new b(a[c]);return d}function d(b){c.call(this,
b);this.touches=a(b.touches);this.targetTouches=a(b.targetTouches);this.changedTouches=a(b.changedTouches);this.altKey=b.altKey;this.metaKey=b.metaKey;this.ctrlKey=b.ctrlKey;this.shiftKey=b.shiftKey}var c=f("./UIEvent"),e=[];d.prototype=Object.create(c.prototype);d.prototype.constructor=d;d.prototype.toString=function(){return"TouchEvent"};l.exports=d},{"./UIEvent":30}],30:[function(f,l,r){function b(b){a.call(this,b);this.detail=b.detail}var a=f("./Event");b.prototype=Object.create(a.prototype);
b.prototype.constructor=b;b.prototype.toString=function(){return"UIEvent"};l.exports=b},{"./Event":23}],31:[function(f,l,r){function b(b){a.call(this,b);this.DOM_DELTA_PIXEL=0;this.DOM_DELTA_LINE=1;this.DOM_DELTA_PAGE=2;this.deltaX=b.deltaX;this.deltaY=b.deltaY;this.deltaZ=b.deltaZ;this.deltaMode=b.deltaMode}var a=f("./MouseEvent");b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.toString=function(){return"WheelEvent"};l.exports=b},{"./MouseEvent":28}],32:[function(f,l,
r){function b(a){this.values=a||[1,0,0,0,1,0,0,0,1]}b.prototype.get=function(){return this.values};b.prototype.set=function(a){this.values=a;return this};b.prototype.copy=function(a){var b=this.values;a=a.values;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return this};b.prototype.vectorMultiply=function(a,b){var c=this.values,e=a.x,h=a.y,g=a.z;b.x=c[0]*e+c[1]*h+c[2]*g;b.y=c[3]*e+c[4]*h+c[5]*g;b.z=c[6]*e+c[7]*h+c[8]*g;return b};b.prototype.multiply=function(a){var b=
this.values,c=a.values;a=b[0];var e=b[1],h=b[2],g=b[3],u=b[4],k=b[5],p=b[6],q=b[7],w=b[8],t=c[0],f=c[1],m=c[2],v=c[3],x=c[4],I=c[5],z=c[6],y=c[7],c=c[8];b[0]=a*t+e*v+h*z;b[1]=a*f+e*x+h*y;b[2]=a*m+e*I+h*c;b[3]=g*t+u*v+k*z;b[4]=g*f+u*x+k*y;b[5]=g*m+u*I+k*c;b[6]=p*t+q*v+w*z;b[7]=p*f+q*x+w*y;b[8]=p*m+q*I+w*c;return this};b.prototype.transpose=function(){var a=this.values,b=a[1],c=a[2],e=a[5],h=a[6],g=a[7];a[1]=a[3];a[2]=h;a[3]=b;a[5]=g;a[6]=c;a[7]=e;return this};b.prototype.getDeterminant=function(){var a=
this.values,b=a[3],c=a[4],e=a[5],h=a[6],g=a[7],u=a[8];return a[0]*(c*u-e*g)-a[1]*(b*u-e*h)+a[2]*(b*g-c*h)};b.prototype.inverse=function(){var a=this.values,b=a[0],c=a[1],e=a[2],h=a[3],g=a[4],u=a[5],k=a[6],p=a[7],q=a[8],w=b*(g*q-u*p)-c*(h*q-u*k)+e*(h*p-g*k);if(1E-40>Math.abs(w))return null;w=1/w;a[0]=(g*q-u*p)*w;a[3]=(-h*q+u*k)*w;a[6]=(h*p-g*k)*w;a[1]=(-c*q+e*p)*w;a[4]=(b*q-e*k)*w;a[7]=(-b*p+c*k)*w;a[2]=(c*u-e*g)*w;a[5]=(-b*u+e*h)*w;a[8]=(b*g-c*h)*w;return this};b.clone=function(a){return new b(a.values.slice())};
b.inverse=function(a,b){var c=a.values,e=b.values,h=c[0],g=c[1],u=c[2],k=c[3],p=c[4],q=c[5],w=c[6],t=c[7],c=c[8],f=h*(p*c-q*t)-g*(k*c-q*w)+u*(k*t-p*w);if(1E-40>Math.abs(f))return null;f=1/f;e[0]=(p*c-q*t)*f;e[3]=(-k*c+q*w)*f;e[6]=(k*t-p*w)*f;e[1]=(-g*c+u*t)*f;e[4]=(h*c-u*w)*f;e[7]=(-h*t+g*w)*f;e[2]=(g*q-u*p)*f;e[5]=(-h*q+u*k)*f;e[8]=(h*p-g*k)*f;return b};b.transpose=function(a,b){var c=a.values,e=b.values,h=c[1],g=c[2],u=c[3],k=c[4],p=c[5],q=c[6],w=c[7],t=c[8];e[0]=c[0];e[1]=u;e[2]=q;e[3]=h;e[4]=
k;e[5]=w;e[6]=g;e[7]=p;e[8]=t;return b};b.add=function(a,b,c){a=a.values;b=b.values;var e=c.values,h=a[1],g=a[2],u=a[3],k=a[4],p=a[5],q=a[6],w=a[7],t=a[8],f=b[1],m=b[2],v=b[3],x=b[4],I=b[5],z=b[6],y=b[7],A=b[8];e[0]=a[0]+b[0];e[1]=h+f;e[2]=g+m;e[3]=u+v;e[4]=k+x;e[5]=p+I;e[6]=q+z;e[7]=w+y;e[8]=t+A;return c};b.subtract=function(a,b,c){a=a.values;b=b.values;var e=c.values,h=a[1],g=a[2],u=a[3],k=a[4],p=a[5],q=a[6],w=a[7],t=a[8],f=b[1],m=b[2],v=b[3],x=b[4],I=b[5],z=b[6],y=b[7],A=b[8];e[0]=a[0]-b[0];e[1]=
h-f;e[2]=g-m;e[3]=u-v;e[4]=k-x;e[5]=p-I;e[6]=q-z;e[7]=w-y;e[8]=t-A;return c};b.multiply=function(a,b,c){var e=a.values,h=b.values;b=c.values;a=e[0];var g=e[1],u=e[2],k=e[3],p=e[4],q=e[5],w=e[6],t=e[7],e=e[8],f=h[0],m=h[1],v=h[2],x=h[3],I=h[4],z=h[5],y=h[6],A=h[7],h=h[8];b[0]=a*f+g*x+u*y;b[1]=a*m+g*I+u*A;b[2]=a*v+g*z+u*h;b[3]=k*f+p*x+q*y;b[4]=k*m+p*I+q*A;b[5]=k*v+p*z+q*h;b[6]=w*f+t*x+e*y;b[7]=w*m+t*I+e*A;b[8]=w*v+t*z+e*h;return c};l.exports=b},{}],33:[function(f,l,r){function b(a,b,d,c){this.w=a||
1;this.x=b||0;this.y=d||0;this.z=c||0}var a=Math.sin,d=Math.cos,c=Math.asin,e=Math.acos,h=Math.atan2,g=Math.sqrt;b.prototype.multiply=function(a){var b=this.x,d=this.y,c=this.z,e=this.w,g=a.x,h=a.y,m=a.z;a=a.w||0;this.w=e*a-b*g-d*h-c*m;this.x=b*a+g*e+h*c-d*m;this.y=d*a+h*e+b*m-g*c;this.z=c*a+m*e+g*d-b*h;return this};b.prototype.leftMultiply=function(a){var b=a.x,d=a.y,c=a.z;a=a.w||0;var e=this.x,g=this.y,h=this.z,m=this.w;this.w=a*m-b*e-d*g-c*h;this.x=b*m+e*a+g*c-d*h;this.y=d*m+g*a+b*h-e*c;this.z=
c*m+h*a+e*d-b*g;return this};b.prototype.rotateVector=function(a,b){var d=this.w,c=-this.x,e=-this.y,g=-this.z,h=a.x,m=a.y,v=a.z,x=-c*h-e*m-g*v,f=h*d+m*g-e*v,z=m*d+c*v-h*g,h=v*d+h*e-c*m,c=-c,e=-e,g=-g;b.x=f*d+c*x+e*h-z*g;b.y=z*d+e*x+f*g-c*h;b.z=h*d+g*x+c*z-f*e;return b};b.prototype.invert=function(){this.w=-this.w;this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};b.prototype.conjugate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};b.prototype.length=function(){var a=
this.w,b=this.x,d=this.y,c=this.z;return g(a*a+b*b+d*d+c*c)};b.prototype.normalize=function(){var a=this.w,b=this.x,d=this.y,c=this.z,a=g(a*a+b*b+d*d+c*c);if(0===a)return this;a=1/a;this.w*=a;this.x*=a;this.y*=a;this.z*=a;return this};b.prototype.set=function(a,b,d,c){null!=a&&(this.w=a);null!=b&&(this.x=b);null!=d&&(this.y=d);null!=c&&(this.z=c);return this};b.prototype.copy=function(a){this.w=a.w;this.x=a.x;this.y=a.y;this.z=a.z;return this};b.prototype.clear=function(){this.w=1;this.z=this.y=this.x=
0;return this};b.prototype.dot=function(a){return this.w*a.w+this.x*a.x+this.y*a.y+this.z*a.z};b.prototype.slerp=function(b,d,c){var g=this.w,h=this.x,t=this.y,f=this.z,m=b.w,v=b.x,x=b.y;b=b.z;var I,z,y;z=g*m+h*v+t*x+f*b;1E-5<1-z?(I=e(z),y=a(I),z=a((1-d)*I)/y,d=a(d*I)/y):z=1-d;c.w=g*z+m*d;c.x=h*z+v*d;c.y=t*z+x*d;c.z=f*z+b*d;return c};b.prototype.toMatrix=function(a){var b=this.w,d=this.x,c=this.y,e=this.z,g=d*d,h=c*c,m=e*e,v=d*c,x=d*e,f=c*e;return a.set([1-2*(h+m),2*(v-b*e),2*(x+b*c),2*(v+b*e),1-
2*(g+m),2*(f-b*d),2*(x-b*c),2*(f+b*d),1-2*(g+h)])};b.prototype.toEuler=function(a){var b=this.w,d=this.x,e=this.y,g=this.z,t=e*e,f=g*g,m=2*(d*g+e*b),m=-1>m?-1:1<m?1:m;a.x=h(2*(d*b-e*g),1-2*(d*d+t));a.y=c(m);a.z=h(2*(g*b-d*e),1-2*(t+f));return a};b.prototype.fromEuler=function(b,c,e){var g=.5*b,h=.5*c,t=.5*e;e=a(g);c=a(h);b=a(t);g=d(g);h=d(h);t=d(t);this.w=g*h*t-e*c*b;this.x=e*h*t+g*c*b;this.y=g*c*t-e*h*b;this.z=g*h*b+e*c*t;return this};b.prototype.fromAngleAxis=function(b,c,e,h){var f=g(c*c+e*e+h*
h);if(0===f)this.w=1,this.x=this.y=this.z=0;else{f=1/f;b*=.5;var t=a(b);this.w=d(b);this.x=t*c*f;this.y=t*e*f;this.z=t*h*f}return this};b.multiply=function(a,b,d){var c=a.w||0,e=a.x,g=a.y;a=a.z;var h=b.w||0,m=b.x,v=b.y;b=b.z;d.w=c*h-e*m-g*v-a*b;d.x=e*h+m*c+v*a-g*b;d.y=g*h+v*c+e*b-m*a;d.z=a*h+b*c+m*g-e*v;return d};b.normalize=function(a,b){var d=a.w,c=a.x,e=a.y,h=a.z,d=g(d*d+c*c+e*e+h*h);if(0===d)return this;d=1/d;b.w*=d;b.x*=d;b.y*=d;b.z*=d;return b};b.conjugate=function(a,b){b.w=a.w;b.x=-a.x;b.y=
-a.y;b.z=-a.z;return b};b.clone=function(a){return new b(a.w,a.x,a.y,a.z)};b.dot=function(a,b){return a.w*b.w+a.x*b.x+a.y*b.y+a.z*b.z};l.exports=b},{}],34:[function(f,l,r){var b=function(a,b){a instanceof Array||a instanceof Float32Array?(this.x=a[0]||0,this.y=a[1]||0):(this.x=a||0,this.y=b||0)};b.prototype.set=function(a,b){null!=a&&(this.x=a);null!=b&&(this.y=b);return this};b.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};b.prototype.subtract=function(a){this.x-=a.x;this.y-=a.y;
return this};b.prototype.scale=function(a){a instanceof b?(this.x*=a.x,this.y*=a.y):(this.x*=a,this.y*=a);return this};b.prototype.rotate=function(a){var b=this.x,c=this.y,e=Math.cos(a);a=Math.sin(a);this.x=b*e-c*a;this.y=b*a+c*e;return this};b.prototype.dot=function(a){return this.x*a.x+this.y*a.y};b.prototype.cross=function(a){return this.x*a.y-this.y*a.x};b.prototype.invert=function(){this.x*=-1;this.y*=-1;return this};b.prototype.map=function(a){this.x=a(this.x);this.y=a(this.y);return this};
b.prototype.length=function(){var a=this.x,b=this.y;return Math.sqrt(a*a+b*b)};b.prototype.copy=function(a){this.x=a.x;this.y=a.y;return this};b.prototype.clear=function(){this.y=this.x=0;return this};b.prototype.isZero=function(){return 0!==this.x||0!==this.y?!1:!0};b.prototype.toArray=function(){return[this.x,this.y]};b.normalize=function(a,b){var c=a.x,e=a.y,c=Math.sqrt(c*c+e*e)||1,c=1/c;b.x=a.x*c;b.y=a.y*c;return b};b.clone=function(a){return new b(a.x,a.y)};b.add=function(a,b,c){c.x=a.x+b.x;
c.y=a.y+b.y;return c};b.subtract=function(a,b,c){c.x=a.x-b.x;c.y=a.y-b.y;return c};b.scale=function(a,b,c){c.x=a.x*b;c.y=a.y*b;return c};b.dot=function(a,b){return a.x*b.x+a.y*b.y};b.cross=function(a,b){return a.x*b.y-a.y*b.x};l.exports=b},{}],35:[function(f,l,r){var b=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};b.prototype.set=function(a,b,c){null!=a&&(this.x=a);null!=b&&(this.y=b);null!=c&&(this.z=c);return this};b.prototype.add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this};
b.prototype.subtract=function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this};b.prototype.rotateX=function(a){var b=this.y,c=this.z,e=Math.cos(a);a=Math.sin(a);this.y=b*e-c*a;this.z=b*a+c*e;return this};b.prototype.rotateY=function(a){var b=this.x,c=this.z,e=Math.cos(a);a=Math.sin(a);this.x=c*a+b*e;this.z=c*e-b*a;return this};b.prototype.rotateZ=function(a){var b=this.x,c=this.y,e=Math.cos(a);a=Math.sin(a);this.x=b*e-c*a;this.y=b*a+c*e;return this};b.prototype.dot=function(a){return this.x*a.x+
this.y*a.y+this.z*a.z};b.prototype.cross=function(a){var b=this.x,c=this.y,e=this.z,h=a.x,g=a.y;a=a.z;this.x=c*a-e*g;this.y=e*h-b*a;this.z=b*g-c*h;return this};b.prototype.scale=function(a){this.x*=a;this.y*=a;this.z*=a;return this};b.prototype.invert=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};b.prototype.map=function(a){this.x=a(this.x);this.y=a(this.y);this.z=a(this.z);return this};b.prototype.length=function(){var a=this.x,b=this.y,c=this.z;return Math.sqrt(a*a+b*b+c*
c)};b.prototype.lengthSq=function(){var a=this.x,b=this.y,c=this.z;return a*a+b*b+c*c};b.prototype.copy=function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this};b.prototype.clear=function(){this.z=this.y=this.x=0;return this};b.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z};b.prototype.toArray=function(){return[this.x,this.y,this.z]};b.prototype.normalize=function(){var a=this.x,b=this.y,c=this.z,a=Math.sqrt(a*a+b*b+c*c)||1,a=1/a;this.x*=a;this.y*=a;this.z*=a;return this};
b.prototype.applyRotation=function(a){var b=a.w,c=-a.x,e=-a.y,h=-a.z,g=this.x,f=this.y,k=this.z;a=-c*g-e*f-h*k;var p=g*b+f*h-e*k,q=f*b+c*k-g*h,g=k*b+g*e-c*f,c=-c,e=-e,h=-h;this.x=p*b+c*a+e*g-q*h;this.y=q*b+e*a+p*h-c*g;this.z=g*b+h*a+c*q-p*e;return this};b.prototype.applyMatrix=function(a){a=a.get();var b=this.x,c=this.y,e=this.z;this.x=a[0]*b+a[1]*c+a[2]*e;this.y=a[3]*b+a[4]*c+a[5]*e;this.z=a[6]*b+a[7]*c+a[8]*e;return this};b.normalize=function(a,b){var c=a.x,e=a.y,h=a.z,g=Math.sqrt(c*c+e*e+h*h)||
1,g=1/g;b.x=c*g;b.y=e*g;b.z=h*g;return b};b.applyRotation=function(a,b,c){var e=b.w,h=-b.x,g=-b.y;b=-b.z;var f=a.x,k=a.y,p=a.z;a=-h*f-g*k-b*p;var q=f*e+k*b-g*p,w=k*e+h*p-f*b,f=p*e+f*g-h*k,h=-h,g=-g;b=-b;c.x=q*e+h*a+g*f-w*b;c.y=w*e+g*a+q*b-h*f;c.z=f*e+b*a+h*w-q*g;return c};b.clone=function(a){return new b(a.x,a.y,a.z)};b.add=function(a,b,c){c.x=a.x+b.x;c.y=a.y+b.y;c.z=a.z+b.z;return c};b.subtract=function(a,b,c){c.x=a.x-b.x;c.y=a.y-b.y;c.z=a.z-b.z;return c};b.scale=function(a,b,c){c.x=a.x*b;c.y=a.y*
b;c.z=a.z*b;return c};b.dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z};b.cross=function(a,b,c){var e=a.x,h=a.y;a=a.z;var g=b.x,f=b.y;b=b.z;c.x=h*b-a*f;c.y=a*g-e*b;c.z=e*f-h*g;return c};b.project=function(a,b,c){var e=b.x,h=b.y;b=b.z;a=a.x*e+a.y*h+a.z*b;a/=e*e+h*h+b*b;c.x=e*a;c.y=h*a;c.z=b*a;return c};l.exports=b},{}],36:[function(f,l,r){l.exports={Mat33:f("./Mat33"),Quaternion:f("./Quaternion"),Vec2:f("./Vec2"),Vec3:f("./Vec3")}},{"./Mat33":32,"./Quaternion":33,"./Vec2":34,"./Vec3":35}],37:[function(f,
l,r){function b(a,b,d){var c=q;g.cross(a,b,c);g.cross(c,d,c);return c}function a(a,b){for(var d,c=-Infinity,e,m,h,v=0;v<a.length;v++)m=a[v],e=g.dot(m,b),e>c&&(d=m,c=e,h=v);return{vertex:d,index:h}}function d(a,b,d){this.distance=a;this.normal=b;this.vertexIndices=d}function c(){this.vertices=[];this.numVertices=0;this.features=[];this.lastVertexIndex=this.numFeatures=0;this._IDPool={vertices:[],features:[]}}function e(a,b,d,c){for(var e=a[d].vertex,g=a[c].vertex,m=0,h=b.length;m<h;m++){var v=b[m];
if(v){var p=a[v[0]].vertex,v=a[v[1]].vertex;if(e===p&&g===v||e===v&&g===p){b[m]=null;return}}}b.push([d,c])}function h(a,b,d,c,e){var m=a+b;c[0]=m+d;var g=a*a,m=g+b*m;c[1]=m+d*c[0];c[2]=a*g+b*m+d*c[1];e[0]=c[1]+a*(c[0]+a);e[1]=c[1]+b*(c[0]+b);e[2]=c[1]+d*(c[0]+d)}var g=f("../math/Vec3"),u=f("../math/Mat33");f=f("../utilities/ObjectManager");f.register("DynamicGeometry",c);f.register("DynamicGeometryFeature",d);var k=f.requestDynamicGeometryFeature,p=f.freeDynamicGeometryFeature,q=new g,w=new g,t=
new g,B=new g,m=new g,v=new g,x=new g,I=new g,z=new g;d.prototype.reset=function(a,b,c){this.distance=a;this.normal=b;this.vertexIndices=c;return this};c.prototype.reset=function(){this.vertices=[];this.numVertices=0;this.features=[];this.lastVertexIndex=this.numFeatures=0;this._IDPool={vertices:[],features:[]};return this};c.prototype.addVertex=function(a){var b=this._IDPool.vertices.length?this._IDPool.vertices.pop():this.vertices.length;this.vertices[b]=a;this.lastVertexIndex=b;this.numVertices++};
c.prototype.removeVertex=function(a){var b=this.vertices[a];this.vertices[a]=null;this._IDPool.vertices.push(a);this.numVertices--;return b};c.prototype.addFeature=function(a,b,c){var d=this._IDPool.features.length?this._IDPool.features.pop():this.features.length;this.features[d]=k().reset(a,b,c);this.numFeatures++};c.prototype.removeFeature=function(a){var b=this.features[a];this.features[a]=null;this._IDPool.features.push(a);this.numFeatures--;p(b)};c.prototype.getLastVertex=function(){return this.vertices[this.lastVertexIndex]};
c.prototype.getFeatureClosestToOrigin=function(){for(var a=Infinity,b=null,c=this.features,d=0,e=c.length;d<e;d++){var m=c[d];m&&m.distance<a&&(a=m.distance,b=m)}return b};c.prototype.reshape=function(a){var b=this.vertices,c=this.getLastVertex().vertex,d=this.features,h,p,x,f,k=[];x=0;for(f=d.length;x<f;x++)d[x]&&(p=d[x].vertexIndices,h=b[p[0]].vertex,-.001<g.dot(d[x].normal,g.subtract(c,h,t))&&(e(b,k,p[0],p[1]),e(b,k,p[1],p[2]),e(b,k,p[2],p[0]),this.removeFeature(x)));h=this.lastVertexIndex;d=0;
for(f=k.length;d<f;d++)if(k[d]){p=k[d][0];x=k[d][1];var q=b[x].vertex,u=g.subtract(b[p].vertex,c,m),q=g.subtract(q,c,v),u=g.cross(u,q,new g);u.normalize();a?(q=g.subtract(a,c,w),-.001<g.dot(u,q)&&u.invert(),this.addFeature(null,u,[h,p,x])):(q=g.dot(u,c),0>q&&(u.invert(),q*=-1),this.addFeature(q,u,[h,p,x]))}};c.prototype.simplexContainsOrigin=function(a,d){var c=this.vertices.length,e=this.lastVertexIndex,h=e-1,p=e-2,f=e-3,h=0>h?h+c:h,p=0>p?p+c:p,f=0>f?f+c:f,k=this.vertices[e].vertex,t=this.vertices[h].vertex,
q=this.vertices[p].vertex,w=this.vertices[f].vertex,u=g.scale(k,-1,B),l=g.subtract(t,k,m),n,H,M;if(4===c){n=g.subtract(q,k,v);H=g.subtract(w,k,x);k=g.cross(l,n,new g);c=g.cross(n,H,new g);M=g.cross(l,H,new g);k.normalize();c.normalize();M.normalize();0<g.dot(k,H)&&k.invert();0<g.dot(c,l)&&c.invert();0<g.dot(M,n)&&M.invert();n=g.dot(k,u);H=g.dot(c,u);u=g.dot(M,u);if(.001>n&&.001>u&&.001>H)return q=g.subtract(q,t,I),w=g.subtract(w,t,z),w=g.cross(q,w,new g),w.normalize(),0>=g.dot(w,l)&&w.invert(),t=
-1*g.dot(w,t),this.addFeature(-n,k,[e,h,p]),this.addFeature(-H,c,[e,p,f]),this.addFeature(-u,M,[e,f,h]),this.addFeature(-t,w,[h,p,f]),!0;.001<=n?(H=this.removeVertex(f),a.copy(k)):.001<=H?(H=this.removeVertex(h),a.copy(c)):(H=this.removeVertex(p),a.copy(M))}else 3===c?(n=g.subtract(q,k,v),g.cross(l,n,a),0>=g.dot(a,u)&&a.invert()):a.copy(b(l,u,l));H&&d&&d(H);return!1};l.exports={DynamicGeometry:c,ConvexHull:function(d,e){var p=e||1E3,f=new c;f.addVertex(a(d,new g(1,0,0)));f.addVertex(a(d,new g(-1,
0,0)));var k=f.vertices[0].vertex,t=f.vertices[1].vertex,q=g.subtract(t,k,m),B,l,E,G,C,r=-Infinity;for(C=0;C<d.length;C++)if(l=d[C],l!==k&&l!==t){var n=g.subtract(l,k,w);B=g.dot(n,b(q,n,q));B=0>B?-1*B:B;B>r&&(r=B,E=l,G=C)}f.addVertex({vertex:E,index:G});var n=E,H=g.subtract(n,k,v),M=g.cross(q,H,new g);M.normalize();r=-Infinity;for(C=0;C<d.length;C++)l=d[C],l!==k&&l!==t&&l!==n&&(B=g.dot(g.subtract(l,k,w),M),B=0>B?-1*B:B,B>r&&(r=B,E=l,G=C));f.addVertex({vertex:E,index:G});C=g.subtract(E,k,x);r=g.subtract(n,
t,I);B=g.subtract(E,t,z);G=g.cross(H,C,new g);l=g.cross(q,C,new g);r=g.cross(r,B,new g);G.normalize();l.normalize();r.normalize();0<g.dot(M,C)&&M.invert();0<g.dot(G,q)&&G.invert();0<g.dot(l,H)&&l.invert();0>g.dot(r,q)&&r.invert();f.addFeature(null,M,[0,1,2]);f.addFeature(null,G,[0,2,3]);f.addFeature(null,l,[0,1,3]);f.addFeature(null,r,[1,2,3]);H={};C=0;for(q=f.vertices.length;C<q;C++)H[f.vertices[C].index]=!0;t=new g(k.x+t.x+n.x+E.x,k.y+t.y+n.y+E.y,k.z+t.z+n.z+E.z);t.scale(.25);n=f.features;for(M=
0;M++<p;){l=null;C=0;for(q=n.length;C<q;C++)n[C]&&!n[C].done&&(l=n[C],k=f.vertices[l.vertexIndices[0]].vertex,r=a(d,l.normal),E=r.vertex,G=r.index,.001>g.dot(g.subtract(E,k,w),l.normal)||H[G]?l.done=!0:(H[G]=!0,f.addVertex(r),f.reshape(t)));if(null===l)break}p=[];k=0;for(n=f.features.length;k<n;k++)(t=f.features[k])&&p.push(t.vertexIndices);t=f.vertices;k=[0,0,0,0,0,0,0,0,0,0];q=[];E=[];G=[];H=[];M=[];l=[];C=0;for(n=p.length;C<n;C++){var R=t[p[C][0]].vertex,Y=t[p[C][1]].vertex,r=t[p[C][2]].vertex;
B=g.subtract(Y,R,m);var W=g.subtract(r,R,v),T=B.cross(W);0>g.dot(R,T)&&T.invert();B=T.x;var W=T.y,T=T.z,V=R.x,aa=R.y,R=R.z,S=Y.x,U=Y.y,Y=Y.z,da=r.x,ea=r.y,r=r.z;h(V,S,da,q,H);h(aa,U,ea,E,M);h(R,Y,r,G,l);k[0]+=B*q[0];k[1]+=B*q[1];k[2]+=W*E[1];k[3]+=T*G[1];k[4]+=B*q[2];k[5]+=W*E[2];k[6]+=T*G[2];k[7]+=B*(aa*H[0]+U*H[1]+ea*H[2]);k[8]+=W*(R*M[0]+Y*M[1]+r*M[2]);k[9]+=T*(V*l[0]+S*l[1]+da*l[2])}k[0]/=6;k[1]/=24;k[2]/=24;k[3]/=24;k[4]/=60;k[5]/=60;k[6]/=60;k[7]/=120;k[8]/=120;k[9]/=120;q=Infinity;E=-Infinity;
G=Infinity;H=-Infinity;M=Infinity;l=-Infinity;C=0;for(n=t.length;C<n;C++)r=t[C].vertex,r.x<q&&(q=r.x),r.x>E&&(E=r.x),r.y<G&&(G=r.y),r.y>H&&(H=r.y),r.z<M&&(M=r.z),r.z>l&&(l=r.z);t=[E-q,H-G,l-M];C=k[0];n=new g(k[1],k[2],k[3]);n.scale(1/C);k=new u([k[4],k[7],k[9],k[7],k[5],k[8],k[9],k[8],k[6]]);t={size:t,volume:C,centroid:n,eulerTensor:k};q=t.centroid;C=[];k=0;for(n=f.vertices.length;k<n;k++)C.push(g.subtract(f.vertices[k].vertex,q,new g));f=[];k=0;for(n=C.length;k<n;k++)f.push(g.normalize(C[k],new g));
n={};q={};for(k=0;k<p.length;k++)E=p[k][0],G=p[k][1],H=p[k][2],q[E]=q[E]||{},q[G]=q[G]||{},q[H]=q[H]||{},n[E]=n[E]||[],n[G]=n[G]||[],n[H]=n[H]||[],q[E][G]||(q[E][G]=1,n[E].push(G)),q[E][H]||(q[E][H]=1,n[E].push(H)),q[G][E]||(q[G][E]=1,n[G].push(E)),q[G][H]||(q[G][H]=1,n[G].push(H)),q[H][E]||(q[H][E]=1,n[H].push(E)),q[H][G]||(q[H][G]=1,n[H].push(G));this.indices=p;this.vertices=C;this.normals=f;this.polyhedralProperties=t;this.graph=n}}},{"../math/Mat33":32,"../math/Vec3":35,"../utilities/ObjectManager":75}],
38:[function(f,l,r){function b(a){this.events=new g;a=a||{};this.bodies=[];this.forces=[];this.constraints=[];this.step=a.step||1E3/60;this.iterations=a.iterations||10;this._indexPools={bodies:[],forces:[],constraints:[]};this._entityMaps={bodies:{},forces:{},constraints:{}};this.speed=a.speed||1;this.delta=this.time=0;this.origin=a.origin||new u;this.orientation=a.orientation?a.orientation.normalize():new k;this.frameDependent=a.frameDependent||!1;this.transformBuffers={position:[0,0,0],rotation:[0,
0,0,1]}}function a(a,b,d){var c=a._entityMaps[d];if(null==c[b._ID]){var e=a[d];a=a._indexPools[d];c[b._ID]=a.length?a.pop():e.length;e[c[b._ID]]=b}}function d(a,b,d){var c=a._entityMaps[d],e=c[b._ID];null!=e&&(a._indexPools[d].push(e),a[d][e]=null,c[b._ID]=null)}var c=f("./bodies/Particle"),e=f("./constraints/Constraint"),h=f("./forces/Force"),g=f("../utilities/CallbackStore"),u=f("../math/Vec3"),k=f("../math/Quaternion"),p=new u,q=new k,w=new u;b.prototype.on=function(a,b){this.events.on(a,b);return this};
b.prototype.off=function(a,b){this.events.off(a,b);return this};b.prototype.trigger=function(a,b){this.events.trigger(a,b);return this};b.prototype.setOrigin=function(a,b,d){this.origin.set(a,b,d);return this};b.prototype.setOrientation=function(a,b,d,c){this.orientation.set(a,b,d,c).normalize();return this};b.prototype.add=function(){for(var a=0,b=arguments.length;a<b;a++){var d=arguments[a];if(d instanceof Array)for(var g=0,k=d.length;g<k;g++)this.add(d[g]);else d instanceof c?this.addBody(d):d instanceof
e?this.addConstraint(d):d instanceof h&&this.addForce(d)}return this};b.prototype.remove=function(){for(var a=0,b=arguments.length;a<b;a++){var d=arguments[a];if(d instanceof Array)for(var g=0,k=d.length;g<k;g++)this.add(d[g]);else d instanceof c?this.removeBody(d):d instanceof e?this.removeConstraint(d):d instanceof h&&this.removeForce(d)}return this};b.prototype.addBody=function(b){a(this,b,"bodies")};b.prototype.addForce=function(b){a(this,b,"forces")};b.prototype.addConstraint=function(b){a(this,
b,"constraints");return b};b.prototype.removeBody=function(a){d(this,a,"bodies")};b.prototype.removeForce=function(a){d(this,a,"forces")};b.prototype.removeConstraint=function(a){d(this,a,"constraints")};b.prototype.update=function(a){0===this.time&&(this.time=a);var b=this.bodies,d=this.forces,c=this.constraints,e=this.frameDependent,g=this.step,h=.001*g,k=this.delta,k=k+(a-this.time)*this.speed;this.time=a;for(var p,f,q;k>g;){this.events.trigger("prestep",a);for(p=0;p<d.length;p++)f=d[p],null!=
f&&f.update(a,h);for(p=0;p<b.length;p++)q=b[p],null!=q&&(f=q,q=h,f.momentum.add(u.scale(f.force,q,w)),f.angularMomentum.add(u.scale(f.torque,q,w)),u.scale(f.momentum,f.inverseMass,f.velocity),f.inverseInertia.vectorMultiply(f.angularMomentum,f.angularVelocity),f.force.clear(),f.torque.clear());for(p=0;p<c.length;p++)q=c[p],null!=q&&q.update(a,h);for(var l=0,D=this.iterations;l<D;l++)for(p=0,f=c.length;p<f;p++)q=c[p],null!==q&&q.resolve(a,h);p=0;for(f=b.length;p<f;p++)if(q=b[p],null!==q){l=h;if(0!==
q.restrictions){var D=q.restrictions,r=null,N=null,K=null,E=null,G=null,C=null;D&32&&(r=0);D&16&&(N=0);D&8&&(K=0);D&4&&(E=0);D&2&&(G=0);D&1&&(C=0);null===r&&null===N&&null===K||q.setVelocity(r,N,K);null===E&&null===G&&null===C||q.setAngularVelocity(E,G,C)}q.position.add(u.scale(q.velocity,l,w));var K=q.angularVelocity,D=q.orientation,r=K.x,N=K.y,K=K.z,E=D.w,G=D.x,C=D.y,L=D.z,l=.5*l;D.w+=(-r*G-N*C-K*L)*l;D.x+=(r*E+N*L-K*C)*l;D.y+=(N*E+K*G-r*L)*l;D.z+=(K*E+r*C-N*G)*l;D.normalize();q.updateInertia()}this.events.trigger("poststep",
a);k=e?0:k-g}this.delta=k};b.prototype.getTransform=function(a){var b=this.origin,d=this.orientation,c=this.transformBuffers,e=a.position,g=a=a.orientation,h=e;1!==d.w&&(g=k.multiply(a,d,q),h=d.rotateVector(e,p));c.position[0]=b.x+h.x;c.position[1]=b.y+h.y;c.position[2]=b.z+h.z;c.rotation[0]=g.x;c.rotation[1]=g.y;c.rotation[2]=g.z;c.rotation[3]=g.w;return c};l.exports=b},{"../math/Quaternion":33,"../math/Vec3":35,"../utilities/CallbackStore":74,"./bodies/Particle":40,"./constraints/Constraint":47,
"./forces/Force":58}],39:[function(f,l,r){function b(b){d.call(this,b);this.normals=[new a(0,1,0),new a(1,0,0),new a(0,0,1)];this.type=2}var a=f("../../math/Vec3"),d=f("./convexBodyFactory")([new a(-100,-100,-100),new a(100,-100,-100),new a(-100,-100,100),new a(100,-100,100),new a(-100,100,-100),new a(100,100,-100),new a(-100,100,100),new a(100,100,100)]);b.prototype=Object.create(d.prototype);b.prototype.constructor=b;l.exports=b},{"../../math/Vec3":35,"./convexBodyFactory":43}],40:[function(f,l,
r){function b(b){this.events=new e;b=b||{};this.position=b.position||new a;this.orientation=b.orientation||new d;this.velocity=new a;this.momentum=new a;this.angularVelocity=new a;this.angularMomentum=new a;this.mass=b.mass||1;this.inverseMass=1/this.mass;this.force=new a;this.torque=new a;this.restitution=null!=b.restitution?b.restitution:.4;this.friction=null!=b.friction?b.friction:.2;this.inverseInertia=new c([0,0,0,0,0,0,0,0,0]);this.localInertia=new c([0,0,0,0,0,0,0,0,0]);this.localInverseInertia=
new c([0,0,0,0,0,0,0,0,0]);this.size=b.size||[0,0,0];var g=b.velocity;g&&this.setVelocity(g.x,g.y,g.z);this.restrictions=0;this.setRestrictions.apply(this,b.restrictions||[]);this.collisionMask=b.collisionMask||1;this.collisionGroup=b.collisionGroup||1;this.type=1;this._ID=u++}var a=f("../../math/Vec3"),d=f("../../math/Quaternion"),c=f("../../math/Mat33"),e=f("../../utilities/CallbackStore"),h=new a,g=new c,u=0;b.prototype.on=function(a,b){this.events.on(a,b);return this};b.prototype.off=function(a,
b){this.events.off(a,b);return this};b.prototype.trigger=function(a,b){this.events.trigger(a,b);return this};b.prototype.getRestrictions=function(){var a="",b="",d=this.restrictions;d&32&&(a+="x");d&16&&(a+="y");d&8&&(a+="z");d&4&&(b+="x");d&2&&(b+="y");d&1&&(b+="z");return[a,b]};b.prototype.setRestrictions=function(a,b){a=a||"";b=b||"";this.restrictions=0;-1<a.indexOf("x")&&(this.restrictions|=32);-1<a.indexOf("y")&&(this.restrictions|=16);-1<a.indexOf("z")&&(this.restrictions|=8);-1<b.indexOf("x")&&
(this.restrictions|=4);-1<b.indexOf("y")&&(this.restrictions|=2);-1<b.indexOf("z")&&(this.restrictions|=1);return this};b.prototype.getMass=function(){return this.mass};b.prototype.setMass=function(a){this.mass=a;this.inverseMass=1/a;return this};b.prototype.getInverseMass=function(){return this.inverseMass};b.prototype.updateLocalInertia=function(){this.localInertia.set([0,0,0,0,0,0,0,0,0]);this.localInverseInertia.set([0,0,0,0,0,0,0,0,0]);return this};b.prototype.updateInertia=function(){var a=
this.localInverseInertia,b=this.orientation;if(a[0]===a[4]&&a[4]===a[8]||1===b.w)return this;a=b.toMatrix(g);c.multiply(a,this.inverseInertia,this.inverseInertia);c.multiply(this.localInverseInertia,a.transpose(),this.inverseInertia);return this};b.prototype.getPosition=function(){return this.position};b.prototype.setPosition=function(a,b,d){this.position.set(a,b,d);return this};b.prototype.getVelocity=function(){return this.velocity};b.prototype.setVelocity=function(b,d,c){this.velocity.set(b,d,
c);a.scale(this.velocity,this.mass,this.momentum);return this};b.prototype.getMomentum=function(){return this.momentum};b.prototype.setMomentum=function(b,d,c){this.momentum.set(b,d,c);a.scale(this.momentum,this.inverseMass,this.velocity);return this};b.prototype.getOrientation=function(){return this.orientation};b.prototype.setOrientation=function(a,b,d,c){this.orientation.set(a,b,d,c).normalize();this.updateInertia();return this};b.prototype.getAngularVelocity=function(){return this.angularVelocity};
b.prototype.setAngularVelocity=function(a,b,d){this.angularVelocity.set(a,b,d);(a=c.inverse(this.inverseInertia,g))?a.vectorMultiply(this.angularVelocity,this.angularMomentum):this.angularMomentum.clear();return this};b.prototype.getAngularMomentum=function(){return this.angularMomentum};b.prototype.setAngularMomentum=function(a,b,d){this.angularMomentum.set(a,b,d);this.inverseInertia.vectorMultiply(this.angularMomentum,this.angularVelocity);return this};b.prototype.getForce=function(){return this.force};
b.prototype.setForce=function(a,b,d){this.force.set(a,b,d);return this};b.prototype.getTorque=function(){return this.torque};b.prototype.setTorque=function(a,b,d){this.torque.set(a,b,d);return this};b.prototype.applyForce=function(a){this.force.add(a);return this};b.prototype.applyTorque=function(a){this.torque.add(a);return this};b.prototype.applyImpulse=function(b){this.momentum.add(b);a.scale(this.momentum,this.inverseMass,this.velocity);return this};b.prototype.applyAngularImpulse=function(a){this.angularMomentum.add(a);
this.inverseInertia.vectorMultiply(this.angularMomentum,this.angularVelocity);return this};b.prototype.support=function(){return h};b.prototype.updateShape=function(){};l.exports=b},{"../../math/Mat33":32,"../../math/Quaternion":33,"../../math/Vec3":35,"../../utilities/CallbackStore":74}],41:[function(f,l,r){function b(b){a.call(this,b);var d=b.radius||1;this.radius=d;this.size=[2*d,2*d,2*d];this.updateLocalInertia();this.inverseInertia.copy(this.localInverseInertia);(b=b.angularVelocity)&&this.setAngularVelocity(b.x,
b.y,b.z);this.type=4}var a=f("./Particle"),d=f("../../math/Vec3"),c=new d;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.getRadius=function(){return this.radius};b.prototype.setRadius=function(a){this.radius=a;this.size=[2*this.radius,2*this.radius,2*this.radius];return this};b.prototype.updateLocalInertia=function(){var a=this.radius,a=this.mass*a*a;this.localInertia.set([.4*a,0,0,0,.4*a,0,0,0,.4*a]);this.localInverseInertia.set([2.5/a,0,0,0,2.5/a,0,0,0,2.5/a])};b.prototype.support=
function(a){return d.scale(a,this.radius,c)};l.exports=b},{"../../math/Vec3":35,"./Particle":40}],42:[function(f,l,r){function b(c){a.call(this,c);var e=this.normal=new d;switch(this.direction=c.direction){case b.DOWN:e.set(0,1,0);break;case b.UP:e.set(0,-1,0);break;case b.LEFT:e.set(-1,0,0);break;case b.RIGHT:e.set(1,0,0);break;case b.FORWARD:e.set(0,0,-1);break;case b.BACKWARD:e.set(0,0,1)}this.invNormal=d.clone(e,new d).invert();this.mass=Infinity;this.inverseMass=0;this.type=8}var a=f("./Particle"),
d=f("../../math/Vec3"),b={DOWN:0,UP:1,LEFT:2,RIGHT:3,FORWARD:4,BACKWARD:5};b.prototype=Object.create(a.prototype);b.prototype.constructor=b;l.exports=b},{"../../math/Vec3":35,"./Particle":40}],43:[function(f,l,r){function b(a){var b=this.hull.polyhedralProperties,c=a.get(),c=c[0]*c[4]*c[8],e=b.eulerTensor,h=new d;d.multiply(a,e,h);d.multiply(h,a,h);var f=h.get(),t=f[0],B=f[4],m=f[8];a=b.volume*c;var e=this.mass/a,h=-f[1],v=-f[7],f=-f[2],x=b.centroid,b=B+m-a*(x.y*x.y+x.z*x.z),m=t+m-a*(x.z*x.z+x.x*
x.x),t=t+B-a*(x.x*x.x+x.y*x.y),h=h+a*x.x*x.y,v=v+a*x.y*x.z,f=f+a*x.z*x.x,b=b*e*c,m=m*e*c,t=t*e*c,h=h*e*c,v=v*e*c,f=f*e*c;this.localInertia.set([b,h,f,h,m,v,f,v,t]);d.inverse(this.localInertia,this.localInverseInertia)}var a=f("./Particle"),d=f("../../math/Mat33"),c=f("../../math/Vec3"),e=f("../Geometry").ConvexHull,h=new c;l.exports=function(g){function f(e){a.call(this,e);var h=g.polyhedralProperties.size,q=e.size||h,w=q[0]/h[0],t=q[1]/h[1],h=q[2]/h[2];this._scale=[w,t,h];w=new d([w,0,0,0,t,0,0,
0,h]);this.hull=g;this.vertices=[];t=0;for(h=g.vertices.length;t<h;t++)this.vertices.push(w.vectorMultiply(g.vertices[t],new c));b.call(this,w);this.inverseInertia.copy(this.localInverseInertia);this.updateInertia();(e=e.angularVelocity)&&this.setAngularVelocity(e.x,e.y,e.z)}if(!(g instanceof e))if(g instanceof Array)g=new e(g);else throw Error("convexBodyFactory requires a ConvexHull object or an array of Vec3's as input.");f.prototype=Object.create(a.prototype);f.prototype.constructor=f;f.prototype.setSize=
function(a,b,c){var e=g.polyhedralProperties.size;this.size[0]=a;this.size[1]=b;this.size[2]=c;a/=e[0];b/=e[1];c/=e[2];this._scale=[a,b,c];c=new d([a,0,0,0,b,0,0,0,c]);e=this.vertices;a=0;for(b=g.vertices.length;a<b;a++)c.vectorMultiply(g.vertices[a],e[a]);return this};f.prototype.updateLocalInertia=function(){var a=new d([this._scale[0],0,0,0,this._scale[1],0,0,0,this._scale[2]]);b.call(this,a);return this};f.prototype.support=function(a){for(var b=this.vertices,d,e,g,h=-Infinity,m=0,f=b.length;m<
f;m++)d=b[m],e=c.dot(d,a),e>h&&(g=d,h=e);return g};f.prototype.updateShape=function(){for(var a=this.vertices,b=this.orientation,d=this.hull.vertices,e=this._scale[0],g=this._scale[1],f=this._scale[2],m=0,v=a.length;m<v;m++)h.copy(d[m]),h.x*=e,h.y*=g,h.z*=f,c.applyRotation(h,b,a[m]);return this};return f}},{"../../math/Mat33":32,"../../math/Vec3":35,"../Geometry":37,"./Particle":40}],44:[function(f,l,r){function b(b,e,f){this.a=b;this.b=e;a.call(this,f);this.effectiveInertia=new c;this.angularImpulse=
new d;this.error=0}var a=f("./Constraint"),d=f("../../math/Vec3"),c=f("../../math/Mat33"),e=new d;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.init=function(){this.cosAngle=this.cosAngle||this.a.orientation.dot(this.b.orientation)};b.prototype.update=function(){var a=this.a,b=this.b;this.error=2*(a.orientation.dot(b.orientation)-this.cosAngle);var d=this.angularImpulse;b.applyAngularImpulse(d);a.applyAngularImpulse(d.invert());c.add(a.inverseInertia,b.inverseInertia,
this.effectiveInertia);this.effectiveInertia.inverse();d.clear()};b.prototype.resolve=function(){var a=this.a,b=this.b;d.subtract(a.angularVelocity,b.angularVelocity,e);e.scale(1+this.error);var c=e.applyMatrix(this.effectiveInertia);b.applyAngularImpulse(c);a.applyAngularImpulse(c.invert());c.invert();this.angularImpulse.add(c)};l.exports=b},{"../../math/Mat33":32,"../../math/Vec3":35,"./Constraint":47}],45:[function(f,l,r){function b(b,e,g){this.a=b;this.b=e;a.call(this,g);this.impulse=new d;this.angImpulseA=
new d;this.angImpulseB=new d;this.error=new d;this.effMassMatrix=new c}var a=f("./Constraint"),d=f("../../math/Vec3"),c=f("../../math/Mat33"),e=f("../../math/Quaternion"),h=new d,g=new d,u=new d,k=new d,p=new d;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.init=function(){var a=this.anchor,b=this.a,c=this.b,g=e.conjugate(b.orientation,new e),m=e.conjugate(c.orientation,new e);this.rA=d.subtract(a,b.position,new d);this.rB=d.subtract(a,c.position,new d);this.bodyRA=g.rotateVector(this.rA,
new d);this.bodyRB=m.rotateVector(this.rB,new d)};b.prototype.update=function(a,b){var e=this.a,h=this.b,m=e.orientation.rotateVector(this.bodyRA,this.rA),f=h.orientation.rotateVector(this.bodyRB,this.rB),m=new c([0,m.z,-m.y,-m.z,0,m.x,m.y,-m.x,0]),f=new c([0,f.z,-f.y,-f.z,0,f.x,f.y,-f.x,0]),m=c.multiply(m,e.inverseInertia,new c).multiply(m.transpose()),f=c.multiply(f,h.inverseInertia,new c).multiply(f.transpose()),f=c.add(m,f,m),m=d.add(e.position,this.rA,this.anchor),p=d.add(h.position,this.rB,
g);d.subtract(p,m,this.error);this.error.scale(.2/b);m=e.inverseMass;p=h.inverseMass;m=new c([m+p,0,0,0,m+p,0,0,0,m+p]);c.add(f,m,this.effMassMatrix);this.effMassMatrix.inverse();f=this.impulse;m=this.angImpulseA;p=this.angImpulseB;h.applyImpulse(f);h.applyAngularImpulse(p);f.invert();e.applyImpulse(f);e.applyAngularImpulse(m);f.clear();m.clear();p.clear()};b.prototype.resolve=function(){var a=this.a,b=this.b,c=this.rA,e=this.rB,m=d.add(a.velocity,d.cross(a.angularVelocity,c,p),u),f=d.add(b.velocity,
d.cross(b.angularVelocity,e,p),k),m=m.subtract(f).subtract(this.error).applyMatrix(this.effMassMatrix),e=d.cross(e,m,h),c=d.cross(c,m,g).invert();b.applyImpulse(m);b.applyAngularImpulse(e);m.invert();a.applyImpulse(m);a.applyAngularImpulse(c);m.invert();this.impulse.add(m);this.angImpulseA.add(c);this.angImpulseB.add(e)};l.exports=b},{"../../math/Mat33":32,"../../math/Quaternion":33,"../../math/Vec3":35,"./Constraint":47}],46:[function(f,l,r){function b(a,b,d){return a<b?b:a>d?d:a}function a(a,b,
d,c,e,g){this.penetration=a;this.normal=b;this.worldContactA=d;this.worldContactB=c;this.localContactA=e;this.localContactB=g}function d(a,b){this.targets=[];a&&(this.targets=this.targets.concat(a));g.call(this,b)}function c(a,b,d){var c=p(b,d);c&&(c=q(b,d,c),null!==c&&a.contactManifoldTable.registerContact(b,d,c))}function e(a,b,d){if(8===b.type){var c=d;d=b;b=c}var e=b.position,g=d.position,m=d.normal,c=d.invNormal,f=b.support(c),e=h.add(e,f,new h),g=h.subtract(e,g,B),g=h.dot(g,c);if(!(0>g)){var m=
h.scale(m,g,new h).add(e),p=h.subtract(m,d.position,new h),c=t().reset(g,c,e,m,f,p);a.contactManifoldTable.registerContact(b,d,c)}}var h=f("../../math/Vec3"),g=f("./Constraint"),u=f("./collision/SweepAndPrune");r=f("./collision/BruteForce");var k=f("./collision/ConvexCollisionDetection"),p=k.gjk,q=k.epa,w=f("./collision/ContactManifold");f=f("../../utilities/ObjectManager");f.register("CollisionData",a);var t=f.requestCollisionData,B=new h;a.prototype.reset=function(a,b,d,c,e,g){this.penetration=
a;this.normal=b;this.worldContactA=d;this.worldContactB=c;this.localContactA=e;this.localContactB=g;return this};d.prototype=Object.create(g.prototype);d.prototype.constructor=d;d.prototype.init=function(){if(this.broadPhase){var a=this.broadphase;a instanceof Function&&(this.broadPhase=new a(this.targets))}else this.broadPhase=new u(this.targets);this.contactManifoldTable=this.contactManifoldTable||new w};d.prototype.update=function(a,b){this.contactManifoldTable.update(b);if(0!==this.targets.length){var d,
c;d=0;for(c=this.targets.length;d<c;d++)this.targets[d].updateShape();var e=this.broadPhase.update(),g;d=0;for(c=e.length;d<c;d++)(g=e[d])&&this.applyNarrowPhase(g);this.contactManifoldTable.prepContacts(b)}};d.prototype.resolve=function(a,b){this.contactManifoldTable.resolveManifolds(b)};d.prototype.addTarget=function(a){this.targets.push(a);this.broadPhase.add(a)};d.prototype.removeTarget=function(a){var b=this.targets.indexOf(a);0>b||(this.targets.splice(b,1),this.broadPhase.remove(a))};var m=
{};m[1]=c;m[2]=c;m[3]=c;m[5]=c;m[4]=function(a,b,d){var c=b.position,e=d.position,g=h.subtract(e,c,new h),m=g.length(),f=b.radius+d.radius,g=g.scale(1/m),m=f-m;if(!(0>m)){var f=h.scale(g,b.radius,new h),p=h.scale(g,-d.radius,new h),c=h.add(c,f,new h),e=h.add(e,p,new h),e=t().reset(m,g,c,e,f,p);a.contactManifoldTable.registerContact(b,d,e)}};m[6]=function(a,d,c){if(4===d.type){var e=c;c=d;d=e}var g=d.position,e=c.position,m=h.subtract(e,g,B),f=d.orientation,p=c.radius,k=d.size,q=.5*k[0],w=.5*k[1],
u=.5*k[2],k=d.normals,l=f.rotateVector(k[1],new h),r=f.rotateVector(k[0],new h),G=f.rotateVector(k[2],new h),k=new h;k.x=b(h.dot(m,l),-q,q);k.y=b(h.dot(m,r),-w,w);k.z=b(h.dot(m,G),-u,u);k.applyRotation(f);m=h.add(g,k,new h);m=h.subtract(m,e,new h);f=m.length();0==f&&(f=.1);p-=f;0>p||(f=h.scale(m,-1/f,new h),g=h.add(g,k,new h),e=h.add(e,m,new h),e=t().reset(p,f,g,e,k,m),a.contactManifoldTable.registerContact(d,c,e))};m[9]=e;m[10]=e;m[12]=e;d.prototype.applyNarrowPhase=function(a){for(var b=0,d=a.length;b<
d;b++)for(var c=b+1;c<d;c++){var e=a[b],g=a[c];if(0!==(e.collisionMask&g.collisionGroup&&e.collisionGroup&g.collisionMask)){var h=e.type|g.type;if(m[h])m[h](this,e,g)}}};d.SweepAndPrune=u;d.BruteForce=r.BruteForce;d.BruteForceAABB=r.BruteForceAABB;l.exports=d},{"../../math/Vec3":35,"../../utilities/ObjectManager":75,"./Constraint":47,"./collision/BruteForce":53,"./collision/ContactManifold":54,"./collision/ConvexCollisionDetection":55,"./collision/SweepAndPrune":56}],47:[function(f,l,r){function b(b){b=
b||{};this.setOptions(b);this._ID=a++}var a=0;b.prototype.setOptions=function(a){for(var b in a)this[b]=a[b];this.init(a)};b.prototype.init=function(a){};b.prototype.update=function(a,b){};b.prototype.resolve=function(a,b){};l.exports=b},{}],48:[function(f,l,r){function b(b,d){this.targets=b?b instanceof Array?b:[b]:[];a.call(this,d);this.impulses={};this.normals={};this.velocityBiases={};this.divisors={}}var a=f("./Constraint"),d=f("../../math/Vec3"),c=new d,e=new d,h=Math.PI;b.prototype=Object.create(a.prototype);
b.prototype.constructor=b;b.prototype.init=function(){this.equation1=this.equation1||function(){return 0};this.equation2=this.equation2||function(a,b,d){return d};this.period=this.period||1;this.dampingRatio=this.dampingRatio||.5;this.stiffness=4*h*h/(this.period*this.period);this.damping=4*h*this.dampingRatio/this.period};b.prototype.update=function(a,b){for(var h=this.targets,f=this.normals,q=this.velocityBiases,w=this.divisors,t=this.impulses,l=this.equation1,m=this.equation2,v=this.damping,x=
this.stiffness,I=0,z=h.length;I<z;I++){var y=h[I],A=y._ID;if(!y.immune){var r=y.position,Q=y.mass,J,D;if(0===this.period)J=0,D=1;else{D=v*Q;var O=x*Q;J=1/(b*(D+b*O));D=b*O/(D+b*O)}var O=r.x,N=r.y,K=r.z,r=l(O,N,K),E=(l(O+1E-7,N,K)-r)/1E-7,G=(l(O,N+1E-7,K)-r)/1E-7,C=(l(O,N,K+1E-7)-r)/1E-7,L=m(O,N,K),n=(m(O+1E-7,N,K)-L)/1E-7,H=(m(O,N+1E-7,K)-L)/1E-7,O=(m(O,N,K+1E-7)-L)/1E-7;e.set(E+n,G+H,C+O);e.normalize();D=D*(r+L)/b;Q=J+1/Q;d.scale(e,t[A]||0,c);y.applyImpulse(c);f[A]=f[A]||new d;f[A].copy(e);q[A]=
D;w[A]=Q;t[A]=0}}};b.prototype.resolve=function(){for(var a=this.targets,b=this.normals,e=this.velocityBiases,h=this.divisors,f=this.impulses,w=0,t=a.length;w<t;w++){var l=a[w],m=l._ID;if(!l.immune){var v=b[m],x=-(d.dot(v,l.velocity)+e[m])/h[m];d.scale(v,x,c);l.applyImpulse(c);f[m]+=x}}};l.exports=b},{"../../math/Vec3":35,"./Constraint":47}],49:[function(f,l,r){function b(b,c,e){this.a=b;this.b=c;a.call(this,e);this.distance=this.impulse=0;this.normal=new d;this.divisor=this.velocityBias=0}var a=
f("./Constraint"),d=f("../../math/Vec3"),c=new d,e=new d,h=new d,g=new d,u=new d,k=Math.PI;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.init=function(){this.direction=this.direction||d.subtract(this.b.position,this.a.position,new d);this.direction.normalize();this.minLength=this.minLength||0;this.period=this.period||.2;this.dampingRatio=this.dampingRatio||.5;this.stiffness=4*k*k/(this.period*this.period);this.damping=4*k*this.dampingRatio/this.period};b.prototype.update=
function(a,b){var h=this.a,f=this.b,k=h.position,m=h.inverseMass,v=f.position,x=f.inverseMass,l=this.direction;d.subtract(v,k,g);d.scale(l,d.dot(l,g),u);k=u.add(k);d.subtract(v,k,c);v=c.length();c.normalize();m+=x;x=1/m;0===this.period?(x=0,k=1):(k=this.damping*x,l=this.stiffness*x,x=1/(b*(k+b*l)),k=b*l/(k+b*l));k=k*v/b;m=x+m;d.scale(c,this.impulse,e);f.applyImpulse(e);h.applyImpulse(e.invert());this.normal.copy(c);this.distance=v;this.velocityBias=k;this.divisor=m;this.impulse=0};b.prototype.resolve=
function(){var a=this.a,b=this.b;if(!(Math.abs(this.distance)<this.minLength)){var c=this.normal;d.subtract(b.velocity,a.velocity,h);var g=-(d.dot(c,h)+this.velocityBias)/this.divisor;d.scale(c,g,e);b.applyImpulse(e);a.applyImpulse(e.invert());this.impulse+=g}};l.exports=b},{"../../math/Vec3":35,"./Constraint":47}],50:[function(f,l,r){function b(b,c,e){this.a=b;this.b=c;a.call(this,e);this.distance=this.impulse=0;this.normal=new d;this.divisor=this.velocityBias=0}var a=f("./Constraint"),d=f("../../math/Vec3"),
c=new d,e=new d,h=new d,g=new d,u=Math.PI;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.init=function(){this.length=this.length||d.subtract(this.b.position,this.a.position,g).length();this.minLength=this.minLength||0;this.period=this.period||.2;this.dampingRatio=this.dampingRatio||.5;this.stiffness=4*u*u/(this.period*this.period);this.damping=4*u*this.dampingRatio/this.period};b.prototype.update=function(a,b){var h=this.a,f=this.b,t=this.length,u=h.inverseMass,m=f.inverseMass;
d.subtract(f.position,h.position,g);var v=g.length();d.scale(g,1/v,c);t=v-t;u+=m;m=1/u;if(0===this.period)m=0,v=1;else var v=this.damping*m,x=this.stiffness*m,m=1/(b*(v+b*x)),v=b*x/(v+b*x);v=v*t/b;u=m+u;d.scale(c,this.impulse,e);f.applyImpulse(e);h.applyImpulse(e.invert());this.normal.copy(c);this.distance=t;this.velocityBias=v;this.divisor=u;this.impulse=0};b.prototype.resolve=function(){var a=this.a,b=this.b;if(!(Math.abs(this.distance)<this.minLength)){var c=a.getVelocity(),g=b.getVelocity(),f=
this.normal;d.subtract(g,c,h);c=-(d.dot(f,h)+this.velocityBias)/this.divisor;d.scale(f,c,e);b.applyImpulse(e);a.applyImpulse(e.invert());this.impulse+=c}};l.exports=b},{"../../math/Vec3":35,"./Constraint":47}],51:[function(f,l,r){function b(b,e,g){this.a=b;this.b=e;a.call(this,g);this.impulse=new d;this.angImpulseA=new d;this.angImpulseB=new d;this.error=new d;this.errorRot=[0,0];this.effMassMatrix=new c;this.effMassMatrixRot=[]}var a=f("./Constraint"),d=f("../../math/Vec3"),c=f("../../math/Mat33"),
e=f("../../math/Quaternion"),h=new d,g=new d,u=new d,k=new d,p=new d,q=new d,w=new d,t=new d;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.init=function(){var a=this.anchor,b=this.axis.normalize(),c=this.a,g=this.b,h=e.conjugate(c.orientation,new e),f=e.conjugate(g.orientation,new e);this.rA=d.subtract(a,c.position,new d);this.rB=d.subtract(a,g.position,new d);this.bodyRA=h.rotateVector(this.rA,new d);this.bodyRB=f.rotateVector(this.rB,new d);this.axisA=d.clone(b);this.axisB=
d.clone(b);this.axisBTangent1=new d;this.axisBTangent2=new d;this.t1xA=new d;this.t2xA=new d;this.bodyAxisA=h.rotateVector(b,new d);this.bodyAxisB=f.rotateVector(b,new d)};b.prototype.update=function(a,b){var e=this.a,f=this.b,p=e.orientation.rotateVector(this.bodyAxisA,this.axisA),q=f.orientation.rotateVector(this.bodyAxisB,this.axisB);this.axis.copy(q);var t=this.axisBTangent1,w=this.axisBTangent2;.57735<=q.x?t.set(q.y,-q.x,0):t.set(0,q.z,-q.y);t.normalize();d.cross(q,t,w);var l=d.cross(t,p,this.t1xA),
q=d.cross(w,p,this.t2xA),r=e.orientation.rotateVector(this.bodyRA,this.rA),J=f.orientation.rotateVector(this.bodyRB,this.rB),r=new c([0,r.z,-r.y,-r.z,0,r.x,r.y,-r.x,0]),J=new c([0,J.z,-J.y,-J.z,0,J.x,J.y,-J.x,0]),r=c.multiply(r,e.inverseInertia,new c).multiply(r.transpose()),J=c.multiply(J,f.inverseInertia,new c).multiply(J.transpose()),r=c.add(r,J,r),D=d.add(e.position,this.rA,this.anchor),O=d.add(f.position,this.rB,h),J=1/b;d.subtract(O,D,this.error);this.error.scale(.2*J);D=e.inverseMass;O=f.inverseMass;
D=new c([D+O,0,0,0,D+O,0,0,0,D+O]);c.add(r,D,this.effMassMatrix);this.effMassMatrix.inverse();var N=e.inverseInertia.vectorMultiply(l,h),D=e.inverseInertia.vectorMultiply(q,g),K=f.inverseInertia.vectorMultiply(l,u),O=f.inverseInertia.vectorMultiply(q,k),r=d.dot(l,N)+d.dot(l,K),l=d.dot(l,D)+d.dot(l,O),N=d.dot(q,N)+d.dot(q,K),q=d.dot(q,D)+d.dot(q,O),D=1/(r*q-l*N);this.effMassMatrixRot[0]=q*D;this.effMassMatrixRot[1]=-N*D;this.effMassMatrixRot[2]=-l*D;this.effMassMatrixRot[3]=r*D;this.errorRot[0]=.2*
d.dot(p,t)*J;this.errorRot[1]=.2*d.dot(p,w)*J;p=this.impulse.scale(.5);t=this.angImpulseA.scale(.5);w=this.angImpulseB.scale(.5);f.applyImpulse(p);f.applyAngularImpulse(w);p.invert();e.applyImpulse(p);e.applyAngularImpulse(t);p.clear();t.clear();w.clear()};b.prototype.resolve=function(){var a=this.a,b=this.b,c=this.rA,e=this.rB,f=this.t1xA,l=this.t2xA,y=a.angularVelocity,r=b.angularVelocity,F=d.add(a.velocity,d.cross(y,c,w),p),Q=d.add(b.velocity,d.cross(r,e,w),q),F=F.subtract(Q).subtract(this.error).applyMatrix(this.effMassMatrix),
r=d.subtract(r,y,t),Q=this.errorRot,y=d.dot(f,r)+Q[0],r=d.dot(l,r)+Q[1],Q=this.effMassMatrixRot,J=-(Q[2]*y+Q[3]*r),f=d.scale(f,-(Q[0]*y+Q[1]*r),g).add(d.scale(l,J,u)),e=d.cross(e,F,h).add(f),c=d.cross(c,F,k).invert().subtract(f);b.applyImpulse(F);b.applyAngularImpulse(e);F.invert();a.applyImpulse(F);a.applyAngularImpulse(c);F.invert();this.impulse.add(F);this.angImpulseA.add(c);this.angImpulseB.add(e)};l.exports=b},{"../../math/Mat33":32,"../../math/Quaternion":33,"../../math/Vec3":35,"./Constraint":47}],
52:[function(f,l,r){function b(a){this._body=a;this._ID=a._ID;this.position=null;this.vertices={x:[],y:[],z:[]};this.update()}b.prototype.update=function(){var a=this._body,b=this.position=a.position,c=Infinity,e=-Infinity,h=Infinity,g=-Infinity,f=Infinity,k=-Infinity,p=a.type;if(4===p)e=g=k=a.radius,c=h=f=-a.radius;else if(8===p)switch(a=a.direction,e=g=k=1E6,c=h=f=-1E6,a){case 0:g=25;h=-1E3;break;case 1:g=1E3;h=-25;break;case 2:e=25;c=-1E3;break;case 3:e=1E3;c=-25;break;case 4:k=25;f=-1E3;break;
case 5:k=1E3,f=-25}else if(a.vertices)for(var a=a.vertices,p=0,q=a.length;p<q;p++){var w=a[p];w.x<c&&(c=w.x);w.x>e&&(e=w.x);w.y<h&&(h=w.y);w.y>g&&(g=w.y);w.z<f&&(f=w.z);w.z>k&&(k=w.z)}else e=g=k=25,c=h=f=-25;a=this.vertices;a.x[0]=c+b.x;a.x[1]=e+b.x;a.y[0]=h+b.y;a.y[1]=g+b.y;a.z[0]=f+b.z;a.z[1]=k+b.z};b.checkOverlap=function(a,b){var c=a.vertices,e=b.vertices,h=c.x[0],g=c.x[1],f=e.x[0],k=e.x[1];if(f<=h&&h<=k||h<=f&&f<=g)if(h=c.y[0],g=c.y[1],f=e.y[0],k=e.y[1],f<=h&&h<=k||h<=f&&f<=g)if(h=c.z[0],c=c.z[1],
g=e.z[0],e=e.z[1],g<=h&&h<=e||h<=g&&g<=c)return!0;return!1};b.vertexThreshold=100;l.exports=b},{}],53:[function(f,l,r){function b(a){this._volumes=[];this._entityRegistry={};for(var b=0;b<a.length;b++)this.add(a[b])}function a(a){this.targets=a}var d=f("./AABB");b.prototype.add=function(a){var b=new d(a);this._entityRegistry[a._ID]=a;this._volumes.push(b)};b.prototype.update=function(){for(var a=this._volumes,b=this._entityRegistry,f=0,g=a.length;f<g;f++)a[f].update();for(var f=[],g=0,u=a.length;g<
u;g++)for(var k=g+1;k<u;k++)d.checkOverlap(a[g],a[k])&&f.push([b[g],b[k]]);return f};a.prototype.add=function(a){this.targets.push(a)};a.prototype.update=function(){return[this.targets]};l.exports.BruteForceAABB=b;l.exports.BruteForce=a},{"./AABB":52}],54:[function(f,l,r){function b(){this.manifolds=[];this.collisionMatrix={};this._IDPool=[]}function a(a,b,d,c){this.lowID=a;this.highID=b;this.contacts=[];this.numContacts=0;this.bodyA=d;this.bodyB=c;this.lru=0}function d(a,b,d){this.bodyA=a;this.bodyB=
b;this.data=d;this.tangentImpulse2=this.tangentImpulse1=this.normalImpulse=0;this.impulse=new c;this.angImpulseA=new c;this.angImpulseB=new c;d&&this.init()}var c=f("../../../math/Vec3"),e=f("../../../utilities/ObjectManager");e.register("Manifold",a);e.register("Contact",d);var h=e.requestManifold,g=e.requestContact,u=e.freeManifold,k=e.freeContact,p=new c,q=new c,w=new c,t=new c,B=new c,m=new c,v=new c,x=new c,I=new c,z=new c,y=new c,A=new c,F=new c,Q=new c,J=new c;b.prototype.addManifold=function(a,
b,d,c){var e=this.collisionMatrix;e[a]=e[a]||{};e=this._IDPool.length?this._IDPool.pop():this.manifolds.length;this.collisionMatrix[a][b]=e;a=h().reset(a,b,d,c);return this.manifolds[e]=a};b.prototype.removeManifold=function(a,b){var d=this.collisionMatrix;this.manifolds[b]=null;d[a.lowID][a.highID]=null;this._IDPool.push(b);u(a)};b.prototype.update=function(a){for(var b=this.manifolds,d=0,c=b.length;d<c;d++){var e=b[d];e&&!e.update(a)&&(this.removeManifold(e,d),e.bodyA.events.trigger("collision:end",
e),e.bodyB.events.trigger("collision:end",e))}};b.prototype.prepContacts=function(a){for(var b=this.manifolds,d=0,c=b.length;d<c;d++){var e=b[d];if(e)for(var e=e.contacts,g=0,f=e.length;g<f;g++){var h=e[g];h&&h.update(a)}}};b.prototype.resolveManifolds=function(){for(var a=this.manifolds,b=0,d=a.length;b<d;b++){var c=a[b];c&&c.resolveContacts()}};b.prototype.registerContact=function(a,b,d){var c,e;a._ID<b._ID?(c=a._ID,e=b._ID):(c=b._ID,e=a._ID);var g=this.manifolds,f=this.collisionMatrix;f[c]&&null!=
f[c][e]?(c=g[f[c][e]],c.contains(d),c.addContact(a,b,d)):(c=this.addManifold(c,e,a,b),c.addContact(a,b,d),a.events.trigger("collision:start",c),b.events.trigger("collision:start",c))};a.prototype.reset=function(a,b,d,c){this.lowID=a;this.highID=b;this.contacts=[];this.numContacts=0;this.bodyA=d;this.bodyB=c;this.lru=0;return this};a.prototype.addContact=function(a,b,d){var c=this.lru;this.contacts[c]&&this.removeContact(this.contacts[c],c);this.contacts[c]=g().reset(a,b,d);this.lru=(this.lru+1)%4;
this.numContacts++};a.prototype.removeContact=function(a,b){this.contacts[b]=null;this.numContacts--;e.freeCollisionData(a.data);a.data=null;k(a)};a.prototype.contains=function(a){var b=a.worldContactA;a=a.worldContactB;for(var d=this.contacts,e=0,g=d.length;e<g;e++){var f=d[e];if(f){var h=f.data,m=c.subtract(h.worldContactA,b,Q).length(),h=c.subtract(h.worldContactB,a,J).length();if(10>m||10>h)return this.removeContact(f,e),!0}}return!1};a.prototype.update=function(){for(var a=this.contacts,b=this.bodyA.position,
d=this.bodyB.position,e=0,g=a.length;e<g;e++){var f=a[e];if(f){var h=f.data,m=h.normal,n=h.localContactB,p=h.worldContactA,k=h.worldContactB,h=c.add(b,h.localContactA,y),n=c.add(d,n,A),m=0<c.dot(c.subtract(n,h,F),m),p=c.subtract(p,h,Q),k=c.subtract(k,n,J);(10<=p.length()||10<=k.length()||m)&&this.removeContact(f,e)}}return this.numContacts?!0:!1};a.prototype.resolveContacts=function(){for(var a=this.contacts,b=0,d=a.length;b<d;b++)a[b]&&a[b].resolve()};d.prototype.reset=function(a,b,d){this.bodyA=
a;this.bodyB=b;this.data=d;this.tangentImpulse2=this.tangentImpulse1=this.normalImpulse=0;this.impulse.clear();this.angImpulseA.clear();this.angImpulseB.clear();this.init();return this};d.prototype.init=function(){var a=this.data,b=a.normal,d=new c;.57735<=b.x?d.set(b.y,-b.x,0):d.set(0,b.z,-b.y);d.normalize();var e=c.cross(b,d,new c);this.tangent1=d;this.tangent2=e;var g=this.bodyA,f=this.bodyB,h=a.localContactA,k=a.localContactB,a=g.inverseMass+f.inverseMass,n=c.cross(h,b,m),b=c.cross(k,b,v);this.effNormalMass=
1/(a+c.dot(n,g.inverseInertia.vectorMultiply(n,p))+c.dot(b,f.inverseInertia.vectorMultiply(b,p)));b=c.cross(h,d,m);d=c.cross(k,d,v);this.effTangentialMass1=1/(a+c.dot(b,g.inverseInertia.vectorMultiply(b,p))+c.dot(d,f.inverseInertia.vectorMultiply(d,p)));h=c.cross(h,e,m);e=c.cross(k,e,v);this.effTangentialMass2=1/(a+c.dot(h,g.inverseInertia.vectorMultiply(h,p))+c.dot(e,f.inverseInertia.vectorMultiply(e,p)));this.restitution=Math.min(g.restitution,f.restitution);this.friction=g.friction*f.friction};
d.prototype.update=function(a){var b=this.data,d=this.bodyA,e=this.bodyB,g=b.localContactB,f=b.normal,h=c.add(d.velocity,c.cross(d.angularVelocity,b.localContactA,B),w),g=c.add(e.velocity,c.cross(e.angularVelocity,g,B),t).subtract(h),f=c.dot(g,f),g=20>Math.abs(f)?0:this.restitution;this.velocityBias=-.15*Math.max(b.penetration-1.5,0)/a;this.velocityBias+=g*f;a=this.impulse.scale(.25);b=this.angImpulseA.scale(.25);f=this.angImpulseB.scale(.25);e.applyImpulse(a);e.applyAngularImpulse(f);a.invert();
d.applyImpulse(a);d.applyAngularImpulse(b);this.tangentImpulse2=this.tangentImpulse1=this.normalImpulse=0;a.clear();b.clear();f.clear()};d.prototype.resolve=function(){var a=this.data,b=this.bodyA,d=this.bodyB,e=a.localContactA,g=a.localContactB,f=a.normal,h=this.tangent1,m=this.tangent2,a=c.add(b.velocity,c.cross(b.angularVelocity,e,B),w),n=c.add(d.velocity,c.cross(d.angularVelocity,g,B),t).subtract(a),k=-(c.dot(n,f)+this.velocityBias)*this.effNormalMass,a=Math.max(this.normalImpulse+k,0),k=a-this.normalImpulse,
v=this.friction*a,u=-c.dot(n,h)*this.effTangentialMass1,l;l=this.tangentImpulse1+u;u=-v;l=l<u?u:l>v?v:l;var u=l-this.tangentImpulse1,n=-c.dot(n,m)*this.effTangentialMass2,n=this.tangentImpulse2+n,y=-v,v=n<y?y:n>v?v:n,n=v-this.tangentImpulse2,f=c.scale(f,k,x),h=c.scale(h,u,I),m=c.scale(m,n,z);f.add(h).add(m);g=c.cross(g,f,p);e=c.cross(e,f,q).invert();d.applyImpulse(f);d.applyAngularImpulse(g);f.invert();b.applyImpulse(f);b.applyAngularImpulse(e);this.normalImpulse=a;this.tangentImpulse1=l;this.tangentImpulse2=
v;this.impulse.add(f);this.angImpulseA.add(e);this.angImpulseB.add(g)};l.exports=b},{"../../../math/Vec3":35,"../../../utilities/ObjectManager":75}],55:[function(f,l,r){function b(a,b,d){this.vertex=a;this.worldVertexA=b;this.worldVertexB=d}function a(a){var b=a.vertices,d;for(d=b.length;d--;){var c=b.pop();null!==c&&u(c)}a.numVertices=0;b=a.features;for(d=b.length;d--;)c=b.pop(),null!==c&&p(c);a.numFeatures=0;k(a)}function d(a,b,d){var e=c.scale(d,-1,v);a=c.add(a.support(d),a.position,new c);b=c.add(b.support(e),
b.position,new c);return h().reset(c.subtract(a,b,new c),a,b)}var c=f("../../../math/Vec3"),e=f("../../../utilities/ObjectManager");e.register("GJK_EPASupportPoint",b);var h=e.requestGJK_EPASupportPoint,g=e.requestDynamicGeometry,u=e.freeGJK_EPASupportPoint,k=e.freeDynamicGeometry,p=e.freeDynamicGeometryFeature,q=new c,w=new c,t=new c,B=new c,m=new c,v=new c;b.prototype.reset=function(a,b,d){this.vertex=a;this.worldVertexA=b;this.worldVertexB=d;return this};l.exports.gjk=function(b,e){var f=c.subtract(e.position,
b.position,m).normalize(),h=g();h.addVertex(d(b,e,f));f.invert();for(var k=0;1E3>k++&&(0!==f.x||0!==f.y||0!==f.z);){h.addVertex(d(b,e,f));if(0>c.dot(h.getLastVertex().vertex,f))break;if(h.simplexContainsOrigin(f,u))return h}a(h);return!1};l.exports.epa=function(b,g,f){for(var h=Infinity,m=0;1E3>m++;){var k=f.getFeatureClosestToOrigin();if(null===k)return null;var p=k.normal,v=d(b,g,p),h=Math.min(h,c.dot(v.vertex,p));if(.01>=h-k.distance){var h=f.vertices[k.vertexIndices[0]],m=f.vertices[k.vertexIndices[1]],
l=f.vertices[k.vertexIndices[2]],r=h.vertex,N=m.vertex,K=l.vertex,E=c.scale(p,k.distance,q),N=c.subtract(N,r,w),K=c.subtract(K,r,t),G=c.subtract(E,r,B),r=c.dot(N,N),E=c.dot(N,K),C=c.dot(K,K),N=c.dot(G,N),G=c.dot(G,K),L=r*C-E*E,K=(C*N-E*G)/L,E=(r*G-E*N)/L,N=1-K-E,r=h.worldVertexA.scale(N).add(m.worldVertexA.scale(K)).add(l.worldVertexA.scale(E)),h=h.worldVertexB.scale(N).add(m.worldVertexB.scale(K)).add(l.worldVertexB.scale(E));b=c.subtract(r,b.position,new c);g=c.subtract(h,g.position,new c);a(f);
u(v);return e.requestCollisionData().reset(k.distance,p,r,h,b,g)}f.addVertex(v);f.reshape()}throw Error("EPA failed to terminate in allotted iterations.");}},{"../../../math/Vec3":35,"../../../utilities/ObjectManager":75}],56:[function(f,l,r){function b(a){this._sweepVolumes=[];this._entityRegistry={};this._boundingVolumeRegistry={};this.endpoints={x:[],y:[],z:[]};this.overlaps=[];this.overlapsMatrix={};this._IDPool=[];a=a||[];for(var b=0;b<a.length;b++)this.add(a[b])}function a(a){this._boundingVolume=
a;this._ID=a._ID;this.points={x:[{_ID:a._ID,side:0,value:null},{_ID:a._ID,side:1,value:null}],y:[{_ID:a._ID,side:0,value:null},{_ID:a._ID,side:1,value:null}],z:[{_ID:a._ID,side:0,value:null},{_ID:a._ID,side:1,value:null}]};this.update()}var d=f("./AABB"),c=["x","y","z"];b.prototype.add=function(b){var f=new d(b),g=new a(f);this._entityRegistry[b._ID]=b;this._boundingVolumeRegistry[b._ID]=f;this._sweepVolumes.push(g);for(b=0;3>b;b++)f=c[b],this.endpoints[f].push(g.points[f][0]),this.endpoints[f].push(g.points[f][1])};
b.prototype.remove=function(a){this._entityRegistry[a._ID]=null;this._boundingVolumeRegistry[a._ID]=null;var b,d,c;b=0;for(d=this._sweepVolumes.length;b<d;b++)if(this._sweepVolumes[b]._ID===a._ID){c=b;break}this._sweepVolumes.splice(c,1);c=this.endpoints;var f,p=[];b=0;for(d=c.x.length;b<d;b++)f=c.x[b],f._ID!==a._ID&&p.push(f);var q=[];b=0;for(d=c.y.length;b<d;b++)f=c.y[b],f._ID!==a._ID&&q.push(f);var w=[];b=0;for(d=c.z.length;b<d;b++)f=c.z[b],f._ID!==a._ID&&w.push(f);c.x=p;c.y=q;c.z=w};b.prototype.update=
function(){var a=this._sweepVolumes,b=this._entityRegistry,f=this._boundingVolumeRegistry,u,k,p;u=0;for(p=a.length;u<p;u++)a[u].update();var q=this.endpoints,w=this.overlaps,t=this.overlapsMatrix,l=this._IDPool;for(k=0;3>k;k++){var m=q[c[k]];u=1;for(p=m.length;u<p;u++){for(var v=m[u],x=v.value,r,z,y,A,F,Q,a=u-1;0<=a&&(r=m[a]).value>x;)y=v._ID,Q=r._ID,y<Q?(A=y,F=Q):(A=Q,F=y),~v.side&r.side?d.checkOverlap(f[y],f[Q])&&(z=t[A]=t[A]||{},y=z[F]=l.length?l.pop():w.length,w[y]=[b[A],b[F]]):v.side&~r.side&&
(z=t[A])&&null!=z[F]&&(y=z[F],w[y]=null,z[F]=null,l.push(y)),m[a+1]=r,a--;m[a+1]=v}}return w};a.prototype.update=function(){var a=this._boundingVolume;a.update();for(var b=this.points,d=0;3>d;d++){var f=c[d];b[f][0].value=a.vertices[f][0];b[f][1].value=a.vertices[f][1]}};l.exports=b},{"./AABB":52}],57:[function(f,l,r){function b(b,d){a.call(this,b,d)}var a=f("./Force"),d=f("../../math/Vec3"),c=new d;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.QUADRATIC=function(a){return a*
a};b.LINEAR=function(a){return a};b.prototype.init=function(){this.max=this.max||Infinity;this.strength=this.strength||1;this.type=this.type||b.LINEAR};b.prototype.update=function(){for(var a=this.targets,b=this.type,f=this.max,l=this.strength,k=0,p=a.length;k<p;k++){var q=a[k],w=q.velocity,t=w.length(),B=t?1/t:0,t=-l*b(t);d.scale(w,(t<-f?-f:t)*B,c);q.applyForce(c)}};l.exports=b},{"../../math/Vec3":35,"./Force":58}],58:[function(f,l,r){function b(b,c){this.targets=b?b instanceof Array?b:[b]:[];c=
c||{};this.setOptions(c);this._ID=a++}var a=0;b.prototype.setOptions=function(a){for(var b in a)this[b]=a[b];this.init(a)};b.prototype.addTarget=function(a){this.targets.push(a)};b.prototype.removeTarget=function(a){a=this.targets.indexOf(a);0>a||this.targets.splice(a,1)};b.prototype.init=function(a){};b.prototype.update=function(a,b){};l.exports=b},{}],59:[function(f,l,r){function b(b,d){a.call(this,b,d)}var a=f("./Force"),d=f("../../math/Vec3"),c=new d;b.prototype=Object.create(a.prototype);b.prototype.constructor=
b;b.DOWN=0;b.UP=1;b.LEFT=2;b.RIGHT=3;b.FORWARD=4;b.BACKWARD=5;b.prototype.init=function(a){this.max=this.max||Infinity;if(a.acceleration)this.strength=this.acceleration.length(),this.direction=-1;else{a=this.acceleration=new d;var c=this.direction=this.direction||b.DOWN,f=this.strength=this.strength||200;switch(c){case b.DOWN:a.set(0,f,0);break;case b.UP:a.set(0,-1*f,0);break;case b.LEFT:a.set(-1*f,0,0);break;case b.RIGHT:a.set(f,0,0);break;case b.FORWARD:a.set(0,0,-1*f);break;case b.BACKWARD:a.set(0,
0,f)}}};b.prototype.update=function(){for(var a=this.targets,b=this.max,f=this.acceleration,l=f.length(),k=l?1/l:0,p=0,q=a.length;p<q;p++){var w=a[p],t=l*w.mass;d.scale(f,(t>b?b:t)*k,c);w.applyForce(c)}};l.exports=b},{"../../math/Vec3":35,"./Force":58}],60:[function(f,l,r){function b(b,d,c){this.source=b||null;a.call(this,d,c)}var a=f("./Force"),d=f("../../math/Vec3"),c=new d;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.init=function(){this.max=this.max||Infinity;this.strength=
this.strength||200};b.prototype.update=function(){for(var a=this.source,b=this.targets,f=this.strength,l=this.max,k=this.anchor||a.position,p=this.anchor?1:a.mass,q=0,w=b.length;q<w;q++){var t=b[q];if(null==t)q++;else{d.subtract(k,t.position,c);var B=c.length(),B=B?1/B:0,m=f*p*t.mass*B*B,m=0>m?m<-l?-l:m:m>l?l:m;c.scale(m*B);t.applyForce(c);a&&a.applyForce(c.invert())}}};l.exports=b},{"../../math/Vec3":35,"./Force":58}],61:[function(f,l,r){function b(b,d){a.call(this,b,d)}var a=f("./Force"),d=f("../../math/Vec3"),
c=new d;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.QUADRATIC=function(a){return a.length()};b.LINEAR=function(){return 1};b.prototype.init=function(){this.max=this.max||Infinity;this.strength=this.strength||1;this.type=this.type||b.LINEAR};b.prototype.update=function(){for(var a=this.targets,b=this.type,f=this.max,l=this.strength,k=0,p=a.length;k<p;k++){var q=a[k],w=q.angularVelocity,t=-l*b(w);d.scale(w,t<-f?-f:t,c);q.applyTorque(c)}};l.exports=b},{"../../math/Vec3":35,"./Force":58}],
62:[function(f,l,r){function b(b,d,c){this.source=b||null;a.call(this,d,c)}var a=f("./Force"),d=f("../../math/Vec3"),c=f("../../math/Mat33"),e=f("../../math/Quaternion"),h=new e,g=new d,u=new d,k=new c,p=Math.PI;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.init=function(a){this.source||(this.anchor=this.anchor?this.anchor.normalize():new e(1,0,0,0));if(a.stiffness||a.damping)this.stiffness=this.stiffness||100,this.damping=this.damping||0,this.dampingRatio=this.period=
null;else if(a.period||a.dampingRatio)this.period=this.period||1,this.dampingRatio=this.dampingRatio||0,this.stiffness=2*p/this.period,this.stiffness*=this.stiffness,this.damping=4*p*this.dampingRatio/this.period};b.prototype.update=function(){for(var a=this.source,b=this.targets,f=this.max,p=this.stiffness,m=this.damping,v=this.anchor||a.orientation,x=this.anchor?null:a.inverseInertia,l=0,r=b.length;l<r;l++){var y=b[l];e.conjugate(y.orientation,h);h.multiply(v);if(!(1<=h.w)){var A=Math.acos(h.w),
F=Math.sqrt(1-h.w*h.w),A=u.copy(h).scale(2*A/F);A.scale(p);null!==x?c.add(x,y.inverseInertia,k).inverse():c.inverse(y.inverseInertia,k);0!==m&&(a?A.add(d.subtract(y.angularVelocity,a.angularVelocity,g).scale(-m)):A.add(d.scale(y.angularVelocity,-m,g)));A=A.applyMatrix(k);F=A.length();F>f&&A.scale(f/F);y.applyTorque(A);a&&a.applyTorque(A.invert())}}};l.exports=b},{"../../math/Mat33":32,"../../math/Quaternion":33,"../../math/Vec3":35,"./Force":58}],63:[function(f,l,r){function b(b,d,c){this.source=
b||null;a.call(this,d,c)}var a=f("./Force"),d=f("../../math/Vec3"),c=new d,e=new d;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;var h=Math.PI;b.FENE=function(a,b){var d=.99*b,d=Math.max(Math.min(a,d),-d);return d/(1-d*d/(b*b))};b.HOOKE=function(a){return a};b.prototype.init=function(a){this.max=this.max||Infinity;this.length=this.length||0;this.type=this.type||b.HOOKE;this.maxLength=this.maxLength||Infinity;if(a.stiffness||a.damping)this.stiffness=this.stiffness||100,this.damping=
this.damping||0,this.dampingRatio=this.period=null;else if(a.period||a.dampingRatio)this.period=this.period||1,this.dampingRatio=this.dampingRatio||0,this.stiffness=2*h/this.period,this.stiffness*=this.stiffness,this.damping=4*h*this.dampingRatio/this.period};b.prototype.update=function(){for(var a=this.source,b=this.targets,f=this.max,h=this.stiffness,q=this.damping,w=this.length,t=this.maxLength,l=this.anchor||a.position,m=this.anchor?0:a.inverseMass,v=this.type,x=0,r=b.length;x<r;x++){var z=b[x];
d.subtract(l,z.position,c);var y=c.length()-w;if(!(1E-6>Math.abs(y))){var A=1/(z.inverseMass+m);null!==this.period&&(h*=A,q*=A);c.scale(h*v(y,t)/y);0!==q&&(a?c.add(d.subtract(z.velocity,a.velocity,e).scale(-q)):c.add(d.scale(z.velocity,-q,e)));y=c.length();d.scale(c,(y>f?f:y)*(y?1/y:0),c);z.applyForce(c);a&&a.applyForce(c.invert())}}};l.exports=b},{"../../math/Vec3":35,"./Force":58}],64:[function(f,l,r){l.exports={Particle:f("./bodies/Particle"),convexBodyFactory:f("./bodies/convexBodyFactory"),Box:f("./bodies/Box"),
Sphere:f("./bodies/Sphere"),Wall:f("./bodies/Wall"),Constraint:f("./constraints/Constraint"),Angle:f("./constraints/Angle"),Collision:f("./constraints/Collision"),Direction:f("./constraints/Direction"),Distance:f("./constraints/Distance"),Curve:f("./constraints/Curve"),Hinge:f("./constraints/Hinge"),BallAndSocket:f("./constraints/BallAndSocket"),Force:f("./forces/Force"),Drag:f("./forces/Drag"),RotationalDrag:f("./forces/RotationalDrag"),Gravity1D:f("./forces/Gravity1D"),Gravity3D:f("./forces/Gravity3D"),
Spring:f("./forces/Spring"),RotationalSpring:f("./forces/RotationalSpring"),PhysicsEngine:f("./PhysicsEngine"),Geometry:f("./Geometry")}},{"./Geometry":37,"./PhysicsEngine":38,"./bodies/Box":39,"./bodies/Particle":40,"./bodies/Sphere":41,"./bodies/Wall":42,"./bodies/convexBodyFactory":43,"./constraints/Angle":44,"./constraints/BallAndSocket":45,"./constraints/Collision":46,"./constraints/Constraint":47,"./constraints/Curve":48,"./constraints/Direction":49,"./constraints/Distance":50,"./constraints/Hinge":51,
"./forces/Drag":57,"./forces/Force":58,"./forces/Gravity1D":59,"./forces/Gravity3D":60,"./forces/RotationalDrag":61,"./forces/RotationalSpring":62,"./forces/Spring":63}],65:[function(f,l,r){var b=0;f=["ms","moz","webkit","o"];var a,d;if("object"===typeof window){a=window.requestAnimationFrame;d=window.cancelAnimationFrame||window.cancelRequestAnimationFrame;for(r=0;r<f.length&&!a;++r)a=window[f[r]+"RequestAnimationFrame"],d=window[f[r]+"CancelRequestAnimationFrame"]||window[f[r]+"CancelAnimationFrame"];
a&&!d&&(a=null)}if(!a){var c=Date.now?Date.now:function(){return(new Date).getTime()};a=function(a){var d=c(),f=Math.max(0,16-(d-b)),l=setTimeout(function(){a(d+f)},f);b=d+f;return l};d=function(a){clearTimeout(a)}}l.exports={requestAnimationFrame:a,cancelAnimationFrame:d}},{}],66:[function(f,l,r){l.exports={requestAnimationFrame:f("./animationFrame").requestAnimationFrame,cancelAnimationFrame:f("./animationFrame").cancelAnimationFrame}},{"./animationFrame":65}],67:[function(f,l,r){function b(){var a=
this;this._updates=[];this._looper=function(b){a.loop(b)};this._sleep=this._stoppedAt=this._time=0;this._startOnVisibilityChange=!0;this._rAF=null;this._sleepDiff=!0;this.start();c&&document.addEventListener(h,function(){a._onVisibilityChange()})}f=f("../polyfills");var a=f.requestAnimationFrame,d=f.cancelAnimationFrame,c="undefined"!==typeof document;if(c){var e,h;"undefined"!==typeof document.hidden?(e="hidden",h="visibilitychange"):"undefined"!==typeof document.mozHidden?(e="mozHidden",h="mozvisibilitychange"):
"undefined"!==typeof document.msHidden?(e="msHidden",h="msvisibilitychange"):"undefined"!==typeof document.webkitHidden&&(e="webkitHidden",h="webkitvisibilitychange")}b.prototype._onVisibilityChange=function(){document[e]?this._onUnfocus():this._onFocus()};b.prototype._onFocus=function(){this._startOnVisibilityChange&&this._start()};b.prototype._onUnfocus=function(){this._stop()};b.prototype.start=function(){this._running||(this._startOnVisibilityChange=!0,this._start());return this};b.prototype._start=
function(){this._sleepDiff=this._running=!0;this._rAF=a(this._looper)};b.prototype.stop=function(){this._running&&(this._startOnVisibilityChange=!1,this._stop());return this};b.prototype._stop=function(){this._running=!1;this._stoppedAt=this._time;d(this._rAF)};b.prototype.isRunning=function(){return this._running};b.prototype.step=function(a){this._time=a;this._sleepDiff&&(this._sleep+=a-this._stoppedAt,this._sleepDiff=!1);a-=this._sleep;for(var b=0,d=this._updates.length;b<d;b++)this._updates[b].update(a);
return this};b.prototype.loop=function(b){this.step(b);this._rAF=a(this._looper);return this};b.prototype.update=function(a){-1===this._updates.indexOf(a)&&this._updates.push(a);return this};b.prototype.noLongerUpdate=function(a){a=this._updates.indexOf(a);-1<a&&this._updates.splice(a,1);return this};l.exports=b},{"../polyfills":66}],68:[function(f,l,r){function b(){d();this._contexts={};this._outCommands=[];this._inCommands=[];this._time=null;this._resized=!1;var a=this;window.addEventListener("resize",
function(){a.onResize()})}var a=f("./Context"),d=f("./inject-css"),c=f("../core/Commands");b.prototype.onResize=function(){this._resized=!0;for(var a in this._contexts)this._contexts[a].updateSize()};b.prototype.getTime=function(){return this._time};b.prototype.sendEvent=function(a,b,d){this._outCommands.push(c.WITH,a,c.TRIGGER,b,d)};b.prototype.sendResize=function(a,b){this.sendEvent(a,"CONTEXT_RESIZE",b)};b.prototype.handleWith=function(a,b){var d=b[a],c=d.split("/");return this.getOrSetContext(c.shift()).receive(d,
b,a)};b.prototype.getOrSetContext=function(b){if(this._contexts[b])return this._contexts[b];var d=new a(b,this);return this._contexts[b]=d};b.prototype.getContext=function(a){if(this._contexts[a])return this._contexts[a]};b.prototype.drawCommands=function(){for(var a=this._inCommands,b=0,d=a[b];d;){switch(d){case c.TIME:this._time=a[++b];break;case c.WITH:b=this.handleWith(++b,a);break;case c.NEED_SIZE_FOR:this.giveSizeFor(++b,a)}d=a[++b]}for(var f in this._contexts)this._contexts[f].draw();this._resized&&
this.updateSize();return this._outCommands};b.prototype.updateSize=function(){for(var a in this._contexts)this._contexts[a].updateSize()};b.prototype.receiveCommands=function(a){for(var b=a.length,d=0;d<b;d++)this._inCommands.push(a[d]);for(var c in this._contexts)this._contexts[c].checkInit()};b.prototype.giveSizeFor=function(a,b){var d=b[a],c=this.getOrSetContext(d).getRootSize();this.sendResize(d,c)};b.prototype.clearCommands=function(){this._inCommands.length=0;this._outCommands.length=0;this._resized=
!1};l.exports=b},{"../core/Commands":5,"./Context":69,"./inject-css":71}],69:[function(f,l,r){function b(a,b){this._compositor=b;this._rootEl=document.querySelector(a);this._selector=a;if(null===this._rootEl)throw Error('Failed to create Context: No matches for "'+a+'" found.');this._selector=a;this._initDOMRenderer();this._webGLRenderer=null;this._domRenderer=new C(this._domRendererRootEl,a,b);this._canvasEl=null;this._renderState={projectionType:G.ORTHOGRAPHIC_PROJECTION,perspectiveTransform:new Float32Array([1,
0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),viewTransform:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),viewDirty:!1,perspectiveDirty:!1};this._size=[];this._meshTransform=new Float32Array(16);this._meshSize=[0,0,0];this._initDOM=!1;this._commandCallbacks=[];this.initCommandCallbacks();this.updateSize()}function a(a,b,d,c){a._webGLRenderer&&a._webGLRenderer.getOrSetCutout(b);a._domRenderer.preventDefault(d[++c]);return c}function d(a,b,d,c){a._webGLRenderer&&a._webGLRenderer.getOrSetCutout(b);a._domRenderer.allowDefault(d[++c]);
return c}function c(a,b,d,c){a._initDOM=!0;return c}function e(a,b,d,c){a._domRenderer.insertEl(d[++c]);return c}function h(a,b,d,c){a._domRenderer.getSizeOf(d[++c]);return c}function g(a,b,d,c){var e=a._meshTransform;e[0]=d[++c];e[1]=d[++c];e[2]=d[++c];e[3]=d[++c];e[4]=d[++c];e[5]=d[++c];e[6]=d[++c];e[7]=d[++c];e[8]=d[++c];e[9]=d[++c];e[10]=d[++c];e[11]=d[++c];e[12]=d[++c];e[13]=d[++c];e[14]=d[++c];e[15]=d[++c];a._domRenderer.setMatrix(e);a._webGLRenderer&&a._webGLRenderer.setCutoutUniform(b,"u_transform",
e);return c}function u(a,b,d,c){var e=d[++c];d=d[++c];a._domRenderer.setSize(e,d);a._webGLRenderer&&(a._meshSize[0]=e,a._meshSize[1]=d,a._webGLRenderer.setCutoutUniform(b,"u_size",a._meshSize));return c}function k(a,b,d,c){a._webGLRenderer&&a._webGLRenderer.getOrSetCutout(b);a._domRenderer.setProperty(d[++c],d[++c]);return c}function p(a,b,d,c){a._webGLRenderer&&a._webGLRenderer.getOrSetCutout(b);a._domRenderer.setContent(d[++c]);return c}function q(a,b,d,c){a._webGLRenderer&&a._webGLRenderer.getOrSetCutout(b);
a._domRenderer.setAttribute(d[++c],d[++c]);return c}function w(a,b,d,c){a._webGLRenderer&&a._webGLRenderer.getOrSetCutout(b);a._domRenderer.addClass(d[++c]);return c}function t(a,b,d,c){a._webGLRenderer&&a._webGLRenderer.getOrSetCutout(b);a._domRenderer.removeClass(d[++c]);return c}function B(a,b,d,c){a._webGLRenderer&&a._webGLRenderer.getOrSetCutout(b);a._domRenderer.subscribe(d[++c]);return c}function m(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.setMeshOptions(b,d[++c]);
return c}function v(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.setAmbientLightColor(b,d[++c],d[++c],d[++c]);return c}function x(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.setLightPosition(b,d[++c],d[++c],d[++c]);return c}function I(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.setLightColor(b,d[++c],d[++c],d[++c]);return c}function z(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.handleMaterialInput(b,d[++c],
d[++c]);return c}function y(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.setGeometry(b,d[++c],d[++c],d[++c]);return c}function A(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.setMeshUniform(b,d[++c],d[++c]);return c}function F(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.bufferData(b,d[++c],d[++c],d[++c],d[++c],d[++c]);return c}function Q(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.setCutoutState(b,d[++c]);return c}
function J(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.setMeshVisibility(b,d[++c]);return c}function D(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.removeMesh(b);return c}function O(a,b,d,c){a._renderState.projectionType=G.PINHOLE_PROJECTION;a._renderState.perspectiveTransform[11]=-1/d[++c];a._renderState.perspectiveDirty=!0;return c}function N(a,b,d,c){a._renderState.projectionType=G.ORTHOGRAPHIC_PROJECTION;a._renderState.perspectiveTransform[11]=0;a._renderState.perspectiveDirty=
!0;return c}function K(a,b,d,c){a._renderState.viewTransform[0]=d[++c];a._renderState.viewTransform[1]=d[++c];a._renderState.viewTransform[2]=d[++c];a._renderState.viewTransform[3]=d[++c];a._renderState.viewTransform[4]=d[++c];a._renderState.viewTransform[5]=d[++c];a._renderState.viewTransform[6]=d[++c];a._renderState.viewTransform[7]=d[++c];a._renderState.viewTransform[8]=d[++c];a._renderState.viewTransform[9]=d[++c];a._renderState.viewTransform[10]=d[++c];a._renderState.viewTransform[11]=d[++c];
a._renderState.viewTransform[12]=d[++c];a._renderState.viewTransform[13]=d[++c];a._renderState.viewTransform[14]=d[++c];a._renderState.viewTransform[15]=d[++c];a._renderState.viewDirty=!0;return c}var E=f("../webgl-renderers/WebGLRenderer"),G=f("../components/Camera"),C=f("../dom-renderers/DOMRenderer"),L=f("../core/Commands");b.prototype.updateSize=function(){var a=this._rootEl.offsetWidth,b=this._rootEl.offsetHeight;this._size[0]=a;this._size[1]=b;this._size[2]=a>b?a:b;this._compositor.sendResize(this._selector,
this._size);this._webGLRenderer&&this._webGLRenderer.updateSize(this._size);return this};b.prototype.draw=function(){this._domRenderer.draw(this._renderState);this._webGLRenderer&&this._webGLRenderer.draw(this._renderState);this._renderState.perspectiveDirty&&(this._renderState.perspectiveDirty=!1);this._renderState.viewDirty&&(this._renderState.viewDirty=!1)};b.prototype._initDOMRenderer=function(){this._domRendererRootEl=document.createElement("div");this._rootEl.appendChild(this._domRendererRootEl);
this._domRendererRootEl.style.display="none";this._domRenderer=new C(this._domRendererRootEl,this._selector,this._compositor)};b.prototype.getRootSize=function(){return[this._rootEl.offsetWidth,this._rootEl.offsetHeight]};b.prototype.initCommandCallbacks=function(){this._commandCallbacks[L.INIT_DOM]=e;this._commandCallbacks[L.DOM_RENDER_SIZE]=h;this._commandCallbacks[L.CHANGE_TRANSFORM]=g;this._commandCallbacks[L.CHANGE_SIZE]=u;this._commandCallbacks[L.CHANGE_PROPERTY]=k;this._commandCallbacks[L.CHANGE_CONTENT]=
p;this._commandCallbacks[L.CHANGE_ATTRIBUTE]=q;this._commandCallbacks[L.ADD_CLASS]=w;this._commandCallbacks[L.REMOVE_CLASS]=t;this._commandCallbacks[L.SUBSCRIBE]=B;this._commandCallbacks[L.GL_SET_DRAW_OPTIONS]=m;this._commandCallbacks[L.GL_AMBIENT_LIGHT]=v;this._commandCallbacks[L.GL_LIGHT_POSITION]=x;this._commandCallbacks[L.GL_LIGHT_COLOR]=I;this._commandCallbacks[L.MATERIAL_INPUT]=z;this._commandCallbacks[L.GL_SET_GEOMETRY]=y;this._commandCallbacks[L.GL_UNIFORMS]=A;this._commandCallbacks[L.GL_BUFFER_DATA]=
F;this._commandCallbacks[L.GL_CUTOUT_STATE]=Q;this._commandCallbacks[L.GL_MESH_VISIBILITY]=J;this._commandCallbacks[L.GL_REMOVE_MESH]=D;this._commandCallbacks[L.PINHOLE_PROJECTION]=O;this._commandCallbacks[L.ORTHOGRAPHIC_PROJECTION]=N;this._commandCallbacks[L.CHANGE_VIEW_TRANSFORM]=K;this._commandCallbacks[L.PREVENT_DEFAULT]=a;this._commandCallbacks[L.ALLOW_DEFAULT]=d;this._commandCallbacks[L.READY]=c};b.prototype._initWebGLRenderer=function(){this._webGLRendererRootEl=document.createElement("canvas");
this._rootEl.appendChild(this._webGLRendererRootEl);this._webGLRenderer=new E(this._webGLRendererRootEl,this._compositor);this._webGLRenderer.updateSize(this._size)};b.prototype.getRootSize=function(){return[this._rootEl.offsetWidth,this._rootEl.offsetHeight]};b.prototype.checkInit=function(){this._initDOM&&(this._domRendererRootEl.style.display="block",this._initDOM=!1)};b.prototype.receive=function(a,b,d){var c=b[++d];this._domRenderer.loadPath(a);for(this._domRenderer.findTarget();null!=c;){if(c===
L.WITH||c===L.TIME)return d-1;d=this._commandCallbacks[c](this,a,b,d)+1;c=b[d]}return d};b.prototype.getDOMRenderer=function(){return this._domRenderer};b.prototype.getWebGLRenderer=function(){return this._webGLRenderer};l.exports=b},{"../components/Camera":1,"../core/Commands":5,"../dom-renderers/DOMRenderer":18,"../webgl-renderers/WebGLRenderer":85}],70:[function(f,l,r){function b(b,c,e){this._thread=b;this._compositor=c;this._renderLoop=e;this._renderLoop.update(this);var f=this;this._thread.onmessage=
function(b){b=b.data?b.data:b;if(b[0]===a.ENGINE)switch(b[1]){case a.START:f._engine.start();break;case a.STOP:f._engine.stop();break;default:console.error('Unknown ENGINE command "'+b[1]+'"')}else f._compositor.receiveCommands(b)};this._thread.onerror=function(a){console.error(a)}}var a=f("../core/Commands");b.prototype.getThread=function(){return this._thread};b.prototype.getCompositor=function(){return this._compositor};b.prototype.getEngine=function(){return this._renderLoop};b.prototype.getRenderLoop=
function(){return this._renderLoop};b.prototype.update=function(b){this._thread.postMessage([a.FRAME,b]);b=this._compositor.drawCommands();this._thread.postMessage(b);this._compositor.clearCommands()};l.exports=b},{"../core/Commands":5}],71:[function(f,l,r){var b="undefined"===typeof document;l.exports=function(){if(!b)if(b=!0,document.createStyleSheet)document.createStyleSheet().cssText=".famous-dom-renderer {width:100%;height:100%;transform-style:preserve-3d;-webkit-transform-style:preserve-3d;}.famous-dom-element {-webkit-transform-origin:0% 0%;transform-origin:0% 0%;-webkit-backface-visibility:visible;backface-visibility:visible;-webkit-transform-style:preserve-3d;transform-style:preserve-3d;-webkit-tap-highlight-color:transparent;pointer-events:auto;z-index:1;}.famous-dom-element-content,.famous-dom-element {position:absolute;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;}.famous-webgl-renderer {-webkit-transform:translateZ(1000000px);transform:translateZ(1000000px);pointer-events:none;position:absolute;z-index:1;top:0;width:100%;height:100%;}";
else{var a=document.getElementsByTagName("head")[0],d=document.createElement("style");d.styleSheet?d.styleSheet.cssText=".famous-dom-renderer {width:100%;height:100%;transform-style:preserve-3d;-webkit-transform-style:preserve-3d;}.famous-dom-element {-webkit-transform-origin:0% 0%;transform-origin:0% 0%;-webkit-backface-visibility:visible;backface-visibility:visible;-webkit-transform-style:preserve-3d;transform-style:preserve-3d;-webkit-tap-highlight-color:transparent;pointer-events:auto;z-index:1;}.famous-dom-element-content,.famous-dom-element {position:absolute;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;}.famous-webgl-renderer {-webkit-transform:translateZ(1000000px);transform:translateZ(1000000px);pointer-events:none;position:absolute;z-index:1;top:0;width:100%;height:100%;}":
d.appendChild(document.createTextNode(".famous-dom-renderer {width:100%;height:100%;transform-style:preserve-3d;-webkit-transform-style:preserve-3d;}.famous-dom-element {-webkit-transform-origin:0% 0%;transform-origin:0% 0%;-webkit-backface-visibility:visible;backface-visibility:visible;-webkit-transform-style:preserve-3d;transform-style:preserve-3d;-webkit-tap-highlight-color:transparent;pointer-events:auto;z-index:1;}.famous-dom-element-content,.famous-dom-element {position:absolute;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;}.famous-webgl-renderer {-webkit-transform:translateZ(1000000px);transform:translateZ(1000000px);pointer-events:none;position:absolute;z-index:1;top:0;width:100%;height:100%;}"));
(a?a:document.documentElement).appendChild(d)}}},{}],72:[function(f,l,r){var b={linear:function(a){return a},easeIn:function(a){return a*a},easeOut:function(a){return a*(2-a)},easeInOut:function(a){return.5>=a?2*a*a:-2*a*a+4*a-1},easeOutBounce:function(a){return a*(3-2*a)},spring:function(a){return(1-a)*Math.sin(6*Math.PI*a)+a},inQuad:function(a){return a*a},outQuad:function(a){return- --a*a+1},inOutQuad:function(a){return 1>(a/=.5)?.5*a*a:-.5*(--a*(a-2)-1)},inCubic:function(a){return a*a*a},outCubic:function(a){return--a*
a*a+1},inOutCubic:function(a){return 1>(a/=.5)?.5*a*a*a:.5*((a-=2)*a*a+2)},inQuart:function(a){return a*a*a*a},outQuart:function(a){return-(--a*a*a*a-1)},inOutQuart:function(a){return 1>(a/=.5)?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)},inQuint:function(a){return a*a*a*a*a},outQuint:function(a){return--a*a*a*a*a+1},inOutQuint:function(a){return 1>(a/=.5)?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)},inSine:function(a){return-1*Math.cos(Math.PI/2*a)+1},outSine:function(a){return Math.sin(Math.PI/2*a)},inOutSine:function(a){return-.5*
(Math.cos(Math.PI*a)-1)},inExpo:function(a){return 0===a?0:Math.pow(2,10*(a-1))},outExpo:function(a){return 1===a?1:-Math.pow(2,-10*a)+1},inOutExpo:function(a){return 0===a?0:1===a?1:1>(a/=.5)?.5*Math.pow(2,10*(a-1)):.5*(-Math.pow(2,-10*--a)+2)},inCirc:function(a){return-(Math.sqrt(1-a*a)-1)},outCirc:function(a){return Math.sqrt(1- --a*a)},inOutCirc:function(a){return 1>(a/=.5)?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)},inElastic:function(a){var b=1.70158,c=0;if(0===a)return 0;if(1===
a)return 1;c||(c=.3);b=c/(2*Math.PI)*Math.asin(1);return-(1*Math.pow(2,10*--a)*Math.sin(2*(a-b)*Math.PI/c))},outElastic:function(a){var b=1.70158,c=0;if(0===a)return 0;if(1===a)return 1;c||(c=.3);b=c/(2*Math.PI)*Math.asin(1);return 1*Math.pow(2,-10*a)*Math.sin(2*(a-b)*Math.PI/c)+1},inOutElastic:function(a){var b=1.70158,c=0;if(0===a)return 0;if(2===(a/=.5))return 1;c||(c=.3*1.5);b=c/(2*Math.PI)*Math.asin(1);return 1>a?-.5*Math.pow(2,10*--a)*Math.sin(2*(a-b)*Math.PI/c):1*Math.pow(2,-10*--a)*Math.sin(2*
(a-b)*Math.PI/c)*.5+1},inBack:function(a,b){void 0===b&&(b=1.70158);return a*a*((b+1)*a-b)},outBack:function(a,b){void 0===b&&(b=1.70158);return--a*a*((b+1)*a+b)+1},inOutBack:function(a,b){void 0===b&&(b=1.70158);return 1>(a/=.5)?.5*a*a*(((b*=1.525)+1)*a-b):.5*((a-=2)*a*(((b*=1.525)+1)*a+b)+2)},inBounce:function(a){return 1-b.outBounce(1-a)},outBounce:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},
inOutBounce:function(a){return.5>a?.5*b.inBounce(2*a):.5*b.outBounce(2*a-1)+.5},flat:function(){return 0}};l.exports=b},{}],73:[function(f,l,r){function b(a){this._queue=[];this._pausedAt=this._startedAt=this._state=this._from=null;null!=a&&this.from(a)}var a=f("./Curves");f=f("../core/FamousEngine");b.Clock=f.getClock();b.prototype.to=function(b,c,e,f,g,l){c=null!=c&&c.constructor===String?a[c]:c;0===this._queue.length&&(this._startedAt=this.constructor.Clock.now(),this._pausedAt=null);this._queue.push(b,
null!=c?c:a.linear,null!=e?e:100,f,g,l);return this};b.prototype.from=function(a){this._state=a;this._from=this._sync(null,this._state);this._queue.length=0;this._startedAt=this.constructor.Clock.now();this._pausedAt=null;return this};b.prototype.delay=function(b,c){return this.to(0<this._queue.length?this._queue[this._queue.length-5]:this._state,a.flat,b,c)};b.prototype.override=function(b,c,e,f,g){0<this._queue.length&&(null!=b&&(this._queue[0]=b),null!=c&&(this._queue[1]=c.constructor===String?
a[c]:c),null!=e&&(this._queue[2]=e),null!=f&&(this._queue[3]=f),null!=g&&(this._queue[4]=g));return this};b.prototype._interpolate=function(a,b,e,f,g){if(e instanceof Object)if("slerp"===g){var l,k,p,q,w,t,r,m;g=b[0];l=b[1];k=b[2];b=b[3];p=e[0];q=e[1];w=e[2];e=e[3];if(1===f)return a[0]=p,a[1]=q,a[2]=w,a[3]=e,a;r=b*e+g*p+l*q+k*w;1E-5<1-r?(t=Math.acos(r),m=Math.sin(t),r=Math.sin((1-f)*t)/m,f=Math.sin(f*t)/m):r=1-f;a[0]=g*r+p*f;a[1]=l*r+q*f;a[2]=k*r+w*f;a[3]=b*r+e*f}else if(e instanceof Array)for(l=
0,k=e.length;l<k;l++)a[l]=this._interpolate(a[l],b[l],e[l],f,g);else for(l in e)a[l]=this._interpolate(a[l],b[l],e[l],f,g);else a=b+f*(e-b);return a};b.prototype._sync=function c(a,b){if("number"===typeof b)a=b;else if(b instanceof Array){null==a&&(a=[]);for(var f=0,l=b.length;f<l;f++)a[f]=c(a[f],b[f])}else if(b instanceof Object)for(f in null==a&&(a={}),b)a[f]=c(a[f],b[f]);return a};b.prototype.get=function(a){if(0===this._queue.length)return this._state;a=(a=this._pausedAt?this._pausedAt:a)?a:this.constructor.Clock.now();
a=(a-this._startedAt)/this._queue[2];var b=this._state=this._interpolate(this._state,this._from,this._queue[0],this._queue[1](1<a?1:a),this._queue[4]);if(1<=a){this._startedAt+=this._queue[2];this._from=this._sync(this._from,this._state);this._queue.shift();this._queue.shift();this._queue.shift();var f=this._queue.shift();this._queue.shift();var g=this._queue.shift();f&&g?f(g):f&&!g&&f()}return 1<a?this.get():b};b.prototype.isActive=function(){return 0<this._queue.length};b.prototype.halt=function(){return this.from(this.get())};
b.prototype.pause=function(){this._pausedAt=this.constructor.Clock.now();return this};b.prototype.isPaused=function(){return!!this._pausedAt};b.prototype.resume=function(){var a=this._pausedAt-this._startedAt;this._startedAt=this.constructor.Clock.now()-a;this._pausedAt=null;return this};b.prototype.reset=function(a){return this.from(a)};b.prototype.set=function(a,b,f){null==b?(this.from(a),f&&f()):this.to(a,b.curve,b.duration,f,b.method);return this};l.exports=b},{"../core/FamousEngine":8,"./Curves":72}],
74:[function(f,l,r){function b(){this._events={}}b.prototype.on=function(a,b){this._events[a]||(this._events[a]=[]);var c=this._events[a];c.push(b);return function(){c.splice(c.indexOf(b),1)}};b.prototype.off=function(a,b){var c=this._events[a];c&&c.splice(c.indexOf(b),1);return this};b.prototype.trigger=function(a,b){var c=this._events[a];if(c)for(var e=0,f=c.length;e<f;e++)c[e](b);return this};l.exports=b},{}],75:[function(f,l,r){function b(a,b){return function(){return 0!==a.length?a.pop():new b}}
function a(a){return function(b){a.push(b)}}l.exports={pools:{},register:function(d,c){var e=this.pools[d]=[];this["request"+d]=b(e,c);this["free"+d]=a(e)},disposeOf:function(a){a=this.pools[a];for(var b=a.length;b--;)a.pop()}}},{}],76:[function(f,l,r){l.exports=function a(d){var c;if("object"===typeof d){c=d instanceof Array?[]:{};for(var e in d)if("object"===typeof d[e]&&null!==d[e])if(d[e]instanceof Array){c[e]=Array(d[e].length);for(var f=0;f<d[e].length;f++)c[e][f]=a(d[e][f])}else c[e]=a(d[e]);
else c[e]=d[e]}else c=d;return c}},{}],77:[function(f,l,r){l.exports=function(b){var a=[],d=[],c=0,e;for(e in b)b.hasOwnProperty(e)&&(a[c]=e,d[c]=b[e],c++);return{keys:a,values:d}}},{}],78:[function(f,l,r){var b=["","-ms-","-webkit-","-moz-","-o-"];l.exports=function(a){for(var d=0;d<b.length;d++){var c=b[d]+a;if(""===document.documentElement.style[c])return c}return a}},{}],79:[function(f,l,r){function b(a,b,c){this.buffer=null;this.target=a;this.type=b;this.data=[];this.gl=c}b.prototype.subData=
function(){for(var a=this.gl,b=[],c=0;c<this.data.length;c+=1E4)b=Array.prototype.concat.apply(b,this.data.slice(c,c+1E4));this.buffer=this.buffer||a.createBuffer();a.bindBuffer(this.target,this.buffer);a.bufferData(this.target,new this.type(b),a.STATIC_DRAW)};l.exports=b},{}],80:[function(f,l,r){function b(a){this.gl=a;this.registry={};this._dynamicBuffers=[];this._staticBuffers=[];this._elementBufferMax=this._arrayBufferMax=3E4}var a=f("./Buffer");b.prototype.allocate=function(b,c,e,f,g){b=this.registry[b]||
(this.registry[b]={keys:[],values:[],spacing:[],offset:[],length:[]});var l=b.keys.indexOf(c),k="indices"===c,p=!1,q,w=0,t,r;if(-1===l){l=b.keys.length;t=k?e.length:Math.floor(e.length/f);if(g)r=new a(k?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,k?Uint16Array:Float32Array,this.gl),this._dynamicBuffers.push({buffer:r,offset:e.length,isIndex:k});else{for(g=0;g<this._staticBuffers.length;g++)if(k===this._staticBuffers[g].isIndex&&(q=this._staticBuffers[g].offset+e.length,!k&&q<this._arrayBufferMax||
k&&q<this._elementBufferMax)){r=this._staticBuffers[g].buffer;w=this._staticBuffers[g].offset;this._staticBuffers[g].offset+=e.length;p=!0;break}p||(r=new a(k?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,k?Uint16Array:Float32Array,this.gl),this._staticBuffers.push({buffer:r,offset:e.length,isIndex:k}))}b.keys.push(c);b.values.push(r);b.spacing.push(f);b.offset.push(w);b.length.push(t)}c=e.length;for(g=0;g<c;g++)b.values[l].data[w+g]=e[g];b.values[l].subData()};l.exports=b},{"./Buffer":79}],81:[function(f,
l,r){function b(a,b){return function(){var c=a.apply(this,arguments);b.apply(this,arguments);return c}}l.exports=function(){return b(this.gl.compileShader,function(a){if(!this.getShaderParameter(a,this.COMPILE_STATUS)){var b=this.getShaderInfoLog(a),c=this.getShaderSource(a);a=document.createElement("style");document.getElementsByTagName("head")[0].appendChild(a);a.textContent="body,html{background:#e3e3e3;font-family:monaco,monospace;font-size:14px;line-height:1.7em}#shaderReport{left:0;top:0;right:0;box-sizing:border-box;position:absolute;z-index:1000;color:#222;padding:15px;white-space:normal;list-style-type:none;margin:50px auto;max-width:1200px}#shaderReport li{background-color:#fff;margin:13px 0;box-shadow:0 1px 2px rgba(0,0,0,.15);padding:20px 30px;border-radius:2px;border-left:20px solid #e01111}span{color:#e01111;text-decoration:underline;font-weight:700}#shaderReport li p{padding:0;margin:0}#shaderReport li:nth-child(even){background-color:#f4f4f4}#shaderReport li p:first-child{margin-bottom:10px;color:#666}";
a=document.createElement("ul");a.setAttribute("id","shaderReport");document.body.appendChild(a);for(var e=/ERROR: [\d]+:([\d]+): (.+)/gmi,c=c.split("\n"),f;null!=(f=e.exec(b));){f.index===e.lastIndex&&e.lastIndex++;var g=document.createElement("li"),l='<p><span>ERROR</span> "'+f[2]+'" in line '+f[1]+"</p>",l=l+("<p><b>"+c[f[1]-1].replace(/^[ \t]+/g,"")+"</b></p>");g.innerHTML=l;a.appendChild(g)}}})}},{}],82:[function(f,l,r){function b(a,b){this.gl=a;this.textureSlots=1;this.options=b||{};this.registeredMaterials=
{};this.flaggedUniforms=[];this.cachedUniforms={};this.uniformTypes=[];this.definitionVec4=[];this.definitionVec3=[];this.definitionFloat=[];this.applicationVec3=[];this.applicationVec4=[];this.applicationFloat=[];this.applicationVert=[];this.definitionVert=[];this.resetProgram()}var a=f("../utilities/clone");r=f("../utilities/keyValueToArrays");var d=f("../webgl-shaders").vertex,c=f("../webgl-shaders").fragment,e=f("./Debug");f=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var h={undefined:"float ",1:"float ",
2:"vec2 ",3:"vec3 ",4:"vec4 ",16:"mat4 "},g={u_baseColor:"vec4",u_normals:"vert",u_glossiness:"vec4",u_positionOffset:"vert"},u={vert:1,vec3:2,vec4:4,"float":8},k=r({u_perspective:f,u_view:f,u_resolution:[0,0,0],u_transform:f,u_size:[1,1,1],u_time:0,u_opacity:1,u_metalness:0,u_glossiness:[0,0,0,0],u_baseColor:[1,1,1,1],u_normals:[1,1,1],u_positionOffset:[0,0,0],u_lightPosition:f,u_lightColor:f,u_ambientLight:[0,0,0],u_flatShading:0,u_numLights:0}),p=r({a_pos:[0,0,0],a_texCoord:[0,0],a_normals:[0,
0,0]}),q=r({v_textureCoordinate:[0,0],v_normal:[0,0,0],v_position:[0,0,0],v_eyeVector:[0,0,0]});b.prototype.registerMaterial=function(a,b){var c=g[a],d=u[c];if((this.registeredMaterials[b._id]&d)===d)return this;for(var e in b.uniforms)-1===k.keys.indexOf(e)&&(k.keys.push(e),k.values.push(b.uniforms[e]));for(e in b.varyings)-1===q.keys.indexOf(e)&&(q.keys.push(e),q.values.push(b.varyings[e]));for(e in b.attributes)-1===p.keys.indexOf(e)&&(p.keys.push(e),p.values.push(b.attributes[e]));this.registeredMaterials[b._id]|=
d;"float"===c&&(this.definitionFloat.push(b.defines),this.definitionFloat.push("float fa_"+b._id+"() {\n "+b.glsl+" \n}"),this.applicationFloat.push("if (int(abs(ID)) == "+b._id+") return fa_"+b._id+"();"));"vec3"===c&&(this.definitionVec3.push(b.defines),this.definitionVec3.push("vec3 fa_"+b._id+"() {\n "+b.glsl+" \n}"),this.applicationVec3.push("if (int(abs(ID.x)) == "+b._id+") return fa_"+b._id+"();"));"vec4"===c&&(this.definitionVec4.push(b.defines),this.definitionVec4.push("vec4 fa_"+b._id+"() {\n "+
b.glsl+" \n}"),this.applicationVec4.push("if (int(abs(ID.x)) == "+b._id+") return fa_"+b._id+"();"));"vert"===c&&(this.definitionVert.push(b.defines),this.definitionVert.push("vec3 fa_"+b._id+"() {\n "+b.glsl+" \n}"),this.applicationVert.push("if (int(abs(ID.x)) == "+b._id+") return fa_"+b._id+"();"));return this.resetProgram()};b.prototype.resetProgram=function(){var b=["precision mediump float;\n"],e=["precision mediump float;\n"],f,m,g;this.uniformLocations=[];this.attributeLocations={};this.uniformTypes=
{};this.attributeNames=a(p.keys);this.attributeValues=a(p.values);this.varyingNames=a(q.keys);this.varyingValues=a(q.values);this.uniformNames=a(k.keys);this.uniformValues=a(k.values);this.flaggedUniforms=[];this.cachedUniforms={};e.push("uniform sampler2D u_textures[7];\n");this.applicationVert.length&&b.push("uniform sampler2D u_textures[7];\n");for(g=0;g<this.uniformNames.length;g++)f=this.uniformNames[g],m=this.uniformValues[g],b.push("uniform "+h[m.length]+f+";\n"),e.push("uniform "+h[m.length]+
f+";\n");for(g=0;g<this.attributeNames.length;g++)f=this.attributeNames[g],m=this.attributeValues[g],b.push("attribute "+h[m.length]+f+";\n");for(g=0;g<this.varyingNames.length;g++)f=this.varyingNames[g],m=this.varyingValues[g],b.push("varying "+h[m.length]+f+";\n"),e.push("varying "+h[m.length]+f+";\n");b=b.join("")+d.replace("#vert_definitions",this.definitionVert.join("\n")).replace("#vert_applications",this.applicationVert.join("\n"));e=e.join("")+c.replace("#vec3_definitions",this.definitionVec3.join("\n")).replace("#vec3_applications",
this.applicationVec3.join("\n")).replace("#vec4_definitions",this.definitionVec4.join("\n")).replace("#vec4_applications",this.applicationVec4.join("\n")).replace("#float_definitions",this.definitionFloat.join("\n")).replace("#float_applications",this.applicationFloat.join("\n"));f=this.gl.createProgram();this.gl.attachShader(f,this.compileShader(this.gl.createShader(35633),b));this.gl.attachShader(f,this.compileShader(this.gl.createShader(35632),e));this.gl.linkProgram(f);this.gl.getProgramParameter(f,
this.gl.LINK_STATUS)?(this.program=f,this.gl.useProgram(this.program)):(console.error("link error: "+this.gl.getProgramInfoLog(f)),this.program=null);this.setUniforms(this.uniformNames,this.uniformValues);e=this.gl.getUniformLocation(this.program,"u_textures[0]");this.gl.uniform1iv(e,[0,1,2,3,4,5,6]);return this};b.prototype.uniformIsCached=function(a,b){if(null==this.cachedUniforms[a])return this.cachedUniforms[a]=b.length?new Float32Array(b):b,!1;if(b.length)for(var c=b.length;c--;){if(b[c]!==this.cachedUniforms[a][c]){for(c=
b.length;c--;)this.cachedUniforms[a][c]=b[c];return!1}}else if(this.cachedUniforms[a]!==b)return this.cachedUniforms[a]=b,!1;return!0};b.prototype.setUniforms=function(a,b){var c=this.gl,d,e,f,g,h;if(!this.program)return this;g=a.length;for(h=0;h<g;h++)if(f=a[h],e=b[h],d=this.uniformLocations[f],null!==d&&(void 0===d&&(d=c.getUniformLocation(this.program,f),this.uniformLocations[f]=d),!this.uniformIsCached(f,e)))switch(this.uniformTypes[f]||(this.uniformTypes[f]=this.getUniformTypeFromValue(e)),this.uniformTypes[f]){case "uniform4fv":c.uniform4fv(d,
e);break;case "uniform3fv":c.uniform3fv(d,e);break;case "uniform2fv":c.uniform2fv(d,e);break;case "uniform1fv":c.uniform1fv(d,e);break;case "uniform1f":c.uniform1f(d,e);break;case "uniformMatrix3fv":c.uniformMatrix3fv(d,!1,e);break;case "uniformMatrix4fv":c.uniformMatrix4fv(d,!1,e)}return this};b.prototype.getUniformTypeFromValue=function(a){if(Array.isArray(a)||a instanceof Float32Array)switch(a.length){case 1:return"uniform1fv";case 2:return"uniform2fv";case 3:return"uniform3fv";case 4:return"uniform4fv";
case 9:return"uniformMatrix3fv";case 16:return"uniformMatrix4fv"}else if(!isNaN(parseFloat(a))&&isFinite(a))return"uniform1f";throw'cant load uniform "'+name+'" with value:'+JSON.stringify(a);};b.prototype.compileShader=function(a,b){var c=1;this.options.debug&&(this.gl.compileShader=e.call(this));this.gl.shaderSource(a,b);this.gl.compileShader(a);this.gl.getShaderParameter(a,this.gl.COMPILE_STATUS)||(console.error("compile error: "+this.gl.getShaderInfoLog(a)),console.error("1: "+b.replace(/\n/g,
function(){return"\n"+(c+=1)+": "})));return a};l.exports=b},{"../utilities/clone":76,"../utilities/keyValueToArrays":77,"../webgl-shaders":89,"./Debug":81}],83:[function(f,l,r){function b(a,b){b=b||{};this.id=a.createTexture();this.width=b.width||0;this.height=b.height||0;this.mipmap=b.mipmap;this.format=b.format||"RGBA";this.type=b.type||"UNSIGNED_BYTE";this.gl=a;this.bind();a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,b.flipYWebgl||!1);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultiplyAlphaWebgl||
!1);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a[b.magFilter]||a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a[b.minFilter]||a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a[b.wrapS]||a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a[b.wrapT]||a.CLAMP_TO_EDGE)}b.prototype.bind=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.id);return this};b.prototype.unbind=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,null);return this};b.prototype.setImage=
function(a){this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl[this.format],this.gl[this.format],this.gl[this.type],a);this.mipmap&&this.gl.generateMipmap(this.gl.TEXTURE_2D);return this};b.prototype.setArray=function(a){this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl[this.format],this.width,this.height,0,this.gl[this.format],this.gl[this.type],a);return this};b.prototype.readBack=function(a,b,c,e){var f=this.gl,g;a=a||0;b=b||0;c=c||this.width;e=e||this.height;var l=f.createFramebuffer();f.bindFramebuffer(f.FRAMEBUFFER,
l);f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,this.id,0);f.checkFramebufferStatus(f.FRAMEBUFFER)===f.FRAMEBUFFER_COMPLETE&&(g=new Uint8Array(c*e*4),f.readPixels(a,b,c,e,f.RGBA,f.UNSIGNED_BYTE,g));return g};l.exports=b},{}],84:[function(f,l,r){function b(a){this.registry=[];this._needsResample=[];this._activeTexture=0;this._boundTexture=null;this._checkerboard=c();this.gl=a}function a(a,b){var c=("string"===typeof a?new Image:a)||{};c.crossOrigin="anonymous";c.src||(c.src=
a);c.complete?b(c):c.onload=function(){b(c)};return c}var d=f("./Texture"),c=f("./createCheckerboard");b.prototype.update=function(a){for(var b=this.registry.length,c=1;c<b;c++){var d=this.registry[c];d&&d.isLoaded&&d.resampleRate&&(!d.lastResample||a-d.lastResample>d.resampleRate)&&!this._needsResample[d.id]&&(this._needsResample[d.id]=!0,d.lastResample=a)}};b.prototype.register=function(b,c){var f=this,l=b.data,k=b.id,p=b.options||{},q=this.registry[k],w;q||(q=new d(this.gl,p),q.setImage(this._checkerboard),
w=this.registry[k]={resampleRate:p.resampleRate||null,lastResample:null,isLoaded:!1,texture:q,source:l,id:k,slot:c},Array.isArray(l)||l instanceof Uint8Array||l instanceof Float32Array?(this.bindTexture(k),q.setArray(l),w.isLoaded=!0):l instanceof HTMLVideoElement?l.addEventListener("loadeddata",function(){f.bindTexture(k);q.setImage(l);w.isLoaded=!0;w.source=l}):"string"===typeof l&&a(l,function(a){f.bindTexture(k);q.setImage(a);w.isLoaded=!0;w.source=a}));return k};b.prototype.bindTexture=function(a){var b=
this.registry[a];this._activeTexture!==b.slot&&(this.gl.activeTexture(this.gl.TEXTURE0+b.slot),this._activeTexture=b.slot);this._boundTexture!==a&&(this._boundTexture=a,b.texture.bind());this._needsResample[b.id]&&(b.texture.setImage(b.source),this._needsResample[b.id]=!1)};l.exports=b},{"./Texture":83,"./createCheckerboard":87}],85:[function(f,l,r){function b(b,c){b.classList.add("famous-webgl-renderer");this.canvas=b;this.compositor=c;var e=this.gl=this.getWebGLContext(this.canvas);e.clearColor(0,
0,0,0);e.polygonOffset(.1,.1);e.enable(e.POLYGON_OFFSET_FILL);e.enable(e.DEPTH_TEST);e.enable(e.BLEND);e.depthFunc(e.LEQUAL);e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);e.enable(e.CULL_FACE);e.cullFace(e.BACK);this.meshRegistry={};this.meshRegistryKeys=[];this.cutoutRegistry={};this.cutoutRegistryKeys=[];this.numLights=0;this.ambientLightColor=[0,0,0];this.lightRegistry={};this.lightRegistryKeys=[];this.lightPositions=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.lightColors=[0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0];this.textureManager=new h(e);this.texCache={};this.bufferRegistry=new d(e);this.program=new a(e,{debug:!0});this.state={boundArrayBuffer:null,boundElementBuffer:null,lastDrawn:null,enabledAttributes:{},enabledAttributesKeys:[]};this.resolutionName=["u_resolution"];this.resolutionValues=[[0,0,0]];this.cachedSize=[];this.projectionTransform=[1,0,0,0,0,1,0,0,0,0,-1E-6,0,-1,1,0,1];e=this.cutoutGeometry={spec:{id:-1,bufferValues:[[-1,-1,0,1,-1,0,-1,1,0,1,1,0]],bufferNames:["a_pos"],type:"TRIANGLE_STRIP"}};
this.bufferRegistry.allocate(this.cutoutGeometry.spec.id,e.spec.bufferNames[0],e.spec.bufferValues[0],3)}var a=f("./Program"),d=f("./BufferRegistry"),c=f("./radixSort"),e=f("../utilities/keyValueToArrays"),h=f("./TextureManager"),g=f("./compileMaterial"),u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],k=e({u_numLights:0,u_ambientLight:Array(3),u_lightPosition:Array(3),u_lightColor:Array(3),u_perspective:Array(16),u_time:0,u_view:Array(16)});b.prototype.getWebGLContext=function(a){for(var b=["webgl","experimental-webgl",
"webkit-3d","moz-webgl"],c,d=0,e=b.length;d<e;d++){try{c=a.getContext(b[d])}catch(f){console.error("Error creating WebGL context: "+f.toString())}if(c)break}return c?c:(console.error("Could not retrieve WebGL context. Please refer to https://www.khronos.org/webgl/ for requirements"),!1)};b.prototype.createLight=function(a){this.numLights++;this.lightRegistryKeys.push(a);this.lightRegistry[a]={color:[0,0,0],position:[0,0,0]};return this.lightRegistry[a]};b.prototype.createMesh=function(a){this.meshRegistryKeys.push(a);
var b=e({u_opacity:1,u_transform:u,u_size:[0,0,0],u_baseColor:[.5,.5,.5,1],u_positionOffset:[0,0,0],u_normals:[0,0,0],u_flatShading:0,u_glossiness:[0,0,0,0]});this.meshRegistry[a]={depth:null,uniformKeys:b.keys,uniformValues:b.values,buffers:{},geometry:null,drawType:null,textures:[],visible:!0};return this.meshRegistry[a]};b.prototype.setCutoutState=function(a,b){this.getOrSetCutout(a).visible=b};b.prototype.getOrSetCutout=function(a){if(!this.cutoutRegistry[a]){var b=e({u_opacity:0,u_transform:u.slice(),
u_size:[0,0,0],u_origin:[0,0,0],u_baseColor:[0,0,0,1]});this.cutoutRegistryKeys.push(a);this.cutoutRegistry[a]={uniformKeys:b.keys,uniformValues:b.values,geometry:this.cutoutGeometry.spec.id,drawType:this.cutoutGeometry.spec.type,visible:!0}}return this.cutoutRegistry[a]};b.prototype.setMeshVisibility=function(a,b){(this.meshRegistry[a]||this.createMesh(a)).visible=b};b.prototype.removeMesh=function(a){var b=this.meshRegistryKeys.indexOf(a);this.meshRegistryKeys.splice(b,1);this.meshRegistry[a]=null};
b.prototype.setCutoutUniform=function(a,b,c){a=this.getOrSetCutout(a);b=a.uniformKeys.indexOf(b);if(c.length)for(var d=0,e=c.length;d<e;d++)a.uniformValues[b][d]=c[d];else a.uniformValues[b]=c};b.prototype.setMeshOptions=function(a,b){(this.meshRegistry[a]||this.createMesh(a)).options=b;return this};b.prototype.setAmbientLightColor=function(a,b,c,d){this.ambientLightColor[0]=b;this.ambientLightColor[1]=c;this.ambientLightColor[2]=d;return this};b.prototype.setLightPosition=function(a,b,c,d){a=this.lightRegistry[a]||
this.createLight(a);a.position[0]=b;a.position[1]=c;a.position[2]=d;return this};b.prototype.setLightColor=function(a,b,c,d){a=this.lightRegistry[a]||this.createLight(a);a.color[0]=b;a.color[1]=c;a.color[2]=d;return this};b.prototype.handleMaterialInput=function(a,b,c){a=this.meshRegistry[a]||this.createMesh(a);c=g(c,a.textures.length);a.uniformValues[a.uniformKeys.indexOf(b)][0]=-c._id;for(var d=c.textures.length;d--;)a.textures.push(this.textureManager.register(c.textures[d],a.textures.length+d));
this.program.registerMaterial(b,c);return this.updateSize()};b.prototype.setGeometry=function(a,b,c,d){a=this.meshRegistry[a]||this.createMesh(a);a.geometry=b;a.drawType=c;a.dynamic=d;return this};b.prototype.setMeshUniform=function(a,b,c){a=this.meshRegistry[a]||this.createMesh(a);var d=a.uniformKeys.indexOf(b);-1===d?(a.uniformKeys.push(b),a.uniformValues.push(c)):a.uniformValues[d]=c};b.prototype.bufferData=function(a,b,c,d,e,f){this.bufferRegistry.allocate(b,c,d,e,f);return this};b.prototype.draw=
function(a){var b=this.compositor.getTime();this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);this.textureManager.update(b);this.meshRegistryKeys=c(this.meshRegistryKeys,this.meshRegistry);this.setGlobalUniforms(a);this.drawCutouts();this.drawMeshes()};b.prototype.drawMeshes=function(){for(var a=this.gl,b,c,d=0;d<this.meshRegistryKeys.length;d++)if(c=this.meshRegistry[this.meshRegistryKeys[d]],b=this.bufferRegistry.registry[c.geometry],c.visible&&(1>c.uniformValues[0]?(a.depthMask(!1),
a.enable(a.BLEND)):(a.depthMask(!0),a.disable(a.BLEND)),b)){for(var e=c.textures.length;e--;)this.textureManager.bindTexture(c.textures[e]);c.options&&this.handleOptions(c.options,c);this.program.setUniforms(c.uniformKeys,c.uniformValues);this.drawBuffers(b,c.drawType,c.geometry);c.options&&this.resetOptions(c.options)}};b.prototype.drawCutouts=function(){var a,b,c=this.cutoutRegistryKeys.length;if(c){this.gl.disable(this.gl.CULL_FACE);this.gl.enable(this.gl.BLEND);this.gl.depthMask(!0);for(var d=
0;d<c;d++)a=this.cutoutRegistry[this.cutoutRegistryKeys[d]],b=this.bufferRegistry.registry[a.geometry],a.visible&&(this.program.setUniforms(a.uniformKeys,a.uniformValues),this.drawBuffers(b,a.drawType,a.geometry));this.gl.enable(this.gl.CULL_FACE)}};b.prototype.setGlobalUniforms=function(a){for(var b,c,d=0,e=this.lightRegistryKeys.length;d<e;d++)b=this.lightRegistry[this.lightRegistryKeys[d]],c=4*d,this.lightPositions[0+c]=b.position[0],this.lightPositions[1+c]=b.position[1],this.lightPositions[2+
c]=b.position[2],this.lightColors[0+c]=b.color[0],this.lightColors[1+c]=b.color[1],this.lightColors[2+c]=b.color[2];k.values[0]=this.numLights;k.values[1]=this.ambientLightColor;k.values[2]=this.lightPositions;k.values[3]=this.lightColors;this.projectionTransform[0]=1/(.5*this.cachedSize[0]);this.projectionTransform[5]=-1/(.5*this.cachedSize[1]);this.projectionTransform[11]=a.perspectiveTransform[11];k.values[4]=this.projectionTransform;k.values[5]=.001*this.compositor.getTime();k.values[6]=a.viewTransform;
this.program.setUniforms(k.keys,k.values)};b.prototype.drawBuffers=function(a,b,c){var d=this.gl,e=0,f,g,h,k,l,r,u;l=a.keys.length;for(u=0;u<l;u++)if(f=a.keys[u],"indices"===f)r=u;else if(g=this.program.attributeLocations[f],-1!==g){if(void 0===g&&(g=d.getAttribLocation(this.program.program,f),this.program.attributeLocations[f]=g,-1===g))continue;this.state.enabledAttributes[f]||(d.enableVertexAttribArray(g),this.state.enabledAttributes[f]=!0,this.state.enabledAttributesKeys.push(f));k=a.values[u];
f=a.spacing[u];h=a.offset[u];e=a.length[u];this.state.boundArrayBuffer!==k&&(d.bindBuffer(k.target,k.buffer),this.state.boundArrayBuffer=k);this.state.lastDrawn!==c&&d.vertexAttribPointer(g,f,d.FLOAT,d.FALSE,0,4*h)}g=this.state.enabledAttributesKeys.length;for(u=0;u<g;u++)l=this.state.enabledAttributesKeys[u],this.state.enabledAttributes[l]&&-1===a.keys.indexOf(l)&&(d.disableVertexAttribArray(this.program.attributeLocations[l]),this.state.enabledAttributes[l]=!1);e&&(void 0!==r?(k=a.values[r],h=a.offset[r],
e=a.length[r],this.state.boundElementBuffer!==k&&(d.bindBuffer(k.target,k.buffer),this.state.boundElementBuffer=k),d.drawElements(d[b],e,d.UNSIGNED_SHORT,2*h)):d.drawArrays(d[b],0,e));this.state.lastDrawn=c};b.prototype.updateSize=function(a){if(a){var b=window.devicePixelRatio||1,c=~~(a[0]*b),b=~~(a[1]*b);this.canvas.width=c;this.canvas.height=b;this.gl.viewport(0,0,c,b);this.cachedSize[0]=a[0];this.cachedSize[1]=a[1];this.cachedSize[2]=a[0]>a[1]?a[0]:a[1];this.resolutionValues[0]=this.cachedSize}this.program.setUniforms(this.resolutionName,
this.resolutionValues);return this};b.prototype.handleOptions=function(a,b){var c=this.gl;a&&(a.blending&&c.enable(c.BLEND),"double"===a.side&&(this.gl.cullFace(this.gl.FRONT),this.drawBuffers(this.bufferRegistry.registry[b.geometry],b.drawType,b.geometry),this.gl.cullFace(this.gl.BACK)),"back"===a.side&&c.cullFace(c.FRONT))};b.prototype.resetOptions=function(a){var b=this.gl;a&&(a.blending&&b.disable(b.BLEND),"back"===a.side&&b.cullFace(b.BACK))};l.exports=b},{"../utilities/keyValueToArrays":77,
"./BufferRegistry":80,"./Program":82,"./TextureManager":84,"./compileMaterial":86,"./radixSort":88}],86:[function(f,l,r){function b(a,c){for(var d=a.inputs,e=d&&d.length,f=-1;++f<e;)b(d[f],c);c(a);return a}function a(b){if("number"===typeof b)return 1;if(Array.isArray(b))return b.length;var c=b.chunk.output;if("number"===typeof c)return c;b=b.inputs.map(function(b){return a(b)}).join(",");return c[b]}function d(a,b,d){return a.replace(/%\d/g,function(a){return c(b[a[1]-1])}).replace(/\$TEXTURE/,"u_textures["+
d+"]")}function c(a){return Array.isArray(a)?"vec"+a.length+"("+a.join(",")+")":"object"===typeof a?"fa_"+a._id:a.toFixed(6)}function e(a,b){for(var c in b)a[c]=b[c]}var h={1:"float ",2:"vec2 ",3:"vec3 ",4:"vec4 "};l.exports=function(f,l){var k="",p={},q={},r={},t=[],B=[];b(f,function(b,f){if(b.chunk){var g=h[a(b)],I=c(b),z=d(b.chunk.glsl,b.inputs,B.length+l);k+=g+I+" = "+z+"\n ";b.uniforms&&e(p,b.uniforms);b.varyings&&e(q,b.varyings);b.attributes&&e(r,b.attributes);b.chunk.defines&&t.push(b.chunk.defines);
b.texture&&B.push(b.texture)}});return{_id:f._id,glsl:k+"return "+c(f)+";",defines:t.join("\n"),uniforms:p,varyings:q,attributes:r,textures:B}}},{}],87:[function(f,l,r){l.exports=function(){var b=document.createElement("canvas").getContext("2d");b.canvas.width=b.canvas.height=128;for(var a=0;a<b.canvas.height;a+=16)for(var d=0;d<b.canvas.width;d+=16)b.fillStyle=(d^a)&16?"#FFF":"#DDD",b.fillRect(d,a,16,16);return b.canvas}},{}],88:[function(f,l,r){function b(a,b,c){a=a[c];c=b[a];return(c.depth?c.depth:
b[a].uniformValues[1][14])+g}function a(a){u[0]=a;return k[0]}function d(a){k[0]=a;return u[0]}var c=Array(2048*Math.ceil(64/11)),e=32/11+.999999999999999|0,h=2048*(e-1),g=Math.pow(20,6);f=new ArrayBuffer(4);var u=new Float32Array(f,0,1),k=new Int32Array(f,0,1);l.exports=function(f,k){var l=0,t=[],r,m,v,x,u;e=32/11+.999999999999999|0;r=0;for(x=2048*e;r<x;r++)c[r]=0;r=0;for(x=f.length;r<x;r++){u=a(b(f,k,r));u^=u>>31|2147483648;for(v=m=0;m<h;m+=2048,v+=11)c[m+(u>>>v&2047)]++;c[m+(u>>>v&1023)]++}for(m=
0;m<=h;m+=2048)for(r=m,x=0;r<m+2048;r++)u=c[r]+x,c[r]=x-1,x=u;if(--e){r=0;for(x=f.length;r<x;r++){u=a(b(f,k,r));m=t;v=++c[u&2047];var z=f[r];k[z].depth=d(u^(u>>31|2147483648))-g;m[v]=z}r=t;t=f;for(f=r;++l<e;){r=0;x=f.length;m=2048*l;for(v=11*l;r<x;r++)u=a(b(f,k,r)),t[++c[m+(u>>>v&2047)]]=f[r];r=t;t=f;f=r}}r=0;x=f.length;m=2048*l;for(v=11*l;r<x;r++){u=a(b(f,k,r));var l=t,z=++c[m+(u>>>v&1023)],y=f[r];k[y].depth=d(u^(~u>>31|2147483648))-g;l[z]=y;k[f[r]].depth=null}return t}},{}],89:[function(f,l,r){l.exports=
{vertex:'#define GLSLIFY 1\n/**\n * The MIT License (MIT)\n * \n * Copyright (c) 2015 Famous Industries Inc.\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the "Software"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/**\n * The MIT License (MIT)\n * \n * Copyright (c) 2015 Famous Industries Inc.\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the "Software"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/**\n * Calculates transpose inverse matrix from transform\n * \n * @method random\n * @private\n *\n *\n */\n\n\nmat3 getNormalMatrix_1_0(in mat4 t) {\n   mat3 matNorm;\n   mat4 a = t;\n\n   float a00 = a[0][0], a01 = a[0][1], a02 = a[0][2], a03 = a[0][3],\n   a10 = a[1][0], a11 = a[1][1], a12 = a[1][2], a13 = a[1][3],\n   a20 = a[2][0], a21 = a[2][1], a22 = a[2][2], a23 = a[2][3],\n   a30 = a[3][0], a31 = a[3][1], a32 = a[3][2], a33 = a[3][3],\n   b00 = a00 * a11 - a01 * a10,\n   b01 = a00 * a12 - a02 * a10,\n   b02 = a00 * a13 - a03 * a10,\n   b03 = a01 * a12 - a02 * a11,\n   b04 = a01 * a13 - a03 * a11,\n   b05 = a02 * a13 - a03 * a12,\n   b06 = a20 * a31 - a21 * a30,\n   b07 = a20 * a32 - a22 * a30,\n   b08 = a20 * a33 - a23 * a30,\n   b09 = a21 * a32 - a22 * a31,\n   b10 = a21 * a33 - a23 * a31,\n   b11 = a22 * a33 - a23 * a32,\n\n   det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n   det = 1.0 / det;\n\n   matNorm[0][0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n   matNorm[0][1] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n   matNorm[0][2] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n\n   matNorm[1][0] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n   matNorm[1][1] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n   matNorm[1][2] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n\n   matNorm[2][0] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n   matNorm[2][1] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n   matNorm[2][2] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n\n   return matNorm;\n}\n\n\n\n/**\n * The MIT License (MIT)\n * \n * Copyright (c) 2015 Famous Industries Inc.\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the "Software"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/**\n * Calculates a matrix that creates the identity when multiplied by m\n * \n * @method inverse\n * @private\n *\n *\n */\n\n\nfloat inverse_2_1(float m) {\n    return 1.0 / m;\n}\n\nmat2 inverse_2_1(mat2 m) {\n    return mat2(m[1][1],-m[0][1],\n               -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n}\n\nmat3 inverse_2_1(mat3 m) {\n    float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n    float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n    float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n    float b01 =  a22 * a11 - a12 * a21;\n    float b11 = -a22 * a10 + a12 * a20;\n    float b21 =  a21 * a10 - a11 * a20;\n\n    float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n    return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nmat4 inverse_2_1(mat4 m) {\n    float\n        a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n        a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n        a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n        a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n        b00 = a00 * a11 - a01 * a10,\n        b01 = a00 * a12 - a02 * a10,\n        b02 = a00 * a13 - a03 * a10,\n        b03 = a01 * a12 - a02 * a11,\n        b04 = a01 * a13 - a03 * a11,\n        b05 = a02 * a13 - a03 * a12,\n        b06 = a20 * a31 - a21 * a30,\n        b07 = a20 * a32 - a22 * a30,\n        b08 = a20 * a33 - a23 * a30,\n        b09 = a21 * a32 - a22 * a31,\n        b10 = a21 * a33 - a23 * a31,\n        b11 = a22 * a33 - a23 * a32,\n\n        det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n    return mat4(\n        a11 * b11 - a12 * b10 + a13 * b09,\n        a02 * b10 - a01 * b11 - a03 * b09,\n        a31 * b05 - a32 * b04 + a33 * b03,\n        a22 * b04 - a21 * b05 - a23 * b03,\n        a12 * b08 - a10 * b11 - a13 * b07,\n        a00 * b11 - a02 * b08 + a03 * b07,\n        a32 * b02 - a30 * b05 - a33 * b01,\n        a20 * b05 - a22 * b02 + a23 * b01,\n        a10 * b10 - a11 * b08 + a13 * b06,\n        a01 * b08 - a00 * b10 - a03 * b06,\n        a30 * b04 - a31 * b02 + a33 * b00,\n        a21 * b02 - a20 * b04 - a23 * b00,\n        a11 * b07 - a10 * b09 - a12 * b06,\n        a00 * b09 - a01 * b07 + a02 * b06,\n        a31 * b01 - a30 * b03 - a32 * b00,\n        a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n\n\n\n/**\n * The MIT License (MIT)\n * \n * Copyright (c) 2015 Famous Industries Inc.\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the "Software"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/**\n * Reflects a matrix over its main diagonal.\n * \n * @method transpose\n * @private\n *\n *\n */\n\n\nfloat transpose_3_2(float m) {\n    return m;\n}\n\nmat2 transpose_3_2(mat2 m) {\n    return mat2(m[0][0], m[1][0],\n                m[0][1], m[1][1]);\n}\n\nmat3 transpose_3_2(mat3 m) {\n    return mat3(m[0][0], m[1][0], m[2][0],\n                m[0][1], m[1][1], m[2][1],\n                m[0][2], m[1][2], m[2][2]);\n}\n\nmat4 transpose_3_2(mat4 m) {\n    return mat4(m[0][0], m[1][0], m[2][0], m[3][0],\n                m[0][1], m[1][1], m[2][1], m[3][1],\n                m[0][2], m[1][2], m[2][2], m[3][2],\n                m[0][3], m[1][3], m[2][3], m[3][3]);\n}\n\n\n\n\n/**\n * Converts vertex from modelspace to screenspace using transform\n * information from context.\n *\n * @method applyTransform\n * @private\n *\n *\n */\n\nvec4 applyTransform(vec4 pos) {\n    //TODO: move this multiplication to application code. \n\n    /**\n     * Currently multiplied in the vertex shader to avoid consuming the complexity of holding an additional\n     * transform as state on the mesh object in WebGLRenderer. Multiplies the object\'s transformation from object space\n     * to world space with its transformation from world space to eye space.\n     */\n    mat4 MVMatrix = u_view * u_transform;\n\n    //TODO: move the origin, sizeScale and y axis inversion to application code in order to amortize redundant per-vertex calculations.\n\n    /**\n     * The transform uniform should be changed to the result of the transformation chain:\n     *\n     * view * modelTransform * invertYAxis * sizeScale * origin\n     *\n     * which could be simplified to:\n     *\n     * view * modelTransform * convertToDOMSpace\n     *\n     * where convertToDOMSpace represents the transform matrix:\n     *\n     *                           size.x 0       0       size.x \n     *                           0      -size.y 0       size.y\n     *                           0      0       1       0\n     *                           0      0       0       1\n     *\n     */\n\n    /**\n     * Assuming a unit volume, moves the object space origin [0, 0, 0] to the "top left" [1, -1, 0], the DOM space origin.\n     * Later in the transformation chain, the projection transform negates the rigidbody translation.\n     * Equivalent to (but much faster than) multiplying a translation matrix "origin"\n     *\n     *                           1 0 0 1 \n     *                           0 1 0 -1\n     *                           0 0 1 0\n     *                           0 0 0 1\n     *\n     * in the transform chain: projection * view * modelTransform * invertYAxis * sizeScale * origin * positionVector.\n     */\n    pos.x += 1.0;\n    pos.y -= 1.0;\n\n    /**\n     * Assuming a unit volume, scales an object to the amount of pixels in the size uniform vector\'s specified dimensions.\n     * Later in the transformation chain, the projection transform transforms the point into clip space by scaling\n     * by the inverse of the canvas\' resolution.\n     * Equivalent to (but much faster than) multiplying a scale matrix "sizeScale"\n     *\n     *                           size.x 0      0      0 \n     *                           0      size.y 0      0\n     *                           0      0      size.z 0\n     *                           0      0      0      1\n     *\n     * in the transform chain: projection * view * modelTransform * invertYAxis * sizeScale * origin * positionVector.\n     */\n    pos.xyz *= u_size * 0.5;\n\n    /**\n     * Inverts the object space\'s y axis in order to match DOM space conventions. \n     * Later in the transformation chain, the projection transform reinverts the y axis to convert to clip space.\n     * Equivalent to (but much faster than) multiplying a scale matrix "invertYAxis"\n     *\n     *                           1 0 0 0 \n     *                           0 -1 0 0\n     *                           0 0 1 0\n     *                           0 0 0 1\n     *\n     * in the transform chain: projection * view * modelTransform * invertYAxis * sizeScale * origin * positionVector.\n     */\n    pos.y *= -1.0;\n\n    /**\n     * Exporting the vertex\'s position as a varying, in DOM space, to be used for lighting calculations. This has to be in DOM space\n     * since light position and direction is derived from the scene graph, calculated in DOM space.\n     */\n\n    v_position = (MVMatrix * pos).xyz;\n\n    /**\n    * Exporting the eye vector (a vector from the center of the screen) as a varying, to be used for lighting calculations.\n    * In clip space deriving the eye vector is a matter of simply taking the inverse of the position, as the position is a vector\n    * from the center of the screen. However, since our points are represented in DOM space,\n    * the position is a vector from the top left corner of the screen, so some additional math is needed (specifically, subtracting\n    * the position from the center of the screen, i.e. half the resolution of the canvas).\n    */\n\n    v_eyeVector = (u_resolution * 0.5) - v_position;\n\n    /**\n     * Transforming the position (currently represented in dom space) into view space (with our dom space view transform)\n     * and then projecting the point into raster both by applying a perspective transformation and converting to clip space\n     * (the perspective matrix is a combination of both transformations, therefore it\'s probably more apt to refer to it as a\n     * projection transform).\n     */\n\n    pos = u_perspective * MVMatrix * pos;\n\n    return pos;\n}\n\n/**\n * Placeholder for positionOffset chunks to be templated in.\n * Used for mesh deformation.\n *\n * @method calculateOffset\n * @private\n *\n *\n */\n#vert_definitions\nvec3 calculateOffset(vec3 ID) {\n    #vert_applications\n    return vec3(0.0);\n}\n\n/**\n * Writes the position of the vertex onto the screen.\n * Passes texture coordinate and normal attributes as varyings\n * and passes the position attribute through position pipeline.\n *\n * @method main\n * @private\n *\n *\n */\nvoid main() {\n    v_textureCoordinate = a_texCoord;\n    vec3 invertedNormals = a_normals + (u_normals.x < 0.0 ? calculateOffset(u_normals) * 2.0 - 1.0 : vec3(0.0));\n    invertedNormals.y *= -1.0;\n    v_normal = transpose_3_2(mat3(inverse_2_1(u_transform))) * invertedNormals;\n    vec3 offsetPos = a_pos + calculateOffset(u_positionOffset);\n    gl_Position = applyTransform(vec4(offsetPos, 1.0));\n}\n',
fragment:'#define GLSLIFY 1\n/**\n * The MIT License (MIT)\n * \n * Copyright (c) 2015 Famous Industries Inc.\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the "Software"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/**\n * The MIT License (MIT)\n * \n * Copyright (c) 2015 Famous Industries Inc.\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the "Software"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/**\n * Placeholder for fragmentShader  chunks to be templated in.\n * Used for normal mapping, gloss mapping and colors.\n * \n * @method applyMaterial\n * @private\n *\n *\n */\n\n#float_definitions\nfloat applyMaterial_1_0(float ID) {\n    #float_applications\n    return 1.;\n}\n\n#vec3_definitions\nvec3 applyMaterial_1_0(vec3 ID) {\n    #vec3_applications\n    return vec3(0);\n}\n\n#vec4_definitions\nvec4 applyMaterial_1_0(vec4 ID) {\n    #vec4_applications\n\n    return vec4(0);\n}\n\n\n\n/**\n * The MIT License (MIT)\n * \n * Copyright (c) 2015 Famous Industries Inc.\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the "Software"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/**\n * Calculates the intensity of light on a surface.\n *\n * @method applyLight\n * @private\n *\n */\nvec4 applyLight_2_1(in vec4 baseColor, in vec3 normal, in vec4 glossiness, int numLights, vec3 ambientColor, vec3 eyeVector, mat4 lightPosition, mat4 lightColor, vec3 v_position) {\n    vec3 diffuse = vec3(0.0);\n    bool hasGlossiness = glossiness.a > 0.0;\n    bool hasSpecularColor = length(glossiness.rgb) > 0.0;\n\n    for(int i = 0; i < 4; i++) {\n        if (i >= numLights) break;\n        vec3 lightDirection = normalize(lightPosition[i].xyz - v_position);\n        float lambertian = max(dot(lightDirection, normal), 0.0);\n\n        if (lambertian > 0.0) {\n            diffuse += lightColor[i].rgb * baseColor.rgb * lambertian;\n            if (hasGlossiness) {\n                vec3 halfVector = normalize(lightDirection + eyeVector);\n                float specularWeight = pow(max(dot(halfVector, normal), 0.0), glossiness.a);\n                vec3 specularColor = hasSpecularColor ? glossiness.rgb : lightColor[i].rgb;\n                diffuse += specularColor * specularWeight * lambertian;\n            }\n        }\n\n    }\n\n    return vec4(ambientColor + diffuse, baseColor.a);\n}\n\n\n\n\n\n/**\n * Writes the color of the pixel onto the screen\n *\n * @method main\n * @private\n *\n *\n */\nvoid main() {\n    vec4 material = u_baseColor.r >= 0.0 ? u_baseColor : applyMaterial_1_0(u_baseColor);\n\n    /**\n     * Apply lights only if flat shading is false\n     * and at least one light is added to the scene\n     */\n    bool lightsEnabled = (u_flatShading == 0.0) && (u_numLights > 0.0 || length(u_ambientLight) > 0.0);\n\n    vec3 normal = normalize(v_normal);\n    vec4 glossiness = u_glossiness.x < 0.0 ? applyMaterial_1_0(u_glossiness) : u_glossiness;\n\n    vec4 color = lightsEnabled ?\n    applyLight_2_1(material, normalize(v_normal), glossiness,\n               int(u_numLights),\n               u_ambientLight * u_baseColor.rgb,\n               normalize(v_eyeVector),\n               u_lightPosition,\n               u_lightColor,   \n               v_position)\n    : material;\n\n    gl_FragColor = color;\n    gl_FragColor.a *= u_opacity;   \n}\n'}},
{}],90:[function(f,l,r){function b(){}b.prototype.init=function(){var a=1/60*1E3;this.framedata={test_box:{sequence:{frames:[{x:0,y:0,ms:a},{x:160,y:0,ms:a},{x:320,y:0,ms:a},{x:480,y:0,ms:a},{x:640,y:0,ms:a},{x:800,y:0,ms:a},{x:960,y:0,ms:a},{x:1120,y:0,ms:a},{x:1280,y:0,ms:a},{x:1440,y:0,ms:a},{x:1600,y:0,ms:a},{x:0,y:160,ms:a},{x:160,y:160,ms:a},{x:320,y:160,ms:a},{x:480,y:160,ms:a},{x:640,y:160,ms:a},{x:800,y:160,ms:a},{x:960,y:160,ms:a},{x:1120,y:160,ms:a},{x:1280,y:160,ms:a},{x:1440,y:160,ms:a},
{x:1600,y:160,ms:a},{x:0,y:320,ms:a},{x:160,y:320,ms:a},{x:320,y:320,ms:a},{x:480,y:320,ms:a},{x:640,y:320,ms:a},{x:800,y:320,ms:a},{x:960,y:320,ms:a},{x:1120,y:320,ms:a},{x:1280,y:320,ms:a},{x:1440,y:320,ms:a},{x:1600,y:320,ms:a},{x:0,y:480,ms:a},{x:160,y:480,ms:a},{x:320,y:480,ms:a},{x:480,y:480,ms:a},{x:640,y:480,ms:a},{x:800,y:480,ms:a},{x:960,y:480,ms:a},{x:1120,y:480,ms:a},{x:1280,y:480,ms:a},{x:1440,y:480,ms:a},{x:1600,y:480,ms:a},{x:0,y:640,ms:a},{x:160,y:640,ms:a},{x:320,y:640,ms:a},{x:480,
y:640,ms:a},{x:640,y:640,ms:a},{x:800,y:640,ms:a},{x:960,y:640,ms:a},{x:1120,y:640,ms:a},{x:1280,y:640,ms:a},{x:1440,y:640,ms:a},{x:1600,y:640,ms:a},{x:0,y:800,ms:a},{x:160,y:800,ms:a},{x:320,y:800,ms:a},{x:480,y:800,ms:a},{x:640,y:800,ms:a}],frameIterator:0,msTimer:0},sequence_timed:{frames:[{x:0,y:0,ms:100},{x:160,y:0,ms:100},{x:320,y:0,ms:100},{x:480,y:0,ms:100},{x:640,y:0,ms:100},{x:800,y:0,ms:100},{x:960,y:0,ms:100},{x:1120,y:0,ms:100},{x:1280,y:0,ms:100},{x:1440,y:0,ms:100},{x:1600,y:0,ms:100},
{x:0,y:160,ms:100},{x:160,y:160,ms:100},{x:320,y:160,ms:100},{x:480,y:160,ms:100},{x:640,y:160,ms:100},{x:800,y:160,ms:100},{x:960,y:160,ms:100},{x:1120,y:160,ms:100},{x:1280,y:160,ms:100},{x:1440,y:160,ms:100},{x:1600,y:160,ms:100},{x:0,y:320,ms:100},{x:160,y:320,ms:100},{x:320,y:320,ms:100},{x:480,y:320,ms:100},{x:640,y:320,ms:100},{x:800,y:320,ms:100},{x:960,y:320,ms:100},{x:1120,y:320,ms:100},{x:1280,y:320,ms:100},{x:1440,y:320,ms:100},{x:1600,y:320,ms:100},{x:0,y:480,ms:100},{x:160,y:480,ms:100},
{x:320,y:480,ms:100},{x:480,y:480,ms:100},{x:640,y:480,ms:100},{x:800,y:480,ms:100},{x:960,y:480,ms:100},{x:1120,y:480,ms:100},{x:1280,y:480,ms:100},{x:1440,y:480,ms:100},{x:1600,y:480,ms:100},{x:0,y:640,ms:100},{x:160,y:640,ms:100},{x:320,y:640,ms:100},{x:480,y:640,ms:100},{x:640,y:640,ms:100},{x:800,y:640,ms:100},{x:960,y:640,ms:100},{x:1120,y:640,ms:100},{x:1280,y:640,ms:100},{x:1440,y:640,ms:100},{x:1600,y:640,ms:100},{x:0,y:800,ms:100},{x:160,y:800,ms:100},{x:320,y:800,ms:100},{x:480,y:800,ms:100},
{x:640,y:800,ms:100}],frameIterator:0,msTimer:0},reverseSequence:{frames:[{x:640,y:800,ms:a},{x:480,y:800,ms:a},{x:320,y:800,ms:a},{x:160,y:800,ms:a},{x:0,y:800,ms:a},{x:1600,y:640,ms:a},{x:1440,y:640,ms:a},{x:1280,y:640,ms:a},{x:1120,y:640,ms:a},{x:960,y:640,ms:a},{x:800,y:640,ms:a},{x:640,y:640,ms:a},{x:480,y:640,ms:a},{x:320,y:640,ms:a},{x:160,y:640,ms:a},{x:0,y:640,ms:a},{x:1600,y:480,ms:a},{x:1440,y:480,ms:a},{x:1280,y:480,ms:a},{x:1120,y:480,ms:a},{x:960,y:480,ms:a},{x:800,y:480,ms:a},{x:640,
y:480,ms:a},{x:480,y:480,ms:a},{x:320,y:480,ms:a},{x:160,y:480,ms:a},{x:0,y:480,ms:a},{x:1600,y:320,ms:a},{x:1440,y:320,ms:a}],frameIterator:0,msTimer:0}},astro:{full:{frames:[{x:0,y:0,ms:100},{x:80,y:0,ms:100},{x:160,y:0,ms:100},{x:240,y:0,ms:100},{x:320,y:0,ms:100},{x:400,y:0,ms:100},{x:480,y:0,ms:100},{x:560,y:0,ms:100},{x:0,y:120,ms:100},{x:80,y:120,ms:100},{x:160,y:120,ms:100},{x:240,y:120,ms:100},{x:320,y:120,ms:100},{x:400,y:120,ms:100},{x:480,y:120,ms:100},{x:560,y:120,ms:100},{x:0,y:240,
ms:100},{x:80,y:240,ms:100},{x:160,y:240,ms:100},{x:240,y:240,ms:100},{x:320,y:240,ms:100},{x:400,y:240,ms:100},{x:480,y:240,ms:100}],frameIterator:0,msTimer:0},loop:{frames:[{x:80,y:120,ms:100},{x:160,y:120,ms:100},{x:240,y:120,ms:100},{x:320,y:120,ms:100},{x:400,y:120,ms:100},{x:480,y:120,ms:100},{x:560,y:120,ms:100},{x:0,y:240,ms:100},{x:80,y:240,ms:100},{x:160,y:240,ms:100},{x:240,y:240,ms:100},{x:320,y:240,ms:100},{x:400,y:240,ms:100},{x:480,y:240,ms:100}],frameIterator:0,msTimer:0,looping:!0}}};
return this};l.exports=new b},{}],91:[function(f,l,r){(function(){var b={},a=null,d=!0,c=!1;try{"undefined"!==typeof AudioContext?a=new AudioContext:"undefined"!==typeof webkitAudioContext?a=new webkitAudioContext:d=!1}catch(f){d=!1}if(!d)if("undefined"!==typeof Audio)try{new Audio}catch(f){c=!0}else c=!0;if(d){var e="undefined"===typeof a.createGain?a.createGainNode():a.createGain();e.gain.value=1;e.connect(a.destination)}var h=function(b){this._volume=1;this._muted=!1;this.usingWebAudio=d;this.ctx=
a;this.noAudio=c;this._howls=[];this._codecs=b;this.iOSAutoEnable=!0};h.prototype={volume:function(a){a=parseFloat(a);if(0<=a&&1>=a){this._volume=a;d&&(e.gain.value=a);for(var b in this._howls)if(this._howls.hasOwnProperty(b)&&!1===this._howls[b]._webAudio)for(a=0;a<this._howls[b]._audioNode.length;a++)this._howls[b]._audioNode[a].volume=this._howls[b]._volume*this._volume;return this}return d?e.gain.value:this._volume},mute:function(){this._setMuted(!0);return this},unmute:function(){this._setMuted(!1);
return this},_setMuted:function(a){this._muted=a;d&&(e.gain.value=a?0:this._volume);for(var b in this._howls)if(this._howls.hasOwnProperty(b)&&!1===this._howls[b]._webAudio)for(var c=0;c<this._howls[b]._audioNode.length;c++)this._howls[b]._audioNode[c].muted=a},codecs:function(a){return this._codecs[a]},_enableiOSAudio:function(){var b=this;if(!a||!b._iOSEnabled&&/iPhone|iPad|iPod/i.test(navigator.userAgent))return b._iOSEnabled=!1,window.addEventListener("touchend",function x(){var c=a.createBuffer(1,
1,22050),d=a.createBufferSource();d.buffer=c;d.connect(a.destination);"undefined"===typeof d.start?d.noteOn(0):d.start(0);setTimeout(function(){if(d.playbackState===d.PLAYING_STATE||d.playbackState===d.FINISHED_STATE)b._iOSEnabled=!0,b.iOSAutoEnable=!1,window.removeEventListener("touchend",x,!1)},0)},!1),b}};var g=null,l={};c||(g=new Audio,l={mp3:!!g.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!g.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!g.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,
""),wav:!!g.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!g.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(g.canPlayType("audio/x-m4a;")||g.canPlayType("audio/m4a;")||g.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(g.canPlayType("audio/x-mp4;")||g.canPlayType("audio/mp4;")||g.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!g.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")});var k=new h(l),p=function(b){this._autoplay=b.autoplay||!1;this._buffer=b.buffer||
!1;this._duration=b.duration||0;this._format=b.format||null;this._loop=b.loop||!1;this._loaded=!1;this._sprite=b.sprite||{};this._src=b.src||"";this._pos3d=b.pos3d||[0,0,-.5];this._volume=void 0!==b.volume?b.volume:1;this._urls=b.urls||[];this._rate=b.rate||1;this._model=b.model||null;this._onload=[b.onload||function(){}];this._onloaderror=[b.onloaderror||function(){}];this._onend=[b.onend||function(){}];this._onpause=[b.onpause||function(){}];this._onplay=[b.onplay||function(){}];this._onendTimer=
[];this._webAudio=d&&!this._buffer;this._audioNode=[];this._webAudio&&this._setupAudioNode();"undefined"!==typeof a&&a&&k.iOSAutoEnable&&k._enableiOSAudio();k._howls.push(this);this.load()};p.prototype={load:function(){var a=this,b=null;if(c)a.on("loaderror",Error("No audio support."));else{for(var d=0;d<a._urls.length;d++){var e,f;if(a._format)e=a._format;else if(f=a._urls[d],(e=/^data:audio\/([^;,]+);/i.exec(f))||(e=/\.([^.]+)$/.exec(f.split("?",1)[0])),e)e=e[1].toLowerCase();else{a.on("loaderror",
Error("Could not extract format from passed URLs, please add format parameter."));return}if(l[e]){b=a._urls[d];break}}if(b){a._src=b;if(a._webAudio)q(a,b);else{var g=new Audio;g.addEventListener("error",function(){g.error&&4===g.error.code&&(h.noAudio=!0);a.on("loaderror",{type:g.error?g.error.code:0})},!1);a._audioNode.push(g);g.src=b;g._pos=0;g.preload="auto";g.volume=k._muted?0:a._volume*k.volume();g.addEventListener("canplaythrough",function F(){a._duration=Math.ceil(10*g.duration)/10;0===Object.getOwnPropertyNames(a._sprite).length&&
(a._sprite={_default:[0,1E3*a._duration]});a._loaded||(a._loaded=!0,a.on("load"));a._autoplay&&a.play();g.removeEventListener("canplaythrough",F,!1)},!1);g.load()}return a}a.on("loaderror",Error("No codec support for selected audio sources."))}},urls:function(a){return a?(this.stop(),this._urls="string"===typeof a?[a]:a,this._loaded=!1,this.load(),this):this._urls},play:function(b,c){var d=this;"function"===typeof b&&(c=b);b&&"function"!==typeof b||(b="_default");if(!d._loaded)return d.on("load",
function(){d.play(b,c)}),d;if(!d._sprite[b])return"function"===typeof c&&c(),d;d._inactiveNode(function(e){e._sprite=b;var f=0<e._pos?e._pos:d._sprite[b][0]/1E3,g=0;d._webAudio?(g=d._sprite[b][1]/1E3-e._pos,0<e._pos&&(f=d._sprite[b][0]/1E3+f)):g=d._sprite[b][1]/1E3-(f-d._sprite[b][0]/1E3);var h=!(!d._loop&&!d._sprite[b][2]),l="string"===typeof c?c:Math.round(Date.now()*Math.random())+"",p;(function(){p=setTimeout(function(){!d._webAudio&&h&&d.stop(l).play(b,l);d._webAudio&&!h&&(d._nodeById(l).paused=
!0,d._nodeById(l)._pos=0,d._clearEndTimer(l));d._webAudio||h||d.stop(l);d.on("end",l)},g/d._rate*1E3);d._onendTimer.push({timer:p,id:l})})();if(d._webAudio){var q=d._sprite[b][0]/1E3,r=d._sprite[b][1]/1E3;e.id=l;e.paused=!1;B(d,[h,q,r],l);d._playStart=a.currentTime;e.gain.value=d._volume;"undefined"===typeof e.bufferSource.start?h?e.bufferSource.noteGrainOn(0,f,86400):e.bufferSource.noteGrainOn(0,f,g):h?e.bufferSource.start(0,f,86400):e.bufferSource.start(0,f,g)}else if(4===e.readyState||!e.readyState&&
navigator.isCocoonJS)e.readyState=4,e.id=l,e.currentTime=f,e.muted=k._muted||e.muted,e.volume=d._volume*k.volume(),setTimeout(function(){e.play()},0);else return d._clearEndTimer(l),function(){var a=b,f=c;e.addEventListener("canplaythrough",function E(){d.play(a,f);e.removeEventListener("canplaythrough",E,!1)},!1)}(),d;d.on("play");"function"===typeof c&&c(l);return d});return d},pause:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.pause(a)}),b;b._clearEndTimer(a);var c=a?b._nodeById(a):
b._activeNode();if(c)if(c._pos=b.pos(null,a),b._webAudio){if(!c.bufferSource||c.paused)return b;c.paused=!0;"undefined"===typeof c.bufferSource.stop?c.bufferSource.noteOff(0):c.bufferSource.stop(0)}else c.pause();b.on("pause");return b},stop:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.stop(a)}),b;b._clearEndTimer(a);var c=a?b._nodeById(a):b._activeNode();if(c)if(c._pos=0,b._webAudio){if(!c.bufferSource||c.paused)return b;c.paused=!0;"undefined"===typeof c.bufferSource.stop?
c.bufferSource.noteOff(0):c.bufferSource.stop(0)}else isNaN(c.duration)||(c.pause(),c.currentTime=0);return b},mute:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.mute(a)}),b;var c=a?b._nodeById(a):b._activeNode();c&&(b._webAudio?c.gain.value=0:c.muted=!0);return b},unmute:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.unmute(a)}),b;var c=a?b._nodeById(a):b._activeNode();c&&(b._webAudio?c.gain.value=b._volume:c.muted=!1);return b},volume:function(a,b){var c=
this;a=parseFloat(a);if(0<=a&&1>=a){c._volume=a;if(!c._loaded)return c.on("play",function(){c.volume(a,b)}),c;var d=b?c._nodeById(b):c._activeNode();d&&(c._webAudio?d.gain.value=a:d.volume=a*k.volume());return c}return c._volume},loop:function(a){return"boolean"===typeof a?(this._loop=a,this):this._loop},sprite:function(a){return"object"===typeof a?(this._sprite=a,this):this._sprite},pos:function(b,c){var d=this;if(!d._loaded)return d.on("load",function(){d.pos(b)}),"number"===typeof b?d:d._pos||
0;b=parseFloat(b);var e=c?d._nodeById(c):d._activeNode();if(e)return 0<=b?(d.pause(c),e._pos=b,d.play(e._sprite,c),d):d._webAudio?e._pos+(a.currentTime-d._playStart):e.currentTime;if(0<=b)return d;for(e=0;e<d._audioNode.length;e++)if(d._audioNode[e].paused&&4===d._audioNode[e].readyState)return d._webAudio?d._audioNode[e]._pos:d._audioNode[e].currentTime},pos3d:function(a,b,c,d){var e=this;b="undefined"!==typeof b&&b?b:0;c="undefined"!==typeof c&&c?c:-.5;if(!e._loaded)return e.on("play",function(){e.pos3d(a,
b,c,d)}),e;if(0<=a||0>a){if(e._webAudio){var f=d?e._nodeById(d):e._activeNode();f&&(e._pos3d=[a,b,c],f.panner.setPosition(a,b,c),f.panner.panningModel=e._model||"HRTF")}}else return e._pos3d;return e},fade:function(a,b,c,d,e){var f=this,g=a>b?"down":"up",h=Math.abs(a-b)/.01,k=c/h;if(!f._loaded)return f.on("load",function(){f.fade(a,b,c,d,e)}),f;f.volume(a,e);for(var l=1;l<=h;l++)(function(){var a=Math.round(1E3*(f._volume+("up"===g?.01:-.01)*l))/1E3;setTimeout(function(){f.volume(a,e);a===b&&d&&d()},
k*l)})()},fadeIn:function(a,b,c){return this.volume(0).play().fade(0,a,b,c)},fadeOut:function(a,b,c,d){var e=this;return e.fade(e._volume,a,b,function(){c&&c();e.pause(d);e.on("end")},d)},_nodeById:function(a){for(var b=this._audioNode[0],c=0;c<this._audioNode.length;c++)if(this._audioNode[c].id===a){b=this._audioNode[c];break}return b},_activeNode:function(){for(var a=null,b=0;b<this._audioNode.length;b++)if(!this._audioNode[b].paused){a=this._audioNode[b];break}this._drainPool();return a},_inactiveNode:function(a){for(var b=
null,c=0;c<this._audioNode.length;c++)if(this._audioNode[c].paused&&4===this._audioNode[c].readyState){a(this._audioNode[c]);b=!0;break}this._drainPool();if(!b){var d;if(this._webAudio)d=this._setupAudioNode(),a(d);else{this.load();d=this._audioNode[this._audioNode.length-1];var e=navigator.isCocoonJS?"canplaythrough":"loadedmetadata";d.addEventListener(e,function A(){d.removeEventListener(e,A,!1);a(d)},!1)}}},_drainPool:function(){var a=0,b;for(b=0;b<this._audioNode.length;b++)this._audioNode[b].paused&&
a++;for(b=this._audioNode.length-1;0<=b&&!(5>=a);b--)this._audioNode[b].paused&&(this._webAudio&&this._audioNode[b].disconnect(0),a--,this._audioNode.splice(b,1))},_clearEndTimer:function(a){for(var b=-1,c=0;c<this._onendTimer.length;c++)if(this._onendTimer[c].id===a){b=c;break}if(a=this._onendTimer[b])clearTimeout(a.timer),this._onendTimer.splice(b,1)},_setupAudioNode:function(){var b=this._audioNode,c=this._audioNode.length;b[c]="undefined"===typeof a.createGain?a.createGainNode():a.createGain();
b[c].gain.value=this._volume;b[c].paused=!0;b[c]._pos=0;b[c].readyState=4;b[c].connect(e);b[c].panner=a.createPanner();b[c].panner.panningModel=this._model||"equalpower";b[c].panner.setPosition(this._pos3d[0],this._pos3d[1],this._pos3d[2]);b[c].panner.connect(b[c]);return b[c]},on:function(a,b){var c=this["_on"+a];if("function"===typeof b)c.push(b);else for(var d=0;d<c.length;d++)b?c[d].call(this,b):c[d].call(this);return this},off:function(a,b){var c=this["_on"+a];if(b)for(var d=0;d<c.length;d++){if(b===
c[d]){c.splice(d,1);break}}else this["_on"+a]=[];return this},unload:function(){for(var a=this._audioNode,c=0;c<this._audioNode.length;c++)a[c].paused||(this.stop(a[c].id),this.on("end",a[c].id)),this._webAudio?a[c].disconnect(0):a[c].src="";for(c=0;c<this._onendTimer.length;c++)clearTimeout(this._onendTimer[c].timer);a=k._howls.indexOf(this);null!==a&&0<=a&&k._howls.splice(a,1);delete b[this._src]}};if(d)var q=function(a,c){if(c in b)a._duration=b[c].duration,t(a);else if(/^data:[^;]+;base64,/.test(c)){for(var d=
atob(c.split(",")[1]),e=new Uint8Array(d.length),f=0;f<d.length;++f)e[f]=d.charCodeAt(f);w(e.buffer,a,c)}else{var g=new XMLHttpRequest;g.open("GET",c,!0);g.responseType="arraybuffer";g.onload=function(){w(g.response,a,c)};g.onerror=function(){a._webAudio&&(a._buffer=!0,a._webAudio=!1,a._audioNode=[],delete a._gainNode,delete b[c],a.load())};try{g.send()}catch(h){g.onerror()}}},w=function(c,d,e){a.decodeAudioData(c,function(a){a&&(b[e]=a,t(d,a))},function(a){d.on("loaderror",a)})},t=function(a,b){a._duration=
b?b.duration:a._duration;0===Object.getOwnPropertyNames(a._sprite).length&&(a._sprite={_default:[0,1E3*a._duration]});a._loaded||(a._loaded=!0,a.on("load"));a._autoplay&&a.play()},B=function(c,d,e){e=c._nodeById(e);e.bufferSource=a.createBufferSource();e.bufferSource.buffer=b[c._src];e.bufferSource.connect(e.panner);e.bufferSource.loop=d[0];d[0]&&(e.bufferSource.loopStart=d[1],e.bufferSource.loopEnd=d[1]+d[2]);e.bufferSource.playbackRate.value=c._rate};"function"===typeof define&&define.amd&&define(function(){return{Howler:k,
Howl:p}});"undefined"!==typeof r&&(r.Howler=k,r.Howl=p);"undefined"!==typeof window&&(window.Howler=k,window.Howl=p)})()},{}],92:[function(f,l,r){function b(){L&&(L=null);L=new F.PhysicsEngine(C);L.game=n;n.world=L;n.over=!1;n.speed_reducer=5;n.teir_reducer=1;n.startButtonNode.setPosition(-1E3,-1E3);n.howToButtonNode.setPosition(-1E3,-1E3);n.soundButtonNode.setPosition(-1E3,-1E3);n.creditsButtonNode.setPosition(-1E3,-1E3);U.setPosition(-1E4,-1E4);document.body.style.cursor="none";R=n.addChild();n.activeEnemies=
[];n.gameEnemies=R;R.name="gameEnemies";n.lives=1;R.createEnemiesComponent={id:null,node:null,active:!1,onMount:function(a){this.id=a.addComponent(this);this.node=a},onReceive:function(a,b){"createEnemies"==a&&this.node.requestUpdate(this.id)},onUpdate:function(){1!=this.active&&(I("start"),this.active=!0,x(),g(),I("end"))}};R.addComponent(R.createEnemiesComponent);n.emit("createEnemies",{});n.emit("loop",{looping:!0});var a=H.addChild();n.scoreNode=a;a.name="scoreNode";n.sizes=n.getSize();a.setSizeMode("absolute",
"absolute").setAbsoluteSize(n.sizes[0],100).setAlign(.5,.5).setPosition(-n.sizes[0]/2,-50);a.DOMElement=new z(a);a.DOMElement.setProperty("font-size","60px").setProperty("opacity","0.5").setProperty("text-align","center").setContent("0").setProperty("color","white").setProperty("z-index","2");n.score=0;v(n.boxNode.box)}function a(a){if(n.startButtonNode)n.startButtonNode&&(d={id:null,node:null,gameOver:a,onMount:function(a){this.id=a.addComponent(this);this.node=a},onReceive:function(a,b){"startButton"==
a&&this.node.requestUpdate(this.id)},onUpdate:function(){if(1==this.gameOver){var a=T.pause()._audioNode[0]._pos;n.storage&&(window.localStorage._pos=a);location.reload()}else n.started=!0,b()}},n.startButtonNode.addComponent(d),a?(n.startButtonNode.setAbsoluteSize(150,60).setPosition(-75,-30),n.startButtonNode.DOMElement.setContent("Restart")):a||n.startButtonNode.setPosition(-120,-130));else{var c=H.addChild();n.startButtonNode=c;c.name="startButtonNode";c.setSizeMode("absolute","absolute").setAbsoluteSize(240,
60).setAlign(.5,.8).setPosition(-110,-130);c.DOMElement=new z(c);var d="Start Game";a&&(d="Restart",c.setAbsoluteSize(150,60).setPosition(-75,-30));c.DOMElement.setProperty("font-size","40px").setContent(d).setProperty("z-index","2").setProperty("color","white");d={id:null,node:null,gameOver:a,onMount:function(a){this.id=a.addComponent(this);this.node=a},onReceive:function(a,b){"startButton"==a&&this.node.requestUpdate(this.id)},onUpdate:function(){if(1==this.gameOver){var a=T.pause()._audioNode[0]._pos;
n.storage&&(window.localStorage._pos=a);location.reload()}else n.started=!0,b()}};c.addComponent(d)}}function d(){var a=H.addChild();n.boxNode=a;a.name="boxNode";a.framedata=G.framedata.astro;n.idle=!0;a.ratio=.8;a.setSizeMode("absolute","absolute").setAbsoluteSize(80*a.ratio,120*a.ratio).setAlign(.5,.5).setPosition(-40*a.ratio,-60*a.ratio,1E4).setOrigin(.5,.5);a.size={w:80,h:120};a.DOMElement=new z(a);a.DOMElement.setProperty("background-image","url(./images/astro_loop.png)").setProperty("background-size",
"800% 300%").setProperty("z-index","1000");var b=a.getPosition(),d=a.addComponent({id:null,node:null,onMount:function(a){this.id=a.addComponent(this);this.node=a},onUpdate:function(c){a.box||(a.box=new J({mass:1,size:[a.size.w*a.ratio-10,a.size.h*a.ratio-5,40],position:new D(b[0],b[1]),restitution:0,friction:0}),a.box.node=a,L.addBody(a.box));1==n.started&&a.setAlign(0,0);c=a.box.getPosition();a.setPosition(c.x-10,c.y-20,1E4);a.requestUpdate(this.id)}});c(a);a.requestUpdate(d)}function c(a){a.addComponent({id:null,
node:null,done:function(a){a.framedata.active.frameIterator=0;a.framedata.active.msTimer=0;a.framedata.active=null;a.animationTransitionable.halt()},onMount:function(a){this.id=a.addComponent(this);this.node=a},onReceive:function(a,b){var c=this.node.framedata;if(c[a]&&(c.active||(c.active=c[a],c.active.event=a,c.active.frameIterator=0,"undefined"!=typeof b.looping&&(c.active.looping=b.looping),"undefined"!=typeof b.interruptable&&(c.active.interruptable=b.interruptable)),"undefined"!=typeof c.active.interruptable&&
0==c.active.interruptable&&(b.interrupt=!1),1>c.active.frameIterator||b.interrupt)){b.interrupt&&(this.node.animationTransitionable&&this.node.animationTransitionable.halt(),c.active.frameIterator=0);c.active=c[a];c.active.event=a;"undefined"!=typeof b.interruptable&&(c.active.interruptable=b.interruptable);for(var d=c.active.frames,e=0,f=0;f<d.length;f++)e+=d[f].ms;c.active.duration=e;this.node.animationTransitionable=new A(0);this.node.requestUpdate(this.id);this.node.animationTransitionable.from(0).to(e,
"linear",e,null,this.done,this.node)}},onUpdate:function(){var a=this.node.framedata;if(a.active){var b=a.active,c=b.frames,d=this.node.animationTransitionable,e=1;this.node.ratio&&(e=this.node.ratio);1>d._state&&(b.frameIterator=0,b.msTimer=0);b.frameIterator<c.length?d._state<b.msTimer+c[b.frameIterator].ms+2&&d._state>=b.msTimer-2&&null!=b?(this.node.DOMElement.setProperty("background-position","-"+c[b.frameIterator].x*e+"px -"+c[b.frameIterator].y*e+"px"),b.msTimer+=c[b.frameIterator].ms,b.frameIterator++,
d.get(),this.node.requestUpdate(this.id)):d.isActive()&&(d.get(),this.node.requestUpdate(this.id)):b.frameIterator>=c.length&&(d.isActive()&&d.halt(),b.looping?(b.frameIterator=0,d.from(0).to(a.active.duration,"linear",a.active.duration,null,this.done,this.node),this.node.requestUpdate(this.id)):a.active=null)}}})}function e(a){a.newEnemyComponent={id:null,node:null,done:function(a){a in a._updater._updateQueue&&y._updateQueue.splice(a._updater._updateQueue.indexOf(a),1);a._updateQueue&&a._updateQueue.length&&
(a._updateQueue=[]);a._nextUpdateQueue&&a._nextUpdateQueue.length&&(a._nextUpdateQueue=[]);n.world.remove(a.collision);n.world.remove(a.sphere);n.activeEnemies.splice(n.activeEnemies.indexOf(a),1);a.dismount();v(n.boxNode.box)},onMount:function(a){this.id=a.addComponent(this);this.node=a},onUpdate:function(a){a=this.node.sphere.getPosition();-100!=a.z&&(a.x-65>M[0]||0>a.x+65||a.y-65>M[1]||0>a.y+65?null!=this.node._id&&this.done(this.node):(this.node.setPosition(a.x,a.y,3),this.node.requestUpdate(this.id)))}};
a.addComponent(a.newEnemyComponent)}function h(a,b,c){n.activeEnemies.push(a);var d=[1,2,3,4],d=d[Math.floor(Math.random()*d.length)],e=a._size;1==d?(a.setPosition(M[0],Math.round(Math.random()*M[1]),3),a.sphere.setPosition(M[0],Math.round(Math.random()*M[1]),0),a.name="right"):2==d?(a.setPosition(-e,Math.round(Math.random()*M[1]),3),a.sphere.setPosition(-e,Math.round(Math.random()*M[1]),0),a.name="left"):3==d?(a.setPosition(Math.round(Math.random()*M[0]),M[1],3),a.sphere.setPosition(Math.round(Math.random()*
M[0]),M[1],0),a.name="bottom"):4==d&&(a.setPosition(Math.round(Math.random()*M[0]),-e,3),a.sphere.setPosition(Math.round(Math.random()*M[0]),-e,0),a.name="top");d=.5>Math.random()?!0:!1;e=a.getPosition();"left"==a.name?1==d?e[1]>M[1]/2?a.sphere.setVelocity(b,-b):a.sphere.setVelocity(b,b):a.sphere.setVelocity(b,0):"right"==a.name?1==d?e[1]>M[1]/2?a.sphere.setVelocity(-b,-b):a.sphere.setVelocity(-b,b):a.sphere.setVelocity(-b,0):"top"==a.name?1==d?e[0]>M[0]/2?a.sphere.setVelocity(-b,b):a.sphere.setVelocity(b,
b):a.sphere.setVelocity(0,b):"bottom"==a.name&&(1==d?e[0]>M[0]/2?a.sphere.setVelocity(-b,-b):a.sphere.setVelocity(b,-b):a.sphere.setVelocity(0,-b));a.requestUpdate(a.newEnemyComponent.id);y.getClock().setTimeout(function(){g()},c)}function g(){var a=92;699<n.score&&(a=100);a=Math.floor(Math.random()*a);if(0==n.over){var b="yellow";46<a&&93>a?b="rock":93==a?b="blue":94==a?b="grey":95==a?b="green":96==a?b="orange":97==a?b="pink":98==a?b="red":99==a?b="purple":100==a&&(b="black");a=[200,275];a=Math.floor(Math.floor(Math.random()*
(a[1]-a[0]))+a[0]+Math.floor(Math.random()*(n.score/2+1))/n.speed_reducer);n.timing_teir_i=0;200>n.score/n.teir_reducer?n.timing_teir_i=0:400>n.score/n.teir_reducer?n.timing_teir_i=1:800>n.score/n.teir_reducer?n.timing_teir_i=2:1600>n.score/n.teir_reducer?n.timing_teir_i=3:2400>n.score/n.teir_reducer?n.timing_teir_i=4:2400<=n.score/n.teir_reducer&&(n.timing_teir_i=5);var c=[[500,800],[400,650],[300,500],[200,400],[100,250],[50,125]][n.timing_teir_i],c=Math.floor(Math.random()*(c[1]-c[0]))+c[0],d=
R.addChild();d.name="";var f=[35,40,50,55],f=f[Math.floor(Math.random()*f.length)];d._size=f;d.setSizeMode("absolute","absolute").setAbsoluteSize(f,f).setAlign(0,0).setPosition(-(f+5),-(f+5),3);d.DOMElement=new z(d);var g;"yellow"==b?g="url(./images/star.png)":"rock"==b?g="url(./images/rock.png)":"blue"==b?g="url(./images/star_b.png)":"grey"==b?g="url(./images/star_g.png)":"green"==b?g="url(./images/star_grn.png)":"orange"==b?g="url(./images/star_oj.png)":"pink"==b?g="url(./images/star_p.png)":"red"==
b?g="url(./images/star_gb.png)":"purple"==b?g="url(./images/star_v.png)":"black"==b&&(g="url(./images/star_blk.png)");d.color=b;d.DOMElement.setProperty("background-image",g).setProperty("background-size","100% 100%").setProperty("color","teal").setProperty("font-size","24px").setProperty("font-weight","bold").setProperty("word-wrap","break-word").setProperty("border-radius","100%").setProperty("text-align","center");g=d.getPosition();d._position=g;d.sphere=new Q({mass:1,radius:f/2,position:new D(g[0],
g[1],-100),restitution:0,friction:0});d.sphere.node=d;"red"!=b&&Y.push(d.sphere);L.addBody(d.sphere);d.collision=L.addConstraint(new K([n.boxNode.box,d.sphere],{restitution:0}));v(d.sphere);e(d);h(d,a,c)}}function u(a){n.score+=a;n.scoreNode.DOMElement.setContent(n.score)}function k(){if(n.slowTime)n.slowTimeBarTimerNode.slowTimeBarTimerComponent.startTime=y.getClock()._time;else{n.slowTime=!0;var a=H.addChild();n.slowTimeBarTimerNode=a;a.name="slowTimeBarTimerNode";a.setSizeMode("relative","absolute").setAbsoluteSize(null,
10).setProportionalSize(.9,null).setAlign(.5,0);a.setPosition(-Math.floor(.9*M[0]/2),130,1);a.DOMElement=new z(a);a.DOMElement.setProperty("background-color","grey").setProperty("opacity","0.5");a.slowTimeBarTimerComponent={id:null,node:null,startTime:null,done:function(a){a in a._updater._updateQueue&&y._updateQueue.splice(a._updater._updateQueue.indexOf(a),1);a._updateQueue&&a._updateQueue.length&&(a._updateQueue=[]);a._nextUpdateQueue&&a._nextUpdateQueue.length&&(a._nextUpdateQueue=[]);a.dismount();
delete n.slowTime;delete n.slowTimeBarTimerNode.DOMElement;for(a=0;a<R._children.length;a++)if(null!=R._children[a]){for(var b=R._children[a].sphere.velocity.toArray(),c=0;c<b.length;c++)b[c]=Math.floor(2*b[c]);R._children[a].sphere.setVelocity(b[0],b[1],b[2])}},onMount:function(a){this.id=a.addComponent(this);this.node=a},onUpdate:function(a){null==this.startTime?this.startTime=a:(a-=this.startTime,3E3<a?this.done(this.node):(a=.9*(1-a/3E3),this.node.setProportionalSize(a,null)));for(a=0;a<R._children.length;a++)if(null!=
R._children[a]&&!R._children[a].slowed){for(var b=R._children[a].sphere.velocity.toArray(),c=0;c<b.length;c++)b[c]=Math.floor(b[c]/2);R._children[a].sphere.setVelocity(b[0],b[1],b[2]);R._children[a].slowed=!0}this.node.requestUpdate(this.id)}};a.addComponent(a.slowTimeBarTimerComponent);a.requestUpdate(a.slowTimeBarTimerComponent.id)}}function p(){if(n.invincible)n.invincibleBarTimerNode.invincibleBarTimerComponent.startTime=y.getClock()._time;else{n.invincible=!0;var a=H.addChild();n.invincibleBarTimerNode=
a;a.name="invincibleBarTimerNode";a.setSizeMode("relative","absolute").setAbsoluteSize(null,10).setProportionalSize(.9,null).setAlign(.5,0);a.setPosition(-Math.floor(.9*M[0]/2),100,1);a.DOMElement=new z(a);a.DOMElement.setProperty("background-color","blue").setProperty("opacity","0.5");a.invincibleBarTimerComponent={id:null,node:null,startTime:null,done:function(a){a.dismount();for(var b=0;b<y._updateQueue.length;b++)y._updateQueue[b]==a&&(y._updateQueue.splice(b,1),b--);delete n.invincible;delete n.invincibleBarTimerNode.DOMElement},
onMount:function(a){this.id=a.addComponent(this);this.node=a},onUpdate:function(a){null==this.startTime?this.startTime=a:(a-=this.startTime,3E3<a?this.done(this.node):(a=.9*(1-a/3E3),this.node.setProportionalSize(a,null)));this.node.requestUpdate(this.id)}};a.addComponent(a.invincibleBarTimerComponent);a.requestUpdate(a.invincibleBarTimerComponent.id)}}function q(){if(n.warp)n.warpBarTimerNode.warpBarTimerComponent.startTime=y.getClock()._time;else{n.warp=!0;var a=H.addChild();n.warpBarTimerNode=
a;a.name="warpBarTimerNode";a.setSizeMode("relative","absolute").setAbsoluteSize(null,10).setProportionalSize(.9,null).setAlign(.5,0);a.setPosition(-Math.floor(.9*M[0]/2),M[1]-130,1);a.DOMElement=new z(a);a.DOMElement.setProperty("background-color","purple").setProperty("opacity","0.5");a.warpBarTimerComponent={id:null,node:null,startTime:null,done:function(a){a.dismount();for(var b=0;b<y._updateQueue.length;b++)y._updateQueue[b]==a&&(y._updateQueue.splice(b,1),b--);delete n.warp;delete n.warpBarTimerNode.DOMElement},
onMount:function(a){this.id=a.addComponent(this);this.node=a},onUpdate:function(a){null==this.startTime?this.startTime=a:(a-=this.startTime,5E3<a?this.done(this.node):(a=.9*(1-a/5E3),this.node.setProportionalSize(a,null)));this.node.requestUpdate(this.id)}};a.addComponent(a.warpBarTimerComponent);a.requestUpdate(a.warpBarTimerComponent.id)}}function w(){if(n.magnetic)n.magneticBarTimerNode.magneticBarTimerComponent.startTime=y.getClock()._time;else{n.magnetic=!0;var a=H.addChild();n.magneticBarTimerNode=
a;a.name="magneticBarTimerNode";a.setSizeMode("relative","absolute").setAbsoluteSize(null,10).setProportionalSize(.9,null).setAlign(.5,0);a.setPosition(-Math.floor(.9*M[0]/2),M[1]-100,1);a.DOMElement=new z(a);a.DOMElement.setProperty("background-color","grey").setProperty("opacity","0.4");a.magneticBarTimerComponent={id:null,node:null,startTime:null,done:function(a){a.dismount();for(var b=0;b<y._updateQueue.length;b++)y._updateQueue[b]==a&&(y._updateQueue.splice(b,1),b--);delete n.magnetic;delete n.magneticBarTimerNode.DOMElement},
onMount:function(a){this.id=a.addComponent(this);this.node=a},onUpdate:function(a){null==this.startTime?this.startTime=a:(a-=this.startTime,5E3<a?this.done(this.node):(a=.9*(1-a/5E3),this.node.setProportionalSize(a,null)));n.gravity&&n.gravity.update();a=new E(n.boxNode.box,Y,{strength:1E8});n.gravity=a;this.node.requestUpdate(this.id)}};a.addComponent(a.magneticBarTimerComponent);a.requestUpdate(a.magneticBarTimerComponent.id)}}function t(){R.removeComponent(R.collisionComponent);for(var b=R.getChildren();b.length;)null==
b[0]?b.splice(0,1):b[0].newEnemyComponent.done(b[0]);R.requestUpdate(R.createEnemiesComponent.id);n.over=!0;H.getChildren();b=H.addChild();b.name="gameOverNode";b.setSizeMode("absolute","absolute").setAbsoluteSize(400,100).setAlign(.5,.5).setPosition(-200,-50);b.DOMElement=new z(b);b.DOMElement.setProperty("font-size","64px").setProperty("text-align","center").setContent("Game Over").setProperty("background","none").setProperty("color","white");a(n.over);n.scoreNode.setAlign(.5,.3,0);n.scoreNode.DOMElement.setProperty("opacity",
"1.0");n.started=!1;n.boxNode.setAlign(.5,.7).setPosition(-20,-20,1E3);n.idle=!0;document.body.style.cursor="auto";1==n.storage&&window.localStorage.high_score&&window.localStorage.high_score<n.score&&(window.localStorage.high_score=n.score);1==n.storage&&3<window.localStorage.games&&(b=H.addChild(),n.shadow=b,b.setSizeMode("relative","relative").setProportionalSize(1,1).setAlign(0,0).setPosition(0,0),b.DOMElement=new z(b),b.DOMElement.setProperty("background-color","black").setProperty("opacity",
"0.5"))}function B(){n.soundButtonNode.setPosition(-1E3,-1E3);n.creditsButtonNode.setPosition(-1E3,-1E3);n.boxNode.box.setPosition(-1E3,-1E3,1E4);n.startButtonNode.setPosition(-1E3,-1E3);n.howToButtonNode.setPosition(-1E3,-1E3);n.gameTitle.setPosition(-1E4,-1E4);if(n.shadow)n.shadow&&n.shadow.setPosition(0,0);else{var a=H.addChild();n.shadow=a;a.setSizeMode("relative","relative").setProportionalSize(1,1).setAlign(0,0).setPosition(0,0);a.DOMElement=new z(a);a.DOMElement.setProperty("background-color",
"black").setProperty("opacity","0.5")}n.rulesView?n.rulesView&&(n.rulesView.setPosition(20,35),n.rulesView.DOMElement.setId("rulesView")):(a=H.addChild(),n.rulesView=a,a.name="rulesView",a.setSizeMode("relative","relative").setProportionalSize(.9,.8).setAlign(0,0).setPosition(20,35),a.DOMElement=new z(a,{id:"rulesView"}),a.DOMElement.setProperty("color","white").setProperty("font-size","22px").setContent("Collect the Stars and avoid the Rocks!<br>Don't lift your finger off the screen<wbr> except if you get the Warp powerup!!<br>The key to a high score<wbr> is to collect powerups and use them to your<wbr> advantage!<br><br>Yellow<div id='yellow'></div> - gives you some points!<br>Blue<div id='blue'></div> - makes you invincible for 3 seconds!<br>Green<div id='green'></div> - reduces how often objects are spawned!<br>Orange<div id='orange'></div> - reduces how fast objects<wbr> are launched!<br>Pink<div id='pink'></div> - gives you a thousand points instantly!<br>Red<div id='gainsboro'></div> - gives you an exra life (up to 2)!<br>Purple<div id='purple'></div> - makes you master of warp holes for 5 seconds!<br>Grey<div id='grey'></div> - slows down time by 1/2 for 3 seconds!<br>Black<div id='black'></div> - makes all stars attracted to you for 5 seconds!").setProperty("zIndex",
"98"));n.howToX?n.howToX&&n.howToX.setPosition(-10,40):(a=H.addChild(),a.name="howToX",n.howToX=a,a.setSizeMode("absolute","absolute").setAbsoluteSize("40","40").setAlign(.9,0).setPosition(-10,40),a.DOMElement=new z(a),a.DOMElement.setContent("X").setProperty("zIndex","98").setProperty("color","white").setProperty("font-size","24px"),a.addComponent({id:null,node:null,onMount:function(a){this.id=a.addComponent(this);this.node=a},onReceive:function(a,b){"howToXButton"==a&&this.node.requestUpdate(this.id)},
onUpdate:function(){n.howToX.setPosition(-1E3,-1E3);n.shadow.setPosition(-1E3,-1E3);n.rulesView.DOMElement.setId(" ");n.rulesView.setPosition(-1E4,-1E4);n.startButtonNode.setPosition(-110,-130);n.howToButtonNode.setPosition(-85,-60);n.boxNode.box.setPosition(-40*n.boxNode.ratio,-60*n.boxNode.ratio,1E4);n.soundButtonNode.setPosition(20,-170);n.creditsButtonNode.setPosition(-60,-170);n.gameTitle.setPosition(-150,0)}}))}function m(){n.soundButtonNode.setPosition(-1E3,-1E3);n.creditsButtonNode.setPosition(-1E3,
-1E3);n.gameTitle.setPosition(-1E4,-1E4);n.boxNode.box.setPosition(-1E3,-1E3,1E4);n.startButtonNode.setPosition(-1E3,-1E3);n.howToButtonNode.setPosition(-1E3,-1E3);if(n.shadow)n.shadow&&n.shadow.setPosition(0,0);else{var a=H.addChild();n.shadow=a;a.setSizeMode("relative","relative").setProportionalSize(1,1).setAlign(0,0).setPosition(0,0);a.DOMElement=new z(a);a.DOMElement.setProperty("background-color","black").setProperty("opacity","0.5")}n.creditsView?n.creditsView&&n.creditsView.setPosition(20,
65):(a=H.addChild(),n.creditsView=a,a.name="creditsView",a.setSizeMode("relative","relative").setProportionalSize(.9,.9).setAlign(0,0).setPosition(20,65),a.DOMElement=new z(a),a.DOMElement.setProperty("color","white").setProperty("font-size","22px").setContent("Stars & Asteroids was designed, created, and developed by Semyon Karaman<br>Music by Ryan Mixey<br>Sound Effects courtesy of www.freesfx.co.uk<br>Comments, criticism, concerns, bugs? email me at semyonkaraman@gmail.com<br>Made with HTML5, Famous.org, & Cocoon.io").setProperty("zIndex",
"98"));n.creditsX?n.creditsX&&n.creditsX.setPosition(-10,40):(a=H.addChild(),a.name="creditsX",n.creditsX=a,a.setSizeMode("absolute","absolute").setAbsoluteSize("40","40").setAlign(.9,0).setPosition(-10,40),a.DOMElement=new z(a),a.DOMElement.setContent("X").setProperty("zIndex","98").setProperty("color","white").setProperty("font-size","24px"),a.addComponent({id:null,node:null,onMount:function(a){this.id=a.addComponent(this);this.node=a},onReceive:function(a,b){"creditsX"==a&&this.node.requestUpdate(this.id)},
onUpdate:function(){n.shadow.setPosition(-1E4,-1E4);n.creditsView.setPosition(-1E3,-1E3);n.creditsX.setPosition(-1E3,-1E3);n.startButtonNode.setPosition(-110,-130);n.howToButtonNode.setPosition(-85,-60);n.boxNode.box.setPosition(-40*n.boxNode.ratio,-60*n.boxNode.ratio,1E4);n.soundButtonNode.setPosition(20,-170);n.creditsButtonNode.setPosition(-60,-170);n.gameTitle.setPosition(-150,0)}}))}function v(a){a.angularMomentum=new D(0,0,0);a.angularVelocity=new D(0,0,0);a.momentum=new D(0,0,0);a.orientation=
new N(1,0,0,0);a.velocity=new D(0,0,0);a.torque=new D(0,0,0);a.inverseInertia=new O([1,0,0,0,1,0,0,0,1]);a.localInertia=new O([1,0,0,0,1,0,0,0,1]);a.localInverseInertia=new O([1,0,0,0,1,0,0,0,1]);a.restitution=0;a.friction=0}function x(){var a=n.gameEnemies,b={id:null,node:null,onMount:function(a){this.id=a.addComponent(this);this.node=a},onUpdate:function(a){for(var b=n.activeEnemies.map(function(a){return a.collision}),c=b.length,d,e,f,g=0;g<c;g++)(d=b[g])&&d.contactManifoldTable.collisionMatrix.hasOwnProperty(0)&&
(v(n.boxNode.box),d.targets[1].node.DOMElement&&(e=d.targets[1].node,f=e.color,e.newEnemyComponent.done(e),d.detected||(d.detected=!0,"yellow"==f?(n.sound&&V.play(),u(2*e._size)):"rock"==f?(n.sound&&aa.play(),n.invincible||1!=n.lives?n.invincible||n.emit("manageLives",{life:-1}):t()):"blue"==f?(n.sound&&V.play(),p()):"grey"==f?(n.sound&&V.play(),k()):"green"==f?(n.sound&&V.play(),n.teir_reducer+=2):"orange"==f?(n.sound&&V.play(),n.speed_reducer+=10):"pink"==f?(n.sound&&V.play(),u(1E3)):"red"==f?(n.sound&&
V.play(),n.emit("manageLives",{life:1})):"purple"==f?(n.sound&&V.play(),q()):"black"==f&&(n.sound&&V.play(),w()))));L.update(a);n.over||(u(1),n.emit("loop",{looping:!0}));this.node.requestUpdate(this.id)}};a.collisionComponent=b;a.addComponent(b);a.requestUpdate(b.id)}function I(a){if("start"==a){a=H.addChild();a.setPosition(0,0,1E6).setSizeMode("relative","relative").setProportionalSize(1,1);a.DOMElement=new z(a);a.DOMElement.setProperty("background-color","white");var b=a.addChild();n.loading=a;
b.name="loadingNode";b.setSizeMode("absolute","absolute").setAbsoluteSize(240,60).setAlign(.5,.5).setPosition(-120,-30,1000002).setOrigin(.5,.5);b.DOMElement=new z(b);b.DOMElement.setProperty("z-index","1000").setProperty("font-size","24px").setProperty("color","black").setContent("Loading...");b.getPosition();b.addComponent({id:null,node:null,onMount:function(a){this.id=a.addComponent(this);this.node=a},onUpdate:function(a){}})}else"end"==a&&H.removeChild(n.loading)}var z=f("famous/dom-renderables/DOMElement"),
y=f("famous/core/FamousEngine");l=f("famous/core/Dispatch");var A=f("famous/transitions/Transitionable");f("famous/core/Node");f("famous/components/Position");f("famous/math");var F=f("famous/physics"),Q=f("famous/physics/bodies/Sphere"),J=f("famous/physics/bodies/Box"),D=f("famous/math/Vec3"),O=f("famous/math/Mat33"),N=f("famous/math/Quaternion"),K=f("famous/physics/constraints/Collision"),E=f("famous/physics/forces/Gravity3D");r=f("./framedata.js");f("./howler.js");y.init();var G=r.init();f=y.createScene();
f.name="theScene";document.theScene=f;var C={},L=new F.PhysicsEngine(C),n=f.addChild();n.name="game";n.dispatch=l;var H=n.addChild();H.name="gameUI";var M=n.getSize(),R,Y=[];(function(a){try{var b=window[a];b.setItem("__storage_test__","__storage_test__");b.removeItem("__storage_test__");return!0}catch(c){return!1}})("localStorage")?(window.localStorage.high_score||(window.localStorage.high_score=0),window.localStorage.games||(window.localStorage.games=0),n.storage=!0):n.storage=!1;document.addEventListener("touchmove",
function(a){n.onReceive(a.type,a)},!1);document.addEventListener("touchend",function(a){n.onReceive(a.type,a)},!1);document.addEventListener("touchstart",function(a){n.onReceive(a.type,a)},!1);document.addEventListener("keydown",function(a){n.onReceive(a.type,a)}.bind(void 0));document.addEventListener("mousemove",function(a){n.onReceive(a.type,a)});document.addEventListener("click",function(a){n.onReceive(a.type,a)});n.onReceive=function(a,b){if("keydown"==a)66==b.keyCode?n.emit("sequence",b):67==
b.keyCode?n.emit("reverseSequence",b):65==b.keyCode&&(b.interruptable=!1,n.emit("sequence_timed",b));else if("click"==a||"touchend"==a){if(b.target.attributes.getNamedItem("data-fa-path"))var c=b.target.attributes.getNamedItem("data-fa-path").value;else b.target.parentNode.attributes.getNamedItem("data-fa-path")&&(c=b.target.parentNode.attributes.getNamedItem("data-fa-path").value);(c=n.dispatch.getNode(c))&&"startButtonNode"==c.name?n.emit("startButton",b):c&&"addEnemyButtonNode"==c.name?n.emit("addEnemyButton",
b):c&&"howToButtonNode"==c.name?n.emit("howToButton",b):c&&"howToX"==c.name?n.emit("howToXButton",b):c&&"soundButtonNode"==c.name?n.emit("sound",b):c&&"creditsButtonNode"==c.name?n.emit("credits",b):c&&"creditsX"==c.name&&n.emit("creditsX",b)}else if("mousemove"==a||"touchmove"==a)if(b.target.attributes.getNamedItem("data-fa-path")?c=b.target.attributes.getNamedItem("data-fa-path").value:b.target.parentNode.attributes.getNamedItem("data-fa-path")&&(c=b.target.parentNode.attributes.getNamedItem("data-fa-path").value),
c&&n.dispatch.getNode(c),n.started&&1==n.started){n.boxNode.box||d();var e;"touchmove"==b.type?(c=b.touches[0].clientX-n.boxNode.size.w/2,e=b.touches[0].clientY-n.boxNode.size.h/2):(c=b.clientX-n.boxNode.size.w/2,e=b.clientY-n.boxNode.size.h/2);if(n.warp||n.idle)n.previousPosition||(n.previousPosition={x:c,y:e},n.idle=!1),n.boxNode.box.setPosition(c,e,0);else if(!n.warp&&n.previousPosition){var f=Math.abs(n.previousPosition.y-e);179<Math.abs(n.previousPosition.x-c)||179<f||(n.boxNode.box.setPosition(c,
e,0),n.previousPosition={x:c,y:e})}}};d();a();(function(){var a=H.addChild();n.howToButtonNode=a;a.name="howToButtonNode";a.setSizeMode("absolute","absolute").setAbsoluteSize(190,60).setAlign(.5,.8).setPosition(-85,-60);a.DOMElement=new z(a);a.DOMElement.setProperty("font-size","30px").setContent("How To Play").setProperty("z-index","2").setProperty("color","white");a.addComponent({id:null,node:null,onMount:function(a){this.id=a.addComponent(this);this.node=a},onReceive:function(a,b){"howToButton"==
a&&this.node.requestUpdate(this.id)},onUpdate:function(){B()}})})();f=H.addChild();f.name="background";f.setSizeMode("relative","relative").setProportionalSize(1,1).setAlign(0,0);f.DOMElement=new z(f);f.DOMElement.setProperty("background-image","url(./images/space_new.png)").setProperty("z-index","1").setProperty("background-size","100% 100%");n.gameLivesNode=H.addChild();n.gameLivesNode.name="gameLivesNode";n.gameLivesNode.gameLivesComponent={id:null,node:null,life:null,onMount:function(a){this.id=
a.addComponent(this);this.node=a},onReceive:function(a,b){"manageLives"==a&&(this.life=b.life,this.node.requestUpdate(this.id))},onUpdate:function(a){a=this.life;n.lives+=a;if(1==a&&3>=n.lives){a=n.lives;var b=n.gameLivesNode.addChild();b.setSizeMode("absolute","absolute").setAbsoluteSize(40,38).setAlign(.5,.5).setPosition(-120+40*a,0,1);b.DOMElement=new z(b);b.DOMElement.setProperty("background-image","url(./images/life.png)").setProperty("background-size","100%").setProperty("z-index","10000").setProperty("opacity",
"0.5").setProperty("padding","5px 0px")}else-1==a&&null!=this.node._children[this.node._children.length-1]&&(this.node._children[this.node._children.length-1].dismount(),this.node._children.splice(this.node._children.length-1,1));3<n.lives&&(n.lives=3)}};n.gameLivesNode.addComponent(n.gameLivesNode.gameLivesComponent);var W=0;n.storage&&window.localStorage._pos&&(W=window.localStorage._pos);var T=new Howl({urls:["./assets/starcatcher.m4a"],loop:!0}),V=new Howl({urls:["./assets/bing.m4a"],volume:.35}),
aa=new Howl({urls:["./assets/bomb.m4a"]});n.storage?!window.localStorage.sound||"true"!=window.localStorage.sound&&"undefined"!=window.localStorage.sound?window.localStorage.sound&&"false"==window.localStorage.sound?n.sound=!1:window.localStorage.sound||(window.localStorage.sound=!0,n.sound=!0,T.play(function(){T.pos(W)})):(n.sound=!0,window.localStorage.sound=n.sound,T.play(function(){T.pos(W)})):(n.sound=!0,T.play(function(){T.pos(W)}));f=H.addChild();n.soundButtonNode=f;f.name="soundButtonNode";
f.setSizeMode("absolute","absolute").setAbsoluteSize(40,40).setAlign(0,1).setPosition(20,-170);f.DOMElement=new z(f);if(1==n.sound)var S="url(./images/music.png)";else 0==n.sound&&(S="url(./images/music_off.png)");f.DOMElement.setProperty("background-image",S).setProperty("z-index","20");f.soundButtonNodeComponent={id:null,node:null,onMount:function(a){this.id=a.addComponent(this);this.node=a},onReceive:function(a,b){"sound"==a&&this.node.requestUpdate(this.id)},onUpdate:function(a){n.sound?(n.sound=
!1,T.pause(),this.node.DOMElement.setProperty("background-image","url(./images/music_off.png)"),n.storage&&(window.localStorage.sound=!1)):(n.sound=!0,T.play(),this.node.DOMElement.setProperty("background-image","url(./images/music.png)"),n.storage&&(window.localStorage.sound=!0))}};f.addComponent(f.soundButtonNodeComponent);S=H.addChild();n.creditsButtonNode=S;S.name="creditsButtonNode";S.setSizeMode("absolute","absolute").setAbsoluteSize(40,40).setAlign(1,1).setPosition(-60,-170);S.DOMElement=new z(S);
S.DOMElement.setProperty("background-image","url(./images/credits.png)").setProperty("z-index","20");S.creditsButtonNodeComponent={id:null,node:null,onMount:function(a){this.id=a.addComponent(this);this.node=a},onReceive:function(a,b){"credits"==a&&this.node.requestUpdate(this.id)},onUpdate:function(a){m()}};S.addComponent(S.creditsButtonNodeComponent);n.storage&&window.localStorage.high_score&&(S=H.addChild(),n.highScoreNode=S,S.name="highScoreNode",f=window.localStorage.high_score.length,S.setSizeMode("absolute",
"absolute").setAbsoluteSize(50*f,30).setAlign(1,0).setPosition(-25*f,0),S.DOMElement=new z(S),S.DOMElement.setProperty("font-size","40px").setContent(window.localStorage.high_score).setProperty("z-index","2").setProperty("color","white").setProperty("opacity","0.5"));var U=H.addChild();U.name="title";n.gameTitle=U;U.setSizeMode("absolute","absolute").setAbsoluteSize(341,45).setAlign(.5,.2).setPosition(-150,0);U.DOMElement=new z(U);U.DOMElement.setContent("Stars & Asteroids").setProperty("z-index",
"1").setProperty("font-size","40px").setProperty("color","white")},{"./framedata.js":90,"./howler.js":91,"famous/components/Position":2,"famous/core/Dispatch":6,"famous/core/FamousEngine":8,"famous/core/Node":9,"famous/dom-renderables/DOMElement":17,"famous/math":36,"famous/math/Mat33":32,"famous/math/Quaternion":33,"famous/math/Vec3":35,"famous/physics":64,"famous/physics/bodies/Box":39,"famous/physics/bodies/Sphere":41,"famous/physics/constraints/Collision":46,"famous/physics/forces/Gravity3D":60,
"famous/transitions/Transitionable":73}]},{},[92]);
