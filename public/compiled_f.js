(function e$$0(k,v,b){function a(c,h){if(!v[c]){if(!k[c]){var g="function"==typeof require&&require;if(!h&&g)return g(c,!0);if(d)return d(c,!0);g=Error("Cannot find module '"+c+"'");throw g.code="MODULE_NOT_FOUND",g;}g=v[c]={exports:{}};k[c][0].call(g.exports,function(b){var d=k[c][1][b];return a(d?d:b)},g,g.exports,e$$0,k,v,b)}return v[c].exports}for(var d="function"==typeof require&&require,c=0;c<b.length;c++)a(b[c]);return a})({1:[function(e,k,v){function b(a){this._node=a;this._projectionType=
b.ORTHOGRAPHIC_PROJECTION;this._far=this._near=this._focalDepth=0;this._requestingUpdate=!1;this._id=a.addComponent(this);this._viewTransform=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this._perspectiveDirty=this._viewDirty=!1;this.setFlat()}var a=e("../core/Commands");b.FRUSTUM_PROJECTION=0;b.PINHOLE_PROJECTION=1;b.ORTHOGRAPHIC_PROJECTION=2;b.prototype.toString=function(){return"Camera"};b.prototype.getValue=function(){return{component:this.toString(),projectionType:this._projectionType,
focalDepth:this._focalDepth,near:this._near,far:this._far}};b.prototype.setValue=function(a){return this.toString()===a.component?(this.set(a.projectionType,a.focalDepth,a.near,a.far),!0):!1};b.prototype.set=function(a,b,f,h){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);this._projectionType=a;this._focalDepth=b;this._near=f;this._far=h;return this};b.prototype.setDepth=function(a){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=
!0);this._perspectiveDirty=!0;this._projectionType=b.PINHOLE_PROJECTION;this._focalDepth=a;this._far=this._near=0;return this};b.prototype.setFrustum=function(a,c){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);this._perspectiveDirty=!0;this._projectionType=b.FRUSTUM_PROJECTION;this._focalDepth=0;this._near=a;this._far=c;return this};b.prototype.setFlat=function(){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);this._perspectiveDirty=
!0;this._projectionType=b.ORTHOGRAPHIC_PROJECTION;this._far=this._near=this._focalDepth=0;return this};b.prototype.onUpdate=function(){this._requestingUpdate=!1;var d=this._node.getLocation();this._node.sendDrawCommand(a.WITH).sendDrawCommand(d);if(this._perspectiveDirty)switch(this._perspectiveDirty=!1,this._projectionType){case b.FRUSTUM_PROJECTION:this._node.sendDrawCommand(a.FRUSTRUM_PROJECTION);this._node.sendDrawCommand(this._near);this._node.sendDrawCommand(this._far);break;case b.PINHOLE_PROJECTION:this._node.sendDrawCommand(a.PINHOLE_PROJECTION);
this._node.sendDrawCommand(this._focalDepth);break;case b.ORTHOGRAPHIC_PROJECTION:this._node.sendDrawCommand(a.ORTHOGRAPHIC_PROJECTION)}this._viewDirty&&(this._viewDirty=!1,this._node.sendDrawCommand(a.CHANGE_VIEW_TRANSFORM),this._node.sendDrawCommand(this._viewTransform[0]),this._node.sendDrawCommand(this._viewTransform[1]),this._node.sendDrawCommand(this._viewTransform[2]),this._node.sendDrawCommand(this._viewTransform[3]),this._node.sendDrawCommand(this._viewTransform[4]),this._node.sendDrawCommand(this._viewTransform[5]),
this._node.sendDrawCommand(this._viewTransform[6]),this._node.sendDrawCommand(this._viewTransform[7]),this._node.sendDrawCommand(this._viewTransform[8]),this._node.sendDrawCommand(this._viewTransform[9]),this._node.sendDrawCommand(this._viewTransform[10]),this._node.sendDrawCommand(this._viewTransform[11]),this._node.sendDrawCommand(this._viewTransform[12]),this._node.sendDrawCommand(this._viewTransform[13]),this._node.sendDrawCommand(this._viewTransform[14]),this._node.sendDrawCommand(this._viewTransform[15]))};
b.prototype.onTransformChange=function(a){this._viewDirty=!0;this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);var b=a[0],f=a[1],h=a[2],g=a[3],r=a[4],l=a[5],m=a[6],p=a[7],u=a[8],n=a[9],A=a[10],t=a[11],w=a[12],e=a[13],x=a[14];a=a[15];var z=b*l-f*r,y=b*m-h*r,B=b*p-g*r,L=f*m-h*l,O=f*p-g*l,J=h*p-g*m,E=u*e-n*w,M=u*x-A*w,k=u*a-t*w,K=n*x-A*e,F=n*a-t*e,G=A*a-t*x,C=1/(z*G-y*F+B*K+L*k-O*M+J*E);this._viewTransform[0]=(l*G-m*F+p*K)*C;this._viewTransform[1]=(h*F-f*G-g*K)*C;
this._viewTransform[2]=(e*J-x*O+a*L)*C;this._viewTransform[3]=(A*O-n*J-t*L)*C;this._viewTransform[4]=(m*k-r*G-p*M)*C;this._viewTransform[5]=(b*G-h*k+g*M)*C;this._viewTransform[6]=(x*B-w*J-a*y)*C;this._viewTransform[7]=(u*J-A*B+t*y)*C;this._viewTransform[8]=(r*F-l*k+p*E)*C;this._viewTransform[9]=(f*k-b*F-g*E)*C;this._viewTransform[10]=(w*O-e*B+a*z)*C;this._viewTransform[11]=(n*B-u*O-t*z)*C;this._viewTransform[12]=(l*M-r*K-m*E)*C;this._viewTransform[13]=(b*K-f*M+h*E)*C;this._viewTransform[14]=(e*y-
w*L-x*z)*C;this._viewTransform[15]=(u*L-n*y+A*z)*C};k.exports=b},{"../core/Commands":5}],2:[function(e,k,v){function b(b){this._node=b;this._id=b.addComponent(this);this._requestingUpdate=!1;b=b.getPosition();this._x=new a(b[0]);this._y=new a(b[1]);this._z=new a(b[2])}var a=e("../transitions/Transitionable");b.prototype.toString=function(){return"Position"};b.prototype.getValue=function(){return{component:this.toString(),x:this._x.get(),y:this._y.get(),z:this._z.get()}};b.prototype.setValue=function(a){return this.toString()===
a.component?(this.set(a.x,a.y,a.z),!0):!1};b.prototype.getX=function(){return this._x.get()};b.prototype.getY=function(){return this._y.get()};b.prototype.getZ=function(){return this._z.get()};b.prototype.isActive=function(){return this._x.isActive()||this._y.isActive()||this._z.isActive()};b.prototype._checkUpdate=function(){this.isActive()?this._node.requestUpdateOnNextTick(this._id):this._requestingUpdate=!1};b.prototype.update=function(){this._node.setPosition(this._x.get(),this._y.get(),this._z.get());
this._checkUpdate()};b.prototype.onUpdate=b.prototype.update;b.prototype.setX=function(a,b,f){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);this._x.set(a,b,f);return this};b.prototype.setY=function(a,b,f){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);this._y.set(a,b,f);return this};b.prototype.setZ=function(a,b,f){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);this._z.set(a,b,
f);return this};b.prototype.set=function(a,b,f,h,g){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);var r,l,m;null!=f?m=g:null!=b?l=g:null!=a&&(r=g);null!=a&&this._x.set(a,h,r);null!=b&&this._y.set(b,h,l);null!=f&&this._z.set(f,h,m);return this};b.prototype.halt=function(){this._x.halt();this._y.halt();this._z.halt();return this};k.exports=b},{"../transitions/Transitionable":73}],3:[function(e,k,v){function b(){"undefined"!==typeof self&&self.window!==self&&
this._enterWorkerMode()}b.prototype._enterWorkerMode=function(){this._workerMode=!0;var a=this;self.addEventListener("message",function(b){a.onMessage(b.data)})};b.prototype.onMessage=null;b.prototype.sendMessage=function(a){if(this._workerMode)self.postMessage(a);else this.onmessage(a)};b.prototype.onmessage=null;b.prototype.postMessage=function(a){return this.onMessage(a)};k.exports=b},{}],4:[function(e,k,v){function b(){this._frame=this._time=0;this._timerQueue=[];this._updatingIndex=0;this._scale=
1;this._scaledTime=this._time}b.prototype.setScale=function(a){this._scale=a;return this};b.prototype.getScale=function(){return this._scale};b.prototype.step=function(a){this._frame++;this._scaledTime+=(a-this._time)*this._scale;this._time=a;for(a=0;a<this._timerQueue.length;a++)this._timerQueue[a](this._scaledTime)&&this._timerQueue.splice(a,1);return this};b.prototype.now=function(){return this._scaledTime};b.prototype.getTime=b.prototype.now;b.prototype.getFrame=function(){return this._frame};
b.prototype.setTimeout=function(a,b){var c=Array.prototype.slice.call(arguments,2),f=this._time,h=function(g){return g-f>=b?(a.apply(null,c),!0):!1};this._timerQueue.push(h);return h};b.prototype.setInterval=function(a,b){var c=Array.prototype.slice.call(arguments,2),f=this._time,h=function(g){g-f>=b&&(a.apply(null,c),f=g);return!1};this._timerQueue.push(h);return h};b.prototype.clearTimer=function(a){a=this._timerQueue.indexOf(a);-1!==a&&this._timerQueue.splice(a,1);return this};k.exports=b},{}],
5:[function(e,k,v){k.exports={INIT_DOM:0,DOM_RENDER_SIZE:1,CHANGE_TRANSFORM:2,CHANGE_SIZE:3,CHANGE_PROPERTY:4,CHANGE_CONTENT:5,CHANGE_ATTRIBUTE:6,ADD_CLASS:7,REMOVE_CLASS:8,SUBSCRIBE:9,GL_SET_DRAW_OPTIONS:10,GL_AMBIENT_LIGHT:11,GL_LIGHT_POSITION:12,GL_LIGHT_COLOR:13,MATERIAL_INPUT:14,GL_SET_GEOMETRY:15,GL_UNIFORMS:16,GL_BUFFER_DATA:17,GL_CUTOUT_STATE:18,GL_MESH_VISIBILITY:19,GL_REMOVE_MESH:20,PINHOLE_PROJECTION:21,ORTHOGRAPHIC_PROJECTION:22,CHANGE_VIEW_TRANSFORM:23,WITH:24,FRAME:25,ENGINE:26,START:27,
STOP:28,TIME:29,TRIGGER:30,NEED_SIZE_FOR:31,DOM:32,READY:33,ALLOW_DEFAULT:34,PREVENT_DEFAULT:35}},{}],6:[function(e,k,v){function b(){this._nodes={};this._queue=[]}var a=e("./Event"),d=e("./Path");b.prototype._setUpdater=function(a){this._updater=a;for(var b in this._nodes)this._nodes[b]._setUpdater(a)};b.prototype.addChildrenToQueue=function(a){a=a.getChildren();for(var b,d=0,g=a.length;d<g;d++)(b=a[d])&&this._queue.push(b)};b.prototype.next=function(){return this._queue.shift()};b.prototype.breadthFirstNext=
function(){var a=this._queue.shift();if(a)return this.addChildrenToQueue(a),a};b.prototype.mount=function(a,b){if(!b)throw Error("Dispatch: no node passed to mount at: "+a);if(this._nodes[a])throw Error("Dispatch: there is a node already registered at: "+a);b._setUpdater(this._updater);this._nodes[a]=b;var h=d.parent(a),g=h?this._nodes[h]:b;if(!g)throw Error("Parent to path: "+a+" doesn't exist at expected path: "+h);var h=b.getChildren(),r=b.getComponents(),l,m;g.isMounted()&&b._setMounted(!0,a);
g.isShown()&&b._setShown(!0);if(g.isMounted()){b._setParent(g);if(b.onMount)b.onMount(a);l=0;for(m=r.length;l<m;l++)if(r[l]&&r[l].onMount)r[l].onMount(b,l);l=0;for(m=h.length;l<m;l++)h[l]&&h[l].mount?h[l].mount(a+"/"+l):h[l]&&this.mount(a+"/"+l,h[l])}if(g.isShown()){if(b.onShow)b.onShow();l=0;for(m=r.length;l<m;l++)if(r[l]&&r[l].onShow)r[l].onShow()}};b.prototype.dismount=function(a){var b=this._nodes[a];if(!b)throw Error("No node registered to path: "+a);var d=b.getChildren(),g=b.getComponents(),
r,l;if(b.isShown()){b._setShown(!1);if(b.onHide)b.onHide();r=0;for(l=g.length;r<l;r++)if(g[r]&&g[r].onHide)g[r].onHide()}if(b.isMounted()){if(b.onDismount)b.onDismount(a);r=0;for(l=d.length;r<l;r++)d[r]&&d[r].dismount?d[r].dismount():d[r]&&this.dismount(a+"/"+r);r=0;for(l=g.length;r<l;r++)if(g[r]&&g[r].onDismount)g[r].onDismount();b._setMounted(!1);b._setParent(null)}delete this._nodes[a]};b.prototype.getNode=function(a){return this._nodes[a]};b.prototype.show=function(a){var b=this._nodes[a];if(!b)throw Error("No node registered to path: "+
a);if(b.onShow)b.onShow();for(this.addChildrenToQueue(b);a=this.breadthFirstNext();)this.show(a.getLocation())};b.prototype.hide=function(a){var b=this._nodes[a];if(!b)throw Error("No node registered to path: "+a);if(b.onHide)b.onHide();for(this.addChildrenToQueue(b);a=this.breadthFirstNext();)this.hide(a.getLocation())};b.prototype.lookupNode=function(a){if(!a)throw Error("lookupNode must be called with a path");this._queue.length=0;var b=this._queue,d=b.length=0,g,r=a.length;for(g=0;g<r;g++)"/"===
a[g]&&(b.push(a.substring(d,g)),d=g+1);0<g-d&&b.push(a.substring(d,g));a=0;for(d=b.length;a<d;a++)b[a]=this._nodes[b[a]];return b[b.length-1]};b.prototype.dispatch=function(a,b,d){if(!a)throw Error("dispatch requires a path as it's first argument");if(!b)throw Error("dispatch requires an event name as it's second argument");var g=this._nodes[a];if(!g)throw Error("No node registered at path: "+a);for(this.addChildrenToQueue(g);a=this.breadthFirstNext();)if(a&&a.onReceive)a.onReceive(b,d);else if(a)for(g=
0;g<a.getComponents().length;g++)if(a._components[g].onReceive)a._components[g].onReceive(b,d)};b.prototype.dispatchUIEvent=function(b,d,h){if(!b)throw Error("dispatchUIEvent needs a valid path to dispatch to");if(!d)throw Error("dispatchUIEvent needs an event name as its second argument");a.call(h);if(b=this.getNode(b)){var g,r,l;for(h.node=b;b;){if(b.onReceive)b.onReceive(d,h);g=b.getComponents();r=0;for(l=g.length;r<l;r++)if(g[r]&&g[r].onReceive)g[r].onReceive(d,h);if(h.propagationStopped)break;
g=b.getParent();if(g===b)break;b=g}}};k.exports=new b},{"./Event":7,"./Path":10}],7:[function(e,k,v){function b(){this.propagationStopped=!0}k.exports=function(){this.propagationStopped=!1;this.stopPropagation=b}},{}],8:[function(e,k,v){function b(){var b=this;f._setUpdater(this);this._updateQueue=[];this._nextUpdateQueue=[];this._scenes={};this._messages=A;this._inUpdate=!1;this._clock=new a;this._channel=new c;this._channel.onMessage=function(a){b.handleMessage(a)}}var a=e("./Clock"),d=e("./Scene"),
c=e("./Channel"),f=e("./Dispatch"),h=e("../renderers/UIManager"),g=e("../renderers/Compositor"),r=e("../render-loops/RequestAnimationFrameLoop"),l=e("./TransformSystem"),m=e("./SizeSystem"),p=e("./Commands"),u=[p.ENGINE,p.START],n=[p.ENGINE,p.STOP],A=[p.TIME,null];b.prototype.init=function(a){this.compositor=a&&a.compositor||new g;this.renderLoop=a&&a.renderLoop||new r;this.uiManager=new h(this.getChannel(),this.compositor,this.renderLoop);return this};b.prototype.setChannel=function(a){this._channel=
a;return this};b.prototype.getChannel=function(){return this._channel};b.prototype._update=function(){this._inUpdate=!0;var a=this._clock.now(),b=this._nextUpdateQueue,g=this._updateQueue;this._messages[1]=a;m.update();for(l.onUpdate();b.length;)g.unshift(b.pop());for(;g.length;)if((b=g.shift())&&b.update&&b.update(a),b&&b.onUpdate)b.onUpdate(a);this._inUpdate=!1};b.prototype.requestUpdate=function(a){if(!a)throw Error("requestUpdate must be called with a class to be updated");this._inUpdate?this.requestUpdateOnNextTick(a):
this._updateQueue.push(a)};b.prototype.requestUpdateOnNextTick=function(a){this._nextUpdateQueue.push(a)};b.prototype.handleMessage=function(a){if(!a)throw Error("onMessage must be called with an array of messages");for(var b;0<a.length;)switch(b=a.shift(),b){case p.WITH:this.handleWith(a);break;case p.FRAME:this.handleFrame(a);break;default:throw Error("received unknown command: "+b);}return this};b.prototype.handleWith=function(a){var b=a.shift(),g=a.shift();switch(g){case p.TRIGGER:g=a.shift();
a=a.shift();f.dispatchUIEvent(b,g,a);break;default:throw Error("received unknown command: "+g);}return this};b.prototype.handleFrame=function(a){if(!a)throw Error("handleFrame must be called with an array of messages");if(!a.length)throw Error("FRAME must be sent with a time");this.step(a.shift());return this};b.prototype.step=function(a){if(null==a)throw Error("step must be called with a time");this._clock.step(a);this._update();if(this._messages.length)for(this._channel.sendMessage(this._messages);2<
this._messages.length;)this._messages.pop();return this};b.prototype.getContext=function(a){if(!a)throw Error("getContext must be called with a selector");var b=a.indexOf("/");a=-1===b?a:a.substring(0,b);return this._scenes[a]};b.prototype.getClock=function(){return this._clock};b.prototype.message=function(a){this._messages.push(a);return this};b.prototype.createScene=function(a){a=a||"body";this._scenes[a]&&this._scenes[a].dismount();this._scenes[a]=new d(a,this);return this._scenes[a]};b.prototype.addScene=
function(a){var b=a._selector,g=this._scenes[b];g&&g!==a&&g.dismount();a.isMounted()||a.mount();this._scenes[b]=a;return this};b.prototype.removeScene=function(a){var b=a._selector,g=this._scenes[b];g&&g===a&&(a.isMounted()&&a.dismount(),delete this._scenes[b]);return this};b.prototype.startRenderLoop=function(){this._channel.sendMessage(u);return this};b.prototype.stopRenderLoop=function(){this._channel.sendMessage(n);return this};b.prototype.startEngine=function(){console.warn("FamousEngine.startEngine is deprecated! Use FamousEngine.startRenderLoop instead!");
return this.startRenderLoop()};b.prototype.stopEngine=function(){console.warn("FamousEngine.stopEngine is deprecated! Use FamousEngine.stopRenderLoop instead!");return this.stopRenderLoop()};k.exports=new b},{"../render-loops/RequestAnimationFrameLoop":67,"../renderers/Compositor":68,"../renderers/UIManager":70,"./Channel":3,"./Clock":4,"./Commands":5,"./Dispatch":6,"./Scene":12,"./SizeSystem":14,"./TransformSystem":16}],9:[function(e,k,v){function b(){this._shown=this._mounted=this._inUpdate=this._requestingUpdate=
!1;this._updater=null;this._opacity=1;this._UIEvents=[];this._updateQueue=[];this._nextUpdateQueue=[];this._freedComponentIndicies=[];this._components=[];this._freedChildIndicies=[];this._children=[];this._sizeID=this._transformID=this._id=this._parent=null;this.constructor.INIT_DEFAULT_COMPONENTS&&this._init()}var a=e("./SizeSystem"),d=e("./Dispatch"),c=e("./TransformSystem"),f=e("./Size"),h=e("./Transform");b.RELATIVE_SIZE=0;b.ABSOLUTE_SIZE=1;b.RENDER_SIZE=2;b.DEFAULT_SIZE=0;b.INIT_DEFAULT_COMPONENTS=
!0;b.prototype._init=function(){this._transformID=this.addComponent(new h);this._sizeID=this.addComponent(new f)};b.prototype._setParent=function(a){this._parent&&-1!==this._parent.getChildren().indexOf(this)&&this._parent.removeChild(this);this._parent=a};b.prototype._setMounted=function(a,b){this._mounted=a;this._id=b?b:null};b.prototype._setShown=function(a){this._shown=a};b.prototype._setUpdater=function(a){this._updater=a;this._requestingUpdate&&this._updater.requestUpdate(this)};b.prototype.getLocation=
function(){return this._id};b.prototype.getId=b.prototype.getLocation;b.prototype.emit=function(a,b){d.dispatch(this.getLocation(),a,b);return this};b.prototype.sendDrawCommand=function(a){this._updater.message(a);return this};b.prototype.getValue=function(){var b=this._children.length,d=this._components.length,l=0,f={location:this.getId(),spec:{location:this.getId(),showState:{mounted:this.isMounted(),shown:this.isShown(),opacity:this.getOpacity()||null},offsets:{mountPoint:[0,0,0],align:[0,0,0],
origin:[0,0,0]},vectors:{position:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1]},size:{sizeMode:[0,0,0],proportional:[1,1,1],differential:[0,0,0],absolute:[0,0,0],render:[0,0,0]}},UIEvents:this._UIEvents,components:[],children:[]};if(f.location){for(var h=c.get(this.getId()),u=a.get(this.getId()),l=0;3>l;l++)f.spec.offsets.mountPoint[l]=h.offsets.mountPoint[l],f.spec.offsets.align[l]=h.offsets.align[l],f.spec.offsets.origin[l]=h.offsets.origin[l],f.spec.vectors.position[l]=h.vectors.position[l],f.spec.vectors.rotation[l]=
h.vectors.rotation[l],f.spec.vectors.scale[l]=h.vectors.scale[l],f.spec.size.sizeMode[l]=u.sizeMode[l],f.spec.size.proportional[l]=u.proportionalSize[l],f.spec.size.differential[l]=u.differentialSize[l],f.spec.size.absolute[l]=u.absoluteSize[l],f.spec.size.render[l]=u.renderSize[l];f.spec.vectors.rotation[3]=h.vectors.rotation[3]}for(l=0;l<b;l++)this._children[l]&&this._children[l].getValue&&f.children.push(this._children[l].getValue());for(l=0;l<d;l++)this._components[l]&&this._components[l].getValue&&
f.components.push(this._components[l].getValue());return f};b.prototype.getComputedValue=function(){console.warn("Node.getComputedValue is depricated. Use Node.getValue instead");for(var b=this._children.length,d={location:this.getId(),computedValues:{transform:this.isMounted()?c.get(this.getLocation()).getLocalTransform():null,size:this.isMounted()?a.get(this.getLocation()).get():null},children:[]},f=0;f<b;f++)this._children[f]&&this._children[f].getComputedValue&&d.children.push(this._children[f].getComputedValue());
return d};b.prototype.getChildren=function(){return this._children};b.prototype.getParent=function(){return this._parent};b.prototype.requestUpdate=function(a){if(this._inUpdate||!this.isMounted())return this.requestUpdateOnNextTick(a);this._updateQueue.push(a);this._requestingUpdate||this._requestUpdate();return this};b.prototype.requestUpdateOnNextTick=function(a){-1==this._nextUpdateQueue.indexOf(a)&&this._nextUpdateQueue.push(a);return this};b.prototype.isMounted=function(){return this._mounted};
b.prototype.isShown=function(){return this._shown};b.prototype.getOpacity=function(){return this._opacity};b.prototype.getMountPoint=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._transformID).getMountPoint();if(this.isMounted())return c.get(this.getLocation()).getMountPoint();throw Error("This node does not have access to a transform component");};b.prototype.getAlign=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._transformID).getAlign();
if(this.isMounted())return c.get(this.getLocation()).getAlign();throw Error("This node does not have access to a transform component");};b.prototype.getOrigin=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._transformID).getOrigin();if(this.isMounted())return c.get(this.getLocation()).getOrigin();throw Error("This node does not have access to a transform component");};b.prototype.getPosition=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._transformID).getPosition();
if(this.isMounted())return c.get(this.getLocation()).getPosition();throw Error("This node does not have access to a transform component");};b.prototype.getRotation=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._transformID).getRotation();if(this.isMounted())return c.get(this.getLocation()).getRotation();throw Error("This node does not have access to a transform component");};b.prototype.getScale=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._transformID).getScale();
if(this.isMounted())return c.get(this.getLocation()).getScale();throw Error("This node does not have access to a transform component");};b.prototype.getSizeMode=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._sizeID).getSizeMode();if(this.isMounted())return a.get(this.getLocation()).getSizeMode();throw Error("This node does not have access to a size component");};b.prototype.getProportionalSize=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._sizeID).getProportional();
if(this.isMounted())return a.get(this.getLocation()).getProportional();throw Error("This node does not have access to a size component");};b.prototype.getDifferentialSize=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._sizeID).getDifferential();if(this.isMounted())return a.get(this.getLocation()).getDifferential();throw Error("This node does not have access to a size component");};b.prototype.getAbsoluteSize=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._sizeID).getAbsolute();
if(this.isMounted())return a.get(this.getLocation()).getAbsolute();throw Error("This node does not have access to a size component");};b.prototype.getRenderSize=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._sizeID).getRender();if(this.isMounted())return a.get(this.getLocation()).getRender();throw Error("This node does not have access to a size component");};b.prototype.getSize=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._sizeID).get();
if(this.isMounted())return a.get(this.getLocation()).get();throw Error("This node does not have access to a size component");};b.prototype.getTransform=function(){return c.get(this.getLocation())};b.prototype.getUIEvents=function(){return this._UIEvents};b.prototype.addChild=function(a){var d=a?this._children.indexOf(a):-1;a=a?a:new b;-1===d&&(d=this._freedChildIndicies.length?this._freedChildIndicies.pop():this._children.length,this._children[d]=a);this.isMounted()&&a.mount(this.getLocation()+"/"+
d);return a};b.prototype.removeChild=function(a){var b=this._children.indexOf(a);if(-1<b)return this._freedChildIndicies.push(b),this._children[b]=null,a.isMounted()&&a.dismount(),!0;throw Error("Node is not a child of this node");};b.prototype.addComponent=function(a){var b=this._components.indexOf(a);if(-1===b){b=this._freedComponentIndicies.length?this._freedComponentIndicies.pop():this._components.length;this._components[b]=a;if(this.isMounted()&&a.onMount)a.onMount(this,b);if(this.isShown()&&
a.onShow)a.onShow()}return b};b.prototype.getComponent=function(a){return this._components[a]};b.prototype.removeComponent=function(a){var b=this._components.indexOf(a);if(-1!==b){this._freedComponentIndicies.push(b);if(this.isShown()&&a.onHide)a.onHide();if(this.isMounted()&&a.onDismount)a.onDismount();this._components.splice(b,1)}return a};b.prototype.removeUIEvent=function(a){var b=this.getUIEvents(),d=this._components,f=b.indexOf(a);if(-1!==f){b.splice(f,1);for(var f=0,c=d.length;f<c;f++)if((b=
d[f])&&b.onRemoveUIEvent)b.onRemoveUIEvent(a)}};b.prototype.addUIEvent=function(a){var b=this.getUIEvents(),d=this._components;if(-1===b.indexOf(a)){b.push(a);for(var f=0,c=d.length;f<c;f++)if((b=d[f])&&b.onAddUIEvent)b.onAddUIEvent(a)}};b.prototype._requestUpdate=function(a){if(a||!this._requestingUpdate)this._updater&&this._updater.requestUpdate(this),this._requestingUpdate=!0};b.prototype._vecOptionalSet=function(a,b,d){return null!=d&&a[b]!==d?(a[b]=d,this._requestingUpdate||this._requestUpdate(),
!0):!1};b.prototype.show=function(){d.show(this.getLocation());this._shown=!0;return this};b.prototype.hide=function(){d.hide(this.getLocation());this._shown=!1;return this};b.prototype.setAlign=function(a,b,d){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._transformID).setAlign(a,b,d);else if(this.isMounted())c.get(this.getLocation()).setAlign(a,b,d);else throw Error("This node does not have access to a transform component");return this};b.prototype.setMountPoint=function(a,
b,d){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._transformID).setMountPoint(a,b,d);else if(this.isMounted())c.get(this.getLocation()).setMountPoint(a,b,d);else throw Error("This node does not have access to a transform component");return this};b.prototype.setOrigin=function(a,b,d){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._transformID).setOrigin(a,b,d);else if(this.isMounted())c.get(this.getLocation()).setOrigin(a,b,d);else throw Error("This node does not have access to a transform component");
return this};b.prototype.setPosition=function(a,b,d){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._transformID).setPosition(a,b,d);else if(this.isMounted())c.get(this.getLocation()).setPosition(a,b,d);else throw Error("This node does not have access to a transform component");return this};b.prototype.setRotation=function(a,b,d,f){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._transformID).setRotation(a,b,d,f);else if(this.isMounted())c.get(this.getLocation()).setRotation(a,
b,d,f);else throw Error("This node does not have access to a transform component");return this};b.prototype.setScale=function(a,b,d){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._transformID).setScale(a,b,d);else if(this.isMounted())c.get(this.getLocation()).setScale(a,b,d);else throw Error("This node does not have access to a transform component");return this};b.prototype.setOpacity=function(a){if(a!==this._opacity){this._opacity=a;this._requestingUpdate||this._requestUpdate();
for(var b=0,d=this._components,f=d.length,c;b<f;b++)if((c=d[b])&&c.onOpacityChange)c.onOpacityChange(a)}return this};b.prototype.setSizeMode=function(b,d,f){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._sizeID).setSizeMode(b,d,f);else if(this.isMounted())a.get(this.getLocation()).setSizeMode(b,d,f);else throw Error("This node does not have access to a size component");return this};b.prototype.setProportionalSize=function(b,d,f){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._sizeID).setProportional(b,
d,f);else if(this.isMounted())a.get(this.getLocation()).setProportional(b,d,f);else throw Error("This node does not have access to a size component");return this};b.prototype.setDifferentialSize=function(b,d,f){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._sizeID).setDifferential(b,d,f);else if(this.isMounted())a.get(this.getLocation()).setDifferential(b,d,f);else throw Error("This node does not have access to a size component");return this};b.prototype.setAbsoluteSize=function(b,
d,f){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._sizeID).setAbsolute(b,d,f);else if(this.isMounted())a.get(this.getLocation()).setAbsolute(b,d,f);else throw Error("This node does not have access to a size component");return this};b.prototype.getFrame=function(){return this._updater.getFrame()};b.prototype.getComponents=function(){return this._components};b.prototype.update=function(a){this._inUpdate=!0;var b;if(this.onUpdate)this.onUpdate();for(;this._nextUpdateQueue&&this._nextUpdateQueue.length;)this._updateQueue.unshift(this._nextUpdateQueue.pop());
for(;this._updateQueue&&this._updateQueue.length;)if((b=this._components[this._updateQueue.shift()])&&b.onUpdate)b.onUpdate(a);this._requestingUpdate=this._inUpdate=!1;this.isMounted()?this._nextUpdateQueue.length&&(this._updater.requestUpdateOnNextTick(this),this._requestingUpdate=!0):this._id=this._parent=null;return this};b.prototype.mount=function(b){if(this.isMounted())throw Error("Node is already mounted at: "+this.getLocation());this.constructor.INIT_DEFAULT_COMPONENTS?(c.registerTransformAtPath(b,
this.getComponent(this._transformID)),a.registerSizeAtPath(b,this.getComponent(this._sizeID))):(c.registerTransformAtPath(b),a.registerSizeAtPath(b));d.mount(b,this);this._requestingUpdate||this._requestUpdate();return this};b.prototype.dismount=function(){if(!this.isMounted())throw Error("Node is not mounted");var b=this.getLocation();c.deregisterTransformAtPath(b);a.deregisterSizeAtPath(b);d.dismount(b);this._requestingUpdate||this._requestUpdate();return this};k.exports=b},{"./Dispatch":6,"./Size":13,
"./SizeSystem":14,"./Transform":15,"./TransformSystem":16}],10:[function(e,k,v){function b(){}b.prototype.hasTrailingSlash=function(a){return"/"===a[a.length-1]};b.prototype.depth=function(a){for(var b=0,c=a.length,c=this.hasTrailingSlash(a)?c-1:c,f=0;f<c;f++)b+="/"===a[f]?1:0;return b};b.prototype.index=function(a){for(var b=this.hasTrailingSlash(a)?a.length-1:a.length;b--&&"/"!==a[b];);a=parseInt(a.substring(b+1));return isNaN(a)?0:a};b.prototype.indexAtDepth=function(a,b){for(var c=0,f=a.length,
h=0;c<f;c++)if("/"===a[c]&&h++,h===b){a=a.substring(c?c+1:c);h=a.indexOf("/");a=-1===h?a:a.substring(0,h);h=parseInt(a);break}return isNaN(h)?a:h};b.prototype.parent=function(a){return a.substring(0,a.lastIndexOf("/",a.length-2))};b.prototype.isChildOf=function(a,b){return this.isDescendentOf(a,b)&&this.depth(a)===this.depth(b)+1};b.prototype.isDescendentOf=function(a,b){if(a===b)return!1;a=this.hasTrailingSlash(a)?a:a+"/";b=this.hasTrailingSlash(b)?b:b+"/";return this.depth(b)<this.depth(a)&&0===
a.indexOf(b)};b.prototype.getSelector=function(a){var b=a.indexOf("/");return-1===b?a:a.substring(0,b)};k.exports=new b},{}],11:[function(e,k,v){function b(){this.items=[];this.paths=[];this.memo={}}var a=e("./Path");b.prototype.insert=function(b,c){var f=this.paths;if(-1!==f.indexOf(b))throw Error("item already exists at path: "+b);for(var h=0,g=a.depth(b),r=a.index(b);f[h]&&g>=a.depth(f[h]);)h++;for(;f[h]&&g===a.depth(f[h])&&r<a.index(f[h]);)h++;f.splice(h,0,b);this.items.splice(h,0,c);this.memo[b]=
h;for(f=this.paths.length;h<f;h++)this.memo[this.paths[h]]=null};b.prototype.remove=function(a){var b=this.paths,f=this.memo[a]?this.memo[a]:b.indexOf(a);if(-1===f)throw Error("Cannot remove. No item exists at path: "+a);b.splice(f,1);this.items.splice(f,1);this.memo[a]=null;for(a=this.paths.length;f<a;f++)this.memo[this.paths[f]]=null};b.prototype.get=function(a){if(this.memo[a])return this.items[this.memo[a]];var b=this.paths.indexOf(a);if(-1!==b)return this.memo[a]=b,this.items[b]};b.prototype.getItems=
function(){return this.items};b.prototype.getPaths=function(){return this.paths};k.exports=b},{"./Path":10}],12:[function(e,k,v){function b(b,d){if(!b)throw Error("Scene needs to be created with a DOM selector");if(!d)throw Error("Scene needs to be created with a class like Famous");a.call(this);this._globalUpdater=d;this._selector=b;this.mount(b);this._globalUpdater.message(c.NEED_SIZE_FOR).message(b);this.show()}var a=e("./Node"),d=e("./Dispatch"),c=e("./Commands"),f=e("./TransformSystem"),h=e("./SizeSystem");
b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.getUpdater=function(){return this._updater};b.prototype.getSelector=function(){return this._selector};b.prototype.getDispatch=function(){console.warn("Scene#getDispatch is deprecated, require the dispatch directly");return d};b.prototype.onReceive=function(a,b){if("CONTEXT_RESIZE"===a){if(2>b.length)throw Error("CONTEXT_RESIZE's payload needs to be at least a pair of pixel sizes");this.setSizeMode("absolute","absolute","absolute");
this.setAbsoluteSize(b[0],b[1],b[2]?b[2]:0);this._updater.message(c.WITH).message(this._selector).message(c.READY)}};b.prototype.mount=function(a){if(this.isMounted())throw Error("Scene is already mounted at: "+this.getLocation());d.mount(a,this);this._id=a;this._mounted=!0;this._parent=this;f.registerTransformAtPath(a);h.registerSizeAtPath(a)};k.exports=b},{"./Commands":5,"./Dispatch":6,"./Node":9,"./SizeSystem":14,"./TransformSystem":16}],13:[function(e,k,v){function b(a){this.finalSize=new Float32Array(3);
this.sizeChanged=!1;this.sizeMode=new Uint8Array(3);this.sizeModeChanged=!1;this.absoluteSize=new Float32Array(3);this.absoluteSizeChanged=!1;this.proportionalSize=new Float32Array(f);this.proportionalSizeChanged=!1;this.differentialSize=new Float32Array(3);this.differentialSizeChanged=!1;this.renderSize=new Float32Array(3);this.renderSizeChanged=!1;this.parent=null!=a?a:null}function a(a,b,d){return null!=d&&a[b]!==d?(a[b]=d,!0):!1}function d(b,d,f,c){var h=!1,h=a(b,0,d)||h,h=a(b,1,f)||h;return h=
a(b,2,c)||h}function c(a){if(a.constructor===String)switch(a.toLowerCase()){case "relative":case "default":return b.RELATIVE;case "absolute":return b.ABSOLUTE;case "render":return b.RENDER;default:throw Error("unknown size mode: "+a);}else if(0>a||a>b.RENDER)throw Error("unknown size mode: "+a);return a}var f=[1,1,1],h=[0,0,0];b.RELATIVE=0;b.ABSOLUTE=1;b.RENDER=2;b.DEFAULT=b.RELATIVE;b.prototype.setParent=function(a){this.parent=a;return this};b.prototype.getParent=function(){return this.parent};
b.prototype.setSizeMode=function(a,b,f){null!=a&&(a=c(a));null!=b&&(b=c(b));null!=f&&(f=c(f));this.sizeModeChanged=d(this.sizeMode,a,b,f);return this};b.prototype.getSizeMode=function(){return this.sizeMode};b.prototype.setAbsolute=function(a,b,f){this.absoluteSizeChanged=d(this.absoluteSize,a,b,f);return this};b.prototype.getAbsolute=function(){return this.absoluteSize};b.prototype.setProportional=function(a,b,f){this.proportionalSizeChanged=d(this.proportionalSize,a,b,f);return this};b.prototype.getProportional=
function(){return this.proportionalSize};b.prototype.setDifferential=function(a,b,f){this.differentialSizeChanged=d(this.differentialSize,a,b,f);return this};b.prototype.getDifferential=function(){return this.differentialSize};b.prototype.get=function(){return this.finalSize};b.prototype.fromComponents=function(a){for(var d=this.sizeMode,f=this.finalSize,c=this.parent?this.parent.get():h,p,u=!1,n=a.length,A,t=0;3>t;t++){p=f[t];switch(d[t]){case b.RELATIVE:f[t]=c[t]*this.proportionalSize[t]+this.differentialSize[t];
break;case b.ABSOLUTE:f[t]=this.absoluteSize[t];break;case b.RENDER:var w;for(A=0;A<n;A++)(w=a[A])&&w.getRenderSize&&(w=w.getRenderSize()[t],f[t]=f[t]<w||0===f[t]?w:f[t])}u=u||p!==f[t]}return this.sizeChanged=u};k.exports=b},{}],14:[function(e,k,v){function b(){this.pathStore=new a}var a=e("./PathStore"),d=e("./Size"),c=e("./Dispatch"),f=e("./Path");b.prototype.registerSizeAtPath=function(a,b){if(!f.depth(a))return this.pathStore.insert(a,b?b:new d);var r=this.pathStore.get(f.parent(a));if(!r)throw Error("No parent size registered at expected path: "+
f.parent(a));b&&b.setParent(r);this.pathStore.insert(a,b?b:new d(r))};b.prototype.deregisterSizeAtPath=function(a){this.pathStore.remove(a)};b.prototype.get=function(a){return this.pathStore.get(a)};b.prototype.update=function(){var a=this.pathStore.getItems(),b=this.pathStore.getPaths(),d,f,m,p,u;m=0;for(p=a.length;m<p;m++)if(d=c.getNode(b[m]),u=d.getComponents(),d){f=a[m];if(f.sizeModeChanged){var n=d,A=u,t=f,w=t.getSizeMode(),e=w[0],x=w[1],w=w[2];if(n.onSizeModeChange)n.onSizeModeChange(e,x,w);
for(var n=0,z=A.length;n<z;n++)if(A[n]&&A[n].onSizeModeChange)A[n].onSizeModeChange(e,x,w);t.sizeModeChanged=!1}if(f.absoluteSizeChanged){n=d;A=u;t=f;w=t.getAbsolute();e=w[0];x=w[1];w=w[2];if(n.onAbsoluteSizeChange)n.onAbsoluteSizeChange(e,x,w);n=0;for(z=A.length;n<z;n++)if(A[n]&&A[n].onAbsoluteSizeChange)A[n].onAbsoluteSizeChange(e,x,w);t.absoluteSizeChanged=!1}if(f.proportionalSizeChanged){n=d;A=u;t=f;w=t.getProportional();e=w[0];x=w[1];w=w[2];if(n.onProportionalSizeChange)n.onProportionalSizeChange(e,
x,w);n=0;for(z=A.length;n<z;n++)if(A[n]&&A[n].onProportionalSizeChange)A[n].onProportionalSizeChange(e,x,w);t.proportionalSizeChanged=!1}if(f.differentialSizeChanged){n=d;A=u;t=f;w=t.getDifferential();e=w[0];x=w[1];w=w[2];if(n.onDifferentialSizeChange)n.onDifferentialSizeChange(e,x,w);n=0;for(z=A.length;n<z;n++)if(A[n]&&A[n].onDifferentialSizeChange)A[n].onDifferentialSizeChange(e,x,w);t.differentialSizeChanged=!1}if(f.renderSizeChanged){n=d;A=u;t=f;w=t.getRenderSize();e=w[0];x=w[1];w=w[2];if(n.onRenderSizeChange)n.onRenderSizeChange(e,
x,w);n=0;for(z=A.length;n<z;n++)if(A[n]&&A[n].onRenderSizeChange)A[n].onRenderSizeChange(e,x,w);t.renderSizeChanged=!1}if(f.fromComponents(u)){e=f.get();A=e[0];t=e[1];e=e[2];if(d.onSizeChange)d.onSizeChange(A,t,e);d=0;for(x=u.length;d<x;d++)if(u[d]&&u[d].onSizeChange)u[d].onSizeChange(A,t,e);f.sizeChanged=!1}}};k.exports=new b},{"./Dispatch":6,"./Path":10,"./PathStore":11,"./Size":13}],15:[function(e,k,v){function b(a){this.local=new Float32Array(b.IDENT);this.global=new Float32Array(b.IDENT);this.offsets=
{align:new Float32Array(3),alignChanged:!1,mountPoint:new Float32Array(3),mountPointChanged:!1,origin:new Float32Array(3),originChanged:!1};this.vectors={position:new Float32Array(3),positionChanged:!1,rotation:new Float32Array(c),rotationChanged:!1,scale:new Float32Array(f),scaleChanged:!1};this._lastEulerVals=[0,0,0];this._lastEuler=!1;this.parent=a?a:null;this.breakPoint=!1}function a(a,b,d){return null!=d&&a[b]!==d?(a[b]=d,!0):!1}function d(b,d,f,c,m){var p=!1,p=a(b,0,d)||p,p=a(b,1,f)||p,p=a(b,
2,c)||p;null!=m&&(p=a(b,3,m)||p);return p}var c=[0,0,0,1],f=[1,1,1];b.IDENT=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];b.WORLD_CHANGED=1;b.LOCAL_CHANGED=2;b.prototype.reset=function(){this.parent=null;this.breakPoint=!1};b.prototype.setParent=function(a){this.parent=a};b.prototype.getParent=function(){return this.parent};b.prototype.setBreakPoint=function(){this.breakPoint=!0};b.prototype.isBreakPoint=function(){return this.breakPoint};b.prototype.getLocalTransform=function(){return this.local};b.prototype.getWorldTransform=
function(){if(!this.isBreakPoint())throw Error("This transform is not calculating world transforms");return this.global};b.prototype.calculate=function(a){if(!this.parent||this.parent.isBreakPoint()){var d=this.getLocalTransform(),f=a.getSize(),c=this.vectors,m=this.offsets,p=a.getParent().getSize(),u=0,n=d[0],A=d[1],t=d[2],w=d[4],e=d[5],x=d[6],z=d[8],y=d[9],B=d[10],L=d[12],k=d[13],J=d[14],E=c.position[0],M=c.position[1],P=c.position[2],K=c.rotation[0],F=c.rotation[1],G=c.rotation[2],C=c.rotation[3],
q=c.scale[0],I=c.scale[1],H=c.scale[2],N=m.align[0]*p[0],S=m.align[1]*p[1],R=m.align[2]*p[2],V=m.mountPoint[0]*f[0],U=m.mountPoint[1]*f[1],v=m.mountPoint[2]*f[2],Y=m.origin[0]*f[0],Z=m.origin[1]*f[1],aa=m.origin[2]*f[2],ca=C*K,da=C*F,La=C*G,Ma=K*K,Na=F*F,Oa=G*G,Pa=K*F,Qa=K*G,Ra=F*G;d[0]=(1-2*(Na+Oa))*q;d[1]=2*(Pa+La)*q;d[2]=2*(Qa-da)*q;d[3]=0;d[4]=2*(Pa-La)*I;d[5]=(1-2*(Ma+Oa))*I;d[6]=2*(Ra+ca)*I;d[7]=0;d[8]=2*(Qa+da)*H;d[9]=2*(Ra-ca)*H;d[10]=(1-2*(Ma+Na))*H;d[11]=0;d[12]=N+E-V+Y-(d[0]*Y+d[4]*Z+d[8]*
aa);d[13]=S+M-U+Z-(d[1]*Y+d[5]*Z+d[9]*aa);d[14]=R+P-v+aa-(d[2]*Y+d[6]*Z+d[10]*aa);d[15]=1;this.isBreakPoint()&&this.calculateWorldMatrix()&&(u|=b.WORLD_CHANGED);if(n!==d[0]||A!==d[1]||t!==d[2]||w!==d[4]||e!==d[5]||x!==d[6]||z!==d[8]||y!==d[9]||B!==d[10]||L!==d[12]||k!==d[13]||J!==d[14])u|=b.LOCAL_CHANGED;return u}var Q=this.getLocalTransform(),T=this.parent.getLocalTransform(),ba=a.getSize(),W=this.vectors,X=this.offsets,Da=a.getParent().getSize(),ea=!1,ab=Q[0],bb=Q[1],cb=Q[2],db=Q[4],eb=Q[5],fb=
Q[6],gb=Q[8],hb=Q[9],ib=Q[10],jb=Q[12],kb=Q[13],lb=Q[14],ia=T[0],ja=T[1],ka=T[2],la=T[4],ma=T[5],na=T[6],oa=T[8],pa=T[9],qa=T[10],mb=T[12],nb=T[13],ob=T[14],fa=W.rotation[0],ga=W.rotation[1],ha=W.rotation[2],Ea=W.rotation[3],Fa=W.scale[0],Ga=W.scale[1],Ha=W.scale[2],ra=X.origin[0]*ba[0],sa=X.origin[1]*ba[1],ta=X.origin[2]*ba[2],Sa=Ea*fa,Ta=Ea*ga,Ua=Ea*ha,Va=fa*fa,Wa=ga*ga,Xa=ha*ha,Ya=fa*ga,Za=fa*ha,$a=ga*ha,ua=(1-2*(Wa+Xa))*Fa,va=2*(Ya+Ua)*Fa,wa=2*(Za-Ta)*Fa,xa=2*(Ya-Ua)*Ga,ya=(1-2*(Va+Xa))*Ga,za=
2*($a+Sa)*Ga,Aa=2*(Za+Ta)*Ha,Ba=2*($a-Sa)*Ha,Ca=(1-2*(Va+Wa))*Ha,Ia=X.align[0]*Da[0]+W.position[0]-X.mountPoint[0]*ba[0]+ra-(ua*ra+xa*sa+Aa*ta),Ja=X.align[1]*Da[1]+W.position[1]-X.mountPoint[1]*ba[1]+sa-(va*ra+ya*sa+Ba*ta),Ka=X.align[2]*Da[2]+W.position[2]-X.mountPoint[2]*ba[2]+ta-(wa*ra+za*sa+Ca*ta);Q[0]=ia*ua+la*va+oa*wa;Q[1]=ja*ua+ma*va+pa*wa;Q[2]=ka*ua+na*va+qa*wa;Q[3]=0;Q[4]=ia*xa+la*ya+oa*za;Q[5]=ja*xa+ma*ya+pa*za;Q[6]=ka*xa+na*ya+qa*za;Q[7]=0;Q[8]=ia*Aa+la*Ba+oa*Ca;Q[9]=ja*Aa+ma*Ba+pa*Ca;Q[10]=
ka*Aa+na*Ba+qa*Ca;Q[11]=0;Q[12]=ia*Ia+la*Ja+oa*Ka+mb;Q[13]=ja*Ia+ma*Ja+pa*Ka+nb;Q[14]=ka*Ia+na*Ja+qa*Ka+ob;Q[15]=1;this.isBreakPoint()&&this.calculateWorldMatrix()&&(ea|=b.WORLD_CHANGED);if(ab!==Q[0]||bb!==Q[1]||cb!==Q[2]||db!==Q[4]||eb!==Q[5]||fb!==Q[6]||gb!==Q[8]||hb!==Q[9]||ib!==Q[10]||jb!==Q[12]||kb!==Q[13]||lb!==Q[14])ea|=b.LOCAL_CHANGED;return ea};b.prototype.getPosition=function(){return this.vectors.position};b.prototype.setPosition=function(a,b,f){this.vectors.positionChanged=d(this.vectors.position,
a,b,f)};b.prototype.getRotation=function(){return this.vectors.rotation};b.prototype.setRotation=function(a,b,f,c){var m=this.vectors.rotation,p,u,n;if(null!=c)p=a,u=b,n=f,this._lastEulerVals[0]=null,this._lastEulerVals[1]=null,this._lastEulerVals[2]=null,this._lastEuler=!1;else{if(null==a||null==b||null==f)this._lastEuler?(a=null==a?this._lastEulerVals[0]:a,b=null==b?this._lastEulerVals[1]:b,f=null==f?this._lastEulerVals[2]:f):(c=-2*(m[1]*m[2]-m[3]*m[0]),.99999<Math.abs(c)?(b=null==b?.5*Math.PI*
c:b,a=null==a?Math.atan2(-m[0]*m[2]+m[3]*m[1],.5-m[1]*m[1]-m[2]*m[2]):a,f=null==f?0:f):(b=null==b?Math.asin(c):b,a=null==a?Math.atan2(m[0]*m[2]+m[3]*m[1],.5-m[0]*m[0]-m[1]*m[1]):a,f=null==f?Math.atan2(m[0]*m[1]+m[3]*m[2],.5-m[0]*m[0]-m[2]*m[2]):f));var A=.5*a;n=.5*b;var t=.5*f;c=Math.sin(A);p=Math.sin(n);u=Math.sin(t);var A=Math.cos(A),e=Math.cos(n),D=Math.cos(t),t=p*u;n=e*u;var x=p*D,e=e*D;p=c*e+A*t;u=A*x-c*n;n=A*n+c*x;c=A*e-c*t;this._lastEuler=!0;this._lastEulerVals[0]=a;this._lastEulerVals[1]=
b;this._lastEulerVals[2]=f}this.vectors.rotationChanged=d(m,p,u,n,c)};b.prototype.getScale=function(){return this.vectors.scale};b.prototype.setScale=function(a,b,f){this.vectors.scaleChanged=d(this.vectors.scale,a,b,f)};b.prototype.getAlign=function(){return this.offsets.align};b.prototype.setAlign=function(a,b,f){this.offsets.alignChanged=d(this.offsets.align,a,b,null!=f?f-.5:f)};b.prototype.getMountPoint=function(){return this.offsets.mountPoint};b.prototype.setMountPoint=function(a,b,f){this.offsets.mountPointChanged=
d(this.offsets.mountPoint,a,b,null!=f?f-.5:f)};b.prototype.getOrigin=function(){return this.offsets.origin};b.prototype.setOrigin=function(a,b,f){this.offsets.originChanged=d(this.offsets.origin,a,b,null!=f?f-.5:f)};b.prototype.calculateWorldMatrix=function(){for(var a=this.parent;a&&!a.isBreakPoint();)a=a.parent;if(a){var b=this.global,d=a.getWorldTransform(),a=this.local,f=d[0],c=d[1],p=d[2],u=d[4],n=d[5],e=d[6],t=d[8],w=d[9],D=d[10],x=d[12],z=d[13],d=d[14],y=!1,B,L=a[0],k=a[1],J=a[2],E=a[3];B=
L*f+k*u+J*t+E*x;y=y?y:b[0]===B;b[0]=B;B=L*c+k*n+J*w+E*z;y=y?y:b[1]===B;b[1]=B;B=L*p+k*e+J*D+E*d;y=y?y:b[2]===B;b[2]=B;b[3]=0;L=a[4];k=a[5];J=a[6];E=a[7];B=L*f+k*u+J*t+E*x;y=y?y:b[4]===B;b[4]=B;B=L*c+k*n+J*w+E*z;y=y?y:b[5]===B;b[5]=B;B=L*p+k*e+J*D+E*d;y=y?y:b[6]===B;b[6]=B;b[7]=0;L=a[8];k=a[9];J=a[10];E=a[11];B=L*f+k*u+J*t+E*x;y=y?y:b[8]===B;b[8]=B;B=L*c+k*n+J*w+E*z;y=y?y:b[9]===B;b[9]=B;B=L*p+k*e+J*D+E*d;y=y?y:b[10]===B;b[10]=B;b[11]=0;L=a[12];k=a[13];J=a[14];E=a[15];B=L*f+k*u+J*t+E*x;y=y?y:b[12]===
B;b[12]=B;B=L*c+k*n+J*w+E*z;y=y?y:b[13]===B;b[13]=B;B=L*p+k*e+J*D+E*d;y=y?y:b[14]===B;b[14]=B;b[15]=1;return y}for(b=0;16>b;b++)this.global[b]=this.local[b];return!1};k.exports=b},{}],16:[function(e,k,v){function b(){this.pathStore=new f}var a=e("./Path"),d=e("./Transform"),c=e("./Dispatch"),f=e("./PathStore");b.prototype.registerTransformAtPath=function(b,f){if(!a.depth(b))return this.pathStore.insert(b,f?f:new d);var c=this.pathStore.get(a.parent(b));if(!c)throw Error("No parent transform registered at expected path: "+
a.parent(b));f&&f.setParent(c);this.pathStore.insert(b,f?f:new d(c))};b.prototype.deregisterTransformAtPath=function(a){this.pathStore.remove(a)};b.prototype.makeBreakPointAt=function(a){var b=this.pathStore.get(a);if(!b)throw Error("No transform Registered at path: "+a);b.setBreakPoint()};b.prototype.get=function(a){return this.pathStore.get(a)};b.prototype.onUpdate=function(){for(var a=this.pathStore.getItems(),b=this.pathStore.getPaths(),f,l,m,p,u,n=0,e=a.length;n<e;n++)if(m=c.getNode(b[n])){u=
m.getComponents();f=a[n];l=f.vectors;p=f.offsets;if(p.alignChanged){var t=u,w=p,D=w.align[0],x=w.align[1],z=w.align[2];if(m.onAlignChange)m.onAlignChange(D,x,z);for(var y=0,B=t.length;y<B;y++)if(t[y]&&t[y].onAlignChange)t[y].onAlignChange(D,x,z);w.alignChanged=!1}if(p.mountPointChanged){t=u;w=p;D=w.mountPoint[0];x=w.mountPoint[1];z=w.mountPoint[2];if(m.onMountPointChange)m.onMountPointChange(D,x,z);y=0;for(B=t.length;y<B;y++)if(t[y]&&t[y].onMountPointChange)t[y].onMountPointChange(D,x,z);w.mountPointChanged=
!1}if(p.originChanged){t=u;w=p.origin[0];D=p.origin[1];x=p.origin[2];if(m.onOriginChange)m.onOriginChange(w,D,x);z=0;for(y=t.length;z<y;z++)if(t[z]&&t[z].onOriginChange)t[z].onOriginChange(w,D,x);p.originChanged=!1}if(l.positionChanged){p=u;t=l;w=t.position[0];D=t.position[1];x=t.position[2];if(m.onPositionChange)m.onPositionChange(w,D,x);z=0;for(y=p.length;z<y;z++)if(p[z]&&p[z].onPositionChange)p[z].onPositionChange(w,D,x);t.positionChanged=!1}if(l.rotationChanged){p=u;t=l;w=t.rotation[0];D=t.rotation[1];
x=t.rotation[2];z=t.rotation[3];if(m.onRotationChange)m.onRotationChange(w,D,x,z);y=0;for(B=p.length;y<B;y++)if(p[y]&&p[y].onRotationChange)p[y].onRotationChange(w,D,x,z);t.rotationChanged=!1}if(l.scaleChanged){p=u;t=l.scale[0];w=l.scale[1];D=l.scale[2];if(m.onScaleChange)m.onScaleChange(t,w,D);x=0;for(z=p.length;x<z;x++)if(p[x]&&p[x].onScaleChange)p[x].onScaleChange(t,w,D);l.scaleChanged=!1}if(l=f.calculate(m)){p=u;t=f;if(m.onTransformChange)m.onTransformChange(t);w=0;for(D=p.length;w<D;w++)if(p[w]&&
p[w].onTransformChange)p[w].onTransformChange(t);if(l&d.LOCAL_CHANGED){p=u;t=f.getLocalTransform();if(m.onLocalTransformChange)m.onLocalTransformChange(t);w=0;for(D=p.length;w<D;w++)if(p[w]&&p[w].onLocalTransformChange)p[w].onLocalTransformChange(t)}if(l&d.WORLD_CHANGED){f=f.getWorldTransform();if(m.onWorldTransformChange)m.onWorldTransformChange(f);m=0;for(l=u.length;m<l;m++)if(u[m]&&u[m].onWorldTransformChange)u[m].onWorldTransformChange(f)}}}};k.exports=new b},{"./Dispatch":6,"./Path":10,"./PathStore":11,
"./Transform":15}],17:[function(e,k,v){function b(b,d){if(!b)throw Error("DOMElement must be instantiated on a node");this._changeQueue=[];this._requestRenderSize=this._renderSized=this._requestingUpdate=!1;this._UIEvents=b.getUIEvents().slice(0);this._classes=["famous-dom-element"];this._requestingEventListeners=[];this._styles={};this._attributes={};this._content="";this._tagName=d&&d.tagName?d.tagName:"div";this._renderSize=[0,0,0];this._id=b?b.addComponent(this):null;this._node=b;this.onSizeModeChange.apply(this,
b.getSizeMode());this._callbacks=new a;this.setProperty("display",b.isShown()?"block":"none");this.onOpacityChange(b.getOpacity());if(d){var c,r;if(d.classes)for(c=0;c<d.classes.length;c++)this.addClass(d.classes[c]);if(d.attributes)for(r in d.attributes)this.setAttribute(r,d.attributes[r]);if(d.properties)for(r in d.properties)this.setProperty(r,d.properties[r]);d.id&&this.setId(d.id);d.content&&this.setContent(d.content);!1===d.cutout&&this.setCutoutState(d.cutout)}}var a=e("../utilities/CallbackStore"),
d=e("../core/TransformSystem"),c=e("../core/Commands");b.prototype.getValue=function(){return{classes:this._classes,styles:this._styles,attributes:this._attributes,content:this._content,id:this._attributes.id,tagName:this._tagName}};b.prototype.onUpdate=function(){var a=this._node,b=this._changeQueue,d=b.length;if(d&&a){a.sendDrawCommand(c.WITH);for(a.sendDrawCommand(a.getLocation());d--;)a.sendDrawCommand(b.shift());this._requestRenderSize&&(a.sendDrawCommand(c.DOM_RENDER_SIZE),a.sendDrawCommand(a.getLocation()),
this._requestRenderSize=!1)}this._requestingUpdate=!1};b.prototype.onMount=function(a,b){this._node=a;this._id=b;this._UIEvents=a.getUIEvents().slice(0);d.makeBreakPointAt(a.getLocation());this.draw();this.setAttribute("data-fa-path",a.getLocation())};b.prototype.onDismount=function(){this.setProperty("display","none");this.setAttribute("data-fa-path","");this.setCutoutState(!1);this.onUpdate();this._initialized=!1};b.prototype.remove=function(){var a=document.querySelector('[data-fa-path="'+this._attributes["data-fa-path"]+
'"');a&&a.remove();this.setCutoutState(!1);this.onUpdate();this._initialized=!1};b.prototype.onShow=function(){this.setProperty("display","block")};b.prototype.onHide=function(){this.setProperty("display","none")};b.prototype.setCutoutState=function(a){this._initialized&&this._changeQueue.push(c.GL_CUTOUT_STATE,a);this._requestingUpdate||this._requestUpdate();return this};b.prototype.onTransformChange=function(a){this._changeQueue.push(c.CHANGE_TRANSFORM);a=a.getLocalTransform();for(var b=0,d=a.length;b<
d;b++)this._changeQueue.push(a[b]);this._requestingUpdate||this._requestUpdate()};b.prototype.onSizeChange=function(a,b){var d=this._node.getSizeMode(),r=2!==d[0],d=2!==d[1];this._initialized&&this._changeQueue.push(c.CHANGE_SIZE,r?a:r,d?b:d);this._requestingUpdate||this._requestUpdate();return this};b.prototype.onOpacityChange=function(a){return this.setProperty("opacity",a)};b.prototype.onAddUIEvent=function(a){-1===this._UIEvents.indexOf(a)?(this._subscribe(a),this._UIEvents.push(a)):this._inDraw&&
this._subscribe(a);return this};b.prototype.onRemoveUIEvent=function(a){var b=this._UIEvents.indexOf(a);-1!==b?(this._unsubscribe(a),this._UIEvents.splice(b,1)):this._inDraw&&this._unsubscribe(a);return this};b.prototype._subscribe=function(a){this._initialized&&this._changeQueue.push(c.SUBSCRIBE,a);this._requestingUpdate||this._requestUpdate()};b.prototype.preventDefault=function(a){this._initialized&&this._changeQueue.push(c.PREVENT_DEFAULT,a);this._requestingUpdate||this._requestUpdate()};b.prototype.allowDefault=
function(a){this._initialized&&this._changeQueue.push(c.ALLOW_DEFAULT,a);this._requestingUpdate||this._requestUpdate()};b.prototype._unsubscribe=function(a){this._initialized&&this._changeQueue.push("UNSUBSCRIBE",a);this._requestingUpdate||this._requestUpdate()};b.prototype.onSizeModeChange=function(a,b,d){if(2===a||2===b||2===d)this._requestRenderSize=this._renderSized=!0;a=this._node.getSize();this.onSizeChange(a[0],a[1])};b.prototype.getRenderSize=function(){return this._renderSize};b.prototype._requestUpdate=
function(){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0)};b.prototype.init=function(){this._changeQueue.push(c.INIT_DOM,this._tagName);this._initialized=!0;this.onTransformChange(d.get(this._node.getLocation()));var a=this._node.getSize();this.onSizeChange(a[0],a[1]);this._requestingUpdate||this._requestUpdate()};b.prototype.setId=function(a){this.setAttribute("id",a);return this};b.prototype.addClass=function(a){if(0>this._classes.indexOf(a))return this._initialized&&
this._changeQueue.push(c.ADD_CLASS,a),this._classes.push(a),this._requestingUpdate||this._requestUpdate(),this._renderSized&&(this._requestRenderSize=!0),this;this._inDraw&&(this._initialized&&this._changeQueue.push(c.ADD_CLASS,a),this._requestingUpdate||this._requestUpdate());return this};b.prototype.removeClass=function(a){var b=this._classes.indexOf(a);if(0>b)return this;this._changeQueue.push(c.REMOVE_CLASS,a);this._classes.splice(b,1);this._requestingUpdate||this._requestUpdate();return this};
b.prototype.hasClass=function(a){return-1!==this._classes.indexOf(a)};b.prototype.setAttribute=function(a,b){if(this._attributes[a]!==b||this._inDraw)this._attributes[a]=b,this._initialized&&this._changeQueue.push(c.CHANGE_ATTRIBUTE,a,b),this._requestUpdate||this._requestUpdate();return this};b.prototype.setProperty=function(a,b){if(this._styles[a]!==b||this._inDraw)this._styles[a]=b,this._initialized&&this._changeQueue.push(c.CHANGE_PROPERTY,a,b),this._requestingUpdate||this._requestUpdate(),this._renderSized&&
(this._requestRenderSize=!0);return this};b.prototype.setContent=function(a){if(this._content!==a||this._inDraw)this._content=a,this._initialized&&this._changeQueue.push(c.CHANGE_CONTENT,a),this._requestingUpdate||this._requestUpdate(),this._renderSized&&(this._requestRenderSize=!0);return this};b.prototype.on=function(a,b){return this._callbacks.on(a,b)};b.prototype.onReceive=function(a,b){"resize"===a&&(this._renderSize[0]=b.val[0],this._renderSize[1]=b.val[1],this._requestingUpdate||this._requestUpdate());
this._callbacks.trigger(a,b)};b.prototype.draw=function(){var a,b,d;this._inDraw=!0;this.init();b=0;for(d=this._classes.length;b<d;b++)this.addClass(this._classes[b]);this._content&&this.setContent(this._content);for(a in this._styles)null!=this._styles[a]&&this.setProperty(a,this._styles[a]);for(a in this._attributes)null!=this._attributes[a]&&this.setAttribute(a,this._attributes[a]);b=0;for(d=this._UIEvents.length;b<d;b++)this.onAddUIEvent(this._UIEvents[b]);this._inDraw=!1};Element.prototype.remove=
function(){this.parentElement.removeChild(this)};NodeList.prototype.remove=HTMLCollection.prototype.remove=function(){for(var a=this.length-1;0<=a;a--)this[a]&&this[a].parentElement&&this[a].parentElement.removeChild(this[a])};k.exports=b},{"../core/Commands":5,"../core/TransformSystem":16,"../utilities/CallbackStore":74}],18:[function(e,k,v){function b(b,d,c){var h=this;b.classList.add("famous-dom-renderer");g=g||f("transform");this._compositor=c;this._path=this._parent=this._target=null;this._children=
[];this._root=new a(b,d);this._boundTriggerEvent=function(a){return h._triggerEvent(a)};this._selector=d;this._elements={};this._elements[d]=this._root;this.perspectiveTransform=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this._VPtransform=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this._lastEv=null}var a=e("./ElementCache"),d=e("./Math"),c=e("../core/Path"),f=e("../utilities/vendorPrefix"),h=e("./events/EventMap"),g=null;b.prototype.subscribe=function(a){this._assertTargetLoaded();
this._listen(a);this._target.subscribe[a]=!0};b.prototype.preventDefault=function(a){this._assertTargetLoaded();this._listen(a);this._target.preventDefault[a]=!0};b.prototype.allowDefault=function(a){this._assertTargetLoaded();this._listen(a);this._target.preventDefault[a]=!1};b.prototype._listen=function(a){this._assertTargetLoaded();if(!this._target.listeners[a]&&!this._root.listeners[a]){var b=h[a][1]?this._root:this._target;b.listeners[a]=this._boundTriggerEvent;b.element.addEventListener(a,this._boundTriggerEvent)}};
b.prototype.unsubscribe=function(a){this._assertTargetLoaded();this._target.subscribe[a]=!1};b.prototype._triggerEvent=function(a){if(this._lastEv!==a){var b;if(a.path)b=a.path;else{b=[];for(var d=a.target;d!==document.body;)b.push(d),d=d.parentNode}for(d=0;d<b.length;d++)if(b[d].dataset){var c=b[d].dataset.faPath;if(c&&(this._elements[c].preventDefault[a.type]&&a.preventDefault(),this._elements[c]&&this._elements[c].subscribe[a.type])){this._lastEv=a;this._compositor.sendEvent(c,a.type,new h[a.type][0](a));
break}}}};b.prototype.getSizeOf=function(a){var b=this._elements[a];if(!b)return null;b={val:b.size};this._compositor.sendEvent(a,"resize",b);return b};b.prototype.draw=function(a){a.perspectiveDirty&&(this.perspectiveDirty=!0,this.perspectiveTransform[0]=a.perspectiveTransform[0],this.perspectiveTransform[1]=a.perspectiveTransform[1],this.perspectiveTransform[2]=a.perspectiveTransform[2],this.perspectiveTransform[3]=a.perspectiveTransform[3],this.perspectiveTransform[4]=a.perspectiveTransform[4],
this.perspectiveTransform[5]=a.perspectiveTransform[5],this.perspectiveTransform[6]=a.perspectiveTransform[6],this.perspectiveTransform[7]=a.perspectiveTransform[7],this.perspectiveTransform[8]=a.perspectiveTransform[8],this.perspectiveTransform[9]=a.perspectiveTransform[9],this.perspectiveTransform[10]=a.perspectiveTransform[10],this.perspectiveTransform[11]=a.perspectiveTransform[11],this.perspectiveTransform[12]=a.perspectiveTransform[12],this.perspectiveTransform[13]=a.perspectiveTransform[13],
this.perspectiveTransform[14]=a.perspectiveTransform[14],this.perspectiveTransform[15]=a.perspectiveTransform[15]);if(a.viewDirty||a.perspectiveDirty)d.multiply(this._VPtransform,this.perspectiveTransform,a.viewTransform),this._root.element.style[g]=this._stringifyMatrix(this._VPtransform)};b.prototype._assertPathLoaded=function(){if(!this._path)throw Error("path not loaded");};b.prototype._assertParentLoaded=function(){if(!this._parent)throw Error("parent not loaded");};b.prototype._assertChildrenLoaded=
function(){if(!this._children)throw Error("children not loaded");};b.prototype._assertTargetLoaded=function(){if(!this._target)throw Error("No target loaded");};b.prototype.findParent=function(){this._assertPathLoaded();for(var a=this._path,b;!b&&a.length;)a=a.substring(0,a.lastIndexOf("/")),b=this._elements[a];return this._parent=b};b.prototype.findTarget=function(){return this._target=this._elements[this._path]};b.prototype.loadPath=function(a){return this._path=a};b.prototype.resolveChildren=function(a,
b){for(var d=0,f,g=this._path,h;f=b.childNodes[d];)f.dataset?(h=f.dataset.faPath)?c.isDescendentOf(h,g)?a.appendChild(f):d++:d++:d++};b.prototype.insertEl=function(b){if(!this._target||this._target.element.tagName.toLowerCase()!==b.toLowerCase()){this.findParent();this._assertParentLoaded();if(this._parent["void"])throw Error(this._parent.path+" is a void element. Void elements are not allowed to have children.");this._target&&this._parent.element.removeChild(this._target.element);this._target=new a(document.createElement(b),
this._path);this.resolveChildren(this._target.element,this._parent.element);this._parent.element.appendChild(this._target.element);this._elements[this._path]=this._target}};b.prototype.setProperty=function(a,b){this._assertTargetLoaded();this._target.element.style[a]=b};b.prototype.setSize=function(a,b){this._assertTargetLoaded();this.setWidth(a);this.setHeight(b)};b.prototype.setWidth=function(a){this._assertTargetLoaded();var b=this._target.content;!1===a?(this._target.explicitWidth=!0,b&&(b.style.width=
""),a=b?b.offsetWidth:0):(this._target.explicitWidth=!1,b&&(b.style.width=a+"px"));this._target.element.style.width=a+"px";this._target.size[0]=a};b.prototype.setHeight=function(a){this._assertTargetLoaded();var b=this._target.content;!1===a?(this._target.explicitHeight=!0,b&&(b.style.height=""),a=b?b.offsetHeight:0):(this._target.explicitHeight=!1,b&&(b.style.height=a+"px"));this._target.element.style.height=a+"px";this._target.size[1]=a};b.prototype.setAttribute=function(a,b){this._assertTargetLoaded();
this._target.element.setAttribute(a,b)};b.prototype.setContent=function(a){this._assertTargetLoaded();this._target.formElement?this._target.element.value=a:(this._target.content||(this._target.content=document.createElement("div"),this._target.content.classList.add("famous-dom-element-content"),this._target.element.insertBefore(this._target.content,this._target.element.firstChild)),this._target.content.innerHTML=a);this.setSize(this._target.explicitWidth?!1:this._target.size[0],this._target.explicitHeight?
!1:this._target.size[1])};b.prototype.setMatrix=function(a){this._assertTargetLoaded();this._target.element.style[g]=this._stringifyMatrix(a)};b.prototype.addClass=function(a){this._assertTargetLoaded();this._target.element.classList.add(a)};b.prototype.removeClass=function(a){this._assertTargetLoaded();this._target.element.classList.remove(a)};b.prototype._stringifyMatrix=function(a){var b;b="matrix3d("+(1E-6>a[0]&&-1E-6<a[0]?"0,":a[0]+",");b+=1E-6>a[1]&&-1E-6<a[1]?"0,":a[1]+",";b+=1E-6>a[2]&&-1E-6<
a[2]?"0,":a[2]+",";b+=1E-6>a[3]&&-1E-6<a[3]?"0,":a[3]+",";b+=1E-6>a[4]&&-1E-6<a[4]?"0,":a[4]+",";b+=1E-6>a[5]&&-1E-6<a[5]?"0,":a[5]+",";b+=1E-6>a[6]&&-1E-6<a[6]?"0,":a[6]+",";b+=1E-6>a[7]&&-1E-6<a[7]?"0,":a[7]+",";b+=1E-6>a[8]&&-1E-6<a[8]?"0,":a[8]+",";b+=1E-6>a[9]&&-1E-6<a[9]?"0,":a[9]+",";b+=1E-6>a[10]&&-1E-6<a[10]?"0,":a[10]+",";b+=1E-6>a[11]&&-1E-6<a[11]?"0,":a[11]+",";b+=1E-6>a[12]&&-1E-6<a[12]?"0,":a[12]+",";b+=1E-6>a[13]&&-1E-6<a[13]?"0,":a[13]+",";b+=1E-6>a[14]&&-1E-6<a[14]?"0,":a[14]+",";
return b+=a[15]+")"};k.exports=b},{"../core/Path":10,"../utilities/vendorPrefix":78,"./ElementCache":19,"./Math":20,"./events/EventMap":24}],19:[function(e,k,v){var b=e("./VoidElements");k.exports=function(a,d){this.tagName=a.tagName.toLowerCase();this["void"]=b[this.tagName];var c=a.constructor;this.formElement=c===HTMLInputElement||c===HTMLTextAreaElement||c===HTMLSelectElement;this.element=a;this.path=d;this.content=null;this.size=new Int16Array(3);this.explicitWidth=this.explicitHeight=!1;this.postRenderSize=
new Float32Array(2);this.listeners={};this.preventDefault={};this.subscribe={}}},{"./VoidElements":21}],20:[function(e,k,v){k.exports={multiply:function(b,a,d){var c=a[0],f=a[1],h=a[2],g=a[3],r=a[4],l=a[5],m=a[6],p=a[7],u=a[8],n=a[9],e=a[10],t=a[11],w=a[12],D=a[13],x=a[14];a=a[15];var z=d[0],y=d[1],B=d[2],k=d[3],O=d[4],J=d[5],E=d[6],M=d[7],P=d[8],K=d[9],F=d[10],G=d[11],C=d[12],q=d[13],I=d[14];d=d[15];b[0]=z*c+y*r+B*u+k*w;b[1]=z*f+y*l+B*n+k*D;b[2]=z*h+y*m+B*e+k*x;b[3]=z*g+y*p+B*t+k*a;z=O;y=J;B=E;k=
M;b[4]=z*c+y*r+B*u+k*w;b[5]=z*f+y*l+B*n+k*D;b[6]=z*h+y*m+B*e+k*x;b[7]=z*g+y*p+B*t+k*a;z=P;y=K;B=F;k=G;b[8]=z*c+y*r+B*u+k*w;b[9]=z*f+y*l+B*n+k*D;b[10]=z*h+y*m+B*e+k*x;b[11]=z*g+y*p+B*t+k*a;z=C;y=q;B=I;k=d;b[12]=z*c+y*r+B*u+k*w;b[13]=z*f+y*l+B*n+k*D;b[14]=z*h+y*m+B*e+k*x;b[15]=z*g+y*p+B*t+k*a;return b},invert:function(b,a){var d=a[0],c=a[1],f=a[2],h=a[3],g=a[4],r=a[5],l=a[6],m=a[7],p=a[8],u=a[9],n=a[10],e=a[11],t=a[12],w=a[13],D=a[14],x=a[15],z=d*r-c*g,y=d*l-f*g,B=d*m-h*g,k=c*l-f*r,O=c*m-h*r,J=f*m-
h*l,E=p*w-u*t,M=p*D-n*t,P=p*x-e*t,K=u*D-n*w,F=u*x-e*w,G=n*x-e*D,C=z*G-y*F+B*K+k*P-O*M+J*E;if(!C)return null;C=1/C;b[0]=(r*G-l*F+m*K)*C;b[1]=(f*F-c*G-h*K)*C;b[2]=(w*J-D*O+x*k)*C;b[3]=(n*O-u*J-e*k)*C;b[4]=(l*P-g*G-m*M)*C;b[5]=(d*G-f*P+h*M)*C;b[6]=(D*B-t*J-x*y)*C;b[7]=(p*J-n*B+e*y)*C;b[8]=(g*F-r*P+m*E)*C;b[9]=(c*P-d*F-h*E)*C;b[10]=(t*O-w*B+x*z)*C;b[11]=(u*B-p*O-e*z)*C;b[12]=(r*M-g*K-l*E)*C;b[13]=(d*K-c*M+f*E)*C;b[14]=(w*y-t*k-D*z)*C;b[15]=(p*k-u*y+n*z)*C;return b}}},{}],21:[function(e,k,v){k.exports=
{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}},{}],22:[function(e,k,v){function b(b){a.call(this,b);this.data=b.data}var a=e("./UIEvent");b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.toString=function(){return"CompositionEvent"};k.exports=b},{"./UIEvent":30}],23:[function(e,k,v){function b(a){this.type=a.type;this.defaultPrevented=a.defaultPrevented;this.timeStamp=a.timeStamp;var b=a.target.constructor;
if(b===HTMLInputElement||b===HTMLTextAreaElement||b===HTMLSelectElement)this.value=a.target.value}b.prototype.toString=function(){return"Event"};k.exports=b},{}],24:[function(e,k,v){v=e("./CompositionEvent");var b=e("./Event"),a=e("./FocusEvent"),d=e("./InputEvent"),c=e("./KeyboardEvent"),f=e("./MouseEvent"),h=e("./TouchEvent"),g=e("./UIEvent");e=e("./WheelEvent");k.exports={change:[b,!0],submit:[b,!0],abort:[b,!1],beforeinput:[d,!0],blur:[a,!1],click:[f,!0],compositionend:[v,!0],compositionstart:[v,
!0],compositionupdate:[v,!0],dblclick:[f,!0],focus:[a,!1],focusin:[a,!0],focusout:[a,!0],input:[d,!0],keydown:[c,!0],keyup:[c,!0],load:[b,!1],mousedown:[f,!0],mouseenter:[f,!1],mouseleave:[f,!1],mousemove:[f,!1],mouseout:[f,!0],mouseover:[f,!0],mouseup:[f,!0],resize:[g,!1],scroll:[g,!1],select:[b,!0],unload:[b,!1],wheel:[e,!0],touchcancel:[h,!0],touchend:[h,!0],touchmove:[h,!0],touchstart:[h,!0]}},{"./CompositionEvent":22,"./Event":23,"./FocusEvent":25,"./InputEvent":26,"./KeyboardEvent":27,"./MouseEvent":28,
"./TouchEvent":29,"./UIEvent":30,"./WheelEvent":31}],25:[function(e,k,v){function b(b){a.call(this,b)}var a=e("./UIEvent");b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.toString=function(){return"FocusEvent"};k.exports=b},{"./UIEvent":30}],26:[function(e,k,v){function b(b){a.call(this,b);this.inputType=b.inputType;this.data=b.data;this.isComposing=b.isComposing;this.targetRange=b.targetRange}var a=e("./UIEvent");b.prototype=Object.create(a.prototype);b.prototype.constructor=
b;b.prototype.toString=function(){return"InputEvent"};k.exports=b},{"./UIEvent":30}],27:[function(e,k,v){function b(b){a.call(this,b);this.DOM_KEY_LOCATION_STANDARD=0;this.DOM_KEY_LOCATION_LEFT=1;this.DOM_KEY_LOCATION_RIGHT=2;this.DOM_KEY_LOCATION_NUMPAD=3;this.key=b.key;this.code=b.code;this.location=b.location;this.ctrlKey=b.ctrlKey;this.shiftKey=b.shiftKey;this.altKey=b.altKey;this.metaKey=b.metaKey;this.repeat=b.repeat;this.isComposing=b.isComposing;this.keyCode=b.keyCode}var a=e("./UIEvent");
b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.toString=function(){return"KeyboardEvent"};k.exports=b},{"./UIEvent":30}],28:[function(e,k,v){function b(b){a.call(this,b);this.screenX=b.screenX;this.screenY=b.screenY;this.clientX=b.clientX;this.clientY=b.clientY;this.ctrlKey=b.ctrlKey;this.shiftKey=b.shiftKey;this.altKey=b.altKey;this.metaKey=b.metaKey;this.button=b.button;this.buttons=b.buttons;this.pageX=b.pageX;this.pageY=b.pageY;this.x=b.x;this.y=b.y;this.offsetX=
b.offsetX;this.offsetY=b.offsetY}var a=e("./UIEvent");b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.toString=function(){return"MouseEvent"};k.exports=b},{"./UIEvent":30}],29:[function(e,k,v){function b(a){this.identifier=a.identifier;this.screenX=a.screenX;this.screenY=a.screenY;this.clientX=a.clientX;this.clientY=a.clientY;this.pageX=a.pageX;this.pageY=a.pageY}function a(a){if(!a)return f;for(var d=[],c=0;c<a.length;c++)d[c]=new b(a[c]);return d}function d(b){c.call(this,
b);this.touches=a(b.touches);this.targetTouches=a(b.targetTouches);this.changedTouches=a(b.changedTouches);this.altKey=b.altKey;this.metaKey=b.metaKey;this.ctrlKey=b.ctrlKey;this.shiftKey=b.shiftKey}var c=e("./UIEvent"),f=[];d.prototype=Object.create(c.prototype);d.prototype.constructor=d;d.prototype.toString=function(){return"TouchEvent"};k.exports=d},{"./UIEvent":30}],30:[function(e,k,v){function b(b){a.call(this,b);this.detail=b.detail}var a=e("./Event");b.prototype=Object.create(a.prototype);
b.prototype.constructor=b;b.prototype.toString=function(){return"UIEvent"};k.exports=b},{"./Event":23}],31:[function(e,k,v){function b(b){a.call(this,b);this.DOM_DELTA_PIXEL=0;this.DOM_DELTA_LINE=1;this.DOM_DELTA_PAGE=2;this.deltaX=b.deltaX;this.deltaY=b.deltaY;this.deltaZ=b.deltaZ;this.deltaMode=b.deltaMode}var a=e("./MouseEvent");b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.toString=function(){return"WheelEvent"};k.exports=b},{"./MouseEvent":28}],32:[function(e,k,
v){function b(a){this.values=a||[1,0,0,0,1,0,0,0,1]}b.prototype.get=function(){return this.values};b.prototype.set=function(a){this.values=a;return this};b.prototype.copy=function(a){var b=this.values;a=a.values;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return this};b.prototype.vectorMultiply=function(a,b){var c=this.values,f=a.x,h=a.y,g=a.z;b.x=c[0]*f+c[1]*h+c[2]*g;b.y=c[3]*f+c[4]*h+c[5]*g;b.z=c[6]*f+c[7]*h+c[8]*g;return b};b.prototype.multiply=function(a){var b=
this.values,c=a.values;a=b[0];var f=b[1],h=b[2],g=b[3],r=b[4],l=b[5],m=b[6],p=b[7],u=b[8],n=c[0],e=c[1],t=c[2],w=c[3],D=c[4],x=c[5],z=c[6],y=c[7],c=c[8];b[0]=a*n+f*w+h*z;b[1]=a*e+f*D+h*y;b[2]=a*t+f*x+h*c;b[3]=g*n+r*w+l*z;b[4]=g*e+r*D+l*y;b[5]=g*t+r*x+l*c;b[6]=m*n+p*w+u*z;b[7]=m*e+p*D+u*y;b[8]=m*t+p*x+u*c;return this};b.prototype.transpose=function(){var a=this.values,b=a[1],c=a[2],f=a[5],h=a[6],g=a[7];a[1]=a[3];a[2]=h;a[3]=b;a[5]=g;a[6]=c;a[7]=f;return this};b.prototype.getDeterminant=function(){var a=
this.values,b=a[3],c=a[4],f=a[5],h=a[6],g=a[7],r=a[8];return a[0]*(c*r-f*g)-a[1]*(b*r-f*h)+a[2]*(b*g-c*h)};b.prototype.inverse=function(){var a=this.values,b=a[0],c=a[1],f=a[2],h=a[3],g=a[4],r=a[5],l=a[6],m=a[7],p=a[8],u=b*(g*p-r*m)-c*(h*p-r*l)+f*(h*m-g*l);if(1E-40>Math.abs(u))return null;u=1/u;a[0]=(g*p-r*m)*u;a[3]=(-h*p+r*l)*u;a[6]=(h*m-g*l)*u;a[1]=(-c*p+f*m)*u;a[4]=(b*p-f*l)*u;a[7]=(-b*m+c*l)*u;a[2]=(c*r-f*g)*u;a[5]=(-b*r+f*h)*u;a[8]=(b*g-c*h)*u;return this};b.clone=function(a){return new b(a.values.slice())};
b.inverse=function(a,b){var c=a.values,f=b.values,h=c[0],g=c[1],r=c[2],l=c[3],m=c[4],p=c[5],u=c[6],n=c[7],c=c[8],e=h*(m*c-p*n)-g*(l*c-p*u)+r*(l*n-m*u);if(1E-40>Math.abs(e))return null;e=1/e;f[0]=(m*c-p*n)*e;f[3]=(-l*c+p*u)*e;f[6]=(l*n-m*u)*e;f[1]=(-g*c+r*n)*e;f[4]=(h*c-r*u)*e;f[7]=(-h*n+g*u)*e;f[2]=(g*p-r*m)*e;f[5]=(-h*p+r*l)*e;f[8]=(h*m-g*l)*e;return b};b.transpose=function(a,b){var c=a.values,f=b.values,h=c[1],g=c[2],r=c[3],l=c[4],m=c[5],p=c[6],u=c[7],n=c[8];f[0]=c[0];f[1]=r;f[2]=p;f[3]=h;f[4]=
l;f[5]=u;f[6]=g;f[7]=m;f[8]=n;return b};b.add=function(a,b,c){a=a.values;b=b.values;var f=c.values,h=a[1],g=a[2],r=a[3],l=a[4],m=a[5],p=a[6],u=a[7],n=a[8],e=b[1],t=b[2],w=b[3],D=b[4],x=b[5],z=b[6],y=b[7],B=b[8];f[0]=a[0]+b[0];f[1]=h+e;f[2]=g+t;f[3]=r+w;f[4]=l+D;f[5]=m+x;f[6]=p+z;f[7]=u+y;f[8]=n+B;return c};b.subtract=function(a,b,c){a=a.values;b=b.values;var f=c.values,h=a[1],g=a[2],r=a[3],l=a[4],m=a[5],p=a[6],u=a[7],n=a[8],e=b[1],t=b[2],w=b[3],D=b[4],x=b[5],z=b[6],y=b[7],B=b[8];f[0]=a[0]-b[0];f[1]=
h-e;f[2]=g-t;f[3]=r-w;f[4]=l-D;f[5]=m-x;f[6]=p-z;f[7]=u-y;f[8]=n-B;return c};b.multiply=function(a,b,c){var f=a.values,h=b.values;b=c.values;a=f[0];var g=f[1],r=f[2],l=f[3],m=f[4],p=f[5],u=f[6],n=f[7],f=f[8],e=h[0],t=h[1],w=h[2],D=h[3],x=h[4],z=h[5],y=h[6],B=h[7],h=h[8];b[0]=a*e+g*D+r*y;b[1]=a*t+g*x+r*B;b[2]=a*w+g*z+r*h;b[3]=l*e+m*D+p*y;b[4]=l*t+m*x+p*B;b[5]=l*w+m*z+p*h;b[6]=u*e+n*D+f*y;b[7]=u*t+n*x+f*B;b[8]=u*w+n*z+f*h;return c};k.exports=b},{}],33:[function(e,k,v){function b(a,b,d,c){this.w=a||
1;this.x=b||0;this.y=d||0;this.z=c||0}var a=Math.sin,d=Math.cos,c=Math.asin,f=Math.acos,h=Math.atan2,g=Math.sqrt;b.prototype.multiply=function(a){var b=this.x,d=this.y,c=this.z,f=this.w,g=a.x,h=a.y,e=a.z;a=a.w||0;this.w=f*a-b*g-d*h-c*e;this.x=b*a+g*f+h*c-d*e;this.y=d*a+h*f+b*e-g*c;this.z=c*a+e*f+g*d-b*h;return this};b.prototype.leftMultiply=function(a){var b=a.x,d=a.y,c=a.z;a=a.w||0;var f=this.x,g=this.y,h=this.z,e=this.w;this.w=a*e-b*f-d*g-c*h;this.x=b*e+f*a+g*c-d*h;this.y=d*e+g*a+b*h-f*c;this.z=
c*e+h*a+f*d-b*g;return this};b.prototype.rotateVector=function(a,b){var d=this.w,c=-this.x,f=-this.y,g=-this.z,h=a.x,e=a.y,w=a.z,D=-c*h-f*e-g*w,x=h*d+e*g-f*w,z=e*d+c*w-h*g,h=w*d+h*f-c*e,c=-c,f=-f,g=-g;b.x=x*d+c*D+f*h-z*g;b.y=z*d+f*D+x*g-c*h;b.z=h*d+g*D+c*z-x*f;return b};b.prototype.invert=function(){this.w=-this.w;this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};b.prototype.conjugate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};b.prototype.length=function(){var a=
this.w,b=this.x,d=this.y,c=this.z;return g(a*a+b*b+d*d+c*c)};b.prototype.normalize=function(){var a=this.w,b=this.x,d=this.y,c=this.z,a=g(a*a+b*b+d*d+c*c);if(0===a)return this;a=1/a;this.w*=a;this.x*=a;this.y*=a;this.z*=a;return this};b.prototype.set=function(a,b,d,c){null!=a&&(this.w=a);null!=b&&(this.x=b);null!=d&&(this.y=d);null!=c&&(this.z=c);return this};b.prototype.copy=function(a){this.w=a.w;this.x=a.x;this.y=a.y;this.z=a.z;return this};b.prototype.clear=function(){this.w=1;this.z=this.y=this.x=
0;return this};b.prototype.dot=function(a){return this.w*a.w+this.x*a.x+this.y*a.y+this.z*a.z};b.prototype.slerp=function(b,d,c){var g=this.w,h=this.x,n=this.y,e=this.z,t=b.w,w=b.x,D=b.y;b=b.z;var x,z,y;z=g*t+h*w+n*D+e*b;1E-5<1-z?(x=f(z),y=a(x),z=a((1-d)*x)/y,d=a(d*x)/y):z=1-d;c.w=g*z+t*d;c.x=h*z+w*d;c.y=n*z+D*d;c.z=e*z+b*d;return c};b.prototype.toMatrix=function(a){var b=this.w,d=this.x,c=this.y,f=this.z,g=d*d,h=c*c,e=f*f,w=d*c,D=d*f,x=c*f;return a.set([1-2*(h+e),2*(w-b*f),2*(D+b*c),2*(w+b*f),1-
2*(g+e),2*(x-b*d),2*(D-b*c),2*(x+b*d),1-2*(g+h)])};b.prototype.toEuler=function(a){var b=this.w,d=this.x,f=this.y,g=this.z,n=f*f,e=g*g,t=2*(d*g+f*b),t=-1>t?-1:1<t?1:t;a.x=h(2*(d*b-f*g),1-2*(d*d+n));a.y=c(t);a.z=h(2*(g*b-d*f),1-2*(n+e));return a};b.prototype.fromEuler=function(b,c,f){var g=.5*b,h=.5*c,n=.5*f;f=a(g);c=a(h);b=a(n);g=d(g);h=d(h);n=d(n);this.w=g*h*n-f*c*b;this.x=f*h*n+g*c*b;this.y=g*c*n-f*h*b;this.z=g*h*b+f*c*n;return this};b.prototype.fromAngleAxis=function(b,c,f,h){var e=g(c*c+f*f+h*
h);if(0===e)this.w=1,this.x=this.y=this.z=0;else{e=1/e;b*=.5;var n=a(b);this.w=d(b);this.x=n*c*e;this.y=n*f*e;this.z=n*h*e}return this};b.multiply=function(a,b,d){var c=a.w||0,f=a.x,g=a.y;a=a.z;var h=b.w||0,e=b.x,w=b.y;b=b.z;d.w=c*h-f*e-g*w-a*b;d.x=f*h+e*c+w*a-g*b;d.y=g*h+w*c+f*b-e*a;d.z=a*h+b*c+e*g-f*w;return d};b.normalize=function(a,b){var d=a.w,c=a.x,f=a.y,h=a.z,d=g(d*d+c*c+f*f+h*h);if(0===d)return this;d=1/d;b.w*=d;b.x*=d;b.y*=d;b.z*=d;return b};b.conjugate=function(a,b){b.w=a.w;b.x=-a.x;b.y=
-a.y;b.z=-a.z;return b};b.clone=function(a){return new b(a.w,a.x,a.y,a.z)};b.dot=function(a,b){return a.w*b.w+a.x*b.x+a.y*b.y+a.z*b.z};k.exports=b},{}],34:[function(e,k,v){var b=function(a,b){a instanceof Array||a instanceof Float32Array?(this.x=a[0]||0,this.y=a[1]||0):(this.x=a||0,this.y=b||0)};b.prototype.set=function(a,b){null!=a&&(this.x=a);null!=b&&(this.y=b);return this};b.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};b.prototype.subtract=function(a){this.x-=a.x;this.y-=a.y;
return this};b.prototype.scale=function(a){a instanceof b?(this.x*=a.x,this.y*=a.y):(this.x*=a,this.y*=a);return this};b.prototype.rotate=function(a){var b=this.x,c=this.y,f=Math.cos(a);a=Math.sin(a);this.x=b*f-c*a;this.y=b*a+c*f;return this};b.prototype.dot=function(a){return this.x*a.x+this.y*a.y};b.prototype.cross=function(a){return this.x*a.y-this.y*a.x};b.prototype.invert=function(){this.x*=-1;this.y*=-1;return this};b.prototype.map=function(a){this.x=a(this.x);this.y=a(this.y);return this};
b.prototype.length=function(){var a=this.x,b=this.y;return Math.sqrt(a*a+b*b)};b.prototype.copy=function(a){this.x=a.x;this.y=a.y;return this};b.prototype.clear=function(){this.y=this.x=0;return this};b.prototype.isZero=function(){return 0!==this.x||0!==this.y?!1:!0};b.prototype.toArray=function(){return[this.x,this.y]};b.normalize=function(a,b){var c=a.x,f=a.y,c=Math.sqrt(c*c+f*f)||1,c=1/c;b.x=a.x*c;b.y=a.y*c;return b};b.clone=function(a){return new b(a.x,a.y)};b.add=function(a,b,c){c.x=a.x+b.x;
c.y=a.y+b.y;return c};b.subtract=function(a,b,c){c.x=a.x-b.x;c.y=a.y-b.y;return c};b.scale=function(a,b,c){c.x=a.x*b;c.y=a.y*b;return c};b.dot=function(a,b){return a.x*b.x+a.y*b.y};b.cross=function(a,b){return a.x*b.y-a.y*b.x};k.exports=b},{}],35:[function(e,k,v){var b=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};b.prototype.set=function(a,b,c){null!=a&&(this.x=a);null!=b&&(this.y=b);null!=c&&(this.z=c);return this};b.prototype.add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this};
b.prototype.subtract=function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this};b.prototype.rotateX=function(a){var b=this.y,c=this.z,f=Math.cos(a);a=Math.sin(a);this.y=b*f-c*a;this.z=b*a+c*f;return this};b.prototype.rotateY=function(a){var b=this.x,c=this.z,f=Math.cos(a);a=Math.sin(a);this.x=c*a+b*f;this.z=c*f-b*a;return this};b.prototype.rotateZ=function(a){var b=this.x,c=this.y,f=Math.cos(a);a=Math.sin(a);this.x=b*f-c*a;this.y=b*a+c*f;return this};b.prototype.dot=function(a){return this.x*a.x+
this.y*a.y+this.z*a.z};b.prototype.cross=function(a){var b=this.x,c=this.y,f=this.z,h=a.x,g=a.y;a=a.z;this.x=c*a-f*g;this.y=f*h-b*a;this.z=b*g-c*h;return this};b.prototype.scale=function(a){this.x*=a;this.y*=a;this.z*=a;return this};b.prototype.invert=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};b.prototype.map=function(a){this.x=a(this.x);this.y=a(this.y);this.z=a(this.z);return this};b.prototype.length=function(){var a=this.x,b=this.y,c=this.z;return Math.sqrt(a*a+b*b+c*
c)};b.prototype.lengthSq=function(){var a=this.x,b=this.y,c=this.z;return a*a+b*b+c*c};b.prototype.copy=function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this};b.prototype.clear=function(){this.z=this.y=this.x=0;return this};b.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z};b.prototype.toArray=function(){return[this.x,this.y,this.z]};b.prototype.normalize=function(){var a=this.x,b=this.y,c=this.z,a=Math.sqrt(a*a+b*b+c*c)||1,a=1/a;this.x*=a;this.y*=a;this.z*=a;return this};
b.prototype.applyRotation=function(a){var b=a.w,c=-a.x,f=-a.y,h=-a.z,g=this.x,e=this.y,l=this.z;a=-c*g-f*e-h*l;var m=g*b+e*h-f*l,p=e*b+c*l-g*h,g=l*b+g*f-c*e,c=-c,f=-f,h=-h;this.x=m*b+c*a+f*g-p*h;this.y=p*b+f*a+m*h-c*g;this.z=g*b+h*a+c*p-m*f;return this};b.prototype.applyMatrix=function(a){a=a.get();var b=this.x,c=this.y,f=this.z;this.x=a[0]*b+a[1]*c+a[2]*f;this.y=a[3]*b+a[4]*c+a[5]*f;this.z=a[6]*b+a[7]*c+a[8]*f;return this};b.normalize=function(a,b){var c=a.x,f=a.y,h=a.z,g=Math.sqrt(c*c+f*f+h*h)||
1,g=1/g;b.x=c*g;b.y=f*g;b.z=h*g;return b};b.applyRotation=function(a,b,c){var f=b.w,h=-b.x,g=-b.y;b=-b.z;var e=a.x,l=a.y,m=a.z;a=-h*e-g*l-b*m;var p=e*f+l*b-g*m,u=l*f+h*m-e*b,e=m*f+e*g-h*l,h=-h,g=-g;b=-b;c.x=p*f+h*a+g*e-u*b;c.y=u*f+g*a+p*b-h*e;c.z=e*f+b*a+h*u-p*g;return c};b.clone=function(a){return new b(a.x,a.y,a.z)};b.add=function(a,b,c){c.x=a.x+b.x;c.y=a.y+b.y;c.z=a.z+b.z;return c};b.subtract=function(a,b,c){c.x=a.x-b.x;c.y=a.y-b.y;c.z=a.z-b.z;return c};b.scale=function(a,b,c){c.x=a.x*b;c.y=a.y*
b;c.z=a.z*b;return c};b.dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z};b.cross=function(a,b,c){var f=a.x,h=a.y;a=a.z;var g=b.x,e=b.y;b=b.z;c.x=h*b-a*e;c.y=a*g-f*b;c.z=f*e-h*g;return c};b.project=function(a,b,c){var f=b.x,h=b.y;b=b.z;a=a.x*f+a.y*h+a.z*b;a/=f*f+h*h+b*b;c.x=f*a;c.y=h*a;c.z=b*a;return c};k.exports=b},{}],36:[function(e,k,v){k.exports={Mat33:e("./Mat33"),Quaternion:e("./Quaternion"),Vec2:e("./Vec2"),Vec3:e("./Vec3")}},{"./Mat33":32,"./Quaternion":33,"./Vec2":34,"./Vec3":35}],37:[function(e,
k,v){function b(a,b,d){var c=p;g.cross(a,b,c);g.cross(c,d,c);return c}function a(a,b){for(var c,d=-Infinity,f,h,m,e=0;e<a.length;e++)h=a[e],f=g.dot(h,b),f>d&&(c=h,d=f,m=e);return{vertex:c,index:m}}function d(a,b,c){this.distance=a;this.normal=b;this.vertexIndices=c}function c(){this.vertices=[];this.numVertices=0;this.features=[];this.lastVertexIndex=this.numFeatures=0;this._IDPool={vertices:[],features:[]}}function f(a,b,c,d){for(var f=a[c].vertex,g=a[d].vertex,h=0,m=b.length;h<m;h++){var e=b[h];
if(e){var n=a[e[0]].vertex,e=a[e[1]].vertex;if(f===n&&g===e||f===e&&g===n){b[h]=null;return}}}b.push([c,d])}function h(a,b,c,d,f){var g=a+b;d[0]=g+c;var h=a*a,g=h+b*g;d[1]=g+c*d[0];d[2]=a*h+b*g+c*d[1];f[0]=d[1]+a*(d[0]+a);f[1]=d[1]+b*(d[0]+b);f[2]=d[1]+c*(d[0]+c)}var g=e("../math/Vec3"),r=e("../math/Mat33");e=e("../utilities/ObjectManager");e.register("DynamicGeometry",c);e.register("DynamicGeometryFeature",d);var l=e.requestDynamicGeometryFeature,m=e.freeDynamicGeometryFeature,p=new g,u=new g,n=
new g,A=new g,t=new g,w=new g,D=new g,x=new g,z=new g;d.prototype.reset=function(a,b,d){this.distance=a;this.normal=b;this.vertexIndices=d;return this};c.prototype.reset=function(){this.vertices=[];this.numVertices=0;this.features=[];this.lastVertexIndex=this.numFeatures=0;this._IDPool={vertices:[],features:[]};return this};c.prototype.addVertex=function(a){var b=this._IDPool.vertices.length?this._IDPool.vertices.pop():this.vertices.length;this.vertices[b]=a;this.lastVertexIndex=b;this.numVertices++};
c.prototype.removeVertex=function(a){var b=this.vertices[a];this.vertices[a]=null;this._IDPool.vertices.push(a);this.numVertices--;return b};c.prototype.addFeature=function(a,b,d){var c=this._IDPool.features.length?this._IDPool.features.pop():this.features.length;this.features[c]=l().reset(a,b,d);this.numFeatures++};c.prototype.removeFeature=function(a){var b=this.features[a];this.features[a]=null;this._IDPool.features.push(a);this.numFeatures--;m(b)};c.prototype.getLastVertex=function(){return this.vertices[this.lastVertexIndex]};
c.prototype.getFeatureClosestToOrigin=function(){for(var a=Infinity,b=null,d=this.features,c=0,f=d.length;c<f;c++){var g=d[c];g&&g.distance<a&&(a=g.distance,b=g)}return b};c.prototype.reshape=function(a){var b=this.vertices,d=this.getLastVertex().vertex,c=this.features,h,m,e,l,p=[];e=0;for(l=c.length;e<l;e++)c[e]&&(m=c[e].vertexIndices,h=b[m[0]].vertex,-.001<g.dot(c[e].normal,g.subtract(d,h,n))&&(f(b,p,m[0],m[1]),f(b,p,m[1],m[2]),f(b,p,m[2],m[0]),this.removeFeature(e)));h=this.lastVertexIndex;c=0;
for(l=p.length;c<l;c++)if(p[c]){m=p[c][0];e=p[c][1];var r=b[e].vertex,A=g.subtract(b[m].vertex,d,t),r=g.subtract(r,d,w),A=g.cross(A,r,new g);A.normalize();a?(r=g.subtract(a,d,u),-.001<g.dot(A,r)&&A.invert(),this.addFeature(null,A,[h,m,e])):(r=g.dot(A,d),0>r&&(A.invert(),r*=-1),this.addFeature(r,A,[h,m,e]))}};c.prototype.simplexContainsOrigin=function(a,c){var d=this.vertices.length,f=this.lastVertexIndex,h=f-1,m=f-2,e=f-3,h=0>h?h+d:h,m=0>m?m+d:m,e=0>e?e+d:e,n=this.vertices[f].vertex,l=this.vertices[h].vertex,
p=this.vertices[m].vertex,u=this.vertices[e].vertex,r=g.scale(n,-1,A),q=g.subtract(l,n,t),k,H,N;if(4===d){k=g.subtract(p,n,w);H=g.subtract(u,n,D);n=g.cross(q,k,new g);d=g.cross(k,H,new g);N=g.cross(q,H,new g);n.normalize();d.normalize();N.normalize();0<g.dot(n,H)&&n.invert();0<g.dot(d,q)&&d.invert();0<g.dot(N,k)&&N.invert();k=g.dot(n,r);H=g.dot(d,r);r=g.dot(N,r);if(.001>k&&.001>r&&.001>H)return p=g.subtract(p,l,x),u=g.subtract(u,l,z),u=g.cross(p,u,new g),u.normalize(),0>=g.dot(u,q)&&u.invert(),l=
-1*g.dot(u,l),this.addFeature(-k,n,[f,h,m]),this.addFeature(-H,d,[f,m,e]),this.addFeature(-r,N,[f,e,h]),this.addFeature(-l,u,[h,m,e]),!0;.001<=k?(H=this.removeVertex(e),a.copy(n)):.001<=H?(H=this.removeVertex(h),a.copy(d)):(H=this.removeVertex(m),a.copy(N))}else 3===d?(k=g.subtract(p,n,w),g.cross(q,k,a),0>=g.dot(a,r)&&a.invert()):a.copy(b(q,r,q));H&&c&&c(H);return!1};k.exports={DynamicGeometry:c,ConvexHull:function(d,f){var m=f||1E3,e=new c;e.addVertex(a(d,new g(1,0,0)));e.addVertex(a(d,new g(-1,
0,0)));var n=e.vertices[0].vertex,l=e.vertices[1].vertex,p=g.subtract(l,n,t),A,k,F,G,C,q=-Infinity;for(C=0;C<d.length;C++)if(k=d[C],k!==n&&k!==l){var I=g.subtract(k,n,u);A=g.dot(I,b(p,I,p));A=0>A?-1*A:A;A>q&&(q=A,F=k,G=C)}e.addVertex({vertex:F,index:G});var I=F,H=g.subtract(I,n,w),N=g.cross(p,H,new g);N.normalize();q=-Infinity;for(C=0;C<d.length;C++)k=d[C],k!==n&&k!==l&&k!==I&&(A=g.dot(g.subtract(k,n,u),N),A=0>A?-1*A:A,A>q&&(q=A,F=k,G=C));e.addVertex({vertex:F,index:G});C=g.subtract(F,n,D);q=g.subtract(I,
l,x);A=g.subtract(F,l,z);G=g.cross(H,C,new g);k=g.cross(p,C,new g);q=g.cross(q,A,new g);G.normalize();k.normalize();q.normalize();0<g.dot(N,C)&&N.invert();0<g.dot(G,p)&&G.invert();0<g.dot(k,H)&&k.invert();0>g.dot(q,p)&&q.invert();e.addFeature(null,N,[0,1,2]);e.addFeature(null,G,[0,2,3]);e.addFeature(null,k,[0,1,3]);e.addFeature(null,q,[1,2,3]);H={};C=0;for(p=e.vertices.length;C<p;C++)H[e.vertices[C].index]=!0;l=new g(n.x+l.x+I.x+F.x,n.y+l.y+I.y+F.y,n.z+l.z+I.z+F.z);l.scale(.25);I=e.features;for(N=
0;N++<m;){k=null;C=0;for(p=I.length;C<p;C++)I[C]&&!I[C].done&&(k=I[C],n=e.vertices[k.vertexIndices[0]].vertex,q=a(d,k.normal),F=q.vertex,G=q.index,.001>g.dot(g.subtract(F,n,u),k.normal)||H[G]?k.done=!0:(H[G]=!0,e.addVertex(q),e.reshape(l)));if(null===k)break}m=[];n=0;for(I=e.features.length;n<I;n++)(l=e.features[n])&&m.push(l.vertexIndices);l=e.vertices;n=[0,0,0,0,0,0,0,0,0,0];p=[];F=[];G=[];H=[];N=[];k=[];C=0;for(I=m.length;C<I;C++){var S=l[m[C][0]].vertex,R=l[m[C][1]].vertex,q=l[m[C][2]].vertex;
A=g.subtract(R,S,t);var V=g.subtract(q,S,w),U=A.cross(V);0>g.dot(S,U)&&U.invert();A=U.x;var V=U.y,U=U.z,v=S.x,Y=S.y,S=S.z,Z=R.x,aa=R.y,R=R.z,ca=q.x,da=q.y,q=q.z;h(v,Z,ca,p,H);h(Y,aa,da,F,N);h(S,R,q,G,k);n[0]+=A*p[0];n[1]+=A*p[1];n[2]+=V*F[1];n[3]+=U*G[1];n[4]+=A*p[2];n[5]+=V*F[2];n[6]+=U*G[2];n[7]+=A*(Y*H[0]+aa*H[1]+da*H[2]);n[8]+=V*(S*N[0]+R*N[1]+q*N[2]);n[9]+=U*(v*k[0]+Z*k[1]+ca*k[2])}n[0]/=6;n[1]/=24;n[2]/=24;n[3]/=24;n[4]/=60;n[5]/=60;n[6]/=60;n[7]/=120;n[8]/=120;n[9]/=120;p=Infinity;F=-Infinity;
G=Infinity;H=-Infinity;N=Infinity;k=-Infinity;C=0;for(I=l.length;C<I;C++)q=l[C].vertex,q.x<p&&(p=q.x),q.x>F&&(F=q.x),q.y<G&&(G=q.y),q.y>H&&(H=q.y),q.z<N&&(N=q.z),q.z>k&&(k=q.z);l=[F-p,H-G,k-N];C=n[0];I=new g(n[1],n[2],n[3]);I.scale(1/C);n=new r([n[4],n[7],n[9],n[7],n[5],n[8],n[9],n[8],n[6]]);l={size:l,volume:C,centroid:I,eulerTensor:n};p=l.centroid;C=[];n=0;for(I=e.vertices.length;n<I;n++)C.push(g.subtract(e.vertices[n].vertex,p,new g));e=[];n=0;for(I=C.length;n<I;n++)e.push(g.normalize(C[n],new g));
I={};p={};for(n=0;n<m.length;n++)F=m[n][0],G=m[n][1],H=m[n][2],p[F]=p[F]||{},p[G]=p[G]||{},p[H]=p[H]||{},I[F]=I[F]||[],I[G]=I[G]||[],I[H]=I[H]||[],p[F][G]||(p[F][G]=1,I[F].push(G)),p[F][H]||(p[F][H]=1,I[F].push(H)),p[G][F]||(p[G][F]=1,I[G].push(F)),p[G][H]||(p[G][H]=1,I[G].push(H)),p[H][F]||(p[H][F]=1,I[H].push(F)),p[H][G]||(p[H][G]=1,I[H].push(G));this.indices=m;this.vertices=C;this.normals=e;this.polyhedralProperties=l;this.graph=I}}},{"../math/Mat33":32,"../math/Vec3":35,"../utilities/ObjectManager":75}],
38:[function(e,k,v){function b(a){this.events=new g;a=a||{};this.bodies=[];this.forces=[];this.constraints=[];this.step=a.step||1E3/60;this.iterations=a.iterations||10;this._indexPools={bodies:[],forces:[],constraints:[]};this._entityMaps={bodies:{},forces:{},constraints:{}};this.speed=a.speed||1;this.delta=this.time=0;this.origin=a.origin||new r;this.orientation=a.orientation?a.orientation.normalize():new l;this.frameDependent=a.frameDependent||!1;this.transformBuffers={position:[0,0,0],rotation:[0,
0,0,1]}}function a(a,b,d){var c=a._entityMaps[d];if(null==c[b._ID]){var f=a[d];a=a._indexPools[d];c[b._ID]=a.length?a.pop():f.length;f[c[b._ID]]=b}}function d(a,b,d){var c=a._entityMaps[d],f=c[b._ID];null!=f&&(a._indexPools[d].push(f),a[d][f]=null,c[b._ID]=null)}var c=e("./bodies/Particle"),f=e("./constraints/Constraint"),h=e("./forces/Force"),g=e("../utilities/CallbackStore"),r=e("../math/Vec3"),l=e("../math/Quaternion"),m=new r,p=new l,u=new r;b.prototype.on=function(a,b){this.events.on(a,b);return this};
b.prototype.off=function(a,b){this.events.off(a,b);return this};b.prototype.trigger=function(a,b){this.events.trigger(a,b);return this};b.prototype.setOrigin=function(a,b,d){this.origin.set(a,b,d);return this};b.prototype.setOrientation=function(a,b,d,c){this.orientation.set(a,b,d,c).normalize();return this};b.prototype.add=function(){for(var a=0,b=arguments.length;a<b;a++){var d=arguments[a];if(d instanceof Array)for(var g=0,e=d.length;g<e;g++)this.add(d[g]);else d instanceof c?this.addBody(d):d instanceof
f?this.addConstraint(d):d instanceof h&&this.addForce(d)}return this};b.prototype.remove=function(){for(var a=0,b=arguments.length;a<b;a++){var d=arguments[a];if(d instanceof Array)for(var g=0,e=d.length;g<e;g++)this.add(d[g]);else d instanceof c?this.removeBody(d):d instanceof f?this.removeConstraint(d):d instanceof h&&this.removeForce(d)}return this};b.prototype.addBody=function(b){a(this,b,"bodies")};b.prototype.addForce=function(b){a(this,b,"forces")};b.prototype.addConstraint=function(b){a(this,
b,"constraints");return b};b.prototype.removeBody=function(a){d(this,a,"bodies")};b.prototype.removeForce=function(a){d(this,a,"forces")};b.prototype.removeConstraint=function(a){d(this,a,"constraints")};b.prototype.update=function(a){0===this.time&&(this.time=a);var b=this.bodies,d=this.forces,c=this.constraints,f=this.frameDependent,g=this.step,h=.001*g,e=this.delta,e=e+(a-this.time)*this.speed;this.time=a;for(var m,l,p;e>g;){this.events.trigger("prestep",a);for(m=0;m<d.length;m++)l=d[m],null!=
l&&l.update(a,h);for(m=0;m<b.length;m++)p=b[m],null!=p&&(l=p,p=h,l.momentum.add(r.scale(l.force,p,u)),l.angularMomentum.add(r.scale(l.torque,p,u)),r.scale(l.momentum,l.inverseMass,l.velocity),l.inverseInertia.vectorMultiply(l.angularMomentum,l.angularVelocity),l.force.clear(),l.torque.clear());for(m=0;m<c.length;m++)p=c[m],null!=p&&p.update(a,h);for(var k=0,E=this.iterations;k<E;k++)for(m=0,l=c.length;m<l;m++)p=c[m],null!==p&&p.resolve(a,h);m=0;for(l=b.length;m<l;m++)if(p=b[m],null!==p){k=h;if(0!==
p.restrictions){var E=p.restrictions,M=null,v=null,K=null,F=null,G=null,C=null;E&32&&(M=0);E&16&&(v=0);E&8&&(K=0);E&4&&(F=0);E&2&&(G=0);E&1&&(C=0);null===M&&null===v&&null===K||p.setVelocity(M,v,K);null===F&&null===G&&null===C||p.setAngularVelocity(F,G,C)}p.position.add(r.scale(p.velocity,k,u));var K=p.angularVelocity,E=p.orientation,M=K.x,v=K.y,K=K.z,F=E.w,G=E.x,C=E.y,q=E.z,k=.5*k;E.w+=(-M*G-v*C-K*q)*k;E.x+=(M*F+v*q-K*C)*k;E.y+=(v*F+K*G-M*q)*k;E.z+=(K*F+M*C-v*G)*k;E.normalize();p.updateInertia()}this.events.trigger("poststep",
a);e=f?0:e-g}this.delta=e};b.prototype.getTransform=function(a){var b=this.origin,d=this.orientation,c=this.transformBuffers,f=a.position,g=a=a.orientation,h=f;1!==d.w&&(g=l.multiply(a,d,p),h=d.rotateVector(f,m));c.position[0]=b.x+h.x;c.position[1]=b.y+h.y;c.position[2]=b.z+h.z;c.rotation[0]=g.x;c.rotation[1]=g.y;c.rotation[2]=g.z;c.rotation[3]=g.w;return c};k.exports=b},{"../math/Quaternion":33,"../math/Vec3":35,"../utilities/CallbackStore":74,"./bodies/Particle":40,"./constraints/Constraint":47,
"./forces/Force":58}],39:[function(e,k,v){function b(b){d.call(this,b);this.normals=[new a(0,1,0),new a(1,0,0),new a(0,0,1)];this.type=2}var a=e("../../math/Vec3"),d=e("./convexBodyFactory")([new a(-100,-100,-100),new a(100,-100,-100),new a(-100,-100,100),new a(100,-100,100),new a(-100,100,-100),new a(100,100,-100),new a(-100,100,100),new a(100,100,100)]);b.prototype=Object.create(d.prototype);b.prototype.constructor=b;k.exports=b},{"../../math/Vec3":35,"./convexBodyFactory":43}],40:[function(e,k,
v){function b(b){this.events=new f;b=b||{};this.position=b.position||new a;this.orientation=b.orientation||new d;this.velocity=new a;this.momentum=new a;this.angularVelocity=new a;this.angularMomentum=new a;this.mass=b.mass||1;this.inverseMass=1/this.mass;this.force=new a;this.torque=new a;this.restitution=null!=b.restitution?b.restitution:.4;this.friction=null!=b.friction?b.friction:.2;this.inverseInertia=new c([0,0,0,0,0,0,0,0,0]);this.localInertia=new c([0,0,0,0,0,0,0,0,0]);this.localInverseInertia=
new c([0,0,0,0,0,0,0,0,0]);this.size=b.size||[0,0,0];var g=b.velocity;g&&this.setVelocity(g.x,g.y,g.z);this.restrictions=0;this.setRestrictions.apply(this,b.restrictions||[]);this.collisionMask=b.collisionMask||1;this.collisionGroup=b.collisionGroup||1;this.type=1;this._ID=r++}var a=e("../../math/Vec3"),d=e("../../math/Quaternion"),c=e("../../math/Mat33"),f=e("../../utilities/CallbackStore"),h=new a,g=new c,r=0;b.prototype.on=function(a,b){this.events.on(a,b);return this};b.prototype.off=function(a,
b){this.events.off(a,b);return this};b.prototype.trigger=function(a,b){this.events.trigger(a,b);return this};b.prototype.getRestrictions=function(){var a="",b="",d=this.restrictions;d&32&&(a+="x");d&16&&(a+="y");d&8&&(a+="z");d&4&&(b+="x");d&2&&(b+="y");d&1&&(b+="z");return[a,b]};b.prototype.setRestrictions=function(a,b){a=a||"";b=b||"";this.restrictions=0;-1<a.indexOf("x")&&(this.restrictions|=32);-1<a.indexOf("y")&&(this.restrictions|=16);-1<a.indexOf("z")&&(this.restrictions|=8);-1<b.indexOf("x")&&
(this.restrictions|=4);-1<b.indexOf("y")&&(this.restrictions|=2);-1<b.indexOf("z")&&(this.restrictions|=1);return this};b.prototype.getMass=function(){return this.mass};b.prototype.setMass=function(a){this.mass=a;this.inverseMass=1/a;return this};b.prototype.getInverseMass=function(){return this.inverseMass};b.prototype.updateLocalInertia=function(){this.localInertia.set([0,0,0,0,0,0,0,0,0]);this.localInverseInertia.set([0,0,0,0,0,0,0,0,0]);return this};b.prototype.updateInertia=function(){var a=
this.localInverseInertia,b=this.orientation;if(a[0]===a[4]&&a[4]===a[8]||1===b.w)return this;a=b.toMatrix(g);c.multiply(a,this.inverseInertia,this.inverseInertia);c.multiply(this.localInverseInertia,a.transpose(),this.inverseInertia);return this};b.prototype.getPosition=function(){return this.position};b.prototype.setPosition=function(a,b,d){this.position.set(a,b,d);return this};b.prototype.getVelocity=function(){return this.velocity};b.prototype.setVelocity=function(b,d,c){this.velocity.set(b,d,
c);a.scale(this.velocity,this.mass,this.momentum);return this};b.prototype.getMomentum=function(){return this.momentum};b.prototype.setMomentum=function(b,d,c){this.momentum.set(b,d,c);a.scale(this.momentum,this.inverseMass,this.velocity);return this};b.prototype.getOrientation=function(){return this.orientation};b.prototype.setOrientation=function(a,b,d,c){this.orientation.set(a,b,d,c).normalize();this.updateInertia();return this};b.prototype.getAngularVelocity=function(){return this.angularVelocity};
b.prototype.setAngularVelocity=function(a,b,d){this.angularVelocity.set(a,b,d);(a=c.inverse(this.inverseInertia,g))?a.vectorMultiply(this.angularVelocity,this.angularMomentum):this.angularMomentum.clear();return this};b.prototype.getAngularMomentum=function(){return this.angularMomentum};b.prototype.setAngularMomentum=function(a,b,d){this.angularMomentum.set(a,b,d);this.inverseInertia.vectorMultiply(this.angularMomentum,this.angularVelocity);return this};b.prototype.getForce=function(){return this.force};
b.prototype.setForce=function(a,b,d){this.force.set(a,b,d);return this};b.prototype.getTorque=function(){return this.torque};b.prototype.setTorque=function(a,b,d){this.torque.set(a,b,d);return this};b.prototype.applyForce=function(a){this.force.add(a);return this};b.prototype.applyTorque=function(a){this.torque.add(a);return this};b.prototype.applyImpulse=function(b){this.momentum.add(b);a.scale(this.momentum,this.inverseMass,this.velocity);return this};b.prototype.applyAngularImpulse=function(a){this.angularMomentum.add(a);
this.inverseInertia.vectorMultiply(this.angularMomentum,this.angularVelocity);return this};b.prototype.support=function(){return h};b.prototype.updateShape=function(){};k.exports=b},{"../../math/Mat33":32,"../../math/Quaternion":33,"../../math/Vec3":35,"../../utilities/CallbackStore":74}],41:[function(e,k,v){function b(b){a.call(this,b);var d=b.radius||1;this.radius=d;this.size=[2*d,2*d,2*d];this.updateLocalInertia();this.inverseInertia.copy(this.localInverseInertia);(b=b.angularVelocity)&&this.setAngularVelocity(b.x,
b.y,b.z);this.type=4}var a=e("./Particle"),d=e("../../math/Vec3"),c=new d;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.getRadius=function(){return this.radius};b.prototype.setRadius=function(a){this.radius=a;this.size=[2*this.radius,2*this.radius,2*this.radius];return this};b.prototype.updateLocalInertia=function(){var a=this.radius,a=this.mass*a*a;this.localInertia.set([.4*a,0,0,0,.4*a,0,0,0,.4*a]);this.localInverseInertia.set([2.5/a,0,0,0,2.5/a,0,0,0,2.5/a])};b.prototype.support=
function(a){return d.scale(a,this.radius,c)};k.exports=b},{"../../math/Vec3":35,"./Particle":40}],42:[function(e,k,v){function b(c){a.call(this,c);var f=this.normal=new d;switch(this.direction=c.direction){case b.DOWN:f.set(0,1,0);break;case b.UP:f.set(0,-1,0);break;case b.LEFT:f.set(-1,0,0);break;case b.RIGHT:f.set(1,0,0);break;case b.FORWARD:f.set(0,0,-1);break;case b.BACKWARD:f.set(0,0,1)}this.invNormal=d.clone(f,new d).invert();this.mass=Infinity;this.inverseMass=0;this.type=8}var a=e("./Particle"),
d=e("../../math/Vec3"),b={DOWN:0,UP:1,LEFT:2,RIGHT:3,FORWARD:4,BACKWARD:5};b.prototype=Object.create(a.prototype);b.prototype.constructor=b;k.exports=b},{"../../math/Vec3":35,"./Particle":40}],43:[function(e,k,v){function b(a){var b=this.hull.polyhedralProperties,c=a.get(),c=c[0]*c[4]*c[8],f=b.eulerTensor,h=new d;d.multiply(a,f,h);d.multiply(h,a,h);var e=h.get(),n=e[0],k=e[4],t=e[8];a=b.volume*c;var f=this.mass/a,h=-e[1],w=-e[7],e=-e[2],D=b.centroid,b=k+t-a*(D.y*D.y+D.z*D.z),t=n+t-a*(D.z*D.z+D.x*
D.x),n=n+k-a*(D.x*D.x+D.y*D.y),h=h+a*D.x*D.y,w=w+a*D.y*D.z,e=e+a*D.z*D.x,b=b*f*c,t=t*f*c,n=n*f*c,h=h*f*c,w=w*f*c,e=e*f*c;this.localInertia.set([b,h,e,h,t,w,e,w,n]);d.inverse(this.localInertia,this.localInverseInertia)}var a=e("./Particle"),d=e("../../math/Mat33"),c=e("../../math/Vec3"),f=e("../Geometry").ConvexHull,h=new c;k.exports=function(g){function e(f){a.call(this,f);var h=g.polyhedralProperties.size,p=f.size||h,u=p[0]/h[0],n=p[1]/h[1],h=p[2]/h[2];this._scale=[u,n,h];u=new d([u,0,0,0,n,0,0,
0,h]);this.hull=g;this.vertices=[];n=0;for(h=g.vertices.length;n<h;n++)this.vertices.push(u.vectorMultiply(g.vertices[n],new c));b.call(this,u);this.inverseInertia.copy(this.localInverseInertia);this.updateInertia();(f=f.angularVelocity)&&this.setAngularVelocity(f.x,f.y,f.z)}if(!(g instanceof f))if(g instanceof Array)g=new f(g);else throw Error("convexBodyFactory requires a ConvexHull object or an array of Vec3's as input.");e.prototype=Object.create(a.prototype);e.prototype.constructor=e;e.prototype.setSize=
function(a,b,c){var f=g.polyhedralProperties.size;this.size[0]=a;this.size[1]=b;this.size[2]=c;a/=f[0];b/=f[1];c/=f[2];this._scale=[a,b,c];c=new d([a,0,0,0,b,0,0,0,c]);f=this.vertices;a=0;for(b=g.vertices.length;a<b;a++)c.vectorMultiply(g.vertices[a],f[a]);return this};e.prototype.updateLocalInertia=function(){var a=new d([this._scale[0],0,0,0,this._scale[1],0,0,0,this._scale[2]]);b.call(this,a);return this};e.prototype.support=function(a){for(var b=this.vertices,d,f,g,h=-Infinity,e=0,r=b.length;e<
r;e++)d=b[e],f=c.dot(d,a),f>h&&(g=d,h=f);return g};e.prototype.updateShape=function(){for(var a=this.vertices,b=this.orientation,d=this.hull.vertices,f=this._scale[0],g=this._scale[1],e=this._scale[2],r=0,w=a.length;r<w;r++)h.copy(d[r]),h.x*=f,h.y*=g,h.z*=e,c.applyRotation(h,b,a[r]);return this};return e}},{"../../math/Mat33":32,"../../math/Vec3":35,"../Geometry":37,"./Particle":40}],44:[function(e,k,v){function b(b,f,e){this.a=b;this.b=f;a.call(this,e);this.effectiveInertia=new c;this.angularImpulse=
new d;this.error=0}var a=e("./Constraint"),d=e("../../math/Vec3"),c=e("../../math/Mat33"),f=new d;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.init=function(){this.cosAngle=this.cosAngle||this.a.orientation.dot(this.b.orientation)};b.prototype.update=function(){var a=this.a,b=this.b;this.error=2*(a.orientation.dot(b.orientation)-this.cosAngle);var d=this.angularImpulse;b.applyAngularImpulse(d);a.applyAngularImpulse(d.invert());c.add(a.inverseInertia,b.inverseInertia,
this.effectiveInertia);this.effectiveInertia.inverse();d.clear()};b.prototype.resolve=function(){var a=this.a,b=this.b;d.subtract(a.angularVelocity,b.angularVelocity,f);f.scale(1+this.error);var c=f.applyMatrix(this.effectiveInertia);b.applyAngularImpulse(c);a.applyAngularImpulse(c.invert());c.invert();this.angularImpulse.add(c)};k.exports=b},{"../../math/Mat33":32,"../../math/Vec3":35,"./Constraint":47}],45:[function(e,k,v){function b(b,f,g){this.a=b;this.b=f;a.call(this,g);this.impulse=new d;this.angImpulseA=
new d;this.angImpulseB=new d;this.error=new d;this.effMassMatrix=new c}var a=e("./Constraint"),d=e("../../math/Vec3"),c=e("../../math/Mat33"),f=e("../../math/Quaternion"),h=new d,g=new d,r=new d,l=new d,m=new d;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.init=function(){var a=this.anchor,b=this.a,c=this.b,g=f.conjugate(b.orientation,new f),h=f.conjugate(c.orientation,new f);this.rA=d.subtract(a,b.position,new d);this.rB=d.subtract(a,c.position,new d);this.bodyRA=g.rotateVector(this.rA,
new d);this.bodyRB=h.rotateVector(this.rB,new d)};b.prototype.update=function(a,b){var f=this.a,h=this.b,e=f.orientation.rotateVector(this.bodyRA,this.rA),m=h.orientation.rotateVector(this.bodyRB,this.rB),e=new c([0,e.z,-e.y,-e.z,0,e.x,e.y,-e.x,0]),m=new c([0,m.z,-m.y,-m.z,0,m.x,m.y,-m.x,0]),e=c.multiply(e,f.inverseInertia,new c).multiply(e.transpose()),m=c.multiply(m,h.inverseInertia,new c).multiply(m.transpose()),m=c.add(e,m,e),e=d.add(f.position,this.rA,this.anchor),l=d.add(h.position,this.rB,
g);d.subtract(l,e,this.error);this.error.scale(.2/b);e=f.inverseMass;l=h.inverseMass;e=new c([e+l,0,0,0,e+l,0,0,0,e+l]);c.add(m,e,this.effMassMatrix);this.effMassMatrix.inverse();m=this.impulse;e=this.angImpulseA;l=this.angImpulseB;h.applyImpulse(m);h.applyAngularImpulse(l);m.invert();f.applyImpulse(m);f.applyAngularImpulse(e);m.clear();e.clear();l.clear()};b.prototype.resolve=function(){var a=this.a,b=this.b,c=this.rA,f=this.rB,e=d.add(a.velocity,d.cross(a.angularVelocity,c,m),r),w=d.add(b.velocity,
d.cross(b.angularVelocity,f,m),l),e=e.subtract(w).subtract(this.error).applyMatrix(this.effMassMatrix),f=d.cross(f,e,h),c=d.cross(c,e,g).invert();b.applyImpulse(e);b.applyAngularImpulse(f);e.invert();a.applyImpulse(e);a.applyAngularImpulse(c);e.invert();this.impulse.add(e);this.angImpulseA.add(c);this.angImpulseB.add(f)};k.exports=b},{"../../math/Mat33":32,"../../math/Quaternion":33,"../../math/Vec3":35,"./Constraint":47}],46:[function(e,k,v){function b(a,b,d){return a<b?b:a>d?d:a}function a(a,b,
d,c,f,g){this.penetration=a;this.normal=b;this.worldContactA=d;this.worldContactB=c;this.localContactA=f;this.localContactB=g}function d(a,b){this.targets=[];a&&(this.targets=this.targets.concat(a));g.call(this,b)}function c(a,b,d){var c=m(b,d);c&&(c=p(b,d,c),null!==c&&a.contactManifoldTable.registerContact(b,d,c))}function f(a,b,d){if(8===b.type){var c=d;d=b;b=c}var f=b.position,g=d.position,e=d.normal,c=d.invNormal,m=b.support(c),f=h.add(f,m,new h),g=h.subtract(f,g,A),g=h.dot(g,c);if(!(0>g)){var e=
h.scale(e,g,new h).add(f),p=h.subtract(e,d.position,new h),c=n().reset(g,c,f,e,m,p);a.contactManifoldTable.registerContact(b,d,c)}}var h=e("../../math/Vec3"),g=e("./Constraint"),r=e("./collision/SweepAndPrune");v=e("./collision/BruteForce");var l=e("./collision/ConvexCollisionDetection"),m=l.gjk,p=l.epa,u=e("./collision/ContactManifold");e=e("../../utilities/ObjectManager");e.register("CollisionData",a);var n=e.requestCollisionData,A=new h;a.prototype.reset=function(a,b,d,c,f,g){this.penetration=
a;this.normal=b;this.worldContactA=d;this.worldContactB=c;this.localContactA=f;this.localContactB=g;return this};d.prototype=Object.create(g.prototype);d.prototype.constructor=d;d.prototype.init=function(){if(this.broadPhase){var a=this.broadphase;a instanceof Function&&(this.broadPhase=new a(this.targets))}else this.broadPhase=new r(this.targets);this.contactManifoldTable=this.contactManifoldTable||new u};d.prototype.update=function(a,b){this.contactManifoldTable.update(b);if(0!==this.targets.length){var d,
c;d=0;for(c=this.targets.length;d<c;d++)this.targets[d].updateShape();var f=this.broadPhase.update(),g;d=0;for(c=f.length;d<c;d++)(g=f[d])&&this.applyNarrowPhase(g);this.contactManifoldTable.prepContacts(b)}};d.prototype.resolve=function(a,b){this.contactManifoldTable.resolveManifolds(b)};d.prototype.addTarget=function(a){this.targets.push(a);this.broadPhase.add(a)};d.prototype.removeTarget=function(a){var b=this.targets.indexOf(a);0>b||(this.targets.splice(b,1),this.broadPhase.remove(a))};var t=
{};t[1]=c;t[2]=c;t[3]=c;t[5]=c;t[4]=function(a,b,d){var c=b.position,f=d.position,g=h.subtract(f,c,new h),e=g.length(),m=b.radius+d.radius,g=g.scale(1/e),e=m-e;if(!(0>e)){var m=h.scale(g,b.radius,new h),p=h.scale(g,-d.radius,new h),c=h.add(c,m,new h),f=h.add(f,p,new h),f=n().reset(e,g,c,f,m,p);a.contactManifoldTable.registerContact(b,d,f)}};t[6]=function(a,d,c){if(4===d.type){var f=c;c=d;d=f}var g=d.position,f=c.position,e=h.subtract(f,g,A),m=d.orientation,p=c.radius,l=d.size,u=.5*l[0],r=.5*l[1],
k=.5*l[2],l=d.normals,t=m.rotateVector(l[1],new h),F=m.rotateVector(l[0],new h),v=m.rotateVector(l[2],new h),l=new h;l.x=b(h.dot(e,t),-u,u);l.y=b(h.dot(e,F),-r,r);l.z=b(h.dot(e,v),-k,k);l.applyRotation(m);e=h.add(g,l,new h);e=h.subtract(e,f,new h);m=e.length();0==m&&(m=.1);p-=m;0>p||(m=h.scale(e,-1/m,new h),g=h.add(g,l,new h),f=h.add(f,e,new h),f=n().reset(p,m,g,f,l,e),a.contactManifoldTable.registerContact(d,c,f))};t[9]=f;t[10]=f;t[12]=f;d.prototype.applyNarrowPhase=function(a){for(var b=0,d=a.length;b<
d;b++)for(var c=b+1;c<d;c++){var f=a[b],g=a[c];if(0!==(f.collisionMask&g.collisionGroup&&f.collisionGroup&g.collisionMask)){var e=f.type|g.type;if(t[e])t[e](this,f,g)}}};d.SweepAndPrune=r;d.BruteForce=v.BruteForce;d.BruteForceAABB=v.BruteForceAABB;k.exports=d},{"../../math/Vec3":35,"../../utilities/ObjectManager":75,"./Constraint":47,"./collision/BruteForce":53,"./collision/ContactManifold":54,"./collision/ConvexCollisionDetection":55,"./collision/SweepAndPrune":56}],47:[function(e,k,v){function b(b){b=
b||{};this.setOptions(b);this._ID=a++}var a=0;b.prototype.setOptions=function(a){for(var b in a)this[b]=a[b];this.init(a)};b.prototype.init=function(a){};b.prototype.update=function(a,b){};b.prototype.resolve=function(a,b){};k.exports=b},{}],48:[function(e,k,v){function b(b,d){this.targets=b?b instanceof Array?b:[b]:[];a.call(this,d);this.impulses={};this.normals={};this.velocityBiases={};this.divisors={}}var a=e("./Constraint"),d=e("../../math/Vec3"),c=new d,f=new d,h=Math.PI;b.prototype=Object.create(a.prototype);
b.prototype.constructor=b;b.prototype.init=function(){this.equation1=this.equation1||function(){return 0};this.equation2=this.equation2||function(a,b,d){return d};this.period=this.period||1;this.dampingRatio=this.dampingRatio||.5;this.stiffness=4*h*h/(this.period*this.period);this.damping=4*h*this.dampingRatio/this.period};b.prototype.update=function(a,b){for(var e=this.targets,h=this.normals,p=this.velocityBiases,u=this.divisors,n=this.impulses,k=this.equation1,t=this.equation2,w=this.damping,D=
this.stiffness,x=0,z=e.length;x<z;x++){var y=e[x],B=y._ID;if(!y.immune){var v=y.position,O=y.mass,J,E;if(0===this.period)J=0,E=1;else{E=w*O;var M=D*O;J=1/(b*(E+b*M));E=b*M/(E+b*M)}var M=v.x,P=v.y,K=v.z,v=k(M,P,K),F=(k(M+1E-7,P,K)-v)/1E-7,G=(k(M,P+1E-7,K)-v)/1E-7,C=(k(M,P,K+1E-7)-v)/1E-7,q=t(M,P,K),I=(t(M+1E-7,P,K)-q)/1E-7,H=(t(M,P+1E-7,K)-q)/1E-7,M=(t(M,P,K+1E-7)-q)/1E-7;f.set(F+I,G+H,C+M);f.normalize();E=E*(v+q)/b;O=J+1/O;d.scale(f,n[B]||0,c);y.applyImpulse(c);h[B]=h[B]||new d;h[B].copy(f);p[B]=
E;u[B]=O;n[B]=0}}};b.prototype.resolve=function(){for(var a=this.targets,b=this.normals,f=this.velocityBiases,e=this.divisors,h=this.impulses,u=0,n=a.length;u<n;u++){var k=a[u],t=k._ID;if(!k.immune){var w=b[t],D=-(d.dot(w,k.velocity)+f[t])/e[t];d.scale(w,D,c);k.applyImpulse(c);h[t]+=D}}};k.exports=b},{"../../math/Vec3":35,"./Constraint":47}],49:[function(e,k,v){function b(b,c,f){this.a=b;this.b=c;a.call(this,f);this.distance=this.impulse=0;this.normal=new d;this.divisor=this.velocityBias=0}var a=
e("./Constraint"),d=e("../../math/Vec3"),c=new d,f=new d,h=new d,g=new d,r=new d,l=Math.PI;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.init=function(){this.direction=this.direction||d.subtract(this.b.position,this.a.position,new d);this.direction.normalize();this.minLength=this.minLength||0;this.period=this.period||.2;this.dampingRatio=this.dampingRatio||.5;this.stiffness=4*l*l/(this.period*this.period);this.damping=4*l*this.dampingRatio/this.period};b.prototype.update=
function(a,b){var e=this.a,h=this.b,l=e.position,k=e.inverseMass,w=h.position,D=h.inverseMass,x=this.direction;d.subtract(w,l,g);d.scale(x,d.dot(x,g),r);l=r.add(l);d.subtract(w,l,c);w=c.length();c.normalize();k+=D;D=1/k;0===this.period?(D=0,l=1):(l=this.damping*D,x=this.stiffness*D,D=1/(b*(l+b*x)),l=b*x/(l+b*x));l=l*w/b;k=D+k;d.scale(c,this.impulse,f);h.applyImpulse(f);e.applyImpulse(f.invert());this.normal.copy(c);this.distance=w;this.velocityBias=l;this.divisor=k;this.impulse=0};b.prototype.resolve=
function(){var a=this.a,b=this.b;if(!(Math.abs(this.distance)<this.minLength)){var c=this.normal;d.subtract(b.velocity,a.velocity,h);var g=-(d.dot(c,h)+this.velocityBias)/this.divisor;d.scale(c,g,f);b.applyImpulse(f);a.applyImpulse(f.invert());this.impulse+=g}};k.exports=b},{"../../math/Vec3":35,"./Constraint":47}],50:[function(e,k,v){function b(b,c,f){this.a=b;this.b=c;a.call(this,f);this.distance=this.impulse=0;this.normal=new d;this.divisor=this.velocityBias=0}var a=e("./Constraint"),d=e("../../math/Vec3"),
c=new d,f=new d,h=new d,g=new d,r=Math.PI;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.init=function(){this.length=this.length||d.subtract(this.b.position,this.a.position,g).length();this.minLength=this.minLength||0;this.period=this.period||.2;this.dampingRatio=this.dampingRatio||.5;this.stiffness=4*r*r/(this.period*this.period);this.damping=4*r*this.dampingRatio/this.period};b.prototype.update=function(a,b){var e=this.a,h=this.b,n=this.length,r=e.inverseMass,k=h.inverseMass;
d.subtract(h.position,e.position,g);var w=g.length();d.scale(g,1/w,c);n=w-n;r+=k;k=1/r;if(0===this.period)k=0,w=1;else var w=this.damping*k,D=this.stiffness*k,k=1/(b*(w+b*D)),w=b*D/(w+b*D);w=w*n/b;r=k+r;d.scale(c,this.impulse,f);h.applyImpulse(f);e.applyImpulse(f.invert());this.normal.copy(c);this.distance=n;this.velocityBias=w;this.divisor=r;this.impulse=0};b.prototype.resolve=function(){var a=this.a,b=this.b;if(!(Math.abs(this.distance)<this.minLength)){var c=a.getVelocity(),g=b.getVelocity(),e=
this.normal;d.subtract(g,c,h);c=-(d.dot(e,h)+this.velocityBias)/this.divisor;d.scale(e,c,f);b.applyImpulse(f);a.applyImpulse(f.invert());this.impulse+=c}};k.exports=b},{"../../math/Vec3":35,"./Constraint":47}],51:[function(e,k,v){function b(b,f,g){this.a=b;this.b=f;a.call(this,g);this.impulse=new d;this.angImpulseA=new d;this.angImpulseB=new d;this.error=new d;this.errorRot=[0,0];this.effMassMatrix=new c;this.effMassMatrixRot=[]}var a=e("./Constraint"),d=e("../../math/Vec3"),c=e("../../math/Mat33"),
f=e("../../math/Quaternion"),h=new d,g=new d,r=new d,l=new d,m=new d,p=new d,u=new d,n=new d;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.init=function(){var a=this.anchor,b=this.axis.normalize(),c=this.a,g=this.b,e=f.conjugate(c.orientation,new f),h=f.conjugate(g.orientation,new f);this.rA=d.subtract(a,c.position,new d);this.rB=d.subtract(a,g.position,new d);this.bodyRA=e.rotateVector(this.rA,new d);this.bodyRB=h.rotateVector(this.rB,new d);this.axisA=d.clone(b);this.axisB=
d.clone(b);this.axisBTangent1=new d;this.axisBTangent2=new d;this.t1xA=new d;this.t2xA=new d;this.bodyAxisA=e.rotateVector(b,new d);this.bodyAxisB=h.rotateVector(b,new d)};b.prototype.update=function(a,b){var f=this.a,e=this.b,m=f.orientation.rotateVector(this.bodyAxisA,this.axisA),n=e.orientation.rotateVector(this.bodyAxisB,this.axisB);this.axis.copy(n);var p=this.axisBTangent1,u=this.axisBTangent2;.57735<=n.x?p.set(n.y,-n.x,0):p.set(0,n.z,-n.y);p.normalize();d.cross(n,p,u);var k=d.cross(p,m,this.t1xA),
n=d.cross(u,m,this.t2xA),v=f.orientation.rotateVector(this.bodyRA,this.rA),J=e.orientation.rotateVector(this.bodyRB,this.rB),v=new c([0,v.z,-v.y,-v.z,0,v.x,v.y,-v.x,0]),J=new c([0,J.z,-J.y,-J.z,0,J.x,J.y,-J.x,0]),v=c.multiply(v,f.inverseInertia,new c).multiply(v.transpose()),J=c.multiply(J,e.inverseInertia,new c).multiply(J.transpose()),v=c.add(v,J,v),E=d.add(f.position,this.rA,this.anchor),M=d.add(e.position,this.rB,h),J=1/b;d.subtract(M,E,this.error);this.error.scale(.2*J);E=f.inverseMass;M=e.inverseMass;
E=new c([E+M,0,0,0,E+M,0,0,0,E+M]);c.add(v,E,this.effMassMatrix);this.effMassMatrix.inverse();var P=f.inverseInertia.vectorMultiply(k,h),E=f.inverseInertia.vectorMultiply(n,g),K=e.inverseInertia.vectorMultiply(k,r),M=e.inverseInertia.vectorMultiply(n,l),v=d.dot(k,P)+d.dot(k,K),k=d.dot(k,E)+d.dot(k,M),P=d.dot(n,P)+d.dot(n,K),n=d.dot(n,E)+d.dot(n,M),E=1/(v*n-k*P);this.effMassMatrixRot[0]=n*E;this.effMassMatrixRot[1]=-P*E;this.effMassMatrixRot[2]=-k*E;this.effMassMatrixRot[3]=v*E;this.errorRot[0]=.2*
d.dot(m,p)*J;this.errorRot[1]=.2*d.dot(m,u)*J;m=this.impulse.scale(.5);p=this.angImpulseA.scale(.5);u=this.angImpulseB.scale(.5);e.applyImpulse(m);e.applyAngularImpulse(u);m.invert();f.applyImpulse(m);f.applyAngularImpulse(p);m.clear();p.clear();u.clear()};b.prototype.resolve=function(){var a=this.a,b=this.b,c=this.rA,f=this.rB,e=this.t1xA,k=this.t2xA,y=a.angularVelocity,v=b.angularVelocity,L=d.add(a.velocity,d.cross(y,c,u),m),O=d.add(b.velocity,d.cross(v,f,u),p),L=L.subtract(O).subtract(this.error).applyMatrix(this.effMassMatrix),
v=d.subtract(v,y,n),O=this.errorRot,y=d.dot(e,v)+O[0],v=d.dot(k,v)+O[1],O=this.effMassMatrixRot,J=-(O[2]*y+O[3]*v),e=d.scale(e,-(O[0]*y+O[1]*v),g).add(d.scale(k,J,r)),f=d.cross(f,L,h).add(e),c=d.cross(c,L,l).invert().subtract(e);b.applyImpulse(L);b.applyAngularImpulse(f);L.invert();a.applyImpulse(L);a.applyAngularImpulse(c);L.invert();this.impulse.add(L);this.angImpulseA.add(c);this.angImpulseB.add(f)};k.exports=b},{"../../math/Mat33":32,"../../math/Quaternion":33,"../../math/Vec3":35,"./Constraint":47}],
52:[function(e,k,v){function b(a){this._body=a;this._ID=a._ID;this.position=null;this.vertices={x:[],y:[],z:[]};this.update()}b.prototype.update=function(){var a=this._body,b=this.position=a.position,c=Infinity,f=-Infinity,e=Infinity,g=-Infinity,r=Infinity,l=-Infinity,m=a.type;if(4===m)f=g=l=a.radius,c=e=r=-a.radius;else if(8===m)switch(a=a.direction,f=g=l=1E6,c=e=r=-1E6,a){case 0:g=25;e=-1E3;break;case 1:g=1E3;e=-25;break;case 2:f=25;c=-1E3;break;case 3:f=1E3;c=-25;break;case 4:l=25;r=-1E3;break;
case 5:l=1E3,r=-25}else if(a.vertices)for(var a=a.vertices,m=0,p=a.length;m<p;m++){var u=a[m];u.x<c&&(c=u.x);u.x>f&&(f=u.x);u.y<e&&(e=u.y);u.y>g&&(g=u.y);u.z<r&&(r=u.z);u.z>l&&(l=u.z)}else f=g=l=25,c=e=r=-25;a=this.vertices;a.x[0]=c+b.x;a.x[1]=f+b.x;a.y[0]=e+b.y;a.y[1]=g+b.y;a.z[0]=r+b.z;a.z[1]=l+b.z};b.checkOverlap=function(a,b){var c=a.vertices,f=b.vertices,e=c.x[0],g=c.x[1],r=f.x[0],l=f.x[1];if(r<=e&&e<=l||e<=r&&r<=g)if(e=c.y[0],g=c.y[1],r=f.y[0],l=f.y[1],r<=e&&e<=l||e<=r&&r<=g)if(e=c.z[0],c=c.z[1],
g=f.z[0],f=f.z[1],g<=e&&e<=f||e<=g&&g<=c)return!0;return!1};b.vertexThreshold=100;k.exports=b},{}],53:[function(e,k,v){function b(a){this._volumes=[];this._entityRegistry={};for(var b=0;b<a.length;b++)this.add(a[b])}function a(a){this.targets=a}var d=e("./AABB");b.prototype.add=function(a){var b=new d(a);this._entityRegistry[a._ID]=a;this._volumes.push(b)};b.prototype.update=function(){for(var a=this._volumes,b=this._entityRegistry,e=0,g=a.length;e<g;e++)a[e].update();for(var e=[],g=0,r=a.length;g<
r;g++)for(var l=g+1;l<r;l++)d.checkOverlap(a[g],a[l])&&e.push([b[g],b[l]]);return e};a.prototype.add=function(a){this.targets.push(a)};a.prototype.update=function(){return[this.targets]};k.exports.BruteForceAABB=b;k.exports.BruteForce=a},{"./AABB":52}],54:[function(e,k,v){function b(){this.manifolds=[];this.collisionMatrix={};this._IDPool=[]}function a(a,b,d,c){this.lowID=a;this.highID=b;this.contacts=[];this.numContacts=0;this.bodyA=d;this.bodyB=c;this.lru=0}function d(a,b,d){this.bodyA=a;this.bodyB=
b;this.data=d;this.tangentImpulse2=this.tangentImpulse1=this.normalImpulse=0;this.impulse=new c;this.angImpulseA=new c;this.angImpulseB=new c;d&&this.init()}var c=e("../../../math/Vec3"),f=e("../../../utilities/ObjectManager");f.register("Manifold",a);f.register("Contact",d);var h=f.requestManifold,g=f.requestContact,r=f.freeManifold,l=f.freeContact,m=new c,p=new c,u=new c,n=new c,A=new c,t=new c,w=new c,D=new c,x=new c,z=new c,y=new c,B=new c,L=new c,O=new c,J=new c;b.prototype.addManifold=function(a,
b,d,c){var f=this.collisionMatrix;f[a]=f[a]||{};f=this._IDPool.length?this._IDPool.pop():this.manifolds.length;this.collisionMatrix[a][b]=f;a=h().reset(a,b,d,c);return this.manifolds[f]=a};b.prototype.removeManifold=function(a,b){var d=this.collisionMatrix;this.manifolds[b]=null;d[a.lowID][a.highID]=null;this._IDPool.push(b);r(a)};b.prototype.update=function(a){for(var b=this.manifolds,d=0,c=b.length;d<c;d++){var f=b[d];f&&!f.update(a)&&(this.removeManifold(f,d),f.bodyA.events.trigger("collision:end",
f),f.bodyB.events.trigger("collision:end",f))}};b.prototype.prepContacts=function(a){for(var b=this.manifolds,d=0,c=b.length;d<c;d++){var f=b[d];if(f)for(var f=f.contacts,e=0,g=f.length;e<g;e++){var h=f[e];h&&h.update(a)}}};b.prototype.resolveManifolds=function(){for(var a=this.manifolds,b=0,d=a.length;b<d;b++){var c=a[b];c&&c.resolveContacts()}};b.prototype.registerContact=function(a,b,d){var c,f;a._ID<b._ID?(c=a._ID,f=b._ID):(c=b._ID,f=a._ID);var e=this.manifolds,g=this.collisionMatrix;g[c]&&null!=
g[c][f]?(c=e[g[c][f]],c.contains(d),c.addContact(a,b,d)):(c=this.addManifold(c,f,a,b),c.addContact(a,b,d),a.events.trigger("collision:start",c),b.events.trigger("collision:start",c))};a.prototype.reset=function(a,b,d,c){this.lowID=a;this.highID=b;this.contacts=[];this.numContacts=0;this.bodyA=d;this.bodyB=c;this.lru=0;return this};a.prototype.addContact=function(a,b,d){var c=this.lru;this.contacts[c]&&this.removeContact(this.contacts[c],c);this.contacts[c]=g().reset(a,b,d);this.lru=(this.lru+1)%4;
this.numContacts++};a.prototype.removeContact=function(a,b){this.contacts[b]=null;this.numContacts--;f.freeCollisionData(a.data);a.data=null;l(a)};a.prototype.contains=function(a){var b=a.worldContactA;a=a.worldContactB;for(var d=this.contacts,f=0,e=d.length;f<e;f++){var g=d[f];if(g){var h=g.data,m=c.subtract(h.worldContactA,b,O).length(),h=c.subtract(h.worldContactB,a,J).length();if(10>m||10>h)return this.removeContact(g,f),!0}}return!1};a.prototype.update=function(){for(var a=this.contacts,b=this.bodyA.position,
d=this.bodyB.position,f=0,e=a.length;f<e;f++){var g=a[f];if(g){var h=g.data,m=h.normal,n=h.localContactB,p=h.worldContactA,l=h.worldContactB,h=c.add(b,h.localContactA,y),n=c.add(d,n,B),m=0<c.dot(c.subtract(n,h,L),m),p=c.subtract(p,h,O),l=c.subtract(l,n,J);(10<=p.length()||10<=l.length()||m)&&this.removeContact(g,f)}}return this.numContacts?!0:!1};a.prototype.resolveContacts=function(){for(var a=this.contacts,b=0,d=a.length;b<d;b++)a[b]&&a[b].resolve()};d.prototype.reset=function(a,b,d){this.bodyA=
a;this.bodyB=b;this.data=d;this.tangentImpulse2=this.tangentImpulse1=this.normalImpulse=0;this.impulse.clear();this.angImpulseA.clear();this.angImpulseB.clear();this.init();return this};d.prototype.init=function(){var a=this.data,b=a.normal,d=new c;.57735<=b.x?d.set(b.y,-b.x,0):d.set(0,b.z,-b.y);d.normalize();var f=c.cross(b,d,new c);this.tangent1=d;this.tangent2=f;var e=this.bodyA,g=this.bodyB,h=a.localContactA,n=a.localContactB,a=e.inverseMass+g.inverseMass,p=c.cross(h,b,t),b=c.cross(n,b,w);this.effNormalMass=
1/(a+c.dot(p,e.inverseInertia.vectorMultiply(p,m))+c.dot(b,g.inverseInertia.vectorMultiply(b,m)));b=c.cross(h,d,t);d=c.cross(n,d,w);this.effTangentialMass1=1/(a+c.dot(b,e.inverseInertia.vectorMultiply(b,m))+c.dot(d,g.inverseInertia.vectorMultiply(d,m)));h=c.cross(h,f,t);f=c.cross(n,f,w);this.effTangentialMass2=1/(a+c.dot(h,e.inverseInertia.vectorMultiply(h,m))+c.dot(f,g.inverseInertia.vectorMultiply(f,m)));this.restitution=Math.min(e.restitution,g.restitution);this.friction=e.friction*g.friction};
d.prototype.update=function(a){var b=this.data,d=this.bodyA,f=this.bodyB,e=b.localContactB,g=b.normal,h=c.add(d.velocity,c.cross(d.angularVelocity,b.localContactA,A),u),e=c.add(f.velocity,c.cross(f.angularVelocity,e,A),n).subtract(h),g=c.dot(e,g),e=20>Math.abs(g)?0:this.restitution;this.velocityBias=-.15*Math.max(b.penetration-1.5,0)/a;this.velocityBias+=e*g;a=this.impulse.scale(.25);b=this.angImpulseA.scale(.25);g=this.angImpulseB.scale(.25);f.applyImpulse(a);f.applyAngularImpulse(g);a.invert();
d.applyImpulse(a);d.applyAngularImpulse(b);this.tangentImpulse2=this.tangentImpulse1=this.normalImpulse=0;a.clear();b.clear();g.clear()};d.prototype.resolve=function(){var a=this.data,b=this.bodyA,d=this.bodyB,f=a.localContactA,e=a.localContactB,g=a.normal,h=this.tangent1,l=this.tangent2,a=c.add(b.velocity,c.cross(b.angularVelocity,f,A),u),r=c.add(d.velocity,c.cross(d.angularVelocity,e,A),n).subtract(a),k=-(c.dot(r,g)+this.velocityBias)*this.effNormalMass,a=Math.max(this.normalImpulse+k,0),k=a-this.normalImpulse,
t=this.friction*a,w=-c.dot(r,h)*this.effTangentialMass1,R;R=this.tangentImpulse1+w;w=-t;R=R<w?w:R>t?t:R;var w=R-this.tangentImpulse1,r=-c.dot(r,l)*this.effTangentialMass2,r=this.tangentImpulse2+r,V=-t,t=r<V?V:r>t?t:r,r=t-this.tangentImpulse2,g=c.scale(g,k,D),h=c.scale(h,w,x),l=c.scale(l,r,z);g.add(h).add(l);e=c.cross(e,g,m);f=c.cross(f,g,p).invert();d.applyImpulse(g);d.applyAngularImpulse(e);g.invert();b.applyImpulse(g);b.applyAngularImpulse(f);this.normalImpulse=a;this.tangentImpulse1=R;this.tangentImpulse2=
t;this.impulse.add(g);this.angImpulseA.add(f);this.angImpulseB.add(e)};k.exports=b},{"../../../math/Vec3":35,"../../../utilities/ObjectManager":75}],55:[function(e,k,v){function b(a,b,d){this.vertex=a;this.worldVertexA=b;this.worldVertexB=d}function a(a){var b=a.vertices,d;for(d=b.length;d--;){var c=b.pop();null!==c&&r(c)}a.numVertices=0;b=a.features;for(d=b.length;d--;)c=b.pop(),null!==c&&m(c);a.numFeatures=0;l(a)}function d(a,b,d){var f=c.scale(d,-1,w);a=c.add(a.support(d),a.position,new c);b=c.add(b.support(f),
b.position,new c);return h().reset(c.subtract(a,b,new c),a,b)}var c=e("../../../math/Vec3"),f=e("../../../utilities/ObjectManager");f.register("GJK_EPASupportPoint",b);var h=f.requestGJK_EPASupportPoint,g=f.requestDynamicGeometry,r=f.freeGJK_EPASupportPoint,l=f.freeDynamicGeometry,m=f.freeDynamicGeometryFeature,p=new c,u=new c,n=new c,A=new c,t=new c,w=new c;b.prototype.reset=function(a,b,d){this.vertex=a;this.worldVertexA=b;this.worldVertexB=d;return this};k.exports.gjk=function(b,f){var e=c.subtract(f.position,
b.position,t).normalize(),h=g();h.addVertex(d(b,f,e));e.invert();for(var m=0;1E3>m++&&(0!==e.x||0!==e.y||0!==e.z);){h.addVertex(d(b,f,e));if(0>c.dot(h.getLastVertex().vertex,e))break;if(h.simplexContainsOrigin(e,r))return h}a(h);return!1};k.exports.epa=function(b,e,g){for(var h=Infinity,m=0;1E3>m++;){var l=g.getFeatureClosestToOrigin();if(null===l)return null;var k=l.normal,t=d(b,e,k),h=Math.min(h,c.dot(t.vertex,k));if(.01>=h-l.distance){var h=g.vertices[l.vertexIndices[0]],m=g.vertices[l.vertexIndices[1]],
w=g.vertices[l.vertexIndices[2]],v=h.vertex,P=m.vertex,K=w.vertex,F=c.scale(k,l.distance,p),P=c.subtract(P,v,u),K=c.subtract(K,v,n),G=c.subtract(F,v,A),v=c.dot(P,P),F=c.dot(P,K),C=c.dot(K,K),P=c.dot(G,P),G=c.dot(G,K),q=v*C-F*F,K=(C*P-F*G)/q,F=(v*G-F*P)/q,P=1-K-F,v=h.worldVertexA.scale(P).add(m.worldVertexA.scale(K)).add(w.worldVertexA.scale(F)),h=h.worldVertexB.scale(P).add(m.worldVertexB.scale(K)).add(w.worldVertexB.scale(F));b=c.subtract(v,b.position,new c);e=c.subtract(h,e.position,new c);a(g);
r(t);return f.requestCollisionData().reset(l.distance,k,v,h,b,e)}g.addVertex(t);g.reshape()}throw Error("EPA failed to terminate in allotted iterations.");}},{"../../../math/Vec3":35,"../../../utilities/ObjectManager":75}],56:[function(e,k,v){function b(a){this._sweepVolumes=[];this._entityRegistry={};this._boundingVolumeRegistry={};this.endpoints={x:[],y:[],z:[]};this.overlaps=[];this.overlapsMatrix={};this._IDPool=[];a=a||[];for(var b=0;b<a.length;b++)this.add(a[b])}function a(a){this._boundingVolume=
a;this._ID=a._ID;this.points={x:[{_ID:a._ID,side:0,value:null},{_ID:a._ID,side:1,value:null}],y:[{_ID:a._ID,side:0,value:null},{_ID:a._ID,side:1,value:null}],z:[{_ID:a._ID,side:0,value:null},{_ID:a._ID,side:1,value:null}]};this.update()}var d=e("./AABB"),c=["x","y","z"];b.prototype.add=function(b){var e=new d(b),g=new a(e);this._entityRegistry[b._ID]=b;this._boundingVolumeRegistry[b._ID]=e;this._sweepVolumes.push(g);for(b=0;3>b;b++)e=c[b],this.endpoints[e].push(g.points[e][0]),this.endpoints[e].push(g.points[e][1])};
b.prototype.remove=function(a){this._entityRegistry[a._ID]=null;this._boundingVolumeRegistry[a._ID]=null;var b,d,c;b=0;for(d=this._sweepVolumes.length;b<d;b++)if(this._sweepVolumes[b]._ID===a._ID){c=b;break}this._sweepVolumes.splice(c,1);c=this.endpoints;var e,m=[];b=0;for(d=c.x.length;b<d;b++)e=c.x[b],e._ID!==a._ID&&m.push(e);var p=[];b=0;for(d=c.y.length;b<d;b++)e=c.y[b],e._ID!==a._ID&&p.push(e);var u=[];b=0;for(d=c.z.length;b<d;b++)e=c.z[b],e._ID!==a._ID&&u.push(e);c.x=m;c.y=p;c.z=u};b.prototype.update=
function(){var a=this._sweepVolumes,b=this._entityRegistry,e=this._boundingVolumeRegistry,k,l,m;k=0;for(m=a.length;k<m;k++)a[k].update();var p=this.endpoints,u=this.overlaps,n=this.overlapsMatrix,A=this._IDPool;for(l=0;3>l;l++){var t=p[c[l]];k=1;for(m=t.length;k<m;k++){for(var w=t[k],v=w.value,x,z,y,B,L,O,a=k-1;0<=a&&(x=t[a]).value>v;)y=w._ID,O=x._ID,y<O?(B=y,L=O):(B=O,L=y),~w.side&x.side?d.checkOverlap(e[y],e[O])&&(z=n[B]=n[B]||{},y=z[L]=A.length?A.pop():u.length,u[y]=[b[B],b[L]]):w.side&~x.side&&
(z=n[B])&&null!=z[L]&&(y=z[L],u[y]=null,z[L]=null,A.push(y)),t[a+1]=x,a--;t[a+1]=w}}return u};a.prototype.update=function(){var a=this._boundingVolume;a.update();for(var b=this.points,d=0;3>d;d++){var e=c[d];b[e][0].value=a.vertices[e][0];b[e][1].value=a.vertices[e][1]}};k.exports=b},{"./AABB":52}],57:[function(e,k,v){function b(b,d){a.call(this,b,d)}var a=e("./Force"),d=e("../../math/Vec3"),c=new d;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.QUADRATIC=function(a){return a*
a};b.LINEAR=function(a){return a};b.prototype.init=function(){this.max=this.max||Infinity;this.strength=this.strength||1;this.type=this.type||b.LINEAR};b.prototype.update=function(){for(var a=this.targets,b=this.type,e=this.max,k=this.strength,l=0,m=a.length;l<m;l++){var p=a[l],u=p.velocity,n=u.length(),A=n?1/n:0,n=-k*b(n);d.scale(u,(n<-e?-e:n)*A,c);p.applyForce(c)}};k.exports=b},{"../../math/Vec3":35,"./Force":58}],58:[function(e,k,v){function b(b,c){this.targets=b?b instanceof Array?b:[b]:[];c=
c||{};this.setOptions(c);this._ID=a++}var a=0;b.prototype.setOptions=function(a){for(var b in a)this[b]=a[b];this.init(a)};b.prototype.addTarget=function(a){this.targets.push(a)};b.prototype.removeTarget=function(a){a=this.targets.indexOf(a);0>a||this.targets.splice(a,1)};b.prototype.init=function(a){};b.prototype.update=function(a,b){};k.exports=b},{}],59:[function(e,k,v){function b(b,d){a.call(this,b,d)}var a=e("./Force"),d=e("../../math/Vec3"),c=new d;b.prototype=Object.create(a.prototype);b.prototype.constructor=
b;b.DOWN=0;b.UP=1;b.LEFT=2;b.RIGHT=3;b.FORWARD=4;b.BACKWARD=5;b.prototype.init=function(a){this.max=this.max||Infinity;if(a.acceleration)this.strength=this.acceleration.length(),this.direction=-1;else{a=this.acceleration=new d;var c=this.direction=this.direction||b.DOWN,e=this.strength=this.strength||200;switch(c){case b.DOWN:a.set(0,e,0);break;case b.UP:a.set(0,-1*e,0);break;case b.LEFT:a.set(-1*e,0,0);break;case b.RIGHT:a.set(e,0,0);break;case b.FORWARD:a.set(0,0,-1*e);break;case b.BACKWARD:a.set(0,
0,e)}}};b.prototype.update=function(){for(var a=this.targets,b=this.max,e=this.acceleration,k=e.length(),l=k?1/k:0,m=0,p=a.length;m<p;m++){var u=a[m],n=k*u.mass;d.scale(e,(n>b?b:n)*l,c);u.applyForce(c)}};k.exports=b},{"../../math/Vec3":35,"./Force":58}],60:[function(e,k,v){function b(b,d,c){this.source=b||null;a.call(this,d,c)}var a=e("./Force"),d=e("../../math/Vec3"),c=new d;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.init=function(){this.max=this.max||Infinity;this.strength=
this.strength||200};b.prototype.update=function(){for(var a=this.source,b=this.targets,e=this.strength,k=this.max,l=this.anchor||a.position,m=this.anchor?1:a.mass,p=0,u=b.length;p<u;p++){var n=b[p];if(null==n)p++;else{d.subtract(l,n.position,c);var A=c.length(),A=A?1/A:0,t=e*m*n.mass*A*A,t=0>t?t<-k?-k:t:t>k?k:t;c.scale(t*A);n.applyForce(c);a&&a.applyForce(c.invert())}}};k.exports=b},{"../../math/Vec3":35,"./Force":58}],61:[function(e,k,v){function b(b,d){a.call(this,b,d)}var a=e("./Force"),d=e("../../math/Vec3"),
c=new d;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.QUADRATIC=function(a){return a.length()};b.LINEAR=function(){return 1};b.prototype.init=function(){this.max=this.max||Infinity;this.strength=this.strength||1;this.type=this.type||b.LINEAR};b.prototype.update=function(){for(var a=this.targets,b=this.type,e=this.max,k=this.strength,l=0,m=a.length;l<m;l++){var p=a[l],u=p.angularVelocity,n=-k*b(u);d.scale(u,n<-e?-e:n,c);p.applyTorque(c)}};k.exports=b},{"../../math/Vec3":35,"./Force":58}],
62:[function(e,k,v){function b(b,d,c){this.source=b||null;a.call(this,d,c)}var a=e("./Force"),d=e("../../math/Vec3"),c=e("../../math/Mat33"),f=e("../../math/Quaternion"),h=new f,g=new d,r=new d,l=new c,m=Math.PI;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.init=function(a){this.source||(this.anchor=this.anchor?this.anchor.normalize():new f(1,0,0,0));if(a.stiffness||a.damping)this.stiffness=this.stiffness||100,this.damping=this.damping||0,this.dampingRatio=this.period=
null;else if(a.period||a.dampingRatio)this.period=this.period||1,this.dampingRatio=this.dampingRatio||0,this.stiffness=2*m/this.period,this.stiffness*=this.stiffness,this.damping=4*m*this.dampingRatio/this.period};b.prototype.update=function(){for(var a=this.source,b=this.targets,e=this.max,m=this.stiffness,k=this.damping,w=this.anchor||a.orientation,v=this.anchor?null:a.inverseInertia,x=0,z=b.length;x<z;x++){var y=b[x];f.conjugate(y.orientation,h);h.multiply(w);if(!(1<=h.w)){var B=Math.acos(h.w),
L=Math.sqrt(1-h.w*h.w),B=r.copy(h).scale(2*B/L);B.scale(m);null!==v?c.add(v,y.inverseInertia,l).inverse():c.inverse(y.inverseInertia,l);0!==k&&(a?B.add(d.subtract(y.angularVelocity,a.angularVelocity,g).scale(-k)):B.add(d.scale(y.angularVelocity,-k,g)));B=B.applyMatrix(l);L=B.length();L>e&&B.scale(e/L);y.applyTorque(B);a&&a.applyTorque(B.invert())}}};k.exports=b},{"../../math/Mat33":32,"../../math/Quaternion":33,"../../math/Vec3":35,"./Force":58}],63:[function(e,k,v){function b(b,d,c){this.source=
b||null;a.call(this,d,c)}var a=e("./Force"),d=e("../../math/Vec3"),c=new d,f=new d;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;var h=Math.PI;b.FENE=function(a,b){var d=.99*b,d=Math.max(Math.min(a,d),-d);return d/(1-d*d/(b*b))};b.HOOKE=function(a){return a};b.prototype.init=function(a){this.max=this.max||Infinity;this.length=this.length||0;this.type=this.type||b.HOOKE;this.maxLength=this.maxLength||Infinity;if(a.stiffness||a.damping)this.stiffness=this.stiffness||100,this.damping=
this.damping||0,this.dampingRatio=this.period=null;else if(a.period||a.dampingRatio)this.period=this.period||1,this.dampingRatio=this.dampingRatio||0,this.stiffness=2*h/this.period,this.stiffness*=this.stiffness,this.damping=4*h*this.dampingRatio/this.period};b.prototype.update=function(){for(var a=this.source,b=this.targets,e=this.max,h=this.stiffness,p=this.damping,k=this.length,n=this.maxLength,A=this.anchor||a.position,t=this.anchor?0:a.inverseMass,w=this.type,v=0,x=b.length;v<x;v++){var z=b[v];
d.subtract(A,z.position,c);var y=c.length()-k;if(!(1E-6>Math.abs(y))){var B=1/(z.inverseMass+t);null!==this.period&&(h*=B,p*=B);c.scale(h*w(y,n)/y);0!==p&&(a?c.add(d.subtract(z.velocity,a.velocity,f).scale(-p)):c.add(d.scale(z.velocity,-p,f)));y=c.length();d.scale(c,(y>e?e:y)*(y?1/y:0),c);z.applyForce(c);a&&a.applyForce(c.invert())}}};k.exports=b},{"../../math/Vec3":35,"./Force":58}],64:[function(e,k,v){k.exports={Particle:e("./bodies/Particle"),convexBodyFactory:e("./bodies/convexBodyFactory"),Box:e("./bodies/Box"),
Sphere:e("./bodies/Sphere"),Wall:e("./bodies/Wall"),Constraint:e("./constraints/Constraint"),Angle:e("./constraints/Angle"),Collision:e("./constraints/Collision"),Direction:e("./constraints/Direction"),Distance:e("./constraints/Distance"),Curve:e("./constraints/Curve"),Hinge:e("./constraints/Hinge"),BallAndSocket:e("./constraints/BallAndSocket"),Force:e("./forces/Force"),Drag:e("./forces/Drag"),RotationalDrag:e("./forces/RotationalDrag"),Gravity1D:e("./forces/Gravity1D"),Gravity3D:e("./forces/Gravity3D"),
Spring:e("./forces/Spring"),RotationalSpring:e("./forces/RotationalSpring"),PhysicsEngine:e("./PhysicsEngine"),Geometry:e("./Geometry")}},{"./Geometry":37,"./PhysicsEngine":38,"./bodies/Box":39,"./bodies/Particle":40,"./bodies/Sphere":41,"./bodies/Wall":42,"./bodies/convexBodyFactory":43,"./constraints/Angle":44,"./constraints/BallAndSocket":45,"./constraints/Collision":46,"./constraints/Constraint":47,"./constraints/Curve":48,"./constraints/Direction":49,"./constraints/Distance":50,"./constraints/Hinge":51,
"./forces/Drag":57,"./forces/Force":58,"./forces/Gravity1D":59,"./forces/Gravity3D":60,"./forces/RotationalDrag":61,"./forces/RotationalSpring":62,"./forces/Spring":63}],65:[function(e,k,v){var b=0;e=["ms","moz","webkit","o"];var a,d;if("object"===typeof window){a=window.requestAnimationFrame;d=window.cancelAnimationFrame||window.cancelRequestAnimationFrame;for(v=0;v<e.length&&!a;++v)a=window[e[v]+"RequestAnimationFrame"],d=window[e[v]+"CancelRequestAnimationFrame"]||window[e[v]+"CancelAnimationFrame"];
a&&!d&&(a=null)}if(!a){var c=Date.now?Date.now:function(){return(new Date).getTime()};a=function(a){var d=c(),e=Math.max(0,16-(d-b)),k=setTimeout(function(){a(d+e)},e);b=d+e;return k};d=function(a){clearTimeout(a)}}k.exports={requestAnimationFrame:a,cancelAnimationFrame:d}},{}],66:[function(e,k,v){k.exports={requestAnimationFrame:e("./animationFrame").requestAnimationFrame,cancelAnimationFrame:e("./animationFrame").cancelAnimationFrame}},{"./animationFrame":65}],67:[function(e,k,v){function b(){var a=
this;this._updates=[];this._looper=function(b){a.loop(b)};this._sleep=this._stoppedAt=this._time=0;this._startOnVisibilityChange=!0;this._rAF=null;this._sleepDiff=!0;this.start();c&&document.addEventListener(h,function(){a._onVisibilityChange()})}e=e("../polyfills");var a=e.requestAnimationFrame,d=e.cancelAnimationFrame,c="undefined"!==typeof document;if(c){var f,h;"undefined"!==typeof document.hidden?(f="hidden",h="visibilitychange"):"undefined"!==typeof document.mozHidden?(f="mozHidden",h="mozvisibilitychange"):
"undefined"!==typeof document.msHidden?(f="msHidden",h="msvisibilitychange"):"undefined"!==typeof document.webkitHidden&&(f="webkitHidden",h="webkitvisibilitychange")}b.prototype._onVisibilityChange=function(){document[f]?this._onUnfocus():this._onFocus()};b.prototype._onFocus=function(){this._startOnVisibilityChange&&this._start()};b.prototype._onUnfocus=function(){this._stop()};b.prototype.start=function(){this._running||(this._startOnVisibilityChange=!0,this._start());return this};b.prototype._start=
function(){this._sleepDiff=this._running=!0;this._rAF=a(this._looper)};b.prototype.stop=function(){this._running&&(this._startOnVisibilityChange=!1,this._stop());return this};b.prototype._stop=function(){this._running=!1;this._stoppedAt=this._time;d(this._rAF)};b.prototype.isRunning=function(){return this._running};b.prototype.step=function(a){this._time=a;this._sleepDiff&&(this._sleep+=a-this._stoppedAt,this._sleepDiff=!1);a-=this._sleep;for(var b=0,d=this._updates.length;b<d;b++)this._updates[b].update(a);
return this};b.prototype.loop=function(b){this.step(b);this._rAF=a(this._looper);return this};b.prototype.update=function(a){-1===this._updates.indexOf(a)&&this._updates.push(a);return this};b.prototype.noLongerUpdate=function(a){a=this._updates.indexOf(a);-1<a&&this._updates.splice(a,1);return this};k.exports=b},{"../polyfills":66}],68:[function(e,k,v){function b(){d();this._contexts={};this._outCommands=[];this._inCommands=[];this._time=null;this._resized=!1;var a=this;window.addEventListener("resize",
function(){a.onResize()})}var a=e("./Context"),d=e("./inject-css"),c=e("../core/Commands");b.prototype.onResize=function(){this._resized=!0;for(var a in this._contexts)this._contexts[a].updateSize()};b.prototype.getTime=function(){return this._time};b.prototype.sendEvent=function(a,b,d){this._outCommands.push(c.WITH,a,c.TRIGGER,b,d)};b.prototype.sendResize=function(a,b){this.sendEvent(a,"CONTEXT_RESIZE",b)};b.prototype.handleWith=function(a,b){var d=b[a],c=d.split("/");return this.getOrSetContext(c.shift()).receive(d,
b,a)};b.prototype.getOrSetContext=function(b){if(this._contexts[b])return this._contexts[b];var d=new a(b,this);return this._contexts[b]=d};b.prototype.getContext=function(a){if(this._contexts[a])return this._contexts[a]};b.prototype.drawCommands=function(){for(var a=this._inCommands,b=0,d=a[b];d;){switch(d){case c.TIME:this._time=a[++b];break;case c.WITH:b=this.handleWith(++b,a);break;case c.NEED_SIZE_FOR:this.giveSizeFor(++b,a)}d=a[++b]}for(var e in this._contexts)this._contexts[e].draw();this._resized&&
this.updateSize();return this._outCommands};b.prototype.updateSize=function(){for(var a in this._contexts)this._contexts[a].updateSize()};b.prototype.receiveCommands=function(a){for(var b=a.length,d=0;d<b;d++)this._inCommands.push(a[d]);for(var c in this._contexts)this._contexts[c].checkInit()};b.prototype.giveSizeFor=function(a,b){var d=b[a],c=this.getOrSetContext(d).getRootSize();this.sendResize(d,c)};b.prototype.clearCommands=function(){this._inCommands.length=0;this._outCommands.length=0;this._resized=
!1};k.exports=b},{"../core/Commands":5,"./Context":69,"./inject-css":71}],69:[function(e,k,v){function b(a,b){this._compositor=b;this._rootEl=document.querySelector(a);this._selector=a;if(null===this._rootEl)throw Error('Failed to create Context: No matches for "'+a+'" found.');this._selector=a;this._initDOMRenderer();this._webGLRenderer=null;this._domRenderer=new C(this._domRendererRootEl,a,b);this._canvasEl=null;this._renderState={projectionType:G.ORTHOGRAPHIC_PROJECTION,perspectiveTransform:new Float32Array([1,
0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),viewTransform:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),viewDirty:!1,perspectiveDirty:!1};this._size=[];this._meshTransform=new Float32Array(16);this._meshSize=[0,0,0];this._initDOM=!1;this._commandCallbacks=[];this.initCommandCallbacks();this.updateSize()}function a(a,b,d,c){a._webGLRenderer&&a._webGLRenderer.getOrSetCutout(b);a._domRenderer.preventDefault(d[++c]);return c}function d(a,b,d,c){a._webGLRenderer&&a._webGLRenderer.getOrSetCutout(b);a._domRenderer.allowDefault(d[++c]);
return c}function c(a,b,d,c){a._initDOM=!0;return c}function f(a,b,d,c){a._domRenderer.insertEl(d[++c]);return c}function h(a,b,d,c){a._domRenderer.getSizeOf(d[++c]);return c}function g(a,b,d,c){var f=a._meshTransform;f[0]=d[++c];f[1]=d[++c];f[2]=d[++c];f[3]=d[++c];f[4]=d[++c];f[5]=d[++c];f[6]=d[++c];f[7]=d[++c];f[8]=d[++c];f[9]=d[++c];f[10]=d[++c];f[11]=d[++c];f[12]=d[++c];f[13]=d[++c];f[14]=d[++c];f[15]=d[++c];a._domRenderer.setMatrix(f);a._webGLRenderer&&a._webGLRenderer.setCutoutUniform(b,"u_transform",
f);return c}function r(a,b,d,c){var f=d[++c];d=d[++c];a._domRenderer.setSize(f,d);a._webGLRenderer&&(a._meshSize[0]=f,a._meshSize[1]=d,a._webGLRenderer.setCutoutUniform(b,"u_size",a._meshSize));return c}function l(a,b,d,c){a._webGLRenderer&&a._webGLRenderer.getOrSetCutout(b);a._domRenderer.setProperty(d[++c],d[++c]);return c}function m(a,b,d,c){a._webGLRenderer&&a._webGLRenderer.getOrSetCutout(b);a._domRenderer.setContent(d[++c]);return c}function p(a,b,d,c){a._webGLRenderer&&a._webGLRenderer.getOrSetCutout(b);
a._domRenderer.setAttribute(d[++c],d[++c]);return c}function u(a,b,d,c){a._webGLRenderer&&a._webGLRenderer.getOrSetCutout(b);a._domRenderer.addClass(d[++c]);return c}function n(a,b,d,c){a._webGLRenderer&&a._webGLRenderer.getOrSetCutout(b);a._domRenderer.removeClass(d[++c]);return c}function A(a,b,d,c){a._webGLRenderer&&a._webGLRenderer.getOrSetCutout(b);a._domRenderer.subscribe(d[++c]);return c}function t(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.setMeshOptions(b,d[++c]);
return c}function w(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.setAmbientLightColor(b,d[++c],d[++c],d[++c]);return c}function D(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.setLightPosition(b,d[++c],d[++c],d[++c]);return c}function x(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.setLightColor(b,d[++c],d[++c],d[++c]);return c}function z(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.handleMaterialInput(b,d[++c],
d[++c]);return c}function y(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.setGeometry(b,d[++c],d[++c],d[++c]);return c}function B(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.setMeshUniform(b,d[++c],d[++c]);return c}function L(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.bufferData(b,d[++c],d[++c],d[++c],d[++c],d[++c]);return c}function O(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.setCutoutState(b,d[++c]);return c}
function J(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.setMeshVisibility(b,d[++c]);return c}function E(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.removeMesh(b);return c}function M(a,b,d,c){a._renderState.projectionType=G.PINHOLE_PROJECTION;a._renderState.perspectiveTransform[11]=-1/d[++c];a._renderState.perspectiveDirty=!0;return c}function P(a,b,d,c){a._renderState.projectionType=G.ORTHOGRAPHIC_PROJECTION;a._renderState.perspectiveTransform[11]=0;a._renderState.perspectiveDirty=
!0;return c}function K(a,b,d,c){a._renderState.viewTransform[0]=d[++c];a._renderState.viewTransform[1]=d[++c];a._renderState.viewTransform[2]=d[++c];a._renderState.viewTransform[3]=d[++c];a._renderState.viewTransform[4]=d[++c];a._renderState.viewTransform[5]=d[++c];a._renderState.viewTransform[6]=d[++c];a._renderState.viewTransform[7]=d[++c];a._renderState.viewTransform[8]=d[++c];a._renderState.viewTransform[9]=d[++c];a._renderState.viewTransform[10]=d[++c];a._renderState.viewTransform[11]=d[++c];
a._renderState.viewTransform[12]=d[++c];a._renderState.viewTransform[13]=d[++c];a._renderState.viewTransform[14]=d[++c];a._renderState.viewTransform[15]=d[++c];a._renderState.viewDirty=!0;return c}var F=e("../webgl-renderers/WebGLRenderer"),G=e("../components/Camera"),C=e("../dom-renderers/DOMRenderer"),q=e("../core/Commands");b.prototype.updateSize=function(){var a=this._rootEl.offsetWidth,b=this._rootEl.offsetHeight;this._size[0]=a;this._size[1]=b;this._size[2]=a>b?a:b;this._compositor.sendResize(this._selector,
this._size);this._webGLRenderer&&this._webGLRenderer.updateSize(this._size);return this};b.prototype.draw=function(){this._domRenderer.draw(this._renderState);this._webGLRenderer&&this._webGLRenderer.draw(this._renderState);this._renderState.perspectiveDirty&&(this._renderState.perspectiveDirty=!1);this._renderState.viewDirty&&(this._renderState.viewDirty=!1)};b.prototype._initDOMRenderer=function(){this._domRendererRootEl=document.createElement("div");this._rootEl.appendChild(this._domRendererRootEl);
this._domRendererRootEl.style.display="none";this._domRenderer=new C(this._domRendererRootEl,this._selector,this._compositor)};b.prototype.getRootSize=function(){return[this._rootEl.offsetWidth,this._rootEl.offsetHeight]};b.prototype.initCommandCallbacks=function(){this._commandCallbacks[q.INIT_DOM]=f;this._commandCallbacks[q.DOM_RENDER_SIZE]=h;this._commandCallbacks[q.CHANGE_TRANSFORM]=g;this._commandCallbacks[q.CHANGE_SIZE]=r;this._commandCallbacks[q.CHANGE_PROPERTY]=l;this._commandCallbacks[q.CHANGE_CONTENT]=
m;this._commandCallbacks[q.CHANGE_ATTRIBUTE]=p;this._commandCallbacks[q.ADD_CLASS]=u;this._commandCallbacks[q.REMOVE_CLASS]=n;this._commandCallbacks[q.SUBSCRIBE]=A;this._commandCallbacks[q.GL_SET_DRAW_OPTIONS]=t;this._commandCallbacks[q.GL_AMBIENT_LIGHT]=w;this._commandCallbacks[q.GL_LIGHT_POSITION]=D;this._commandCallbacks[q.GL_LIGHT_COLOR]=x;this._commandCallbacks[q.MATERIAL_INPUT]=z;this._commandCallbacks[q.GL_SET_GEOMETRY]=y;this._commandCallbacks[q.GL_UNIFORMS]=B;this._commandCallbacks[q.GL_BUFFER_DATA]=
L;this._commandCallbacks[q.GL_CUTOUT_STATE]=O;this._commandCallbacks[q.GL_MESH_VISIBILITY]=J;this._commandCallbacks[q.GL_REMOVE_MESH]=E;this._commandCallbacks[q.PINHOLE_PROJECTION]=M;this._commandCallbacks[q.ORTHOGRAPHIC_PROJECTION]=P;this._commandCallbacks[q.CHANGE_VIEW_TRANSFORM]=K;this._commandCallbacks[q.PREVENT_DEFAULT]=a;this._commandCallbacks[q.ALLOW_DEFAULT]=d;this._commandCallbacks[q.READY]=c};b.prototype._initWebGLRenderer=function(){this._webGLRendererRootEl=document.createElement("canvas");
this._rootEl.appendChild(this._webGLRendererRootEl);this._webGLRenderer=new F(this._webGLRendererRootEl,this._compositor);this._webGLRenderer.updateSize(this._size)};b.prototype.getRootSize=function(){return[this._rootEl.offsetWidth,this._rootEl.offsetHeight]};b.prototype.checkInit=function(){this._initDOM&&(this._domRendererRootEl.style.display="block",this._initDOM=!1)};b.prototype.receive=function(a,b,d){var c=b[++d];this._domRenderer.loadPath(a);for(this._domRenderer.findTarget();null!=c;){if(c===
q.WITH||c===q.TIME)return d-1;d=this._commandCallbacks[c](this,a,b,d)+1;c=b[d]}return d};b.prototype.getDOMRenderer=function(){return this._domRenderer};b.prototype.getWebGLRenderer=function(){return this._webGLRenderer};k.exports=b},{"../components/Camera":1,"../core/Commands":5,"../dom-renderers/DOMRenderer":18,"../webgl-renderers/WebGLRenderer":85}],70:[function(e,k,v){function b(b,c,f){this._thread=b;this._compositor=c;this._renderLoop=f;this._renderLoop.update(this);var e=this;this._thread.onmessage=
function(b){b=b.data?b.data:b;if(b[0]===a.ENGINE)switch(b[1]){case a.START:e._engine.start();break;case a.STOP:e._engine.stop();break;default:console.error('Unknown ENGINE command "'+b[1]+'"')}else e._compositor.receiveCommands(b)};this._thread.onerror=function(a){console.error(a)}}var a=e("../core/Commands");b.prototype.getThread=function(){return this._thread};b.prototype.getCompositor=function(){return this._compositor};b.prototype.getEngine=function(){return this._renderLoop};b.prototype.getRenderLoop=
function(){return this._renderLoop};b.prototype.update=function(b){this._thread.postMessage([a.FRAME,b]);b=this._compositor.drawCommands();this._thread.postMessage(b);this._compositor.clearCommands()};k.exports=b},{"../core/Commands":5}],71:[function(e,k,v){var b="undefined"===typeof document;k.exports=function(){if(!b)if(b=!0,document.createStyleSheet)document.createStyleSheet().cssText=".famous-dom-renderer {width:100%;height:100%;transform-style:preserve-3d;-webkit-transform-style:preserve-3d;}.famous-dom-element {-webkit-transform-origin:0% 0%;transform-origin:0% 0%;-webkit-backface-visibility:visible;backface-visibility:visible;-webkit-transform-style:preserve-3d;transform-style:preserve-3d;-webkit-tap-highlight-color:transparent;pointer-events:auto;z-index:1;}.famous-dom-element-content,.famous-dom-element {position:absolute;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;}.famous-webgl-renderer {-webkit-transform:translateZ(1000000px);transform:translateZ(1000000px);pointer-events:none;position:absolute;z-index:1;top:0;width:100%;height:100%;}";
else{var a=document.getElementsByTagName("head")[0],d=document.createElement("style");d.styleSheet?d.styleSheet.cssText=".famous-dom-renderer {width:100%;height:100%;transform-style:preserve-3d;-webkit-transform-style:preserve-3d;}.famous-dom-element {-webkit-transform-origin:0% 0%;transform-origin:0% 0%;-webkit-backface-visibility:visible;backface-visibility:visible;-webkit-transform-style:preserve-3d;transform-style:preserve-3d;-webkit-tap-highlight-color:transparent;pointer-events:auto;z-index:1;}.famous-dom-element-content,.famous-dom-element {position:absolute;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;}.famous-webgl-renderer {-webkit-transform:translateZ(1000000px);transform:translateZ(1000000px);pointer-events:none;position:absolute;z-index:1;top:0;width:100%;height:100%;}":
d.appendChild(document.createTextNode(".famous-dom-renderer {width:100%;height:100%;transform-style:preserve-3d;-webkit-transform-style:preserve-3d;}.famous-dom-element {-webkit-transform-origin:0% 0%;transform-origin:0% 0%;-webkit-backface-visibility:visible;backface-visibility:visible;-webkit-transform-style:preserve-3d;transform-style:preserve-3d;-webkit-tap-highlight-color:transparent;pointer-events:auto;z-index:1;}.famous-dom-element-content,.famous-dom-element {position:absolute;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;}.famous-webgl-renderer {-webkit-transform:translateZ(1000000px);transform:translateZ(1000000px);pointer-events:none;position:absolute;z-index:1;top:0;width:100%;height:100%;}"));
(a?a:document.documentElement).appendChild(d)}}},{}],72:[function(e,k,v){var b={linear:function(a){return a},easeIn:function(a){return a*a},easeOut:function(a){return a*(2-a)},easeInOut:function(a){return.5>=a?2*a*a:-2*a*a+4*a-1},easeOutBounce:function(a){return a*(3-2*a)},spring:function(a){return(1-a)*Math.sin(6*Math.PI*a)+a},inQuad:function(a){return a*a},outQuad:function(a){return- --a*a+1},inOutQuad:function(a){return 1>(a/=.5)?.5*a*a:-.5*(--a*(a-2)-1)},inCubic:function(a){return a*a*a},outCubic:function(a){return--a*
a*a+1},inOutCubic:function(a){return 1>(a/=.5)?.5*a*a*a:.5*((a-=2)*a*a+2)},inQuart:function(a){return a*a*a*a},outQuart:function(a){return-(--a*a*a*a-1)},inOutQuart:function(a){return 1>(a/=.5)?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)},inQuint:function(a){return a*a*a*a*a},outQuint:function(a){return--a*a*a*a*a+1},inOutQuint:function(a){return 1>(a/=.5)?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)},inSine:function(a){return-1*Math.cos(Math.PI/2*a)+1},outSine:function(a){return Math.sin(Math.PI/2*a)},inOutSine:function(a){return-.5*
(Math.cos(Math.PI*a)-1)},inExpo:function(a){return 0===a?0:Math.pow(2,10*(a-1))},outExpo:function(a){return 1===a?1:-Math.pow(2,-10*a)+1},inOutExpo:function(a){return 0===a?0:1===a?1:1>(a/=.5)?.5*Math.pow(2,10*(a-1)):.5*(-Math.pow(2,-10*--a)+2)},inCirc:function(a){return-(Math.sqrt(1-a*a)-1)},outCirc:function(a){return Math.sqrt(1- --a*a)},inOutCirc:function(a){return 1>(a/=.5)?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)},inElastic:function(a){var b=1.70158,c=0;if(0===a)return 0;if(1===
a)return 1;c||(c=.3);b=c/(2*Math.PI)*Math.asin(1);return-(1*Math.pow(2,10*--a)*Math.sin(2*(a-b)*Math.PI/c))},outElastic:function(a){var b=1.70158,c=0;if(0===a)return 0;if(1===a)return 1;c||(c=.3);b=c/(2*Math.PI)*Math.asin(1);return 1*Math.pow(2,-10*a)*Math.sin(2*(a-b)*Math.PI/c)+1},inOutElastic:function(a){var b=1.70158,c=0;if(0===a)return 0;if(2===(a/=.5))return 1;c||(c=.3*1.5);b=c/(2*Math.PI)*Math.asin(1);return 1>a?-.5*Math.pow(2,10*--a)*Math.sin(2*(a-b)*Math.PI/c):1*Math.pow(2,-10*--a)*Math.sin(2*
(a-b)*Math.PI/c)*.5+1},inBack:function(a,b){void 0===b&&(b=1.70158);return a*a*((b+1)*a-b)},outBack:function(a,b){void 0===b&&(b=1.70158);return--a*a*((b+1)*a+b)+1},inOutBack:function(a,b){void 0===b&&(b=1.70158);return 1>(a/=.5)?.5*a*a*(((b*=1.525)+1)*a-b):.5*((a-=2)*a*(((b*=1.525)+1)*a+b)+2)},inBounce:function(a){return 1-b.outBounce(1-a)},outBounce:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},
inOutBounce:function(a){return.5>a?.5*b.inBounce(2*a):.5*b.outBounce(2*a-1)+.5},flat:function(){return 0}};k.exports=b},{}],73:[function(e,k,v){function b(a){this._queue=[];this._pausedAt=this._startedAt=this._state=this._from=null;null!=a&&this.from(a)}var a=e("./Curves");e=e("../core/FamousEngine");b.Clock=e.getClock();b.prototype.to=function(b,c,f,e,g,k){c=null!=c&&c.constructor===String?a[c]:c;0===this._queue.length&&(this._startedAt=this.constructor.Clock.now(),this._pausedAt=null);this._queue.push(b,
null!=c?c:a.linear,null!=f?f:100,e,g,k);return this};b.prototype.from=function(a){this._state=a;this._from=this._sync(null,this._state);this._queue.length=0;this._startedAt=this.constructor.Clock.now();this._pausedAt=null;return this};b.prototype.delay=function(b,c){return this.to(0<this._queue.length?this._queue[this._queue.length-5]:this._state,a.flat,b,c)};b.prototype.override=function(b,c,f,e,g){0<this._queue.length&&(null!=b&&(this._queue[0]=b),null!=c&&(this._queue[1]=c.constructor===String?
a[c]:c),null!=f&&(this._queue[2]=f),null!=e&&(this._queue[3]=e),null!=g&&(this._queue[4]=g));return this};b.prototype._interpolate=function(a,b,f,e,g){if(f instanceof Object)if("slerp"===g){var k,l,m,p,u,n,A,t;g=b[0];k=b[1];l=b[2];b=b[3];m=f[0];p=f[1];u=f[2];f=f[3];if(1===e)return a[0]=m,a[1]=p,a[2]=u,a[3]=f,a;A=b*f+g*m+k*p+l*u;1E-5<1-A?(n=Math.acos(A),t=Math.sin(n),A=Math.sin((1-e)*n)/t,e=Math.sin(e*n)/t):A=1-e;a[0]=g*A+m*e;a[1]=k*A+p*e;a[2]=l*A+u*e;a[3]=b*A+f*e}else if(f instanceof Array)for(k=
0,l=f.length;k<l;k++)a[k]=this._interpolate(a[k],b[k],f[k],e,g);else for(k in f)a[k]=this._interpolate(a[k],b[k],f[k],e,g);else a=b+e*(f-b);return a};b.prototype._sync=function c(a,b){if("number"===typeof b)a=b;else if(b instanceof Array){null==a&&(a=[]);for(var e=0,k=b.length;e<k;e++)a[e]=c(a[e],b[e])}else if(b instanceof Object)for(e in null==a&&(a={}),b)a[e]=c(a[e],b[e]);return a};b.prototype.get=function(a){if(0===this._queue.length)return this._state;a=(a=this._pausedAt?this._pausedAt:a)?a:this.constructor.Clock.now();
a=(a-this._startedAt)/this._queue[2];var b=this._state=this._interpolate(this._state,this._from,this._queue[0],this._queue[1](1<a?1:a),this._queue[4]);if(1<=a){this._startedAt+=this._queue[2];this._from=this._sync(this._from,this._state);this._queue.shift();this._queue.shift();this._queue.shift();var e=this._queue.shift();this._queue.shift();var g=this._queue.shift();e&&g?e(g):e&&!g&&e()}return 1<a?this.get():b};b.prototype.isActive=function(){return 0<this._queue.length};b.prototype.halt=function(){return this.from(this.get())};
b.prototype.pause=function(){this._pausedAt=this.constructor.Clock.now();return this};b.prototype.isPaused=function(){return!!this._pausedAt};b.prototype.resume=function(){var a=this._pausedAt-this._startedAt;this._startedAt=this.constructor.Clock.now()-a;this._pausedAt=null;return this};b.prototype.reset=function(a){return this.from(a)};b.prototype.set=function(a,b,e){null==b?(this.from(a),e&&e()):this.to(a,b.curve,b.duration,e,b.method);return this};k.exports=b},{"../core/FamousEngine":8,"./Curves":72}],
74:[function(e,k,v){function b(){this._events={}}b.prototype.on=function(a,b){this._events[a]||(this._events[a]=[]);var c=this._events[a];c.push(b);return function(){c.splice(c.indexOf(b),1)}};b.prototype.off=function(a,b){var c=this._events[a];c&&c.splice(c.indexOf(b),1);return this};b.prototype.trigger=function(a,b){var c=this._events[a];if(c)for(var f=0,e=c.length;f<e;f++)c[f](b);return this};k.exports=b},{}],75:[function(e,k,v){function b(a,b){return function(){return 0!==a.length?a.pop():new b}}
function a(a){return function(b){a.push(b)}}k.exports={pools:{},register:function(d,c){var f=this.pools[d]=[];this["request"+d]=b(f,c);this["free"+d]=a(f)},disposeOf:function(a){a=this.pools[a];for(var b=a.length;b--;)a.pop()}}},{}],76:[function(e,k,v){k.exports=function a(d){var c;if("object"===typeof d){c=d instanceof Array?[]:{};for(var f in d)if("object"===typeof d[f]&&null!==d[f])if(d[f]instanceof Array){c[f]=Array(d[f].length);for(var e=0;e<d[f].length;e++)c[f][e]=a(d[f][e])}else c[f]=a(d[f]);
else c[f]=d[f]}else c=d;return c}},{}],77:[function(e,k,v){k.exports=function(b){var a=[],d=[],c=0,f;for(f in b)b.hasOwnProperty(f)&&(a[c]=f,d[c]=b[f],c++);return{keys:a,values:d}}},{}],78:[function(e,k,v){var b=["","-ms-","-webkit-","-moz-","-o-"];k.exports=function(a){for(var d=0;d<b.length;d++){var c=b[d]+a;if(""===document.documentElement.style[c])return c}return a}},{}],79:[function(e,k,v){function b(a,b,c){this.buffer=null;this.target=a;this.type=b;this.data=[];this.gl=c}b.prototype.subData=
function(){for(var a=this.gl,b=[],c=0;c<this.data.length;c+=1E4)b=Array.prototype.concat.apply(b,this.data.slice(c,c+1E4));this.buffer=this.buffer||a.createBuffer();a.bindBuffer(this.target,this.buffer);a.bufferData(this.target,new this.type(b),a.STATIC_DRAW)};k.exports=b},{}],80:[function(e,k,v){function b(a){this.gl=a;this.registry={};this._dynamicBuffers=[];this._staticBuffers=[];this._elementBufferMax=this._arrayBufferMax=3E4}var a=e("./Buffer");b.prototype.allocate=function(b,c,f,e,g){b=this.registry[b]||
(this.registry[b]={keys:[],values:[],spacing:[],offset:[],length:[]});var k=b.keys.indexOf(c),l="indices"===c,m=!1,p,u=0,n,A;if(-1===k){k=b.keys.length;n=l?f.length:Math.floor(f.length/e);if(g)A=new a(l?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,l?Uint16Array:Float32Array,this.gl),this._dynamicBuffers.push({buffer:A,offset:f.length,isIndex:l});else{for(g=0;g<this._staticBuffers.length;g++)if(l===this._staticBuffers[g].isIndex&&(p=this._staticBuffers[g].offset+f.length,!l&&p<this._arrayBufferMax||
l&&p<this._elementBufferMax)){A=this._staticBuffers[g].buffer;u=this._staticBuffers[g].offset;this._staticBuffers[g].offset+=f.length;m=!0;break}m||(A=new a(l?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,l?Uint16Array:Float32Array,this.gl),this._staticBuffers.push({buffer:A,offset:f.length,isIndex:l}))}b.keys.push(c);b.values.push(A);b.spacing.push(e);b.offset.push(u);b.length.push(n)}c=f.length;for(g=0;g<c;g++)b.values[k].data[u+g]=f[g];b.values[k].subData()};k.exports=b},{"./Buffer":79}],81:[function(e,
k,v){function b(a,b){return function(){var c=a.apply(this,arguments);b.apply(this,arguments);return c}}k.exports=function(){return b(this.gl.compileShader,function(a){if(!this.getShaderParameter(a,this.COMPILE_STATUS)){var b=this.getShaderInfoLog(a),c=this.getShaderSource(a);a=document.createElement("style");document.getElementsByTagName("head")[0].appendChild(a);a.textContent="body,html{background:#e3e3e3;font-family:monaco,monospace;font-size:14px;line-height:1.7em}#shaderReport{left:0;top:0;right:0;box-sizing:border-box;position:absolute;z-index:1000;color:#222;padding:15px;white-space:normal;list-style-type:none;margin:50px auto;max-width:1200px}#shaderReport li{background-color:#fff;margin:13px 0;box-shadow:0 1px 2px rgba(0,0,0,.15);padding:20px 30px;border-radius:2px;border-left:20px solid #e01111}span{color:#e01111;text-decoration:underline;font-weight:700}#shaderReport li p{padding:0;margin:0}#shaderReport li:nth-child(even){background-color:#f4f4f4}#shaderReport li p:first-child{margin-bottom:10px;color:#666}";
a=document.createElement("ul");a.setAttribute("id","shaderReport");document.body.appendChild(a);for(var f=/ERROR: [\d]+:([\d]+): (.+)/gmi,c=c.split("\n"),e;null!=(e=f.exec(b));){e.index===f.lastIndex&&f.lastIndex++;var g=document.createElement("li"),k='<p><span>ERROR</span> "'+e[2]+'" in line '+e[1]+"</p>",k=k+("<p><b>"+c[e[1]-1].replace(/^[ \t]+/g,"")+"</b></p>");g.innerHTML=k;a.appendChild(g)}}})}},{}],82:[function(e,k,v){function b(a,b){this.gl=a;this.textureSlots=1;this.options=b||{};this.registeredMaterials=
{};this.flaggedUniforms=[];this.cachedUniforms={};this.uniformTypes=[];this.definitionVec4=[];this.definitionVec3=[];this.definitionFloat=[];this.applicationVec3=[];this.applicationVec4=[];this.applicationFloat=[];this.applicationVert=[];this.definitionVert=[];this.resetProgram()}var a=e("../utilities/clone");v=e("../utilities/keyValueToArrays");var d=e("../webgl-shaders").vertex,c=e("../webgl-shaders").fragment,f=e("./Debug");e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var h={undefined:"float ",1:"float ",
2:"vec2 ",3:"vec3 ",4:"vec4 ",16:"mat4 "},g={u_baseColor:"vec4",u_normals:"vert",u_glossiness:"vec4",u_positionOffset:"vert"},r={vert:1,vec3:2,vec4:4,"float":8},l=v({u_perspective:e,u_view:e,u_resolution:[0,0,0],u_transform:e,u_size:[1,1,1],u_time:0,u_opacity:1,u_metalness:0,u_glossiness:[0,0,0,0],u_baseColor:[1,1,1,1],u_normals:[1,1,1],u_positionOffset:[0,0,0],u_lightPosition:e,u_lightColor:e,u_ambientLight:[0,0,0],u_flatShading:0,u_numLights:0}),m=v({a_pos:[0,0,0],a_texCoord:[0,0],a_normals:[0,
0,0]}),p=v({v_textureCoordinate:[0,0],v_normal:[0,0,0],v_position:[0,0,0],v_eyeVector:[0,0,0]});b.prototype.registerMaterial=function(a,b){var c=g[a],d=r[c];if((this.registeredMaterials[b._id]&d)===d)return this;for(var f in b.uniforms)-1===l.keys.indexOf(f)&&(l.keys.push(f),l.values.push(b.uniforms[f]));for(f in b.varyings)-1===p.keys.indexOf(f)&&(p.keys.push(f),p.values.push(b.varyings[f]));for(f in b.attributes)-1===m.keys.indexOf(f)&&(m.keys.push(f),m.values.push(b.attributes[f]));this.registeredMaterials[b._id]|=
d;"float"===c&&(this.definitionFloat.push(b.defines),this.definitionFloat.push("float fa_"+b._id+"() {\n "+b.glsl+" \n}"),this.applicationFloat.push("if (int(abs(ID)) == "+b._id+") return fa_"+b._id+"();"));"vec3"===c&&(this.definitionVec3.push(b.defines),this.definitionVec3.push("vec3 fa_"+b._id+"() {\n "+b.glsl+" \n}"),this.applicationVec3.push("if (int(abs(ID.x)) == "+b._id+") return fa_"+b._id+"();"));"vec4"===c&&(this.definitionVec4.push(b.defines),this.definitionVec4.push("vec4 fa_"+b._id+"() {\n "+
b.glsl+" \n}"),this.applicationVec4.push("if (int(abs(ID.x)) == "+b._id+") return fa_"+b._id+"();"));"vert"===c&&(this.definitionVert.push(b.defines),this.definitionVert.push("vec3 fa_"+b._id+"() {\n "+b.glsl+" \n}"),this.applicationVert.push("if (int(abs(ID.x)) == "+b._id+") return fa_"+b._id+"();"));return this.resetProgram()};b.prototype.resetProgram=function(){var b=["precision mediump float;\n"],f=["precision mediump float;\n"],e,g,k;this.uniformLocations=[];this.attributeLocations={};this.uniformTypes=
{};this.attributeNames=a(m.keys);this.attributeValues=a(m.values);this.varyingNames=a(p.keys);this.varyingValues=a(p.values);this.uniformNames=a(l.keys);this.uniformValues=a(l.values);this.flaggedUniforms=[];this.cachedUniforms={};f.push("uniform sampler2D u_textures[7];\n");this.applicationVert.length&&b.push("uniform sampler2D u_textures[7];\n");for(k=0;k<this.uniformNames.length;k++)e=this.uniformNames[k],g=this.uniformValues[k],b.push("uniform "+h[g.length]+e+";\n"),f.push("uniform "+h[g.length]+
e+";\n");for(k=0;k<this.attributeNames.length;k++)e=this.attributeNames[k],g=this.attributeValues[k],b.push("attribute "+h[g.length]+e+";\n");for(k=0;k<this.varyingNames.length;k++)e=this.varyingNames[k],g=this.varyingValues[k],b.push("varying "+h[g.length]+e+";\n"),f.push("varying "+h[g.length]+e+";\n");b=b.join("")+d.replace("#vert_definitions",this.definitionVert.join("\n")).replace("#vert_applications",this.applicationVert.join("\n"));f=f.join("")+c.replace("#vec3_definitions",this.definitionVec3.join("\n")).replace("#vec3_applications",
this.applicationVec3.join("\n")).replace("#vec4_definitions",this.definitionVec4.join("\n")).replace("#vec4_applications",this.applicationVec4.join("\n")).replace("#float_definitions",this.definitionFloat.join("\n")).replace("#float_applications",this.applicationFloat.join("\n"));e=this.gl.createProgram();this.gl.attachShader(e,this.compileShader(this.gl.createShader(35633),b));this.gl.attachShader(e,this.compileShader(this.gl.createShader(35632),f));this.gl.linkProgram(e);this.gl.getProgramParameter(e,
this.gl.LINK_STATUS)?(this.program=e,this.gl.useProgram(this.program)):(console.error("link error: "+this.gl.getProgramInfoLog(e)),this.program=null);this.setUniforms(this.uniformNames,this.uniformValues);f=this.gl.getUniformLocation(this.program,"u_textures[0]");this.gl.uniform1iv(f,[0,1,2,3,4,5,6]);return this};b.prototype.uniformIsCached=function(a,b){if(null==this.cachedUniforms[a])return this.cachedUniforms[a]=b.length?new Float32Array(b):b,!1;if(b.length)for(var c=b.length;c--;){if(b[c]!==this.cachedUniforms[a][c]){for(c=
b.length;c--;)this.cachedUniforms[a][c]=b[c];return!1}}else if(this.cachedUniforms[a]!==b)return this.cachedUniforms[a]=b,!1;return!0};b.prototype.setUniforms=function(a,b){var c=this.gl,d,f,e,g,h;if(!this.program)return this;g=a.length;for(h=0;h<g;h++)if(e=a[h],f=b[h],d=this.uniformLocations[e],null!==d&&(void 0===d&&(d=c.getUniformLocation(this.program,e),this.uniformLocations[e]=d),!this.uniformIsCached(e,f)))switch(this.uniformTypes[e]||(this.uniformTypes[e]=this.getUniformTypeFromValue(f)),this.uniformTypes[e]){case "uniform4fv":c.uniform4fv(d,
f);break;case "uniform3fv":c.uniform3fv(d,f);break;case "uniform2fv":c.uniform2fv(d,f);break;case "uniform1fv":c.uniform1fv(d,f);break;case "uniform1f":c.uniform1f(d,f);break;case "uniformMatrix3fv":c.uniformMatrix3fv(d,!1,f);break;case "uniformMatrix4fv":c.uniformMatrix4fv(d,!1,f)}return this};b.prototype.getUniformTypeFromValue=function(a){if(Array.isArray(a)||a instanceof Float32Array)switch(a.length){case 1:return"uniform1fv";case 2:return"uniform2fv";case 3:return"uniform3fv";case 4:return"uniform4fv";
case 9:return"uniformMatrix3fv";case 16:return"uniformMatrix4fv"}else if(!isNaN(parseFloat(a))&&isFinite(a))return"uniform1f";throw'cant load uniform "'+name+'" with value:'+JSON.stringify(a);};b.prototype.compileShader=function(a,b){var c=1;this.options.debug&&(this.gl.compileShader=f.call(this));this.gl.shaderSource(a,b);this.gl.compileShader(a);this.gl.getShaderParameter(a,this.gl.COMPILE_STATUS)||(console.error("compile error: "+this.gl.getShaderInfoLog(a)),console.error("1: "+b.replace(/\n/g,
function(){return"\n"+(c+=1)+": "})));return a};k.exports=b},{"../utilities/clone":76,"../utilities/keyValueToArrays":77,"../webgl-shaders":89,"./Debug":81}],83:[function(e,k,v){function b(a,b){b=b||{};this.id=a.createTexture();this.width=b.width||0;this.height=b.height||0;this.mipmap=b.mipmap;this.format=b.format||"RGBA";this.type=b.type||"UNSIGNED_BYTE";this.gl=a;this.bind();a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,b.flipYWebgl||!1);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultiplyAlphaWebgl||
!1);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a[b.magFilter]||a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a[b.minFilter]||a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a[b.wrapS]||a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a[b.wrapT]||a.CLAMP_TO_EDGE)}b.prototype.bind=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.id);return this};b.prototype.unbind=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,null);return this};b.prototype.setImage=
function(a){this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl[this.format],this.gl[this.format],this.gl[this.type],a);this.mipmap&&this.gl.generateMipmap(this.gl.TEXTURE_2D);return this};b.prototype.setArray=function(a){this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl[this.format],this.width,this.height,0,this.gl[this.format],this.gl[this.type],a);return this};b.prototype.readBack=function(a,b,c,f){var e=this.gl,g;a=a||0;b=b||0;c=c||this.width;f=f||this.height;var k=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,
k);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.id,0);e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE&&(g=new Uint8Array(c*f*4),e.readPixels(a,b,c,f,e.RGBA,e.UNSIGNED_BYTE,g));return g};k.exports=b},{}],84:[function(e,k,v){function b(a){this.registry=[];this._needsResample=[];this._activeTexture=0;this._boundTexture=null;this._checkerboard=c();this.gl=a}function a(a,b){var c=("string"===typeof a?new Image:a)||{};c.crossOrigin="anonymous";c.src||(c.src=
a);c.complete?b(c):c.onload=function(){b(c)};return c}var d=e("./Texture"),c=e("./createCheckerboard");b.prototype.update=function(a){for(var b=this.registry.length,c=1;c<b;c++){var d=this.registry[c];d&&d.isLoaded&&d.resampleRate&&(!d.lastResample||a-d.lastResample>d.resampleRate)&&!this._needsResample[d.id]&&(this._needsResample[d.id]=!0,d.lastResample=a)}};b.prototype.register=function(b,c){var e=this,k=b.data,l=b.id,m=b.options||{},p=this.registry[l],u;p||(p=new d(this.gl,m),p.setImage(this._checkerboard),
u=this.registry[l]={resampleRate:m.resampleRate||null,lastResample:null,isLoaded:!1,texture:p,source:k,id:l,slot:c},Array.isArray(k)||k instanceof Uint8Array||k instanceof Float32Array?(this.bindTexture(l),p.setArray(k),u.isLoaded=!0):k instanceof HTMLVideoElement?k.addEventListener("loadeddata",function(){e.bindTexture(l);p.setImage(k);u.isLoaded=!0;u.source=k}):"string"===typeof k&&a(k,function(a){e.bindTexture(l);p.setImage(a);u.isLoaded=!0;u.source=a}));return l};b.prototype.bindTexture=function(a){var b=
this.registry[a];this._activeTexture!==b.slot&&(this.gl.activeTexture(this.gl.TEXTURE0+b.slot),this._activeTexture=b.slot);this._boundTexture!==a&&(this._boundTexture=a,b.texture.bind());this._needsResample[b.id]&&(b.texture.setImage(b.source),this._needsResample[b.id]=!1)};k.exports=b},{"./Texture":83,"./createCheckerboard":87}],85:[function(e,k,v){function b(b,c){b.classList.add("famous-webgl-renderer");this.canvas=b;this.compositor=c;var e=this.gl=this.getWebGLContext(this.canvas);e.clearColor(0,
0,0,0);e.polygonOffset(.1,.1);e.enable(e.POLYGON_OFFSET_FILL);e.enable(e.DEPTH_TEST);e.enable(e.BLEND);e.depthFunc(e.LEQUAL);e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);e.enable(e.CULL_FACE);e.cullFace(e.BACK);this.meshRegistry={};this.meshRegistryKeys=[];this.cutoutRegistry={};this.cutoutRegistryKeys=[];this.numLights=0;this.ambientLightColor=[0,0,0];this.lightRegistry={};this.lightRegistryKeys=[];this.lightPositions=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.lightColors=[0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0];this.textureManager=new h(e);this.texCache={};this.bufferRegistry=new d(e);this.program=new a(e,{debug:!0});this.state={boundArrayBuffer:null,boundElementBuffer:null,lastDrawn:null,enabledAttributes:{},enabledAttributesKeys:[]};this.resolutionName=["u_resolution"];this.resolutionValues=[[0,0,0]];this.cachedSize=[];this.projectionTransform=[1,0,0,0,0,1,0,0,0,0,-1E-6,0,-1,1,0,1];e=this.cutoutGeometry={spec:{id:-1,bufferValues:[[-1,-1,0,1,-1,0,-1,1,0,1,1,0]],bufferNames:["a_pos"],type:"TRIANGLE_STRIP"}};
this.bufferRegistry.allocate(this.cutoutGeometry.spec.id,e.spec.bufferNames[0],e.spec.bufferValues[0],3)}var a=e("./Program"),d=e("./BufferRegistry"),c=e("./radixSort"),f=e("../utilities/keyValueToArrays"),h=e("./TextureManager"),g=e("./compileMaterial"),r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],l=f({u_numLights:0,u_ambientLight:Array(3),u_lightPosition:Array(3),u_lightColor:Array(3),u_perspective:Array(16),u_time:0,u_view:Array(16)});b.prototype.getWebGLContext=function(a){for(var b=["webgl","experimental-webgl",
"webkit-3d","moz-webgl"],c,d=0,e=b.length;d<e;d++){try{c=a.getContext(b[d])}catch(f){console.error("Error creating WebGL context: "+f.toString())}if(c)break}return c?c:(console.error("Could not retrieve WebGL context. Please refer to https://www.khronos.org/webgl/ for requirements"),!1)};b.prototype.createLight=function(a){this.numLights++;this.lightRegistryKeys.push(a);this.lightRegistry[a]={color:[0,0,0],position:[0,0,0]};return this.lightRegistry[a]};b.prototype.createMesh=function(a){this.meshRegistryKeys.push(a);
var b=f({u_opacity:1,u_transform:r,u_size:[0,0,0],u_baseColor:[.5,.5,.5,1],u_positionOffset:[0,0,0],u_normals:[0,0,0],u_flatShading:0,u_glossiness:[0,0,0,0]});this.meshRegistry[a]={depth:null,uniformKeys:b.keys,uniformValues:b.values,buffers:{},geometry:null,drawType:null,textures:[],visible:!0};return this.meshRegistry[a]};b.prototype.setCutoutState=function(a,b){this.getOrSetCutout(a).visible=b};b.prototype.getOrSetCutout=function(a){if(!this.cutoutRegistry[a]){var b=f({u_opacity:0,u_transform:r.slice(),
u_size:[0,0,0],u_origin:[0,0,0],u_baseColor:[0,0,0,1]});this.cutoutRegistryKeys.push(a);this.cutoutRegistry[a]={uniformKeys:b.keys,uniformValues:b.values,geometry:this.cutoutGeometry.spec.id,drawType:this.cutoutGeometry.spec.type,visible:!0}}return this.cutoutRegistry[a]};b.prototype.setMeshVisibility=function(a,b){(this.meshRegistry[a]||this.createMesh(a)).visible=b};b.prototype.removeMesh=function(a){var b=this.meshRegistryKeys.indexOf(a);this.meshRegistryKeys.splice(b,1);this.meshRegistry[a]=null};
b.prototype.setCutoutUniform=function(a,b,c){a=this.getOrSetCutout(a);b=a.uniformKeys.indexOf(b);if(c.length)for(var d=0,e=c.length;d<e;d++)a.uniformValues[b][d]=c[d];else a.uniformValues[b]=c};b.prototype.setMeshOptions=function(a,b){(this.meshRegistry[a]||this.createMesh(a)).options=b;return this};b.prototype.setAmbientLightColor=function(a,b,c,d){this.ambientLightColor[0]=b;this.ambientLightColor[1]=c;this.ambientLightColor[2]=d;return this};b.prototype.setLightPosition=function(a,b,c,d){a=this.lightRegistry[a]||
this.createLight(a);a.position[0]=b;a.position[1]=c;a.position[2]=d;return this};b.prototype.setLightColor=function(a,b,c,d){a=this.lightRegistry[a]||this.createLight(a);a.color[0]=b;a.color[1]=c;a.color[2]=d;return this};b.prototype.handleMaterialInput=function(a,b,c){a=this.meshRegistry[a]||this.createMesh(a);c=g(c,a.textures.length);a.uniformValues[a.uniformKeys.indexOf(b)][0]=-c._id;for(var d=c.textures.length;d--;)a.textures.push(this.textureManager.register(c.textures[d],a.textures.length+d));
this.program.registerMaterial(b,c);return this.updateSize()};b.prototype.setGeometry=function(a,b,c,d){a=this.meshRegistry[a]||this.createMesh(a);a.geometry=b;a.drawType=c;a.dynamic=d;return this};b.prototype.setMeshUniform=function(a,b,c){a=this.meshRegistry[a]||this.createMesh(a);var d=a.uniformKeys.indexOf(b);-1===d?(a.uniformKeys.push(b),a.uniformValues.push(c)):a.uniformValues[d]=c};b.prototype.bufferData=function(a,b,c,d,e,f){this.bufferRegistry.allocate(b,c,d,e,f);return this};b.prototype.draw=
function(a){var b=this.compositor.getTime();this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);this.textureManager.update(b);this.meshRegistryKeys=c(this.meshRegistryKeys,this.meshRegistry);this.setGlobalUniforms(a);this.drawCutouts();this.drawMeshes()};b.prototype.drawMeshes=function(){for(var a=this.gl,b,c,d=0;d<this.meshRegistryKeys.length;d++)if(c=this.meshRegistry[this.meshRegistryKeys[d]],b=this.bufferRegistry.registry[c.geometry],c.visible&&(1>c.uniformValues[0]?(a.depthMask(!1),
a.enable(a.BLEND)):(a.depthMask(!0),a.disable(a.BLEND)),b)){for(var e=c.textures.length;e--;)this.textureManager.bindTexture(c.textures[e]);c.options&&this.handleOptions(c.options,c);this.program.setUniforms(c.uniformKeys,c.uniformValues);this.drawBuffers(b,c.drawType,c.geometry);c.options&&this.resetOptions(c.options)}};b.prototype.drawCutouts=function(){var a,b,c=this.cutoutRegistryKeys.length;if(c){this.gl.disable(this.gl.CULL_FACE);this.gl.enable(this.gl.BLEND);this.gl.depthMask(!0);for(var d=
0;d<c;d++)a=this.cutoutRegistry[this.cutoutRegistryKeys[d]],b=this.bufferRegistry.registry[a.geometry],a.visible&&(this.program.setUniforms(a.uniformKeys,a.uniformValues),this.drawBuffers(b,a.drawType,a.geometry));this.gl.enable(this.gl.CULL_FACE)}};b.prototype.setGlobalUniforms=function(a){for(var b,c,d=0,e=this.lightRegistryKeys.length;d<e;d++)b=this.lightRegistry[this.lightRegistryKeys[d]],c=4*d,this.lightPositions[0+c]=b.position[0],this.lightPositions[1+c]=b.position[1],this.lightPositions[2+
c]=b.position[2],this.lightColors[0+c]=b.color[0],this.lightColors[1+c]=b.color[1],this.lightColors[2+c]=b.color[2];l.values[0]=this.numLights;l.values[1]=this.ambientLightColor;l.values[2]=this.lightPositions;l.values[3]=this.lightColors;this.projectionTransform[0]=1/(.5*this.cachedSize[0]);this.projectionTransform[5]=-1/(.5*this.cachedSize[1]);this.projectionTransform[11]=a.perspectiveTransform[11];l.values[4]=this.projectionTransform;l.values[5]=.001*this.compositor.getTime();l.values[6]=a.viewTransform;
this.program.setUniforms(l.keys,l.values)};b.prototype.drawBuffers=function(a,b,c){var d=this.gl,e=0,f,g,h,k,l,r,v;l=a.keys.length;for(v=0;v<l;v++)if(f=a.keys[v],"indices"===f)r=v;else if(g=this.program.attributeLocations[f],-1!==g){if(void 0===g&&(g=d.getAttribLocation(this.program.program,f),this.program.attributeLocations[f]=g,-1===g))continue;this.state.enabledAttributes[f]||(d.enableVertexAttribArray(g),this.state.enabledAttributes[f]=!0,this.state.enabledAttributesKeys.push(f));k=a.values[v];
f=a.spacing[v];h=a.offset[v];e=a.length[v];this.state.boundArrayBuffer!==k&&(d.bindBuffer(k.target,k.buffer),this.state.boundArrayBuffer=k);this.state.lastDrawn!==c&&d.vertexAttribPointer(g,f,d.FLOAT,d.FALSE,0,4*h)}g=this.state.enabledAttributesKeys.length;for(v=0;v<g;v++)l=this.state.enabledAttributesKeys[v],this.state.enabledAttributes[l]&&-1===a.keys.indexOf(l)&&(d.disableVertexAttribArray(this.program.attributeLocations[l]),this.state.enabledAttributes[l]=!1);e&&(void 0!==r?(k=a.values[r],h=a.offset[r],
e=a.length[r],this.state.boundElementBuffer!==k&&(d.bindBuffer(k.target,k.buffer),this.state.boundElementBuffer=k),d.drawElements(d[b],e,d.UNSIGNED_SHORT,2*h)):d.drawArrays(d[b],0,e));this.state.lastDrawn=c};b.prototype.updateSize=function(a){if(a){var b=window.devicePixelRatio||1,c=~~(a[0]*b),b=~~(a[1]*b);this.canvas.width=c;this.canvas.height=b;this.gl.viewport(0,0,c,b);this.cachedSize[0]=a[0];this.cachedSize[1]=a[1];this.cachedSize[2]=a[0]>a[1]?a[0]:a[1];this.resolutionValues[0]=this.cachedSize}this.program.setUniforms(this.resolutionName,
this.resolutionValues);return this};b.prototype.handleOptions=function(a,b){var c=this.gl;a&&(a.blending&&c.enable(c.BLEND),"double"===a.side&&(this.gl.cullFace(this.gl.FRONT),this.drawBuffers(this.bufferRegistry.registry[b.geometry],b.drawType,b.geometry),this.gl.cullFace(this.gl.BACK)),"back"===a.side&&c.cullFace(c.FRONT))};b.prototype.resetOptions=function(a){var b=this.gl;a&&(a.blending&&b.disable(b.BLEND),"back"===a.side&&b.cullFace(b.BACK))};k.exports=b},{"../utilities/keyValueToArrays":77,
"./BufferRegistry":80,"./Program":82,"./TextureManager":84,"./compileMaterial":86,"./radixSort":88}],86:[function(e,k,v){function b(a,c){for(var d=a.inputs,e=d&&d.length,f=-1;++f<e;)b(d[f],c);c(a);return a}function a(b){if("number"===typeof b)return 1;if(Array.isArray(b))return b.length;var c=b.chunk.output;if("number"===typeof c)return c;b=b.inputs.map(function(b){return a(b)}).join(",");return c[b]}function d(a,b,d){return a.replace(/%\d/g,function(a){return c(b[a[1]-1])}).replace(/\$TEXTURE/,"u_textures["+
d+"]")}function c(a){return Array.isArray(a)?"vec"+a.length+"("+a.join(",")+")":"object"===typeof a?"fa_"+a._id:a.toFixed(6)}function f(a,b){for(var c in b)a[c]=b[c]}var h={1:"float ",2:"vec2 ",3:"vec3 ",4:"vec4 "};k.exports=function(e,k){var l="",m={},p={},u={},n=[],v=[];b(e,function(b,e){if(b.chunk){var g=h[a(b)],x=c(b),z=d(b.chunk.glsl,b.inputs,v.length+k);l+=g+x+" = "+z+"\n ";b.uniforms&&f(m,b.uniforms);b.varyings&&f(p,b.varyings);b.attributes&&f(u,b.attributes);b.chunk.defines&&n.push(b.chunk.defines);
b.texture&&v.push(b.texture)}});return{_id:e._id,glsl:l+"return "+c(e)+";",defines:n.join("\n"),uniforms:m,varyings:p,attributes:u,textures:v}}},{}],87:[function(e,k,v){k.exports=function(){var b=document.createElement("canvas").getContext("2d");b.canvas.width=b.canvas.height=128;for(var a=0;a<b.canvas.height;a+=16)for(var d=0;d<b.canvas.width;d+=16)b.fillStyle=(d^a)&16?"#FFF":"#DDD",b.fillRect(d,a,16,16);return b.canvas}},{}],88:[function(e,k,v){function b(a,b,c){a=a[c];c=b[a];return(c.depth?c.depth:
b[a].uniformValues[1][14])+g}function a(a){r[0]=a;return l[0]}function d(a){l[0]=a;return r[0]}var c=Array(2048*Math.ceil(64/11)),f=32/11+.999999999999999|0,h=2048*(f-1),g=Math.pow(20,6);e=new ArrayBuffer(4);var r=new Float32Array(e,0,1),l=new Int32Array(e,0,1);k.exports=function(e,k){var l=0,n=[],r,t,w,v,x;f=32/11+.999999999999999|0;r=0;for(v=2048*f;r<v;r++)c[r]=0;r=0;for(v=e.length;r<v;r++){x=a(b(e,k,r));x^=x>>31|2147483648;for(w=t=0;t<h;t+=2048,w+=11)c[t+(x>>>w&2047)]++;c[t+(x>>>w&1023)]++}for(t=
0;t<=h;t+=2048)for(r=t,v=0;r<t+2048;r++)x=c[r]+v,c[r]=v-1,v=x;if(--f){r=0;for(v=e.length;r<v;r++){x=a(b(e,k,r));t=n;w=++c[x&2047];var z=e[r];k[z].depth=d(x^(x>>31|2147483648))-g;t[w]=z}r=n;n=e;for(e=r;++l<f;){r=0;v=e.length;t=2048*l;for(w=11*l;r<v;r++)x=a(b(e,k,r)),n[++c[t+(x>>>w&2047)]]=e[r];r=n;n=e;e=r}}r=0;v=e.length;t=2048*l;for(w=11*l;r<v;r++){x=a(b(e,k,r));var l=n,z=++c[t+(x>>>w&1023)],y=e[r];k[y].depth=d(x^(~x>>31|2147483648))-g;l[z]=y;k[e[r]].depth=null}return n}},{}],89:[function(e,k,v){k.exports=
{vertex:'#define GLSLIFY 1\n/**\n * The MIT License (MIT)\n * \n * Copyright (c) 2015 Famous Industries Inc.\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the "Software"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/**\n * The MIT License (MIT)\n * \n * Copyright (c) 2015 Famous Industries Inc.\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the "Software"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/**\n * Calculates transpose inverse matrix from transform\n * \n * @method random\n * @private\n *\n *\n */\n\n\nmat3 getNormalMatrix_1_0(in mat4 t) {\n   mat3 matNorm;\n   mat4 a = t;\n\n   float a00 = a[0][0], a01 = a[0][1], a02 = a[0][2], a03 = a[0][3],\n   a10 = a[1][0], a11 = a[1][1], a12 = a[1][2], a13 = a[1][3],\n   a20 = a[2][0], a21 = a[2][1], a22 = a[2][2], a23 = a[2][3],\n   a30 = a[3][0], a31 = a[3][1], a32 = a[3][2], a33 = a[3][3],\n   b00 = a00 * a11 - a01 * a10,\n   b01 = a00 * a12 - a02 * a10,\n   b02 = a00 * a13 - a03 * a10,\n   b03 = a01 * a12 - a02 * a11,\n   b04 = a01 * a13 - a03 * a11,\n   b05 = a02 * a13 - a03 * a12,\n   b06 = a20 * a31 - a21 * a30,\n   b07 = a20 * a32 - a22 * a30,\n   b08 = a20 * a33 - a23 * a30,\n   b09 = a21 * a32 - a22 * a31,\n   b10 = a21 * a33 - a23 * a31,\n   b11 = a22 * a33 - a23 * a32,\n\n   det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n   det = 1.0 / det;\n\n   matNorm[0][0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n   matNorm[0][1] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n   matNorm[0][2] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n\n   matNorm[1][0] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n   matNorm[1][1] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n   matNorm[1][2] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n\n   matNorm[2][0] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n   matNorm[2][1] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n   matNorm[2][2] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n\n   return matNorm;\n}\n\n\n\n/**\n * The MIT License (MIT)\n * \n * Copyright (c) 2015 Famous Industries Inc.\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the "Software"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/**\n * Calculates a matrix that creates the identity when multiplied by m\n * \n * @method inverse\n * @private\n *\n *\n */\n\n\nfloat inverse_2_1(float m) {\n    return 1.0 / m;\n}\n\nmat2 inverse_2_1(mat2 m) {\n    return mat2(m[1][1],-m[0][1],\n               -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n}\n\nmat3 inverse_2_1(mat3 m) {\n    float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n    float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n    float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n    float b01 =  a22 * a11 - a12 * a21;\n    float b11 = -a22 * a10 + a12 * a20;\n    float b21 =  a21 * a10 - a11 * a20;\n\n    float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n    return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nmat4 inverse_2_1(mat4 m) {\n    float\n        a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n        a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n        a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n        a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n        b00 = a00 * a11 - a01 * a10,\n        b01 = a00 * a12 - a02 * a10,\n        b02 = a00 * a13 - a03 * a10,\n        b03 = a01 * a12 - a02 * a11,\n        b04 = a01 * a13 - a03 * a11,\n        b05 = a02 * a13 - a03 * a12,\n        b06 = a20 * a31 - a21 * a30,\n        b07 = a20 * a32 - a22 * a30,\n        b08 = a20 * a33 - a23 * a30,\n        b09 = a21 * a32 - a22 * a31,\n        b10 = a21 * a33 - a23 * a31,\n        b11 = a22 * a33 - a23 * a32,\n\n        det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n    return mat4(\n        a11 * b11 - a12 * b10 + a13 * b09,\n        a02 * b10 - a01 * b11 - a03 * b09,\n        a31 * b05 - a32 * b04 + a33 * b03,\n        a22 * b04 - a21 * b05 - a23 * b03,\n        a12 * b08 - a10 * b11 - a13 * b07,\n        a00 * b11 - a02 * b08 + a03 * b07,\n        a32 * b02 - a30 * b05 - a33 * b01,\n        a20 * b05 - a22 * b02 + a23 * b01,\n        a10 * b10 - a11 * b08 + a13 * b06,\n        a01 * b08 - a00 * b10 - a03 * b06,\n        a30 * b04 - a31 * b02 + a33 * b00,\n        a21 * b02 - a20 * b04 - a23 * b00,\n        a11 * b07 - a10 * b09 - a12 * b06,\n        a00 * b09 - a01 * b07 + a02 * b06,\n        a31 * b01 - a30 * b03 - a32 * b00,\n        a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n\n\n\n/**\n * The MIT License (MIT)\n * \n * Copyright (c) 2015 Famous Industries Inc.\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the "Software"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/**\n * Reflects a matrix over its main diagonal.\n * \n * @method transpose\n * @private\n *\n *\n */\n\n\nfloat transpose_3_2(float m) {\n    return m;\n}\n\nmat2 transpose_3_2(mat2 m) {\n    return mat2(m[0][0], m[1][0],\n                m[0][1], m[1][1]);\n}\n\nmat3 transpose_3_2(mat3 m) {\n    return mat3(m[0][0], m[1][0], m[2][0],\n                m[0][1], m[1][1], m[2][1],\n                m[0][2], m[1][2], m[2][2]);\n}\n\nmat4 transpose_3_2(mat4 m) {\n    return mat4(m[0][0], m[1][0], m[2][0], m[3][0],\n                m[0][1], m[1][1], m[2][1], m[3][1],\n                m[0][2], m[1][2], m[2][2], m[3][2],\n                m[0][3], m[1][3], m[2][3], m[3][3]);\n}\n\n\n\n\n/**\n * Converts vertex from modelspace to screenspace using transform\n * information from context.\n *\n * @method applyTransform\n * @private\n *\n *\n */\n\nvec4 applyTransform(vec4 pos) {\n    //TODO: move this multiplication to application code. \n\n    /**\n     * Currently multiplied in the vertex shader to avoid consuming the complexity of holding an additional\n     * transform as state on the mesh object in WebGLRenderer. Multiplies the object\'s transformation from object space\n     * to world space with its transformation from world space to eye space.\n     */\n    mat4 MVMatrix = u_view * u_transform;\n\n    //TODO: move the origin, sizeScale and y axis inversion to application code in order to amortize redundant per-vertex calculations.\n\n    /**\n     * The transform uniform should be changed to the result of the transformation chain:\n     *\n     * view * modelTransform * invertYAxis * sizeScale * origin\n     *\n     * which could be simplified to:\n     *\n     * view * modelTransform * convertToDOMSpace\n     *\n     * where convertToDOMSpace represents the transform matrix:\n     *\n     *                           size.x 0       0       size.x \n     *                           0      -size.y 0       size.y\n     *                           0      0       1       0\n     *                           0      0       0       1\n     *\n     */\n\n    /**\n     * Assuming a unit volume, moves the object space origin [0, 0, 0] to the "top left" [1, -1, 0], the DOM space origin.\n     * Later in the transformation chain, the projection transform negates the rigidbody translation.\n     * Equivalent to (but much faster than) multiplying a translation matrix "origin"\n     *\n     *                           1 0 0 1 \n     *                           0 1 0 -1\n     *                           0 0 1 0\n     *                           0 0 0 1\n     *\n     * in the transform chain: projection * view * modelTransform * invertYAxis * sizeScale * origin * positionVector.\n     */\n    pos.x += 1.0;\n    pos.y -= 1.0;\n\n    /**\n     * Assuming a unit volume, scales an object to the amount of pixels in the size uniform vector\'s specified dimensions.\n     * Later in the transformation chain, the projection transform transforms the point into clip space by scaling\n     * by the inverse of the canvas\' resolution.\n     * Equivalent to (but much faster than) multiplying a scale matrix "sizeScale"\n     *\n     *                           size.x 0      0      0 \n     *                           0      size.y 0      0\n     *                           0      0      size.z 0\n     *                           0      0      0      1\n     *\n     * in the transform chain: projection * view * modelTransform * invertYAxis * sizeScale * origin * positionVector.\n     */\n    pos.xyz *= u_size * 0.5;\n\n    /**\n     * Inverts the object space\'s y axis in order to match DOM space conventions. \n     * Later in the transformation chain, the projection transform reinverts the y axis to convert to clip space.\n     * Equivalent to (but much faster than) multiplying a scale matrix "invertYAxis"\n     *\n     *                           1 0 0 0 \n     *                           0 -1 0 0\n     *                           0 0 1 0\n     *                           0 0 0 1\n     *\n     * in the transform chain: projection * view * modelTransform * invertYAxis * sizeScale * origin * positionVector.\n     */\n    pos.y *= -1.0;\n\n    /**\n     * Exporting the vertex\'s position as a varying, in DOM space, to be used for lighting calculations. This has to be in DOM space\n     * since light position and direction is derived from the scene graph, calculated in DOM space.\n     */\n\n    v_position = (MVMatrix * pos).xyz;\n\n    /**\n    * Exporting the eye vector (a vector from the center of the screen) as a varying, to be used for lighting calculations.\n    * In clip space deriving the eye vector is a matter of simply taking the inverse of the position, as the position is a vector\n    * from the center of the screen. However, since our points are represented in DOM space,\n    * the position is a vector from the top left corner of the screen, so some additional math is needed (specifically, subtracting\n    * the position from the center of the screen, i.e. half the resolution of the canvas).\n    */\n\n    v_eyeVector = (u_resolution * 0.5) - v_position;\n\n    /**\n     * Transforming the position (currently represented in dom space) into view space (with our dom space view transform)\n     * and then projecting the point into raster both by applying a perspective transformation and converting to clip space\n     * (the perspective matrix is a combination of both transformations, therefore it\'s probably more apt to refer to it as a\n     * projection transform).\n     */\n\n    pos = u_perspective * MVMatrix * pos;\n\n    return pos;\n}\n\n/**\n * Placeholder for positionOffset chunks to be templated in.\n * Used for mesh deformation.\n *\n * @method calculateOffset\n * @private\n *\n *\n */\n#vert_definitions\nvec3 calculateOffset(vec3 ID) {\n    #vert_applications\n    return vec3(0.0);\n}\n\n/**\n * Writes the position of the vertex onto the screen.\n * Passes texture coordinate and normal attributes as varyings\n * and passes the position attribute through position pipeline.\n *\n * @method main\n * @private\n *\n *\n */\nvoid main() {\n    v_textureCoordinate = a_texCoord;\n    vec3 invertedNormals = a_normals + (u_normals.x < 0.0 ? calculateOffset(u_normals) * 2.0 - 1.0 : vec3(0.0));\n    invertedNormals.y *= -1.0;\n    v_normal = transpose_3_2(mat3(inverse_2_1(u_transform))) * invertedNormals;\n    vec3 offsetPos = a_pos + calculateOffset(u_positionOffset);\n    gl_Position = applyTransform(vec4(offsetPos, 1.0));\n}\n',
fragment:'#define GLSLIFY 1\n/**\n * The MIT License (MIT)\n * \n * Copyright (c) 2015 Famous Industries Inc.\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the "Software"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/**\n * The MIT License (MIT)\n * \n * Copyright (c) 2015 Famous Industries Inc.\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the "Software"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/**\n * Placeholder for fragmentShader  chunks to be templated in.\n * Used for normal mapping, gloss mapping and colors.\n * \n * @method applyMaterial\n * @private\n *\n *\n */\n\n#float_definitions\nfloat applyMaterial_1_0(float ID) {\n    #float_applications\n    return 1.;\n}\n\n#vec3_definitions\nvec3 applyMaterial_1_0(vec3 ID) {\n    #vec3_applications\n    return vec3(0);\n}\n\n#vec4_definitions\nvec4 applyMaterial_1_0(vec4 ID) {\n    #vec4_applications\n\n    return vec4(0);\n}\n\n\n\n/**\n * The MIT License (MIT)\n * \n * Copyright (c) 2015 Famous Industries Inc.\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the "Software"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/**\n * Calculates the intensity of light on a surface.\n *\n * @method applyLight\n * @private\n *\n */\nvec4 applyLight_2_1(in vec4 baseColor, in vec3 normal, in vec4 glossiness, int numLights, vec3 ambientColor, vec3 eyeVector, mat4 lightPosition, mat4 lightColor, vec3 v_position) {\n    vec3 diffuse = vec3(0.0);\n    bool hasGlossiness = glossiness.a > 0.0;\n    bool hasSpecularColor = length(glossiness.rgb) > 0.0;\n\n    for(int i = 0; i < 4; i++) {\n        if (i >= numLights) break;\n        vec3 lightDirection = normalize(lightPosition[i].xyz - v_position);\n        float lambertian = max(dot(lightDirection, normal), 0.0);\n\n        if (lambertian > 0.0) {\n            diffuse += lightColor[i].rgb * baseColor.rgb * lambertian;\n            if (hasGlossiness) {\n                vec3 halfVector = normalize(lightDirection + eyeVector);\n                float specularWeight = pow(max(dot(halfVector, normal), 0.0), glossiness.a);\n                vec3 specularColor = hasSpecularColor ? glossiness.rgb : lightColor[i].rgb;\n                diffuse += specularColor * specularWeight * lambertian;\n            }\n        }\n\n    }\n\n    return vec4(ambientColor + diffuse, baseColor.a);\n}\n\n\n\n\n\n/**\n * Writes the color of the pixel onto the screen\n *\n * @method main\n * @private\n *\n *\n */\nvoid main() {\n    vec4 material = u_baseColor.r >= 0.0 ? u_baseColor : applyMaterial_1_0(u_baseColor);\n\n    /**\n     * Apply lights only if flat shading is false\n     * and at least one light is added to the scene\n     */\n    bool lightsEnabled = (u_flatShading == 0.0) && (u_numLights > 0.0 || length(u_ambientLight) > 0.0);\n\n    vec3 normal = normalize(v_normal);\n    vec4 glossiness = u_glossiness.x < 0.0 ? applyMaterial_1_0(u_glossiness) : u_glossiness;\n\n    vec4 color = lightsEnabled ?\n    applyLight_2_1(material, normalize(v_normal), glossiness,\n               int(u_numLights),\n               u_ambientLight * u_baseColor.rgb,\n               normalize(v_eyeVector),\n               u_lightPosition,\n               u_lightColor,   \n               v_position)\n    : material;\n\n    gl_FragColor = color;\n    gl_FragColor.a *= u_opacity;   \n}\n'}},
{}],90:[function(e,k,v){function b(){}b.prototype.init=function(){var a=1/60*1E3;this.framedata={test_box:{sequence:{frames:[{x:0,y:0,ms:a},{x:160,y:0,ms:a},{x:320,y:0,ms:a},{x:480,y:0,ms:a},{x:640,y:0,ms:a},{x:800,y:0,ms:a},{x:960,y:0,ms:a},{x:1120,y:0,ms:a},{x:1280,y:0,ms:a},{x:1440,y:0,ms:a},{x:1600,y:0,ms:a},{x:0,y:160,ms:a},{x:160,y:160,ms:a},{x:320,y:160,ms:a},{x:480,y:160,ms:a},{x:640,y:160,ms:a},{x:800,y:160,ms:a},{x:960,y:160,ms:a},{x:1120,y:160,ms:a},{x:1280,y:160,ms:a},{x:1440,y:160,ms:a},
{x:1600,y:160,ms:a},{x:0,y:320,ms:a},{x:160,y:320,ms:a},{x:320,y:320,ms:a},{x:480,y:320,ms:a},{x:640,y:320,ms:a},{x:800,y:320,ms:a},{x:960,y:320,ms:a},{x:1120,y:320,ms:a},{x:1280,y:320,ms:a},{x:1440,y:320,ms:a},{x:1600,y:320,ms:a},{x:0,y:480,ms:a},{x:160,y:480,ms:a},{x:320,y:480,ms:a},{x:480,y:480,ms:a},{x:640,y:480,ms:a},{x:800,y:480,ms:a},{x:960,y:480,ms:a},{x:1120,y:480,ms:a},{x:1280,y:480,ms:a},{x:1440,y:480,ms:a},{x:1600,y:480,ms:a},{x:0,y:640,ms:a},{x:160,y:640,ms:a},{x:320,y:640,ms:a},{x:480,
y:640,ms:a},{x:640,y:640,ms:a},{x:800,y:640,ms:a},{x:960,y:640,ms:a},{x:1120,y:640,ms:a},{x:1280,y:640,ms:a},{x:1440,y:640,ms:a},{x:1600,y:640,ms:a},{x:0,y:800,ms:a},{x:160,y:800,ms:a},{x:320,y:800,ms:a},{x:480,y:800,ms:a},{x:640,y:800,ms:a}],frameIterator:0,msTimer:0},sequence_timed:{frames:[{x:0,y:0,ms:100},{x:160,y:0,ms:100},{x:320,y:0,ms:100},{x:480,y:0,ms:100},{x:640,y:0,ms:100},{x:800,y:0,ms:100},{x:960,y:0,ms:100},{x:1120,y:0,ms:100},{x:1280,y:0,ms:100},{x:1440,y:0,ms:100},{x:1600,y:0,ms:100},
{x:0,y:160,ms:100},{x:160,y:160,ms:100},{x:320,y:160,ms:100},{x:480,y:160,ms:100},{x:640,y:160,ms:100},{x:800,y:160,ms:100},{x:960,y:160,ms:100},{x:1120,y:160,ms:100},{x:1280,y:160,ms:100},{x:1440,y:160,ms:100},{x:1600,y:160,ms:100},{x:0,y:320,ms:100},{x:160,y:320,ms:100},{x:320,y:320,ms:100},{x:480,y:320,ms:100},{x:640,y:320,ms:100},{x:800,y:320,ms:100},{x:960,y:320,ms:100},{x:1120,y:320,ms:100},{x:1280,y:320,ms:100},{x:1440,y:320,ms:100},{x:1600,y:320,ms:100},{x:0,y:480,ms:100},{x:160,y:480,ms:100},
{x:320,y:480,ms:100},{x:480,y:480,ms:100},{x:640,y:480,ms:100},{x:800,y:480,ms:100},{x:960,y:480,ms:100},{x:1120,y:480,ms:100},{x:1280,y:480,ms:100},{x:1440,y:480,ms:100},{x:1600,y:480,ms:100},{x:0,y:640,ms:100},{x:160,y:640,ms:100},{x:320,y:640,ms:100},{x:480,y:640,ms:100},{x:640,y:640,ms:100},{x:800,y:640,ms:100},{x:960,y:640,ms:100},{x:1120,y:640,ms:100},{x:1280,y:640,ms:100},{x:1440,y:640,ms:100},{x:1600,y:640,ms:100},{x:0,y:800,ms:100},{x:160,y:800,ms:100},{x:320,y:800,ms:100},{x:480,y:800,ms:100},
{x:640,y:800,ms:100}],frameIterator:0,msTimer:0},reverseSequence:{frames:[{x:640,y:800,ms:a},{x:480,y:800,ms:a},{x:320,y:800,ms:a},{x:160,y:800,ms:a},{x:0,y:800,ms:a},{x:1600,y:640,ms:a},{x:1440,y:640,ms:a},{x:1280,y:640,ms:a},{x:1120,y:640,ms:a},{x:960,y:640,ms:a},{x:800,y:640,ms:a},{x:640,y:640,ms:a},{x:480,y:640,ms:a},{x:320,y:640,ms:a},{x:160,y:640,ms:a},{x:0,y:640,ms:a},{x:1600,y:480,ms:a},{x:1440,y:480,ms:a},{x:1280,y:480,ms:a},{x:1120,y:480,ms:a},{x:960,y:480,ms:a},{x:800,y:480,ms:a},{x:640,
y:480,ms:a},{x:480,y:480,ms:a},{x:320,y:480,ms:a},{x:160,y:480,ms:a},{x:0,y:480,ms:a},{x:1600,y:320,ms:a},{x:1440,y:320,ms:a}],frameIterator:0,msTimer:0}},astro:{full:{frames:[{x:0,y:0,ms:100},{x:80,y:0,ms:100},{x:160,y:0,ms:100},{x:240,y:0,ms:100},{x:320,y:0,ms:100},{x:400,y:0,ms:100},{x:480,y:0,ms:100},{x:560,y:0,ms:100},{x:0,y:120,ms:100},{x:80,y:120,ms:100},{x:160,y:120,ms:100},{x:240,y:120,ms:100},{x:320,y:120,ms:100},{x:400,y:120,ms:100},{x:480,y:120,ms:100},{x:560,y:120,ms:100},{x:0,y:240,
ms:100},{x:80,y:240,ms:100},{x:160,y:240,ms:100},{x:240,y:240,ms:100},{x:320,y:240,ms:100},{x:400,y:240,ms:100},{x:480,y:240,ms:100}],frameIterator:0,msTimer:0},loop:{frames:[{x:80,y:120,ms:100},{x:160,y:120,ms:100},{x:240,y:120,ms:100},{x:320,y:120,ms:100},{x:400,y:120,ms:100},{x:480,y:120,ms:100},{x:560,y:120,ms:100},{x:0,y:240,ms:100},{x:80,y:240,ms:100},{x:160,y:240,ms:100},{x:240,y:240,ms:100},{x:320,y:240,ms:100},{x:400,y:240,ms:100},{x:480,y:240,ms:100}],frameIterator:0,msTimer:0,looping:!0}}};
return this};k.exports=new b},{}],91:[function(e,k,v){function b(){C&&(C=null);C=new B.PhysicsEngine(G);C.game=q;q.world=C;q.over=!1;q.speed_reducer=5;q.teir_reducer=1;for(var a=I.getChildren(),b=a.length;b--;)null!=a[b]&&("scoreNode"!=a[b].name&&"startButtonNode"!=a[b].name&&"gameOverNode"!=a[b].name&&"howToButtonNode"!=a[b].name||I.removeChild(a[b]));document.body.style.cursor="none";N&&(N.dismount(),N={});N=q.addChild();q.activeEnemies=[];q.gameEnemies=N;N.name="gameEnemies";q.lives=1;N.createEnemiesComponent=
{id:null,node:null,active:!1,onMount:function(a){this.id=a.addComponent(this);this.node=a},onReceive:function(a,b){"createEnemies"==a&&this.node.requestUpdate(this.id)},onUpdate:function(){1!=this.active&&(D("start"),this.active=!0,w(),g(),q.emit("sequence_timed",{looping:!0}),D("end"))}};N.addComponent(N.createEnemiesComponent);q.emit("createEnemies",{});q.emit("loop",{interrupt:!0});a=I.addChild();q.scoreNode=a;a.name="scoreNode";q.sizes=q.getSize();a.setSizeMode("absolute","absolute").setAbsoluteSize(q.sizes[0],
100).setAlign(.5,.5).setPosition(-q.sizes[0]/2,-50);a.DOMElement=new x(a);a.DOMElement.setProperty("font-size","60px").setProperty("opacity","0.5").setProperty("text-align","center").setContent("0").setProperty("color","white").setProperty("z-index","2");q.score=0;t(q.boxNode.box);q.gameLivesNode=I.addChild();q.gameLivesNode.name="gameLivesNode";q.gameLivesNode.gameLivesComponent={id:null,node:null,life:null,onMount:function(a){this.id=a.addComponent(this);this.node=a},onReceive:function(a,b){"manageLives"==
a&&(this.life=b.life,this.node.requestUpdate(this.id))},onUpdate:function(a){a=this.life;q.lives+=a;if(1==a&&3>=q.lives){a=q.lives;var b=q.gameLivesNode.addChild();b.setSizeMode("absolute","absolute").setAbsoluteSize(40,40).setAlign(.5,.5).setPosition(-120+40*a,0,1);b.DOMElement=new x(b);b.DOMElement.setProperty("background-color","green").setProperty("opacity","0.4").setProperty("padding","5px 0px")}else-1==a&&null!=this.node._children[this.node._children.length-1]&&(this.node._children[this.node._children.length-
1].dismount(),this.node._children.splice(this.node._children.length-1,1));3<q.lives&&(q.lives=3)}};q.gameLivesNode.addComponent(q.gameLivesNode.gameLivesComponent)}function a(a){var c=I.addChild();q.startButtonNode=c;c.name="startButtonNode";c.setSizeMode("absolute","absolute").setAbsoluteSize(240,60).setAlign(.5,.8).setPosition(-120,-30);c.DOMElement=new x(c);var d="Start Game";a&&(d="Restart",c.setAbsoluteSize(150,60).setPosition(-75,-30));c.DOMElement.setProperty("font-size","46px").setContent(d).setProperty("z-index",
"2").setProperty("color","white");c.addComponent({id:null,node:null,gameOver:a,onMount:function(a){this.id=a.addComponent(this);this.node=a},onReceive:function(a,b){"startButton"==a&&this.node.requestUpdate(this.id)},onUpdate:function(){1==this.gameOver?location.reload():(q.started=!0,b())}})}function d(){var a=I.addChild();q.boxNode=a;a.name="boxNode";a.framedata=F.framedata.astro;a.idle=!0;a.ratio=.8;a.setSizeMode("absolute","absolute").setAbsoluteSize(80*a.ratio,120*a.ratio).setAlign(.5,.5).setPosition(-40*
a.ratio,-60*a.ratio,1E4).setOrigin(.5,.5);a.size={w:80,h:120};a.DOMElement=new x(a);a.DOMElement.setProperty("background-image","url(./images/astro_loop.png)").setProperty("background-size","800% 300%").setProperty("z-index","1000");var b=a.getPosition(),d=a.addComponent({id:null,node:null,onMount:function(a){this.id=a.addComponent(this);this.node=a},onUpdate:function(c){a.box||(a.box=new O({mass:1,size:[a.size.w*a.ratio-10,a.size.h*a.ratio-5,40],position:new J(b[0],b[1]),restitution:0,friction:0}),
a.box.node=a,C.addBody(a.box));1==q.started&&a.setAlign(0,0);c=a.box.getPosition();a.setPosition(c.x-10,c.y-20,1E4);a.requestUpdate(this.id)}});c(a);a.requestUpdate(d)}function c(a){a.addComponent({id:null,node:null,done:function(a){a.framedata.active.frameIterator=0;a.framedata.active.msTimer=0;a.framedata.active=null;a.animationTransitionable.halt()},onMount:function(a){this.id=a.addComponent(this);this.node=a},onReceive:function(a,b){var c=this.node.framedata;if(c[a]&&(c.active||(c.active=c[a],
c.active.event=a,c.active.frameIterator=0,"undefined"!=typeof b.looping&&(c.active.looping=b.looping),"undefined"!=typeof b.interruptable&&(c.active.interruptable=b.interruptable)),"undefined"!=typeof c.active.interruptable&&0==c.active.interruptable&&(b.interrupt=!1),1>c.active.frameIterator||b.interrupt)){b.interrupt&&(this.node.animationTransitionable&&this.node.animationTransitionable.halt(),c.active.frameIterator=0);c.active=c[a];c.active.event=a;"undefined"!=typeof b.interruptable&&(c.active.interruptable=
b.interruptable);for(var d=c.active.frames,e=0,f=0;f<d.length;f++)e+=d[f].ms;c.active.duration=e;this.node.animationTransitionable=new y(0);this.node.requestUpdate(this.id);this.node.animationTransitionable.from(0).to(e,"linear",e,null,this.done,this.node)}},onUpdate:function(){var a=this.node.framedata;if(a.active){var b=a.active,c=b.frames,d=this.node.animationTransitionable,e=1;this.node.ratio&&(e=this.node.ratio);1>d._state&&(b.frameIterator=0,b.msTimer=0);b.frameIterator<c.length?d._state<b.msTimer+
c[b.frameIterator].ms+2&&d._state>=b.msTimer-2&&null!=b?(this.node.DOMElement.setProperty("background-position","-"+c[b.frameIterator].x*e+"px -"+c[b.frameIterator].y*e+"px"),b.msTimer+=c[b.frameIterator].ms,b.frameIterator++,d.get(),this.node.requestUpdate(this.id)):d.isActive()&&(d.get(),this.node.requestUpdate(this.id)):b.frameIterator>=c.length&&(d.isActive()&&d.halt(),b.looping?(b.frameIterator=0,d.from(0).to(a.active.duration,"linear",a.active.duration,null,this.done,this.node),this.node.requestUpdate(this.id)):
a.active=null)}}})}function f(a){a.newEnemyComponent={id:null,node:null,done:function(a){a in a._updater._updateQueue&&z._updateQueue.splice(a._updater._updateQueue.indexOf(a),1);a._updateQueue&&a._updateQueue.length&&(a._updateQueue=[]);a._nextUpdateQueue&&a._nextUpdateQueue.length&&(a._nextUpdateQueue=[]);q.world.remove(a.collision);q.world.remove(a.sphere);q.activeEnemies.splice(q.activeEnemies.indexOf(a),1);a.dismount();t(q.boxNode.box)},onMount:function(a){this.id=a.addComponent(this);this.node=
a},onUpdate:function(a){a=this.node.sphere.getPosition();-100!=a.z&&(a.x-65>H[0]||0>a.x+65||a.y-65>H[1]||0>a.y+65?null!=this.node._id&&this.done(this.node):(this.node.setPosition(a.x,a.y,3),this.node.requestUpdate(this.id)))}};a.addComponent(a.newEnemyComponent)}function h(a,b,c){q.activeEnemies.push(a);var d=[1,2,3,4],d=d[Math.floor(Math.random()*d.length)],e=a._size;1==d?(a.setPosition(H[0],Math.round(Math.random()*H[1]),3),a.sphere.setPosition(H[0],Math.round(Math.random()*H[1]),0),a.name="right"):
2==d?(a.setPosition(-e,Math.round(Math.random()*H[1]),3),a.sphere.setPosition(-e,Math.round(Math.random()*H[1]),0),a.name="left"):3==d?(a.setPosition(Math.round(Math.random()*H[0]),H[1],3),a.sphere.setPosition(Math.round(Math.random()*H[0]),H[1],0),a.name="bottom"):4==d&&(a.setPosition(Math.round(Math.random()*H[0]),-e,3),a.sphere.setPosition(Math.round(Math.random()*H[0]),-e,0),a.name="top");d=.5>Math.random()?!0:!1;e=a.getPosition();"left"==a.name?1==d?e[1]>H[1]/2?a.sphere.setVelocity(b,-b):a.sphere.setVelocity(b,
b):a.sphere.setVelocity(b,0):"right"==a.name?1==d?e[1]>H[1]/2?a.sphere.setVelocity(-b,-b):a.sphere.setVelocity(-b,b):a.sphere.setVelocity(-b,0):"top"==a.name?1==d?e[0]>H[0]/2?a.sphere.setVelocity(-b,b):a.sphere.setVelocity(b,b):a.sphere.setVelocity(0,b):"bottom"==a.name&&(1==d?e[0]>H[0]/2?a.sphere.setVelocity(-b,-b):a.sphere.setVelocity(b,-b):a.sphere.setVelocity(0,-b));a.requestUpdate(a.newEnemyComponent.id);z.getClock().setTimeout(function(){g()},c)}function g(){var a=92;699<q.score&&(a=100);a=
Math.floor(Math.random()*a);if(0==q.over){var b="yellow";46<a&&93>a?b="red":93==a?b="blue":94==a?b="grey":95==a?b="green":96==a?b="orange":97==a?b="purple":98==a?b="violet":99==a?b="gainsboro":100==a&&(b="true_black");a=[200,275];a=Math.floor(Math.floor(Math.random()*(a[1]-a[0]))+a[0]+Math.floor(Math.random()*(q.score+1))/q.speed_reducer);q.timing_teir_i=0;200>q.score/q.teir_reducer?q.timing_teir_i=0:400>q.score/q.teir_reducer?q.timing_teir_i=1:800>q.score/q.teir_reducer?q.timing_teir_i=2:1600>q.score/
q.teir_reducer?q.timing_teir_i=3:2400>q.score/q.teir_reducer?q.timing_teir_i=4:2400<=q.score/q.teir_reducer&&(q.timing_teir_i=5);var c=[[500,800],[400,650],[300,500],[200,400],[100,250],[50,125]][q.timing_teir_i],c=Math.floor(Math.random()*(c[1]-c[0]))+c[0],d=N.addChild();d.name="";var e=[35,40,50,55],e=e[Math.floor(Math.random()*e.length)];d._size=e;d.setSizeMode("absolute","absolute").setAbsoluteSize(e,e).setAlign(0,0).setPosition(-(e+5),-(e+5),3);d.DOMElement=new x(d);var g;"yellow"==b?g="url(./images/star.png)":
"red"==b?g="url(./images/rock.png)":"blue"==b?g="url(./images/star_b.png)":"grey"==b?g="url(./images/star_g.png)":"green"==b?g="url(./images/star_grn.png)":"orange"==b?g="url(./images/star_oj.png)":"purple"==b?g="url(./images/star_p.png)":"violet"==b?g="url(./images/star_v.png)":"gainsboro"==b?g="url(./images/star_gb.png)":"true_black"==b&&(g="url(./images/star_blk.png)");d.color=b;d.DOMElement.setProperty("background-image",g).setProperty("background-size","100% 100%").setProperty("color","teal").setProperty("font-size",
"24px").setProperty("font-weight","bold").setProperty("word-wrap","break-word").setProperty("border-radius","100%").setProperty("text-align","center");g=d.getPosition();d._position=g;d.sphere=new L({mass:1,radius:e/2,position:new J(g[0],g[1],-100),restitution:0,friction:0});d.sphere.node=d;"red"!=b&&S.push(d.sphere);C.addBody(d.sphere);d.collision=C.addConstraint(new P([q.boxNode.box,d.sphere],{restitution:0}));t(d.sphere);f(d);h(d,a,c)}}function r(a){q.score+=a;q.scoreNode.DOMElement.setContent(q.score)}
function l(){if(q.slowTime)q.slowTimeBarTimerNode.slowTimeBarTimerComponent.startTime=z.getClock()._time;else{q.slowTime=!0;var a=I.addChild();q.slowTimeBarTimerNode=a;a.name="slowTimeBarTimerNode";a.setSizeMode("relative","absolute").setAbsoluteSize(null,10).setProportionalSize(.9,null).setAlign(.5,0);a.setPosition(-Math.floor(.9*H[0]/2),130,1);a.DOMElement=new x(a);a.DOMElement.setProperty("background-color","grey").setProperty("opacity","0.5");a.slowTimeBarTimerComponent={id:null,node:null,startTime:null,
done:function(a){a in a._updater._updateQueue&&z._updateQueue.splice(a._updater._updateQueue.indexOf(a),1);a._updateQueue&&a._updateQueue.length&&(a._updateQueue=[]);a._nextUpdateQueue&&a._nextUpdateQueue.length&&(a._nextUpdateQueue=[]);a.dismount();delete q.slowTime;delete q.slowTimeBarTimerNode.DOMElement;for(a=0;a<N._children.length;a++)if(null!=N._children[a]){for(var b=N._children[a].sphere.velocity.toArray(),c=0;c<b.length;c++)b[c]=Math.floor(2*b[c]);N._children[a].sphere.setVelocity(b[0],b[1],
b[2])}},onMount:function(a){this.id=a.addComponent(this);this.node=a},onUpdate:function(a){null==this.startTime?this.startTime=a:(a-=this.startTime,3E3<a?this.done(this.node):(a=.9*(1-a/3E3),this.node.setProportionalSize(a,null)));for(a=0;a<N._children.length;a++)if(null!=N._children[a]&&!N._children[a].slowed){for(var b=N._children[a].sphere.velocity.toArray(),c=0;c<b.length;c++)b[c]=Math.floor(b[c]/2);N._children[a].sphere.setVelocity(b[0],b[1],b[2]);N._children[a].slowed=!0}this.node.requestUpdate(this.id)}};
a.addComponent(a.slowTimeBarTimerComponent);a.requestUpdate(a.slowTimeBarTimerComponent.id)}}function m(){if(q.invincible)q.invincibleBarTimerNode.invincibleBarTimerComponent.startTime=z.getClock()._time;else{q.invincible=!0;var a=I.addChild();q.invincibleBarTimerNode=a;a.name="invincibleBarTimerNode";a.setSizeMode("relative","absolute").setAbsoluteSize(null,10).setProportionalSize(.9,null).setAlign(.5,0);a.setPosition(-Math.floor(.9*H[0]/2),100,1);a.DOMElement=new x(a);a.DOMElement.setProperty("background-color",
"blue").setProperty("opacity","0.5");a.invincibleBarTimerComponent={id:null,node:null,startTime:null,done:function(a){a.dismount();for(var b=0;b<z._updateQueue.length;b++)z._updateQueue[b]==a&&(z._updateQueue.splice(b,1),b--);delete q.invincible;delete q.invincibleBarTimerNode.DOMElement},onMount:function(a){this.id=a.addComponent(this);this.node=a},onUpdate:function(a){null==this.startTime?this.startTime=a:(a-=this.startTime,3E3<a?this.done(this.node):(a=.9*(1-a/3E3),this.node.setProportionalSize(a,
null)));this.node.requestUpdate(this.id)}};a.addComponent(a.invincibleBarTimerComponent);a.requestUpdate(a.invincibleBarTimerComponent.id)}}function p(){if(q.warp)q.warpBarTimerNode.warpBarTimerComponent.startTime=z.getClock()._time;else{q.warp=!0;var a=I.addChild();q.warpBarTimerNode=a;a.name="warpBarTimerNode";a.setSizeMode("relative","absolute").setAbsoluteSize(null,10).setProportionalSize(.9,null).setAlign(.5,0);a.setPosition(-Math.floor(.9*H[0]/2),H[1]-100,1);a.DOMElement=new x(a);a.DOMElement.setProperty("background-color",
"red").setProperty("opacity","0.5");a.warpBarTimerComponent={id:null,node:null,startTime:null,done:function(a){a.dismount();for(var b=0;b<z._updateQueue.length;b++)z._updateQueue[b]==a&&(z._updateQueue.splice(b,1),b--);delete q.warp;delete q.warpBarTimerNode.DOMElement},onMount:function(a){this.id=a.addComponent(this);this.node=a},onUpdate:function(a){null==this.startTime?this.startTime=a:(a-=this.startTime,5E3<a?this.done(this.node):(a=.9*(1-a/5E3),this.node.setProportionalSize(a,null)));this.node.requestUpdate(this.id)}};
a.addComponent(a.warpBarTimerComponent);a.requestUpdate(a.warpBarTimerComponent.id)}}function u(){if(q.magnetic)q.magneticBarTimerNode.magneticBarTimerComponent.startTime=z.getClock()._time;else{q.magnetic=!0;var a=I.addChild();q.magneticBarTimerNode=a;a.name="magneticBarTimerNode";a.setSizeMode("relative","absolute").setAbsoluteSize(null,10).setProportionalSize(.9,null).setAlign(.5,0);a.setPosition(-Math.floor(.9*H[0]/2),H[1]-130,1);a.DOMElement=new x(a);a.DOMElement.setProperty("background-color",
"purple").setProperty("opacity","0.5");a.magneticBarTimerComponent={id:null,node:null,startTime:null,done:function(a){a.dismount();for(var b=0;b<z._updateQueue.length;b++)z._updateQueue[b]==a&&(z._updateQueue.splice(b,1),b--);delete q.magnetic;delete q.magneticBarTimerNode.DOMElement},onMount:function(a){this.id=a.addComponent(this);this.node=a},onUpdate:function(a){null==this.startTime?this.startTime=a:(a-=this.startTime,5E3<a?this.done(this.node):(a=.9*(1-a/5E3),this.node.setProportionalSize(a,
null)));q.gravity&&q.gravity.update();a=new K(q.boxNode.box,S,{strength:1E8});q.gravity=a;this.node.requestUpdate(this.id)}};a.addComponent(a.magneticBarTimerComponent);a.requestUpdate(a.magneticBarTimerComponent.id)}}function n(){N.removeComponent(N.collisionComponent);for(var b=N.getChildren();b.length;)null==b[0]?b.splice(0,1):b[0].newEnemyComponent.done(b[0]);N.requestUpdate(N.createEnemiesComponent.id);q.over=!0;var b=I.getChildren()[1],c=I.addChild();c.name="gameOverNode";c.setSizeMode("absolute",
"absolute").setAbsoluteSize(400,100).setAlign(.5,.5).setPosition(-200,-50);c.DOMElement=new x(c);c.DOMElement.setProperty("font-size","64px").setProperty("text-align","center").setContent("Game Over").setProperty("background","none").setProperty("color","white");a(!0);b.setAlign(.5,.3,0);b.DOMElement.setProperty("opacity","1.0");q.started=!1;q.boxNode.setAlign(.5,.7).setPosition(-20,-20,1E3);q.boxNode.idle=!0;document.body.style.cursor="auto";1==q.storage.available&&window.localStorage.high_score&&
window.localStorage.high_score<q.score&&(window.localStorage.high_score=q.score)}function A(a){var b=I.addChild();q.shadow=b;b.setSizeMode("relative","relative").setProportionalSize(1,1).setAlign(0,0).setPosition(0,0);b.DOMElement=new x(b);b.DOMElement.setProperty("background-color","black").setProperty("opacity","0.5");b=I.addChild();q.rulesView=b;b.setSizeMode("relative","relative").setProportionalSize(.8,.8).setAlign(0,0).setPosition(20,20);b.DOMElement=new x(b);b.DOMElement.setProperty("color",
"white").setProperty("font-size","24px").setContent("Collect the Stars and avoid the Rocks!<br>Don't lift your finger off the screen<wbr> except if you get the Warp powerup!!<br>The key to a high score<wbr>is to collect powerups and use them to your<wbr>advantage!<br><br>Yellow<div id='yellow'></div> - gives you some points!<br>Blue<div id='blue'></div> - makes you invincible for 3 seconds!<br>Grey<div id='grey'></div> - slows down time by 1/2 for 3 seconds!<br>Green<div id='green'></div> - reduces how often objects are spawned!<br>Orange<div id='orange'></div> - reduces how fast objects<wbr> are launched!<br>Pink<div id='pink'></div> - gives you a thousand points instantly!<br>Red<div id='gainsboro'></div> - gives you an exra life (up to 2)!<br>Purple<div id='purple'></div> - makes you master of warp holes for 5 seconds!<br>Black<div id='black'></div> - makes all stars attracted to you for 5 seconds!").setProperty("zIndex",
"98");q.boxNode.box.setPosition(-1E3,-1E3,1E4);q.startButtonNode.setPosition(-1E3,-1E3);q.howToButtonNode.setPosition(-1E3,-1E3);b=I.addChild();b.name="howToX";q.howToX=b;b.setSizeMode("absolute","absolute").setAbsoluteSize("40","40").setAlign(.9,0).setPosition(-10,40);b.DOMElement=new x(b);b.DOMElement.setContent("X").setProperty("zIndex","98").setProperty("color","white").setProperty("font-size","24px");b.addComponent({id:null,node:null,gameOver:a,onMount:function(a){this.id=a.addComponent(this);
this.node=a},onReceive:function(a,b){"howToXButton"==a&&this.node.requestUpdate(this.id)},onUpdate:function(){I.removeChild(q.howToX);I.removeChild(q.rulesView);I.removeChild(q.shadow);q.startButtonNode.setPosition(-120,-30);q.howToButtonNode.setPosition(-90,40);q.boxNode.box.setPosition(-40*q.boxNode.ratio,-60*q.boxNode.ratio,1E4)}})}function t(a){a.angularMomentum=new J(0,0,0);a.angularVelocity=new J(0,0,0);a.momentum=new J(0,0,0);a.orientation=new M(1,0,0,0);a.velocity=new J(0,0,0);a.torque=new J(0,
0,0);a.inverseInertia=new E([1,0,0,0,1,0,0,0,1]);a.localInertia=new E([1,0,0,0,1,0,0,0,1]);a.localInverseInertia=new E([1,0,0,0,1,0,0,0,1]);a.restitution=0;a.friction=0}function w(){var a=q.gameEnemies,b={id:null,node:null,onMount:function(a){this.id=a.addComponent(this);this.node=a},onUpdate:function(a){for(var b=q.activeEnemies.map(function(a){return a.collision}),c=b.length,d,e,f,g=0;g<c;g++)(d=b[g])&&d.contactManifoldTable.collisionMatrix.hasOwnProperty(0)&&(t(q.boxNode.box),d.targets[1].node.DOMElement&&
(e=d.targets[1].node,f=e.color,e.newEnemyComponent.done(e),d.detected||(d.detected=!0,"yellow"==f?r(2*e._size):"red"==f?q.invincible||1!=q.lives?q.invincible||q.emit("manageLives",{life:-1}):n():"blue"==f?m():"grey"==f?l():"green"==f?q.teir_reducer+=2:"orange"==f?q.speed_reducer+=10:"purple"==f?r(1E3):"violet"==f?q.emit("manageLives",{life:1}):"gainsboro"==f?u():"true_black"==f&&p())));C.update(a);q.over||r(1);this.node.requestUpdate(this.id)}};a.collisionComponent=b;a.addComponent(b);a.requestUpdate(b.id)}
function D(a){if("start"==a){a=I.addChild();a.setPosition(0,0,1E6).setSizeMode("relative","relative").setProportionalSize(1,1);a.DOMElement=new x(a);a.DOMElement.setProperty("background-color","white");var b=a.addChild();q.loading=a;b.name="loadingNode";b.setSizeMode("absolute","absolute").setAbsoluteSize(240,60).setAlign(.5,.5).setPosition(-120,-30,1000002).setOrigin(.5,.5);b.DOMElement=new x(b);b.DOMElement.setProperty("z-index","1000").setProperty("font-size","24px").setProperty("color","black").setContent("Loading...");
b.getPosition();b.addComponent({id:null,node:null,onMount:function(a){this.id=a.addComponent(this);this.node=a},onUpdate:function(a){}})}else"end"==a&&I.removeChild(q.loading)}var x=e("famous/dom-renderables/DOMElement"),z=e("famous/core/FamousEngine");k=e("famous/core/Dispatch");var y=e("famous/transitions/Transitionable");e("famous/core/Node");e("famous/components/Position");e("famous/math");var B=e("famous/physics"),L=e("famous/physics/bodies/Sphere"),O=e("famous/physics/bodies/Box"),J=e("famous/math/Vec3"),
E=e("famous/math/Mat33"),M=e("famous/math/Quaternion"),P=e("famous/physics/constraints/Collision"),K=e("famous/physics/forces/Gravity3D");e=e("./framedata.js");z.init();var F=e.init();e=z.createScene();e.name="theScene";document.theScene=e;var G={},C=new B.PhysicsEngine(G),q=e.addChild();q.name="game";q.dispatch=k;var I=q.addChild();I.name="gameUI";var H=q.getSize(),N,S=[];document.addEventListener("touchmove",function(a){a.preventDefault();q.onReceive(a.type,a)},!1);document.addEventListener("touchend",
function(a){a.preventDefault();q.onReceive(a.type,a)},!1);document.addEventListener("keydown",function(a){q.onReceive(a.type,a)}.bind(void 0));document.addEventListener("mousemove",function(a){q.onReceive(a.type,a)});document.addEventListener("click",function(a){q.onReceive(a.type,a)});q.onReceive=function(a,b){if("keydown"==a)66==b.keyCode?q.emit("sequence",b):67==b.keyCode?q.emit("reverseSequence",b):65==b.keyCode&&(b.interruptable=!1,q.emit("sequence_timed",b));else if("click"==a||"touchend"==
a){if(b.target.attributes.getNamedItem("data-fa-path"))var c=b.target.attributes.getNamedItem("data-fa-path").value;else b.target.parentNode.attributes.getNamedItem("data-fa-path")&&(c=b.target.parentNode.attributes.getNamedItem("data-fa-path").value);(c=q.dispatch.getNode(c))&&"startButtonNode"==c.name?q.emit("startButton",b):c&&"addEnemyButtonNode"==c.name?q.emit("addEnemyButton",b):c&&"howToButtonNode"==c.name?q.emit("howToButton",b):c&&"howToX"==c.name&&q.emit("howToXButton",b)}else if(("mousemove"==
a||"touchmove"==a)&&q.started&&1==q.started)a:{q.boxNode.box||d();var e;"touchmove"==event.type?(c=event.touches[0].clientX-q.boxNode.size/2,e=event.touches[0].clientY-q.boxNode.size/2):(c=event.clientX-q.boxNode.size.w/2,e=event.clientY-q.boxNode.size.h/2);if(q.warp||!q.idle)q.previousPosition||(q.previousPosition={x:c,y:e}),q.boxNode.box.setPosition(c,e,0);else if(!q.warp&&q.previousPosition){var f=Math.abs(q.previousPosition.x-c),g=Math.abs(q.previousPosition.y=e);if(179<f||179<g)break a;else q.boxNode.box.setPosition(c,
e,0);q.previousPosition={x:c,y:e}}q.boxNode.box.setPosition(c,e,0)}};d();a();(function(a){var b=I.addChild();q.howToButtonNode=b;b.name="howToButtonNode";b.setSizeMode("absolute","absolute").setAbsoluteSize(190,60).setAlign(.5,.8).setPosition(-95,40);b.DOMElement=new x(b);b.DOMElement.setProperty("font-size","30px").setContent("How To Play").setProperty("z-index","2").setProperty("color","white");b.addComponent({id:null,node:null,gameOver:a,onMount:function(a){this.id=a.addComponent(this);this.node=
a},onReceive:function(a,b){"howToButton"==a&&this.node.requestUpdate(this.id)},onUpdate:function(){A()}})})();e=I.addChild();e.name="background";e.setSizeMode("relative","relative").setProportionalSize(1,1).setAlign(0,0);e.DOMElement=new x(e);e.DOMElement.setProperty("background-image","url(./images/space_new.png)").setProperty("z-index","1").setProperty("background-size","100% 100%");(function(a){try{var b=window[a];b.setItem("__storage_test__","__storage_test__");b.removeItem("__storage_test__");
return!0}catch(c){return!1}})("localStorage")?(window.localStorage.high_score||(window.localStorage.high_score=0),q.storage={available:!0}):q.storage={available:!1};q.storage.available&&window.localStorage.high_score&&(e=I.addChild(),q.highScoreNode=e,e.name="highScoreNode",k=window.localStorage.high_score.length,e.setSizeMode("absolute","absolute").setAbsoluteSize(50*k,30).setAlign(1,0).setPosition(-25*k,0),e.DOMElement=new x(e),e.DOMElement.setProperty("font-size","40px").setContent(window.localStorage.high_score).setProperty("z-index",
"2").setProperty("color","white").setProperty("opacity","0.5"))},{"./framedata.js":90,"famous/components/Position":2,"famous/core/Dispatch":6,"famous/core/FamousEngine":8,"famous/core/Node":9,"famous/dom-renderables/DOMElement":17,"famous/math":36,"famous/math/Mat33":32,"famous/math/Quaternion":33,"famous/math/Vec3":35,"famous/physics":64,"famous/physics/bodies/Box":39,"famous/physics/bodies/Sphere":41,"famous/physics/constraints/Collision":46,"famous/physics/forces/Gravity3D":60,"famous/transitions/Transitionable":73}]},
{},[91]);
