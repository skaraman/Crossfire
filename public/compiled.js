(function(d){"object"===typeof exports&&"undefined"!==typeof module?module.exports=d():"function"===typeof define&&define.amd?define([],d):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).Matter=d()})(function(){return function a(b,e,c){function f(g,q){if(!e[g]){if(!b[g]){var l="function"==typeof require&&require;if(!q&&l)return l(g,!0);if(h)return h(g,!0);l=Error("Cannot find module '"+g+"'");throw l.code="MODULE_NOT_FOUND",l;}l=e[g]={exports:{}};
b[g][0].call(l.exports,function(a){var c=b[g][1][a];return f(c?c:a)},l,l.exports,a,b,e,c)}return e[g].exports}for(var h="function"==typeof require&&require,k=0;k<c.length;k++)f(c[k]);return f}({1:[function(a,b,e){var c={};b.exports=c;var f=a("../geometry/Vertices"),h=a("../geometry/Vector"),k=a("../core/Sleeping");a("../render/Render");var g=a("../core/Common"),q=a("../geometry/Bounds"),l=a("../geometry/Axes");(function(){c._inertiaScale=4;c._nextCollidingGroupId=1;c._nextNonCollidingGroupId=-1;c._nextCategory=
1;c.create=function(a){var m={id:g.nextId(),type:"body",label:"Body",parts:[],angle:0,vertices:f.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,
timeScale:1,render:{visible:!0,opacity:1,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0},lineWidth:1.5}},m=g.extend(m,a);c.set(m,{bounds:m.bounds||q.create(m.vertices),positionPrev:m.positionPrev||h.clone(m.position),anglePrev:m.anglePrev||m.angle,vertices:m.vertices,parts:m.parts||[m],isStatic:m.isStatic,isSleeping:m.isSleeping,parent:m.parent||m});f.rotate(m.vertices,m.angle,m.position);l.rotate(m.axes,m.angle);q.update(m.bounds,m.vertices,m.velocity);c.set(m,{axes:a.axes||m.axes,area:a.area||m.area,
mass:a.mass||m.mass,inertia:a.inertia||m.inertia});a=m.isStatic?"#eeeeee":g.choose(["#556270","#4ECDC4","#C7F464","#FF6B6B","#C44D58"]);var p=g.shadeColor(a,-20);m.render.fillStyle=m.render.fillStyle||a;m.render.strokeStyle=m.render.strokeStyle||p;m.render.sprite.xOffset+=-(m.bounds.min.x-m.position.x)/(m.bounds.max.x-m.bounds.min.x);m.render.sprite.yOffset+=-(m.bounds.min.y-m.position.y)/(m.bounds.max.y-m.bounds.min.y);return m};c.nextGroup=function(a){return a?c._nextNonCollidingGroupId--:c._nextCollidingGroupId++};
c.nextCategory=function(){c._nextCategory<<=1;return c._nextCategory};c.set=function(a,m,p){var b;"string"===typeof m&&(b=m,m={},m[b]=p);for(b in m)if(p=m[b],m.hasOwnProperty(b))switch(b){case "isStatic":c.setStatic(a,p);break;case "isSleeping":k.set(a,p);break;case "mass":c.setMass(a,p);break;case "density":c.setDensity(a,p);break;case "inertia":c.setInertia(a,p);break;case "vertices":c.setVertices(a,p);break;case "position":c.setPosition(a,p);break;case "angle":c.setAngle(a,p);break;case "velocity":c.setVelocity(a,
p);break;case "angularVelocity":c.setAngularVelocity(a,p);break;case "parts":c.setParts(a,p);break;default:a[b]=p}};c.setStatic=function(a,c){for(var b=0;b<a.parts.length;b++){var g=a.parts[b];if(g.isStatic=c)g.restitution=0,g.friction=1,g.mass=g.inertia=g.density=Infinity,g.inverseMass=g.inverseInertia=0,g.positionPrev.x=g.position.x,g.positionPrev.y=g.position.y,g.anglePrev=g.angle,g.angularVelocity=0,g.speed=0,g.angularSpeed=0,g.motion=0}};c.setMass=function(a,c){a.mass=c;a.inverseMass=1/a.mass;
a.density=a.mass/a.area};c.setDensity=function(a,m){c.setMass(a,m*a.area);a.density=m};c.setInertia=function(a,c){a.inertia=c;a.inverseInertia=1/a.inertia};c.setVertices=function(a,m){a.vertices=m[0].body===a?m:f.create(m,a);a.axes=l.fromVertices(a.vertices);a.area=f.area(a.vertices);c.setMass(a,a.density*a.area);var b=f.centre(a.vertices);f.translate(a.vertices,b,-1);c.setInertia(a,c._inertiaScale*f.inertia(a.vertices,a.mass));f.translate(a.vertices,a.position);q.update(a.bounds,a.vertices,a.velocity)};
c.setParts=function(r,m,b){var g;m=m.slice(0);r.parts.length=0;r.parts.push(r);r.parent=r;for(g=0;g<m.length;g++){var l=m[g];l!==r&&(l.parent=r,r.parts.push(l))}if(1!==r.parts.length){if("undefined"!==typeof b?b:1){b=[];for(g=0;g<m.length;g++)b=b.concat(m[g].vertices);f.clockwiseSort(b);m=f.hull(b);g=f.centre(m);c.setVertices(r,m);f.translate(r.vertices,g)}m=a(r);r.area=m.area;r.parent=r;r.position.x=m.centre.x;r.position.y=m.centre.y;r.positionPrev.x=m.centre.x;r.positionPrev.y=m.centre.y;c.setMass(r,
m.mass);c.setInertia(r,m.inertia);c.setPosition(r,m.centre)}};c.setPosition=function(a,c){var b=h.sub(c,a.position);a.positionPrev.x+=b.x;a.positionPrev.y+=b.y;for(var g=0;g<a.parts.length;g++){var l=a.parts[g];l.position.x+=b.x;l.position.y+=b.y;f.translate(l.vertices,b);q.update(l.bounds,l.vertices,a.velocity)}};c.setAngle=function(a,c){var b=c-a.angle;a.anglePrev+=b;for(var g=0;g<a.parts.length;g++){var v=a.parts[g];v.angle+=b;f.rotate(v.vertices,b,a.position);l.rotate(v.axes,b);q.update(v.bounds,
v.vertices,a.velocity);0<g&&h.rotateAbout(v.position,b,a.position,v.position)}};c.setVelocity=function(a,c){a.positionPrev.x=a.position.x-c.x;a.positionPrev.y=a.position.y-c.y;a.velocity.x=c.x;a.velocity.y=c.y;a.speed=h.magnitude(a.velocity)};c.setAngularVelocity=function(a,c){a.anglePrev=a.angle-c;a.angularVelocity=c;a.angularSpeed=Math.abs(a.angularVelocity)};c.translate=function(a,b){c.setPosition(a,h.add(a.position,b))};c.rotate=function(a,b){c.setAngle(a,a.angle+b)};c.scale=function(b,m,g,h){for(h=
0;h<b.parts.length;h++){var k=b.parts[h];f.scale(k.vertices,m,g,b.position);k.axes=l.fromVertices(k.vertices);b.isStatic||(k.area=f.area(k.vertices),c.setMass(k,b.density*k.area),f.translate(k.vertices,{x:-k.position.x,y:-k.position.y}),c.setInertia(k,f.inertia(k.vertices,k.mass)),f.translate(k.vertices,{x:k.position.x,y:k.position.y}));q.update(k.bounds,k.vertices,b.velocity)}b.isStatic||(m=a(b),b.area=m.area,c.setMass(b,m.mass),c.setInertia(b,m.inertia))};c.update=function(a,c,b,g){c=Math.pow(c*
b*a.timeScale,2);b=1-a.frictionAir*b*a.timeScale;var k=a.position.y-a.positionPrev.y;a.velocity.x=(a.position.x-a.positionPrev.x)*b*g+a.force.x/a.mass*c;a.velocity.y=k*b*g+a.force.y/a.mass*c;a.positionPrev.x=a.position.x;a.positionPrev.y=a.position.y;a.position.x+=a.velocity.x;a.position.y+=a.velocity.y;a.angularVelocity=(a.angle-a.anglePrev)*b*g+a.torque/a.inertia*c;a.anglePrev=a.angle;a.angle+=a.angularVelocity;a.speed=h.magnitude(a.velocity);a.angularSpeed=Math.abs(a.angularVelocity);for(g=0;g<
a.parts.length;g++)c=a.parts[g],f.translate(c.vertices,a.velocity),0<g&&(c.position.x+=a.velocity.x,c.position.y+=a.velocity.y),0!==a.angularVelocity&&(f.rotate(c.vertices,a.angularVelocity,a.position),l.rotate(c.axes,a.angularVelocity),0<g&&h.rotateAbout(c.position,a.angularVelocity,a.position,c.position)),q.update(c.bounds,c.vertices,a.velocity)};c.applyForce=function(a,c,b){a.force.x+=b.x;a.force.y+=b.y;a.torque+=(c.x-a.position.x)*b.y-(c.y-a.position.y)*b.x};var a=function(a){for(var c={mass:0,
area:0,inertia:0,centre:{x:0,y:0}},b=1===a.parts.length?0:1;b<a.parts.length;b++){var g=a.parts[b];c.mass+=g.mass;c.area+=g.area;c.inertia+=g.inertia;c.centre=h.add(c.centre,h.mult(g.position,Infinity!==g.mass?g.mass:1))}c.centre=h.div(c.centre,Infinity!==c.mass?c.mass:a.parts.length);return c}})()},{"../core/Common":14,"../core/Sleeping":20,"../geometry/Axes":23,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27,"../render/Render":29}],2:[function(a,b,e){var c={};b.exports=
c;var f=a("../core/Events"),h=a("../core/Common"),k=a("./Body");(function(){c.create=function(a){return h.extend({id:h.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite"},a)};c.setModified=function(a,b,l,f){a.isModified=b;l&&a.parent&&c.setModified(a.parent,b,l,f);if(f)for(var r=0;r<a.composites.length;r++)c.setModified(a.composites[r],b,l,f)};c.add=function(a,b){var l=[].concat(b);f.trigger(a,"beforeAdd",{object:b});for(var k=0;k<l.length;k++){var r=
l[k];switch(r.type){case "body":if(r.parent!==r){h.log("Composite.add: skipped adding a compound body part (you must add its parent instead)","warn");break}c.addBody(a,r);break;case "constraint":c.addConstraint(a,r);break;case "composite":c.addComposite(a,r);break;case "mouseConstraint":c.addConstraint(a,r.constraint)}}f.trigger(a,"afterAdd",{object:b});return a};c.remove=function(a,b,l){var h=[].concat(b);f.trigger(a,"beforeRemove",{object:b});for(var r=0;r<h.length;r++){var m=h[r];switch(m.type){case "body":c.removeBody(a,
m,l);break;case "constraint":c.removeConstraint(a,m,l);break;case "composite":c.removeComposite(a,m,l);break;case "mouseConstraint":c.removeConstraint(a,m.constraint)}}f.trigger(a,"afterRemove",{object:b});return a};c.addComposite=function(a,b){a.composites.push(b);b.parent=a;c.setModified(a,!0,!0,!1);return a};c.removeComposite=function(a,b,l){var f=h.indexOf(a.composites,b);-1!==f&&(c.removeCompositeAt(a,f),c.setModified(a,!0,!0,!1));if(l)for(l=0;l<a.composites.length;l++)c.removeComposite(a.composites[l],
b,!0);return a};c.removeCompositeAt=function(a,b){a.composites.splice(b,1);c.setModified(a,!0,!0,!1);return a};c.addBody=function(a,b){a.bodies.push(b);c.setModified(a,!0,!0,!1);return a};c.removeBody=function(a,b,l){var f=h.indexOf(a.bodies,b);-1!==f&&(c.removeBodyAt(a,f),c.setModified(a,!0,!0,!1));if(l)for(l=0;l<a.composites.length;l++)c.removeBody(a.composites[l],b,!0);return a};c.removeBodyAt=function(a,b){a.bodies.splice(b,1);c.setModified(a,!0,!0,!1);return a};c.addConstraint=function(a,b){a.constraints.push(b);
c.setModified(a,!0,!0,!1);return a};c.removeConstraint=function(a,b,l){var f=h.indexOf(a.constraints,b);-1!==f&&c.removeConstraintAt(a,f);if(l)for(l=0;l<a.composites.length;l++)c.removeConstraint(a.composites[l],b,!0);return a};c.removeConstraintAt=function(a,b){a.constraints.splice(b,1);c.setModified(a,!0,!0,!1);return a};c.clear=function(a,b,l){if(l)for(l=0;l<a.composites.length;l++)c.clear(a.composites[l],b,!0);b?a.bodies=a.bodies.filter(function(a){return a.isStatic}):a.bodies.length=0;a.constraints.length=
0;a.composites.length=0;c.setModified(a,!0,!0,!1);return a};c.allBodies=function(a){for(var b=[].concat(a.bodies),l=0;l<a.composites.length;l++)b=b.concat(c.allBodies(a.composites[l]));return b};c.allConstraints=function(a){for(var b=[].concat(a.constraints),l=0;l<a.composites.length;l++)b=b.concat(c.allConstraints(a.composites[l]));return b};c.allComposites=function(a){for(var b=[].concat(a.composites),l=0;l<a.composites.length;l++)b=b.concat(c.allComposites(a.composites[l]));return b};c.get=function(a,
b,l){var f;switch(l){case "body":f=c.allBodies(a);break;case "constraint":f=c.allConstraints(a);break;case "composite":f=c.allComposites(a).concat(a)}if(!f)return null;a=f.filter(function(a){return a.id.toString()===b.toString()});return 0===a.length?null:a[0]};c.move=function(a,b,l){c.remove(a,b);c.add(l,b);return a};c.rebase=function(a){for(var b=c.allBodies(a).concat(c.allConstraints(a)).concat(c.allComposites(a)),l=0;l<b.length;l++)b[l].id=h.nextId();c.setModified(a,!0,!0,!1);return a};c.translate=
function(a,b,l){l=l?c.allBodies(a):a.bodies;for(var f=0;f<l.length;f++)k.translate(l[f],b);c.setModified(a,!0,!0,!1);return a};c.rotate=function(a,b,l,f){var r=Math.cos(b),m=Math.sin(b);f=f?c.allBodies(a):a.bodies;for(var p=0;p<f.length;p++){var h=f[p],e=h.position.x-l.x,u=h.position.y-l.y;k.setPosition(h,{x:l.x+(e*r-u*m),y:l.y+(e*m+u*r)});k.rotate(h,b)}c.setModified(a,!0,!0,!1);return a};c.scale=function(a,b,l,f,r){r=r?c.allBodies(a):a.bodies;for(var m=0;m<r.length;m++){var p=r[m];k.setPosition(p,
{x:f.x+(p.position.x-f.x)*b,y:f.y+(p.position.y-f.y)*l});k.scale(p,b,l)}c.setModified(a,!0,!0,!1);return a}})()},{"../core/Common":14,"../core/Events":16,"./Body":1}],3:[function(a,b,e){var c={};b.exports=c;var f=a("./Composite");a("../constraint/Constraint");var h=a("../core/Common");(function(){c.create=function(a){var c=f.create();return h.extend(c,{label:"World",gravity:{x:0,y:1,scale:.001},bounds:{min:{x:-Infinity,y:-Infinity},max:{x:Infinity,y:Infinity}}},a)}})()},{"../constraint/Constraint":12,
"../core/Common":14,"./Composite":2}],4:[function(a,b,e){var c={};b.exports=c;(function(){c.create=function(a){return{id:c.id(a),vertex:a,normalImpulse:0,tangentImpulse:0}};c.id=function(a){return a.body.id+"_"+a.index}})()},{}],5:[function(a,b,e){var c={};b.exports=c;var f=a("./SAT"),h=a("./Pair"),k=a("../geometry/Bounds");(function(){c.collisions=function(a,b){for(var l=[],v=b.pairs.table,r=0;r<a.length;r++){var m=a[r][0],p=a[r][1];if((!m.isStatic&&!m.isSleeping||!p.isStatic&&!p.isSleeping)&&c.canCollide(m.collisionFilter,
p.collisionFilter)&&k.overlaps(m.bounds,p.bounds))for(var e=1<m.parts.length?1:0;e<m.parts.length;e++)for(var x=m.parts[e],u=1<p.parts.length?1:0;u<p.parts.length;u++){var t=p.parts[u];if(x===m&&t===p||k.overlaps(x.bounds,t.bounds)){var w=h.id(x,t),w=v[w],t=f.collides(x,t,w&&w.isActive?w.collision:null);t.collided&&l.push(t)}}}return l};c.canCollide=function(a,c){return a.group===c.group&&0!==a.group?0<a.group:0!==(a.mask&c.category)&&0!==(c.mask&a.category)}})()},{"../geometry/Bounds":24,"./Pair":7,
"./SAT":11}],6:[function(a,b,e){var c={};b.exports=c;var f=a("./Pair"),h=a("./Detector"),k=a("../core/Common");(function(){c.create=function(a){return k.extend({controller:c,detector:h.collisions,buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48},a)};c.update=function(c,b,h,r){var m,p,e=h.world,x=c.buckets,u,t;m=!1;for(h=0;h<b.length;h++){var w=b[h];if(!(w.isSleeping&&!r||0>w.bounds.max.x||w.bounds.min.x>e.bounds.width||0>w.bounds.max.y||w.bounds.min.y>e.bounds.height)){var z;z=w.bounds;
z=a(Math.floor(z.min.x/c.bucketWidth),Math.floor(z.max.x/c.bucketWidth),Math.floor(z.min.y/c.bucketHeight),Math.floor(z.max.y/c.bucketHeight));if(!w.region||z.id!==w.region.id||r){if(!w.region||r)w.region=z;var y;m=w.region;y=a(Math.min(z.startCol,m.startCol),Math.max(z.endCol,m.endCol),Math.min(z.startRow,m.startRow),Math.max(z.endRow,m.endRow));for(m=y.startCol;m<=y.endCol;m++)for(p=y.startRow;p<=y.endRow;p++){t=m+","+p;u=x[t];var B=m>=z.startCol&&m<=z.endCol&&p>=z.startRow&&p<=z.endRow,C=m>=w.region.startCol&&
m<=w.region.endCol&&p>=w.region.startRow&&p<=w.region.endRow;if(!B&&C&&C&&u){var D=c,G=u,H=w;G.splice(k.indexOf(G,H),1);for(var E=0;E<G.length;E++){var I=f.id(H,G[E]);(I=D.pairs[I])&&--I[2]}}if(w.region===z||B&&!C||r){u||(u=x[t]=[]);t=c;B=w;for(C=0;C<u.length;C++)D=u[C],B.id===D.id||B.isStatic&&D.isStatic||(G=f.id(B,D),(H=t.pairs[G])?H[2]+=1:t.pairs[G]=[B,D,1]);u.push(B)}}w.region=z;m=!0}}}if(m){h=[];b=k.keys(c.pairs);for(e=0;e<b.length;e++)r=c.pairs[b[e]],0<r[2]?h.push(r):delete c.pairs[b[e]];c.pairsList=
h}};c.clear=function(a){a.buckets={};a.pairs={};a.pairsList=[]};var a=function(a,c,b,f){return{id:a+","+c+","+b+","+f,startCol:a,endCol:c,startRow:b,endRow:f}}})()},{"../core/Common":14,"./Detector":5,"./Pair":7}],7:[function(a,b,e){var c={};b.exports=c;var f=a("./Contact");(function(){c.create=function(a,b){var f=a.bodyA,q=a.bodyB,l=a.parentA,v=a.parentB,f={id:c.id(f,q),bodyA:f,bodyB:q,contacts:{},activeContacts:[],separation:0,isActive:!0,timeCreated:b,timeUpdated:b,inverseMass:l.inverseMass+v.inverseMass,
friction:Math.min(l.friction,v.friction),frictionStatic:Math.max(l.frictionStatic,v.frictionStatic),restitution:Math.max(l.restitution,v.restitution),slop:Math.max(l.slop,v.slop)};c.update(f,a,b);return f};c.update=function(a,b,g){var q=a.contacts,l=b.supports,v=a.activeContacts,r=b.parentA,m=b.parentB;a.collision=b;a.inverseMass=r.inverseMass+m.inverseMass;a.friction=Math.min(r.friction,m.friction);a.frictionStatic=Math.max(r.frictionStatic,m.frictionStatic);a.restitution=Math.max(r.restitution,
m.restitution);a.slop=Math.max(r.slop,m.slop);v.length=0;if(b.collided){for(r=0;r<l.length;r++){var m=l[r],p=f.id(m),e=q[p];e?v.push(e):v.push(q[p]=f.create(m))}a.separation=b.depth;c.setActive(a,!0,g)}else!0===a.isActive&&c.setActive(a,!1,g)};c.setActive=function(a,c,b){c?(a.isActive=!0,a.timeUpdated=b):(a.isActive=!1,a.activeContacts.length=0)};c.id=function(a,c){return a.id<c.id?a.id+"_"+c.id:c.id+"_"+a.id}})()},{"./Contact":4}],8:[function(a,b,e){var c={};b.exports=c;var f=a("./Pair"),h=a("../core/Common");
(function(){c.create=function(a){return h.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},a)};c.update=function(a,c,b){var l=a.list,v=a.table,r=a.collisionStart,m=a.collisionEnd;a=a.collisionActive;var p=[],e,x,u,t;r.length=0;m.length=0;for(t=a.length=0;t<c.length;t++)e=c[t],e.collided&&(x=f.id(e.bodyA,e.bodyB),p.push(x),(u=v[x])?(u.isActive?a.push(u):r.push(u),f.update(u,e,b)):(u=f.create(e,b),v[x]=u,r.push(u),l.push(u)));for(t=0;t<l.length;t++)u=l[t],u.isActive&&-1===
h.indexOf(p,u.id)&&(f.setActive(u,!1,b),m.push(u))};c.removeOld=function(a,c){var b=a.list,f=a.table,h=[],r,m,p;for(p=0;p<b.length;p++)r=b[p],m=r.collision,m.bodyA.isSleeping||m.bodyB.isSleeping?r.timeUpdated=c:1E3<c-r.timeUpdated&&h.push(p);for(p=0;p<h.length;p++)m=h[p]-p,r=b[m],delete f[r.id],b.splice(m,1)};c.clear=function(a){a.table={};a.list.length=0;a.collisionStart.length=0;a.collisionActive.length=0;a.collisionEnd.length=0;return a}})()},{"../core/Common":14,"./Pair":7}],9:[function(a,b,e){var c=
{};b.exports=c;var f=a("../geometry/Vector"),h=a("./SAT"),k=a("../geometry/Bounds"),g=a("../factory/Bodies"),q=a("../geometry/Vertices");(function(){c.ray=function(a,c,b,m){m=m||1E-100;var p=f.angle(c,b),e=f.magnitude(f.sub(c,b));c=g.rectangle(.5*(b.x+c.x),.5*(b.y+c.y),e,m,{angle:p});b=[];for(m=0;m<a.length;m++)if(p=a[m],k.overlaps(p.bounds,c.bounds))for(e=1===p.parts.length?0:1;e<p.parts.length;e++){var q=p.parts[e];if(k.overlaps(q.bounds,c.bounds)&&(q=h.collides(q,c),q.collided)){q.body=q.bodyA=
q.bodyB=p;b.push(q);break}}return b};c.region=function(a,c,b){for(var m=[],f=0;f<a.length;f++){var h=a[f],g=k.overlaps(h.bounds,c);(g&&!b||!g&&b)&&m.push(h)}return m};c.point=function(a,c){for(var b=[],f=0;f<a.length;f++){var p=a[f];if(k.contains(p.bounds,c))for(var h=1===p.parts.length?0:1;h<p.parts.length;h++){var g=p.parts[h];if(k.contains(g.bounds,c)&&q.contains(g.vertices,c)){b.push(p);break}}}return b}})()},{"../factory/Bodies":21,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27,
"./SAT":11}],10:[function(a,b,e){var c={};b.exports=c;var f=a("../geometry/Vertices"),h=a("../geometry/Vector"),k=a("../core/Common"),g=a("../geometry/Bounds");(function(){c._restingThresh=4;c._restingThreshTangent=6;c._positionDampen=.9;c._positionWarming=.8;c._frictionNormalMultiplier=5;c.preSolvePosition=function(a){var c,b,f;for(c=0;c<a.length;c++)b=a[c],b.isActive&&(f=b.activeContacts.length,b.collision.parentA.totalContacts+=f,b.collision.parentB.totalContacts+=f)};c.solvePosition=function(a,
b){var f,r,m,p,g,k,e;e=h._temp[0];var t=h._temp[1],w=h._temp[2],z=h._temp[3];for(f=0;f<a.length;f++)r=a[f],r.isActive&&(m=r.collision,p=m.parentA,g=m.parentB,k=m.normal,p=h.sub(h.add(g.positionImpulse,g.position,e),h.add(p.positionImpulse,h.sub(g.position,m.penetration,t),w),z),r.separation=h.dot(k,p));for(f=0;f<a.length;f++)if(r=a[f],r.isActive&&!(0>r.separation)){m=r.collision;p=m.parentA;g=m.parentB;k=m.normal;e=(r.separation-r.slop)*b;if(p.isStatic||g.isStatic)e*=2;p.isStatic||p.isSleeping||(r=
c._positionDampen/p.totalContacts,p.positionImpulse.x+=k.x*e*r,p.positionImpulse.y+=k.y*e*r);g.isStatic||g.isSleeping||(r=c._positionDampen/g.totalContacts,g.positionImpulse.x-=k.x*e*r,g.positionImpulse.y-=k.y*e*r)}};c.postSolvePosition=function(a){for(var b=0;b<a.length;b++){var k=a[b];k.totalContacts=0;if(0!==k.positionImpulse.x||0!==k.positionImpulse.y){for(var r=0;r<k.parts.length;r++){var m=k.parts[r];f.translate(m.vertices,k.positionImpulse);g.update(m.bounds,m.vertices,k.velocity);m.position.x+=
k.positionImpulse.x;m.position.y+=k.positionImpulse.y}k.positionPrev.x+=k.positionImpulse.x;k.positionPrev.y+=k.positionImpulse.y;0>h.dot(k.positionImpulse,k.velocity)?(k.positionImpulse.x=0,k.positionImpulse.y=0):(k.positionImpulse.x*=c._positionWarming,k.positionImpulse.y*=c._positionWarming)}}};c.preSolveVelocity=function(a){var c,b,f,m,p,k,g,e,t,w,z=h._temp[0],y=h._temp[1];for(c=0;c<a.length;c++)if(f=a[c],f.isActive)for(m=f.activeContacts,b=f.collision,f=b.parentA,p=b.parentB,k=b.normal,g=b.tangent,
b=0;b<m.length;b++)if(e=m[b],t=e.vertex,w=e.normalImpulse,e=e.tangentImpulse,0!==w||0!==e)z.x=k.x*w+g.x*e,z.y=k.y*w+g.y*e,f.isStatic||f.isSleeping||(w=h.sub(t,f.position,y),f.positionPrev.x+=z.x*f.inverseMass,f.positionPrev.y+=z.y*f.inverseMass,f.anglePrev+=h.cross(w,z)*f.inverseInertia),p.isStatic||p.isSleeping||(w=h.sub(t,p.position,y),p.positionPrev.x-=z.x*p.inverseMass,p.positionPrev.y-=z.y*p.inverseMass,p.anglePrev-=h.cross(w,z)*p.inverseInertia)};c.solveVelocity=function(a,b){for(var f=b*b,
g=h._temp[0],m=h._temp[1],p=h._temp[2],e=h._temp[3],x=h._temp[4],u=h._temp[5],t=0;t<a.length;t++){var w=a[t];if(w.isActive){var z=w.collision,y=z.parentA,B=z.parentB,C=z.normal,z=z.tangent,D=w.activeContacts,G=1/D.length;y.velocity.x=y.position.x-y.positionPrev.x;y.velocity.y=y.position.y-y.positionPrev.y;B.velocity.x=B.position.x-B.positionPrev.x;B.velocity.y=B.position.y-B.positionPrev.y;y.angularVelocity=y.angle-y.anglePrev;B.angularVelocity=B.angle-B.anglePrev;for(var H=0;H<D.length;H++){var E=
D[H],I=E.vertex,J=h.sub(I,y.position,m),I=h.sub(I,B.position,p),F=h.add(y.velocity,h.mult(h.perp(J),y.angularVelocity),e),K=h.add(B.velocity,h.mult(h.perp(I),B.angularVelocity),x),F=h.sub(F,K,u),L=h.dot(C,F),N=h.dot(z,F),M=Math.abs(N),P=k.sign(N),F=(1+w.restitution)*L,Q=k.clamp(w.separation+L,0,1)*c._frictionNormalMultiplier,K=N,O=Infinity;M>w.friction*w.frictionStatic*Q*f&&(O=M,K=k.clamp(w.friction*P*f,-O,O));M=h.cross(J,C);P=h.cross(I,C);M=G/(y.inverseMass+B.inverseMass+y.inverseInertia*M*M+B.inverseInertia*
P*P);F*=M;K*=M;0>L&&L*L>c._restingThresh*f?E.normalImpulse=0:(L=E.normalImpulse,E.normalImpulse=Math.min(E.normalImpulse+F,0),F=E.normalImpulse-L);N*N>c._restingThreshTangent*f?E.tangentImpulse=0:(L=E.tangentImpulse,E.tangentImpulse=k.clamp(E.tangentImpulse+K,-O,O),K=E.tangentImpulse-L);g.x=C.x*F+z.x*K;g.y=C.y*F+z.y*K;y.isStatic||y.isSleeping||(y.positionPrev.x+=g.x*y.inverseMass,y.positionPrev.y+=g.y*y.inverseMass,y.anglePrev+=h.cross(J,g)*y.inverseInertia);B.isStatic||B.isSleeping||(B.positionPrev.x-=
g.x*B.inverseMass,B.positionPrev.y-=g.y*B.inverseMass,B.anglePrev-=h.cross(I,g)*B.inverseInertia)}}}}})()},{"../core/Common":14,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27}],11:[function(a,b,e){var c={};b.exports=c;var f=a("../geometry/Vertices"),h=a("../geometry/Vector");(function(){c.collides=function(c,b,g){var m,p;m=!1;g?(p=c.parent,m=b.parent,p=p.speed*p.speed+p.angularSpeed*p.angularSpeed+m.speed*m.speed+m.angularSpeed*m.angularSpeed,m=g&&g.collided&&.2>p,p=g):
p={collided:!1,bodyA:c,bodyB:b};if(g&&m){if(m=p.axisBody,g=a(m.vertices,(m===c?b:c).vertices,[m.axes[g.axisNumber]]),p.reused=!0,0>=g.overlap)return p.collided=!1,p}else{g=a(c.vertices,b.vertices,c.axes);if(0>=g.overlap)return p.collided=!1,p;m=a(b.vertices,c.vertices,b.axes);if(0>=m.overlap)return p.collided=!1,p;g.overlap<m.overlap?p.axisBody=c:(g=m,p.axisBody=b);p.axisNumber=g.axisNumber}p.bodyA=c.id<b.id?c:b;p.bodyB=c.id<b.id?b:c;p.collided=!0;p.normal=g.axis;p.depth=g.overlap;p.parentA=p.bodyA.parent;
p.parentB=p.bodyB.parent;c=p.bodyA;b=p.bodyB;0<h.dot(p.normal,h.sub(b.position,c.position))&&(p.normal=h.neg(p.normal));p.tangent=h.perp(p.normal);p.penetration={x:p.normal.x*p.depth,y:p.normal.y*p.depth};g=e(c,b,p.normal);m=p.supports||[];m.length=0;f.contains(c.vertices,g[0])&&m.push(g[0]);f.contains(c.vertices,g[1])&&m.push(g[1]);2>m.length&&(c=e(b,c,h.neg(p.normal)),f.contains(b.vertices,c[0])&&m.push(c[0]),2>m.length&&f.contains(b.vertices,c[1])&&m.push(c[1]));1>m.length&&(m=[g[0]]);p.supports=
m;return p};var a=function(a,c,f){for(var m=h._temp[0],p=h._temp[1],k={overlap:Number.MAX_VALUE},e,q,t=0;t<f.length;t++){q=f[t];b(m,a,q);b(p,c,q);e=Math.min(m.max-p.min,p.max-m.min);if(0>=e){k.overlap=e;break}e<k.overlap&&(k.overlap=e,k.axis=q,k.axisNumber=t)}return k},b=function(a,c,b){for(var f=h.dot(c[0],b),p=f,g=1;g<c.length;g+=1){var k=h.dot(c[g],b);k>p?p=k:k<f&&(f=k)}a.min=f;a.max=p},e=function(a,c,b){var f=Number.MAX_VALUE,p=h._temp[0];c=c.vertices;a=a.position;var g,k,e,q;for(q=0;q<c.length;q++)k=
c[q],p.x=k.x-a.x,p.y=k.y-a.y,g=-h.dot(b,p),g<f&&(f=g,e=k);k=c[0<=e.index-1?e.index-1:c.length-1];p.x=k.x-a.x;p.y=k.y-a.y;f=-h.dot(b,p);q=k;k=c[(e.index+1)%c.length];p.x=k.x-a.x;p.y=k.y-a.y;g=-h.dot(b,p);g<f&&(q=k);return[e,q]}})()},{"../geometry/Vector":26,"../geometry/Vertices":27}],12:[function(a,b,e){var c={};b.exports=c;var f=a("../geometry/Vertices"),h=a("../geometry/Vector"),k=a("../core/Sleeping"),g=a("../geometry/Bounds"),q=a("../geometry/Axes"),l=a("../core/Common");(function(){c.create=
function(a){a.bodyA&&!a.pointA&&(a.pointA={x:0,y:0});a.bodyB&&!a.pointB&&(a.pointB={x:0,y:0});var c=a.bodyA?h.add(a.bodyA.position,a.pointA):a.pointA,b=a.bodyB?h.add(a.bodyB.position,a.pointB):a.pointB,c=h.magnitude(h.sub(c,b));a.length=a.length||c||1E-6;a.render=l.extend({visible:!0,lineWidth:2,strokeStyle:"#666"},a.render);a.id=a.id||l.nextId();a.label=a.label||"Constraint";a.type="constraint";a.stiffness=a.stiffness||1;a.angularStiffness=a.angularStiffness||0;a.angleA=a.bodyA?a.bodyA.angle:a.angleA;
a.angleB=a.bodyB?a.bodyB.angle:a.angleB;return a};c.solveAll=function(a,b){for(var f=0;f<a.length;f++)c.solve(a[f],b)};c.solve=function(a,c){var b=a.bodyA,f=a.bodyB,g=a.pointA,k=a.pointB;b&&!b.isStatic&&(a.pointA=h.rotate(g,b.angle-a.angleA),a.angleA=b.angle);f&&!f.isStatic&&(a.pointB=h.rotate(k,f.angle-a.angleB),a.angleB=f.angle);var l=g,e=k;b&&(l=h.add(b.position,g));f&&(e=h.add(f.position,k));if(l&&e){var k=h.sub(l,e),q=h.magnitude(k);0===q&&(q=1E-6);var z=(q-a.length)/q,g=h.div(k,q),k=h.mult(k,
.5*z*a.stiffness*c*c);if(!(Math.abs(1-q/a.length)<.001*c)){var y,B;b&&!b.isStatic?(y={x:l.x-b.position.x+k.x,y:l.y-b.position.y+k.y},b.velocity.x=b.position.x-b.positionPrev.x,b.velocity.y=b.position.y-b.positionPrev.y,b.angularVelocity=b.angle-b.anglePrev,l=h.add(b.velocity,h.mult(h.perp(y),b.angularVelocity)),q=h.dot(y,g),q=b.inverseMass+b.inverseInertia*q*q):(l={x:0,y:0},q=b?b.inverseMass:0);f&&!f.isStatic?(B={x:e.x-f.position.x-k.x,y:e.y-f.position.y-k.y},f.velocity.x=f.position.x-f.positionPrev.x,
f.velocity.y=f.position.y-f.positionPrev.y,f.angularVelocity=f.angle-f.anglePrev,e=h.add(f.velocity,h.mult(h.perp(B),f.angularVelocity)),z=h.dot(B,g),z=f.inverseMass+f.inverseInertia*z*z):(e={x:0,y:0},z=f?f.inverseMass:0);e=h.sub(e,l);e=h.dot(g,e)/(q+z);0<e&&(e=0);g={x:g.x*e,y:g.y*e};b&&!b.isStatic&&(y=h.cross(y,g)*b.inverseInertia*(1-a.angularStiffness),b.constraintImpulse.x-=k.x,b.constraintImpulse.y-=k.y,b.constraintImpulse.angle+=y,b.position.x-=k.x,b.position.y-=k.y,b.angle+=y);f&&!f.isStatic&&
(y=h.cross(B,g)*f.inverseInertia*(1-a.angularStiffness),f.constraintImpulse.x+=k.x,f.constraintImpulse.y+=k.y,f.constraintImpulse.angle-=y,f.position.x+=k.x,f.position.y+=k.y,f.angle-=y)}}};c.postSolveAll=function(a){for(var b=0;b<a.length;b++){var c=a[b],p=c.constraintImpulse;if(0!==p.x||0!==p.y||0!==p.angle){k.set(c,!1);for(var l=0;l<c.parts.length;l++){var e=c.parts[l];f.translate(e.vertices,p);0<l&&(e.position.x+=p.x,e.position.y+=p.y);0!==p.angle&&(f.rotate(e.vertices,p.angle,c.position),q.rotate(e.axes,
p.angle),0<l&&h.rotateAbout(e.position,p.angle,c.position,e.position));g.update(e.bounds,e.vertices,c.velocity)}p.angle=0;p.x=0;p.y=0}}}})()},{"../core/Common":14,"../core/Sleeping":20,"../geometry/Axes":23,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27}],13:[function(a,b,e){var c={};b.exports=c;var f=a("../geometry/Vertices"),h=a("../core/Sleeping"),k=a("../core/Mouse"),g=a("../core/Events"),q=a("../collision/Detector"),l=a("./Constraint"),v=a("../body/Composite"),r=a("../core/Common"),
m=a("../geometry/Bounds");(function(){c.create=function(a,b){var f=(a?a.mouse:null)||(b?b.mouse:null);f||(a&&a.render&&a.render.canvas?f=k.create(a.render.canvas):(f=k.create(),r.log("MouseConstraint.create: options.mouse was undefined, engine.render.canvas was undefined, may not function as expected","warn")));var h=l.create({label:"Mouse Constraint",pointA:f.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),m=r.extend({type:"mouseConstraint",
mouse:f,body:null,constraint:h,collisionFilter:{category:1,mask:4294967295,group:0}},b);g.on(a,"tick",function(){var b=v.allBodies(a.world);c.update(m,b);var b=m.mouse,f=b.sourceEvents;f.mousemove&&g.trigger(m,"mousemove",{mouse:b});f.mousedown&&g.trigger(m,"mousedown",{mouse:b});f.mouseup&&g.trigger(m,"mouseup",{mouse:b});k.clearSourceEvents(b)});return m};c.update=function(a,b){var c=a.mouse,k=a.constraint,l=a.body;if(0===c.button)if(k.bodyB)h.set(k.bodyB,!1),k.pointA=c.position;else for(var e=
0;e<b.length;e++){if(l=b[e],m.contains(l.bounds,c.position)&&q.canCollide(l.collisionFilter,a.collisionFilter))for(var r=1<l.parts.length?1:0;r<l.parts.length;r++)if(f.contains(l.parts[r].vertices,c.position)){k.pointA=c.position;k.bodyB=a.body=l;k.pointB={x:c.position.x-l.position.x,y:c.position.y-l.position.y};k.angleB=l.angle;h.set(l,!1);g.trigger(a,"startdrag",{mouse:c,body:l});break}}else k.bodyB=a.body=null,k.pointB=null,l&&g.trigger(a,"enddrag",{mouse:c,body:l})}})()},{"../body/Composite":2,
"../collision/Detector":5,"../core/Common":14,"../core/Events":16,"../core/Mouse":18,"../core/Sleeping":20,"../geometry/Bounds":24,"../geometry/Vertices":27,"./Constraint":12}],14:[function(a,b,e){var c={};b.exports=c;(function(){c._nextId=0;c._seed=0;c.extend=function(a,b){var k,g;"boolean"===typeof b?(k=2,g=b):(k=1,g=!0);k=Array.prototype.slice.call(arguments,k);for(var e=0;e<k.length;e++){var l=k[e];if(l)for(var v in l)g&&l[v]&&l[v].constructor===Object?a[v]&&a[v].constructor!==Object?a[v]=l[v]:
(a[v]=a[v]||{},c.extend(a[v],g,l[v])):a[v]=l[v]}return a};c.clone=function(a,b){return c.extend({},b,a)};c.keys=function(a){if(Object.keys)return Object.keys(a);var b=[],c;for(c in a)b.push(c);return b};c.values=function(a){var b=[];if(Object.keys){for(var c=Object.keys(a),g=0;g<c.length;g++)b.push(a[c[g]]);return b}for(c in a)b.push(a[c]);return b};c.shadeColor=function(a,b){var c=parseInt(a.slice(1),16),g=Math.round(2.55*b),e=(c>>16)+g,l=(c>>8&255)+g,c=(c&255)+g;return"#"+(16777216+65536*(255>e?
1>e?0:e:255)+256*(255>l?1>l?0:l:255)+(255>c?1>c?0:c:255)).toString(16).slice(1)};c.shuffle=function(a){for(var b=a.length-1;0<b;b--){var k=Math.floor(c.random()*(b+1)),g=a[b];a[b]=a[k];a[k]=g}return a};c.choose=function(a){return a[Math.floor(c.random()*a.length)]};c.isElement=function(a){try{return a instanceof HTMLElement}catch(b){return"object"===typeof a&&1===a.nodeType&&"object"===typeof a.style&&"object"===typeof a.ownerDocument}};c.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)};
c.clamp=function(a,b,c){return a<b?b:a>c?c:a};c.sign=function(a){return 0>a?-1:1};c.now=function(){var a=window.performance||{};a.now=function(){return a.now||a.webkitNow||a.msNow||a.oNow||a.mozNow||function(){return+new Date}}();return a.now()};c.random=function(a,b){a="undefined"!==typeof a?a:0;c._seed=(9301*c._seed+49297)%233280;return a+c._seed/233280*(("undefined"!==typeof b?b:1)-a)};c.colorToNumber=function(a){a=a.replace("#","");3==a.length&&(a=a.charAt(0)+a.charAt(0)+a.charAt(1)+a.charAt(1)+
a.charAt(2)+a.charAt(2));return parseInt(a,16)};c.log=function(a,b){if(console&&console.log&&console.warn)switch(b){case "warn":console.warn("Matter.js:",a);break;case "error":console.log("Matter.js:",a)}};c.nextId=function(){return c._nextId++};c.indexOf=function(a,b){if(a.indexOf)return a.indexOf(b);for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1}})()},{}],15:[function(a,b,e){var c={};b.exports=c;var f=a("../body/World"),h=a("./Sleeping"),k=a("../collision/Resolver"),g=a("../render/Render"),
q=a("../collision/Pairs");a("./Metrics");var l=a("../collision/Grid"),v=a("./Events"),r=a("../body/Composite"),m=a("../constraint/Constraint"),p=a("./Common"),A=a("../body/Body");(function(){c.create=function(a,b){b=p.isElement(a)?b:a;a=p.isElement(a)?a:null;var c=p.extend({positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],timing:{timestamp:0,timeScale:1},broadphase:{controller:l}},b);if(a||c.render)c.render=p.extend({element:a,controller:g},c.render);c.render&&
c.render.controller&&(c.render=c.render.controller.create(c.render));c.world=f.create(c.world);c.pairs=q.create();c.broadphase=c.broadphase.controller.create(c.broadphase);c.metrics=c.metrics||{extended:!1};return c};c.update=function(a,b,c){b=b||1E3/60;c=c||1;var f=a.world,g=a.timing,l=a.broadphase,p=[];g.timestamp+=b*g.timeScale;var e={timestamp:g.timestamp};v.trigger(a,"beforeUpdate",e);var D=r.allBodies(f),p=r.allConstraints(f);a.enableSleeping&&h.update(D,g.timeScale);var G=f.gravity,H="undefined"!==
typeof G.scale?G.scale:.001;if((0!==G.x||0!==G.y)&&0!==H)for(var E=0;E<D.length;E++){var I=D[E];I.isStatic||I.isSleeping||(I.force.y+=I.mass*G.y*H,I.force.x+=I.mass*G.x*H)}G=g.timeScale;for(H=0;H<D.length;H++)E=D[H],E.isStatic||E.isSleeping||A.update(E,b,G,c);for(c=0;c<a.constraintIterations;c++)m.solveAll(p,g.timeScale);m.postSolveAll(D);l.controller?(f.isModified&&l.controller.clear(l),l.controller.update(l,D,a,f.isModified),p=l.pairsList):p=D;p=l.detector(p,a);l=a.pairs;c=g.timestamp;q.update(l,
p,c);q.removeOld(l,c);a.enableSleeping&&h.afterCollisions(l.list,g.timeScale);0<l.collisionStart.length&&v.trigger(a,"collisionStart",{pairs:l.collisionStart});k.preSolvePosition(l.list);for(c=0;c<a.positionIterations;c++)k.solvePosition(l.list,g.timeScale);k.postSolvePosition(D);k.preSolveVelocity(l.list);for(c=0;c<a.velocityIterations;c++)k.solveVelocity(l.list,g.timeScale);0<l.collisionActive.length&&v.trigger(a,"collisionActive",{pairs:l.collisionActive});0<l.collisionEnd.length&&v.trigger(a,
"collisionEnd",{pairs:l.collisionEnd});for(g=0;g<D.length;g++)l=D[g],l.force.x=0,l.force.y=0,l.torque=0;f.isModified&&r.setModified(f,!1,!1,!0);v.trigger(a,"afterUpdate",e);return a};c.merge=function(a,b){p.extend(a,b);if(b.world){a.world=b.world;c.clear(a);for(var f=r.allBodies(a.world),g=0;g<f.length;g++){var l=f[g];h.set(l,!1);l.id=p.nextId()}}};c.clear=function(a){var c=a.world;q.clear(a.pairs);var b=a.broadphase;b.controller&&(c=r.allBodies(c),b.controller.clear(b),b.controller.update(b,c,a,
!0))}})()},{"../body/Body":1,"../body/Composite":2,"../body/World":3,"../collision/Grid":6,"../collision/Pairs":8,"../collision/Resolver":10,"../constraint/Constraint":12,"../render/Render":29,"./Common":14,"./Events":16,"./Metrics":17,"./Sleeping":20}],16:[function(a,b,e){var c={};b.exports=c;var f=a("./Common");(function(){c.on=function(a,c,b){c=c.split(" ");for(var f,l=0;l<c.length;l++)f=c[l],a.events=a.events||{},a.events[f]=a.events[f]||[],a.events[f].push(b);return b};c.off=function(a,c,b){if(c){"function"===
typeof c&&(b=c,c=f.keys(a.events).join(" "));c=c.split(" ");for(var e=0;e<c.length;e++){var l=a.events[c[e]],v=[];if(b&&l)for(var r=0;r<l.length;r++)l[r]!==b&&v.push(l[r]);a.events[c[e]]=v}}else a.events={}};c.trigger=function(a,c,b){var e,l,v;if(a.events){b||(b={});c=c.split(" ");for(var r=0;r<c.length;r++)if(e=c[r],l=a.events[e])for(v=f.clone(b,!1),v.name=e,v.source=a,e=0;e<l.length;e++)l[e].apply(a,[v])}}})()},{"./Common":14}],17:[function(a,b,e){},{"../body/Composite":2,"./Common":14}],18:[function(a,
b,e){var c={};b.exports=c;var f=a("../core/Common");(function(){c.create=function(b){var g={};b||f.log("Mouse.create: element was undefined, defaulting to document.body","warn");g.element=b||document.body;g.absolute={x:0,y:0};g.position={x:0,y:0};g.mousedownPosition={x:0,y:0};g.mouseupPosition={x:0,y:0};g.offset={x:0,y:0};g.scale={x:1,y:1};g.wheelDelta=0;g.button=-1;g.pixelRatio=g.element.getAttribute("data-pixel-ratio")||1;g.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null};
g.mousemove=function(c){var b=a(c,g.element,g.pixelRatio);c.changedTouches&&(g.button=0,c.preventDefault());g.absolute.x=b.x;g.absolute.y=b.y;g.position.x=g.absolute.x*g.scale.x+g.offset.x;g.position.y=g.absolute.y*g.scale.y+g.offset.y;g.sourceEvents.mousemove=c};g.mousedown=function(c){var b=a(c,g.element,g.pixelRatio);c.changedTouches?(g.button=0,c.preventDefault()):g.button=c.button;g.absolute.x=b.x;g.absolute.y=b.y;g.position.x=g.absolute.x*g.scale.x+g.offset.x;g.position.y=g.absolute.y*g.scale.y+
g.offset.y;g.mousedownPosition.x=g.position.x;g.mousedownPosition.y=g.position.y;g.sourceEvents.mousedown=c};g.mouseup=function(c){var b=a(c,g.element,g.pixelRatio);c.changedTouches&&c.preventDefault();g.button=-1;g.absolute.x=b.x;g.absolute.y=b.y;g.position.x=g.absolute.x*g.scale.x+g.offset.x;g.position.y=g.absolute.y*g.scale.y+g.offset.y;g.mouseupPosition.x=g.position.x;g.mouseupPosition.y=g.position.y;g.sourceEvents.mouseup=c};g.mousewheel=function(a){g.wheelDelta=Math.max(-1,Math.min(1,a.wheelDelta||
-a.detail));a.preventDefault()};c.setElement(g,g.element);return g};c.setElement=function(a,c){a.element=c;c.addEventListener("mousemove",a.mousemove);c.addEventListener("mousedown",a.mousedown);c.addEventListener("mouseup",a.mouseup);c.addEventListener("mousewheel",a.mousewheel);c.addEventListener("DOMMouseScroll",a.mousewheel);c.addEventListener("touchmove",a.mousemove);c.addEventListener("touchstart",a.mousedown);c.addEventListener("touchend",a.mouseup)};c.clearSourceEvents=function(a){a.sourceEvents.mousemove=
null;a.sourceEvents.mousedown=null;a.sourceEvents.mouseup=null;a.sourceEvents.mousewheel=null;a.wheelDelta=0};c.setOffset=function(a,c){a.offset.x=c.x;a.offset.y=c.y;a.position.x=a.absolute.x*a.scale.x+a.offset.x;a.position.y=a.absolute.y*a.scale.y+a.offset.y};c.setScale=function(a,c){a.scale.x=c.x;a.scale.y=c.y;a.position.x=a.absolute.x*a.scale.x+a.offset.x;a.position.y=a.absolute.y*a.scale.y+a.offset.y};var a=function(a,c,b){var f=c.getBoundingClientRect(),e=document.documentElement||document.body.parentNode||
document.body,h=void 0!==window.pageXOffset?window.pageXOffset:e.scrollLeft,e=void 0!==window.pageYOffset?window.pageYOffset:e.scrollTop,m=a.changedTouches;m?(h=m[0].pageX-f.left-h,a=m[0].pageY-f.top-e):(h=a.pageX-f.left-h,a=a.pageY-f.top-e);return{x:h/(c.clientWidth/c.width*b),y:a/(c.clientHeight/c.height*b)}}})()},{"../core/Common":14}],19:[function(a,b,e){var c={};b.exports=c;var f=a("./Events"),h=a("./Engine"),k=a("./Common");(function(){var a,b;"undefined"!==typeof window&&(a=window.requestAnimationFrame||
window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(function(){a(k.now())},1E3/60)},b=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame);c.create=function(a){a=k.extend({fps:60,correction:1,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,timeScalePrev:1,frameRequestId:null,isFixed:!1,enabled:!0},a);a.delta=a.delta||
1E3/a.fps;a.deltaMin=a.deltaMin||1E3/a.fps;a.deltaMax=a.deltaMax||1E3/(.5*a.fps);a.fps=1E3/a.delta;return a};c.run=function(b,f){"undefined"!==typeof b.positionIterations&&(f=b,b=c.create());(function m(e){b.frameRequestId=a(m);e&&b.enabled&&c.tick(b,f,e)})();return b};c.tick=function(a,c,b){var g=c.timing,e=1,k,q={timestamp:g.timestamp};f.trigger(a,"beforeTick",q);f.trigger(c,"beforeTick",q);a.isFixed?k=a.delta:(k=b-a.timePrev||a.delta,a.timePrev=b,a.deltaHistory.push(k),a.deltaHistory=a.deltaHistory.slice(-a.deltaSampleSize),
k=Math.min.apply(null,a.deltaHistory),k=k<a.deltaMin?a.deltaMin:k,k=k>a.deltaMax?a.deltaMax:k,e=k/a.delta,a.delta=k);0!==a.timeScalePrev&&(e*=g.timeScale/a.timeScalePrev);0===g.timeScale&&(e=0);a.timeScalePrev=g.timeScale;a.correction=e;a.frameCounter+=1;1E3<=b-a.counterTimestamp&&(a.fps=(b-a.counterTimestamp)/1E3*a.frameCounter,a.counterTimestamp=b,a.frameCounter=0);f.trigger(a,"tick",q);f.trigger(c,"tick",q);c.world.isModified&&c.render&&c.render.controller&&c.render.controller.clear&&c.render.controller.clear(c.render);
f.trigger(a,"beforeUpdate",q);h.update(c,k,e);f.trigger(a,"afterUpdate",q);c.render&&c.render.controller&&(f.trigger(a,"beforeRender",q),f.trigger(c,"beforeRender",q),c.render.controller.world(c),f.trigger(a,"afterRender",q),f.trigger(c,"afterRender",q));f.trigger(a,"afterTick",q);f.trigger(c,"afterTick",q)};c.stop=function(a){b(a.frameRequestId)};c.start=function(a,b){c.run(a,b)}})()},{"./Common":14,"./Engine":15,"./Events":16}],20:[function(a,b,e){var c={};b.exports=c;var f=a("./Events");(function(){c._motionWakeThreshold=
.18;c._motionSleepThreshold=.08;c._minBias=.9;c.update=function(a,b){for(var f=b*b*b,e=0;e<a.length;e++){var l=a[e],v=l.speed*l.speed+l.angularSpeed*l.angularSpeed;0!==l.force.x||0!==l.force.y?c.set(l,!1):(l.motion=c._minBias*Math.min(l.motion,v)+(1-c._minBias)*Math.max(l.motion,v),0<l.sleepThreshold&&l.motion<c._motionSleepThreshold*f?(l.sleepCounter+=1,l.sleepCounter>=l.sleepThreshold&&c.set(l,!0)):0<l.sleepCounter&&--l.sleepCounter)}};c.afterCollisions=function(a,b){for(var f=b*b*b,e=0;e<a.length;e++){var l=
a[e];if(l.isActive){var v=l.collision,l=v.bodyA.parent,r=v.bodyB.parent;l.isSleeping&&r.isSleeping||l.isStatic||r.isStatic||!l.isSleeping&&!r.isSleeping||(v=l.isSleeping&&!l.isStatic?l:r,l=v===l?r:l,!v.isStatic&&l.motion>c._motionWakeThreshold*f&&c.set(v,!1))}}};c.set=function(a,c){var b=a.isSleeping;c?(a.isSleeping=!0,a.sleepCounter=a.sleepThreshold,a.positionImpulse.x=0,a.positionImpulse.y=0,a.positionPrev.x=a.position.x,a.positionPrev.y=a.position.y,a.anglePrev=a.angle,a.speed=0,a.angularSpeed=
0,a.motion=0,b||f.trigger(a,"sleepStart")):(a.isSleeping=!1,a.sleepCounter=0,b&&f.trigger(a,"sleepEnd"))}})()},{"./Events":16}],21:[function(a,b,e){var c={};b.exports=c;var f=a("../geometry/Vertices"),h=a("../core/Common"),k=a("../body/Body"),g=a("../geometry/Bounds"),q=a("../geometry/Vector");(function(){c.rectangle=function(a,c,b,e,g){g=g||{};a={label:"Rectangle Body",position:{x:a,y:c},vertices:f.fromPath("L 0 0 L "+b+" 0 L "+b+" "+e+" L 0 "+e)};g.chamfer&&(c=g.chamfer,a.vertices=f.chamfer(a.vertices,
c.radius,c.quality,c.qualityMin,c.qualityMax),delete g.chamfer);return k.create(h.extend({},a,g))};c.trapezoid=function(a,c,b,e,g,q){q=q||{};g*=.5;var x=b*g;b=x+(1-2*g)*b;var u=b+x;a={label:"Trapezoid Body",position:{x:a,y:c},vertices:f.fromPath(.5>g?"L 0 0 L "+x+" "+-e+" L "+b+" "+-e+" L "+u+" 0":"L 0 0 L "+b+" "+-e+" L "+u+" 0")};q.chamfer&&(c=q.chamfer,a.vertices=f.chamfer(a.vertices,c.radius,c.quality,c.qualityMin,c.qualityMax),delete q.chamfer);return k.create(h.extend({},a,q))};c.circle=function(a,
b,f,e,g){e=e||{};var k={label:"Circle Body",circleRadius:f};g=Math.ceil(Math.max(10,Math.min(g||25,f)));1===g%2&&(g+=1);return c.polygon(a,b,g,f,h.extend({},k,e))};c.polygon=function(a,b,e,g,p){p=p||{};if(3>e)return c.circle(a,b,g,p);for(var q=2*Math.PI/e,x="",u=.5*q,t=0;t<e;t+=1)var w=u+t*q,z=Math.sin(w)*g,x=x+("L "+(Math.cos(w)*g).toFixed(3)+" "+z.toFixed(3)+" ");a={label:"Polygon Body",position:{x:a,y:b},vertices:f.fromPath(x)};p.chamfer&&(b=p.chamfer,a.vertices=f.chamfer(a.vertices,b.radius,b.quality,
b.qualityMin,b.qualityMax),delete p.chamfer);return k.create(h.extend({},a,p))};c.fromVertices=function(a,c,b,e,p,A,x){var u,t,w,z;e=e||{};u=[];p="undefined"!==typeof p?p:!1;A="undefined"!==typeof A?A:.01;x="undefined"!==typeof x?x:10;window.decomp||h.log("Bodies.fromVertices: poly-decomp.js required. Could not decompose vertices. Fallback to convex hull.","warn");h.isArray(b[0])||(b=[b]);for(z=0;z<b.length;z+=1)if(w=b[z],(t=f.isConvex(w))||!window.decomp)w=t?f.clockwiseSort(w):f.hull(w),u.push({position:{x:a,
y:c},vertices:w});else{var y=new decomp.Polygon;for(t=0;t<w.length;t++)y.vertices.push([w[t].x,w[t].y]);y.makeCCW();!1!==A&&y.removeCollinearPoints(A);y=y.quickDecomp();for(t=0;t<y.length;t++){var B=y[t],C=[];for(w=0;w<B.vertices.length;w++)C.push({x:B.vertices[w][0],y:B.vertices[w][1]});0<x&&f.area(C)<x||u.push({position:f.centre(C),vertices:C})}}for(t=0;t<u.length;t++)u[t]=k.create(h.extend(u[t],e));if(p)for(t=0;t<u.length;t++)for(A=u[t],w=t+1;w<u.length;w++)if(x=u[w],g.overlaps(A.bounds,x.bounds))for(z=
A.vertices,y=x.vertices,b=0;b<A.vertices.length;b++)for(p=0;p<x.vertices.length;p++)B=q.magnitudeSquared(q.sub(z[(b+1)%z.length],y[p])),C=q.magnitudeSquared(q.sub(z[b],y[(p+1)%y.length])),5>B&&5>C&&(z[b].isInternal=!0,y[p].isInternal=!0);return 1<u.length?(e=k.create(h.extend({parts:u.slice(0)},e)),k.setPosition(e,{x:a,y:c}),e):u[0]}})()},{"../body/Body":1,"../core/Common":14,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27}],22:[function(a,b,e){var c={};b.exports=c;var f=
a("../body/Composite"),h=a("../constraint/Constraint"),k=a("../core/Common"),g=a("../body/Body"),q=a("./Bodies");(function(){c.stack=function(a,c,b,e,p,k,h){for(var q=f.create({label:"Stack"}),t=a,w,z=0,y=0;y<e;y++){for(var B=0,C=0;C<b;C++){var D=h(t,c,C,y,w,z);D?(t=D.bounds.max.y-D.bounds.min.y,w=D.bounds.max.x-D.bounds.min.x,t>B&&(B=t),g.translate(D,{x:.5*w,y:.5*t}),t=D.bounds.max.x+p,f.addBody(q,D),w=D,z+=1):t+=p}c+=B+k;t=a}return q};c.chain=function(a,c,b,e,g,q){for(var x=a.bodies,u=1;u<x.length;u++){var t=
x[u-1],w=x[u],t=k.extend({bodyA:t,pointA:{x:(t.bounds.max.x-t.bounds.min.x)*c,y:(t.bounds.max.y-t.bounds.min.y)*b},bodyB:w,pointB:{x:(w.bounds.max.x-w.bounds.min.x)*e,y:(w.bounds.max.y-w.bounds.min.y)*g}},q);f.addConstraint(a,h.create(t))}a.label+=" Chain";return a};c.mesh=function(a,c,b,e,g){var q=a.bodies,x,u,t,w;for(x=0;x<b;x++){for(u=1;u<c;u++)t=q[u-1+x*c],w=q[u+x*c],f.addConstraint(a,h.create(k.extend({bodyA:t,bodyB:w},g)));if(0<x)for(u=0;u<c;u++)t=q[u+(x-1)*c],w=q[u+x*c],f.addConstraint(a,h.create(k.extend({bodyA:t,
bodyB:w},g))),e&&0<u&&(t=q[u-1+(x-1)*c],f.addConstraint(a,h.create(k.extend({bodyA:t,bodyB:w},g)))),e&&u<c-1&&(t=q[u+1+(x-1)*c],f.addConstraint(a,h.create(k.extend({bodyA:t,bodyB:w},g))))}a.label+=" Mesh";return a};c.pyramid=function(a,b,f,e,p,k,h){return c.stack(a,b,f,e,p,k,function(c,b,k,q,A,v){var C=Math.min(e,Math.ceil(f/2));c=A?A.bounds.max.x-A.bounds.min.x:0;if(!(q>C||(q=C-q,C=f-1-q,k<q||k>C)))return 1===v&&g.translate(A,{x:(k+(1===f%2?1:-1))*c,y:0}),h(a+(A?k*c:0)+k*p,b,k,q,A,v)})};c.newtonsCradle=
function(a,c,b,e,g){for(var k=f.create({label:"Newtons Cradle"}),x=0;x<b;x++){var u=q.circle(a+1.9*x*e,c+g,e,{inertia:Infinity,restitution:1,friction:0,frictionAir:1E-4,slop:1}),t=h.create({pointA:{x:a+1.9*x*e,y:c},bodyB:u});f.addBody(k,u);f.addConstraint(k,t)}return k};c.car=function(a,c,b,e,k){var A=g.nextGroup(!0),x=.5*-b+-20,u=.5*b- -20,t=f.create({label:"Car"});b=q.trapezoid(a,c,b,e,.3,{collisionFilter:{group:A},friction:.01,chamfer:{radius:10}});e=q.circle(a+x,c+0,k,{collisionFilter:{group:A},
friction:.8,density:.01});a=q.circle(a+u,c+0,k,{collisionFilter:{group:A},friction:.8,density:.01});x=h.create({bodyA:b,pointA:{x:x,y:0},bodyB:e,stiffness:.2});u=h.create({bodyA:b,pointA:{x:u,y:0},bodyB:a,stiffness:.2});f.addBody(t,b);f.addBody(t,e);f.addBody(t,a);f.addConstraint(t,x);f.addConstraint(t,u);return t};c.softBody=function(a,b,f,e,g,h,x,u,t,w){t=k.extend({inertia:Infinity},t);w=k.extend({stiffness:.4},w);a=c.stack(a,b,f,e,g,h,function(a,c){return q.circle(a,c,u,t)});c.mesh(a,f,e,x,w);
a.label="Soft Body";return a}})()},{"../body/Body":1,"../body/Composite":2,"../constraint/Constraint":12,"../core/Common":14,"./Bodies":21}],23:[function(a,b,e){var c={};b.exports=c;var f=a("../geometry/Vector"),h=a("../core/Common");(function(){c.fromVertices=function(a){for(var c={},b=0;b<a.length;b++){var e=(b+1)%a.length,e=f.normalise({x:a[e].y-a[b].y,y:a[b].x-a[e].x}),v=0===e.y?Infinity:e.x/e.y,v=v.toFixed(3).toString();c[v]=e}return h.values(c)};c.rotate=function(a,c){if(0!==c)for(var b=Math.cos(c),
f=Math.sin(c),e=0;e<a.length;e++){var h=a[e],m;m=h.x*b-h.y*f;h.y=h.x*f+h.y*b;h.x=m}}})()},{"../core/Common":14,"../geometry/Vector":26}],24:[function(a,b,e){var c={};b.exports=c;(function(){c.create=function(a){var b={min:{x:0,y:0},max:{x:0,y:0}};a&&c.update(b,a);return b};c.update=function(a,c,b){a.min.x=Infinity;a.max.x=-Infinity;a.min.y=Infinity;a.max.y=-Infinity;for(var e=0;e<c.length;e++){var q=c[e];q.x>a.max.x&&(a.max.x=q.x);q.x<a.min.x&&(a.min.x=q.x);q.y>a.max.y&&(a.max.y=q.y);q.y<a.min.y&&
(a.min.y=q.y)}b&&(0<b.x?a.max.x+=b.x:a.min.x+=b.x,0<b.y?a.max.y+=b.y:a.min.y+=b.y)};c.contains=function(a,c){return c.x>=a.min.x&&c.x<=a.max.x&&c.y>=a.min.y&&c.y<=a.max.y};c.overlaps=function(a,c){return a.min.x<=c.max.x&&a.max.x>=c.min.x&&a.max.y>=c.min.y&&a.min.y<=c.max.y};c.translate=function(a,c){a.min.x+=c.x;a.max.x+=c.x;a.min.y+=c.y;a.max.y+=c.y};c.shift=function(a,c){var b=a.max.x-a.min.x,e=a.max.y-a.min.y;a.min.x=c.x;a.max.x=c.x+b;a.min.y=c.y;a.max.y=c.y+e}})()},{}],25:[function(a,b,e){var c=
{};b.exports=c;a("../geometry/Bounds");(function(){c.pathToVertices=function(c,b){var e,q,l,v,r,m,p=[],A,x,u=0,t=0,w=0;b=b||15;var z=function(a,c,b){b=1===b%2&&1<b;if(!m||a!=m.x||c!=m.y){m&&b?(A=m.x,x=m.y):x=A=0;var e={x:A+a,y:x+c};if(b||!m)m=e;p.push(e);t=A+a;w=x+c}},y=function(a){var c=a.pathSegTypeAsLetter.toUpperCase();if("Z"!==c){switch(c){case "M":case "L":case "T":case "C":case "S":case "Q":t=a.x;w=a.y;break;case "H":t=a.x;break;case "V":w=a.y}z(t,w,a.pathSegType)}};a(c);q=c.getTotalLength();
l=[];for(e=0;e<c.pathSegList.numberOfItems;e+=1)l.push(c.pathSegList.getItem(e));for(v=l.concat();u<q;){e=c.getPathSegAtLength(u);e=l[e];if(e!=r){for(;v.length&&v[0]!=e;)y(v.shift());r=e}switch(e.pathSegTypeAsLetter.toUpperCase()){case "C":case "T":case "S":case "Q":case "A":e=c.getPointAtLength(u),z(e.x,e.y,0)}u+=b}e=0;for(q=v.length;e<q;++e)y(v[e]);return p};var a=function(a){for(var c,b,e,f,v,r,m=a.pathSegList,p=0,A=0,x=m.numberOfItems,u=0;u<x;++u){var t=m.getItem(u),w=t.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(w))"x"in
t&&(p=t.x),"y"in t&&(A=t.y);else switch("x1"in t&&(e=p+t.x1),"x2"in t&&(v=p+t.x2),"y1"in t&&(f=A+t.y1),"y2"in t&&(r=A+t.y2),"x"in t&&(p+=t.x),"y"in t&&(A+=t.y),w){case "m":m.replaceItem(a.createSVGPathSegMovetoAbs(p,A),u);break;case "l":m.replaceItem(a.createSVGPathSegLinetoAbs(p,A),u);break;case "h":m.replaceItem(a.createSVGPathSegLinetoHorizontalAbs(p),u);break;case "v":m.replaceItem(a.createSVGPathSegLinetoVerticalAbs(A),u);break;case "c":m.replaceItem(a.createSVGPathSegCurvetoCubicAbs(p,A,e,f,
v,r),u);break;case "s":m.replaceItem(a.createSVGPathSegCurvetoCubicSmoothAbs(p,A,v,r),u);break;case "q":m.replaceItem(a.createSVGPathSegCurvetoQuadraticAbs(p,A,e,f),u);break;case "t":m.replaceItem(a.createSVGPathSegCurvetoQuadraticSmoothAbs(p,A),u);break;case "a":m.replaceItem(a.createSVGPathSegArcAbs(p,A,t.r1,t.r2,t.angle,t.largeArcFlag,t.sweepFlag),u);break;case "z":case "Z":p=c,A=b}if("M"==w||"m"==w)c=p,b=A}}})()},{"../geometry/Bounds":24}],26:[function(a,b,e){var c={};b.exports=c;(function(){c.create=
function(a,c){return{x:a||0,y:c||0}};c.clone=function(a){return{x:a.x,y:a.y}};c.magnitude=function(a){return Math.sqrt(a.x*a.x+a.y*a.y)};c.magnitudeSquared=function(a){return a.x*a.x+a.y*a.y};c.rotate=function(a,c){var b=Math.cos(c),e=Math.sin(c);return{x:a.x*b-a.y*e,y:a.x*e+a.y*b}};c.rotateAbout=function(a,c,b,e){var q=Math.cos(c);c=Math.sin(c);e||(e={});var l=b.x+((a.x-b.x)*q-(a.y-b.y)*c);e.y=b.y+((a.x-b.x)*c+(a.y-b.y)*q);e.x=l;return e};c.normalise=function(a){var b=c.magnitude(a);return 0===b?
{x:0,y:0}:{x:a.x/b,y:a.y/b}};c.dot=function(a,c){return a.x*c.x+a.y*c.y};c.cross=function(a,c){return a.x*c.y-a.y*c.x};c.cross3=function(a,c,b){return(c.x-a.x)*(b.y-a.y)-(c.y-a.y)*(b.x-a.x)};c.add=function(a,c,b){b||(b={});b.x=a.x+c.x;b.y=a.y+c.y;return b};c.sub=function(a,c,b){b||(b={});b.x=a.x-c.x;b.y=a.y-c.y;return b};c.mult=function(a,c){return{x:a.x*c,y:a.y*c}};c.div=function(a,c){return{x:a.x/c,y:a.y/c}};c.perp=function(a,c){c=!0===c?-1:1;return{x:c*-a.y,y:c*a.x}};c.neg=function(a){return{x:-a.x,
y:-a.y}};c.angle=function(a,c){return Math.atan2(c.y-a.y,c.x-a.x)};c._temp=[c.create(),c.create(),c.create(),c.create(),c.create(),c.create()]})()},{}],27:[function(a,b,e){var c={};b.exports=c;var f=a("../geometry/Vector"),h=a("../core/Common");(function(){c.create=function(a,c){for(var b=[],e=0;e<a.length;e++){var f=a[e];b.push({x:f.x,y:f.y,index:e,body:c,isInternal:!1})}return b};c.fromPath=function(a,b){var e=[];a.replace(/L?\s*([\-\d\.e]+)[\s,]*([\-\d\.e]+)*/ig,function(a,c,b){e.push({x:parseFloat(c),
y:parseFloat(b)})});return c.create(e,b)};c.centre=function(a){for(var b=c.area(a,!0),e={x:0,y:0},l,h,r=0;r<a.length;r++)h=(r+1)%a.length,l=f.cross(a[r],a[h]),l=f.mult(f.add(a[r],a[h]),l),e=f.add(e,l);return f.div(e,6*b)};c.mean=function(a){for(var c={x:0,y:0},b=0;b<a.length;b++)c.x+=a[b].x,c.y+=a[b].y;return f.div(c,a.length)};c.area=function(a,c){for(var b=0,e=a.length-1,f=0;f<a.length;f++)b+=(a[e].x-a[f].x)*(a[e].y+a[f].y),e=f;return c?b/2:Math.abs(b)/2};c.inertia=function(a,c){for(var b=0,e=0,
h,r,m=0;m<a.length;m++)r=(m+1)%a.length,h=Math.abs(f.cross(a[r],a[m])),b+=h*(f.dot(a[r],a[r])+f.dot(a[r],a[m])+f.dot(a[m],a[m])),e+=h;return c/6*(b/e)};c.translate=function(a,c,b){var e;if(b)for(e=0;e<a.length;e++)a[e].x+=c.x*b,a[e].y+=c.y*b;else for(e=0;e<a.length;e++)a[e].x+=c.x,a[e].y+=c.y;return a};c.rotate=function(a,c,b){if(0!==c){var e=Math.cos(c);c=Math.sin(c);for(var f=0;f<a.length;f++){var h=a[f],m=h.x-b.x,p=h.y-b.y;h.x=b.x+(m*e-p*c);h.y=b.y+(m*c+p*e)}return a}};c.contains=function(a,c){for(var b=
0;b<a.length;b++){var e=a[b],f=a[(b+1)%a.length];if(0<(c.x-e.x)*(f.y-e.y)+(c.y-e.y)*(e.x-f.x))return!1}return!0};c.scale=function(a,b,e,h){if(1===b&&1===e)return a;h=h||c.centre(a);for(var v,r=0;r<a.length;r++)v=a[r],v=f.sub(v,h),a[r].x=h.x+v.x*b,a[r].y=h.y+v.y*e;return a};c.chamfer=function(a,c,b,e,v){c=c||[8];c.length||(c=[c]);b="undefined"!==typeof b?b:-1;e=e||2;v=v||14;for(var r=[],m=0;m<a.length;m++){var p=a[0<=m-1?m-1:a.length-1],A=a[m],x=a[(m+1)%a.length],u=c[m<c.length?m:c.length-1];if(0===
u)r.push(A);else{var p=f.normalise({x:A.y-p.y,y:p.x-A.x}),t=f.normalise({x:x.y-A.y,y:A.x-x.x}),w=Math.sqrt(2*Math.pow(u,2)),x=f.mult(h.clone(p),u),z=f.normalise(f.mult(f.add(p,t),.5)),A=f.sub(A,f.mult(z,w)),w=b;-1===b&&(w=1.75*Math.pow(u,.32));w=h.clamp(w,e,v);1===w%2&&(w+=1);u=Math.acos(f.dot(p,t))/w;for(p=0;p<w;p++)r.push(f.add(f.rotate(x,u*p),A))}}return r};c.clockwiseSort=function(a){var b=c.mean(a);a.sort(function(a,c){return f.angle(b,a)-f.angle(b,c)});return a};c.isConvex=function(a){var c=
0,b=a.length,e,f,h,m;if(3>b)return null;for(e=0;e<b;e++)if(f=(e+1)%b,h=(e+2)%b,m=(a[f].x-a[e].x)*(a[h].y-a[f].y),m-=(a[f].y-a[e].y)*(a[h].x-a[f].x),0>m?c|=1:0<m&&(c|=2),3===c)return!1;return 0!==c?!0:null};c.hull=function(a){var c=[],b=[],e,h;a=a.slice(0);a.sort(function(a,c){var b=a.x-c.x;return 0!==b?b:a.y-c.y});for(h=0;h<a.length;h++){for(e=a[h];2<=b.length&&0>=f.cross3(b[b.length-2],b[b.length-1],e);)b.pop();b.push(e)}for(h=a.length-1;0<=h;h--){for(e=a[h];2<=c.length&&0>=f.cross3(c[c.length-2],
c[c.length-1],e);)c.pop();c.push(e)}c.pop();b.pop();return c.concat(b)}})()},{"../core/Common":14,"../geometry/Vector":26}],28:[function(a,b,e){b=b.exports={};b.version="master";b.Body=a("../body/Body");b.Composite=a("../body/Composite");b.World=a("../body/World");b.Contact=a("../collision/Contact");b.Detector=a("../collision/Detector");b.Grid=a("../collision/Grid");b.Pairs=a("../collision/Pairs");b.Pair=a("../collision/Pair");b.Query=a("../collision/Query");b.Resolver=a("../collision/Resolver");
b.SAT=a("../collision/SAT");b.Constraint=a("../constraint/Constraint");b.MouseConstraint=a("../constraint/MouseConstraint");b.Common=a("../core/Common");b.Engine=a("../core/Engine");b.Events=a("../core/Events");b.Mouse=a("../core/Mouse");b.Runner=a("../core/Runner");b.Sleeping=a("../core/Sleeping");b.Bodies=a("../factory/Bodies");b.Composites=a("../factory/Composites");b.Axes=a("../geometry/Axes");b.Bounds=a("../geometry/Bounds");b.Svg=a("../geometry/Svg");b.Vector=a("../geometry/Vector");b.Vertices=
a("../geometry/Vertices");b.Render=a("../render/Render");b.RenderPixi=a("../render/RenderPixi");b.World.add=b.Composite.add;b.World.remove=b.Composite.remove;b.World.addComposite=b.Composite.addComposite;b.World.addBody=b.Composite.addBody;b.World.addConstraint=b.Composite.addConstraint;b.World.clear=b.Composite.clear;b.Engine.run=b.Runner.run},{"../body/Body":1,"../body/Composite":2,"../body/World":3,"../collision/Contact":4,"../collision/Detector":5,"../collision/Grid":6,"../collision/Pair":7,"../collision/Pairs":8,
"../collision/Query":9,"../collision/Resolver":10,"../collision/SAT":11,"../constraint/Constraint":12,"../constraint/MouseConstraint":13,"../core/Common":14,"../core/Engine":15,"../core/Events":16,"../core/Metrics":17,"../core/Mouse":18,"../core/Runner":19,"../core/Sleeping":20,"../factory/Bodies":21,"../factory/Composites":22,"../geometry/Axes":23,"../geometry/Bounds":24,"../geometry/Svg":25,"../geometry/Vector":26,"../geometry/Vertices":27,"../render/Render":29,"../render/RenderPixi":30}],29:[function(a,
b,e){var c={};b.exports=c;var f=a("../core/Common"),h=a("../body/Composite"),k=a("../geometry/Bounds"),g=a("../core/Events"),q=a("../collision/Grid"),l=a("../geometry/Vector");(function(){c.create=function(b){b=f.extend({controller:c,element:null,canvas:null,mouse:null,options:{width:800,height:600,pixelRatio:1,background:"#fafafa",wireframeBackground:"#222",hasBounds:!1,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,
showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},b);b.canvas&&(b.canvas.width=b.options.width||b.canvas.width,b.canvas.height=b.options.height||b.canvas.height);b.canvas=b.canvas||a(b.options.width,b.options.height);b.context=b.canvas.getContext("2d");b.textures={};b.bounds=b.bounds||{min:{x:0,y:0},max:{x:b.canvas.width,y:b.canvas.height}};1!==b.options.pixelRatio&&c.setPixelRatio(b,b.options.pixelRatio);
f.isElement(b.element)?b.element.appendChild(b.canvas):f.log("Render.create: options.element was undefined, render.canvas was created but not appended","warn");return b};c.setPixelRatio=function(a,c){var b=a.options,e=a.canvas;if("auto"===c){var f=e.getContext("2d");c=(window.devicePixelRatio||1)/(f.webkitBackingStorePixelRatio||f.mozBackingStorePixelRatio||f.msBackingStorePixelRatio||f.oBackingStorePixelRatio||f.backingStorePixelRatio||1)}b.pixelRatio=c;e.setAttribute("data-pixel-ratio",c);e.width=
b.width*c;e.height=b.height*c;e.style.width=b.width+"px";e.style.height=b.height+"px";a.context.scale(c,c)};c.world=function(a){var b=a.render,e=a.world,f=b.canvas,x=b.context,u=b.options,t=h.allBodies(e),e=h.allConstraints(e),w=u.wireframes?u.wireframeBackground:u.background,v=[],y=[],B={timestamp:a.timing.timestamp};g.trigger(b,"beforeRender",B);if(b.currentBackground!==w){var C=w;/(jpg|gif|png)$/.test(w)&&(C="url("+w+")");b.canvas.style.background=C;b.canvas.style.backgroundSize="100%";b.currentBackground=
w}x.globalCompositeOperation="source-in";x.fillStyle="transparent";x.fillRect(0,0,f.width,f.height);x.globalCompositeOperation="source-over";if(u.hasBounds){w=(b.bounds.max.x-b.bounds.min.x)/u.width;C=(b.bounds.max.y-b.bounds.min.y)/u.height;for(f=0;f<t.length;f++){var D=t[f];k.overlaps(D.bounds,b.bounds)&&v.push(D)}for(f=0;f<e.length;f++){var t=e[f],D=t.bodyA,G=t.bodyB,H=t.pointA,E=t.pointB;D&&(H=l.add(D.position,t.pointA));G&&(E=l.add(G.position,t.pointB));H&&E&&(k.contains(b.bounds,H)||k.contains(b.bounds,
E))&&y.push(t)}x.scale(1/w,1/C);x.translate(-b.bounds.min.x,-b.bounds.min.y)}else y=e,v=t;!u.wireframes||a.enableSleeping&&u.showSleeping?c.bodies(a,v,x):(u.showConvexHulls&&c.bodyConvexHulls(a,v,x),c.bodyWireframes(a,v,x));u.showBounds&&c.bodyBounds(a,v,x);(u.showAxes||u.showAngleIndicator)&&c.bodyAxes(a,v,x);u.showPositions&&c.bodyPositions(a,v,x);u.showVelocity&&c.bodyVelocity(a,v,x);u.showIds&&c.bodyIds(a,v,x);u.showSeparations&&c.separations(a,a.pairs.list,x);u.showCollisions&&c.collisions(a,
a.pairs.list,x);u.showVertexNumbers&&c.vertexNumbers(a,v,x);u.showMousePosition&&c.mousePosition(a,b.mouse,x);c.constraints(y,x);u.showBroadphase&&a.broadphase.controller===q&&c.grid(a,a.broadphase,x);u.showDebug&&c.debug(a,x);u.hasBounds&&x.setTransform(u.pixelRatio,0,0,u.pixelRatio,0,0);g.trigger(b,"afterRender",B)};c.debug=function(a,b){var c=a.render,e=a.metrics,f=c.options;h.allBodies(a.world);if(500<=a.timing.timestamp-(c.debugTimestamp||0)){var g="";e.timing&&(g+="fps: "+Math.round(e.timing.fps)+
"    ");c.debugString=g;c.debugTimestamp=a.timing.timestamp}if(c.debugString)for(b.font="12px Arial",b.fillStyle=f.wireframes?"rgba(255,255,255,0.5)":"rgba(0,0,0,0.5)",c=c.debugString.split("\n"),e=0;e<c.length;e++)b.fillText(c[e],50,50+18*e)};c.constraints=function(a,b){for(var c=0;c<a.length;c++){var e=a[c];if(e.render.visible&&e.pointA&&e.pointB){var f=e.bodyA,g=e.bodyB;f?(b.beginPath(),b.moveTo(f.position.x+e.pointA.x,f.position.y+e.pointA.y)):(b.beginPath(),b.moveTo(e.pointA.x,e.pointA.y));g?
b.lineTo(g.position.x+e.pointB.x,g.position.y+e.pointB.y):b.lineTo(e.pointB.x,e.pointB.y);b.lineWidth=e.render.lineWidth;b.strokeStyle=e.render.strokeStyle;b.stroke()}}};c.bodyShadows=function(a,b,c){a=a.render;for(var e=0;e<b.length;e++){var f=b[e];if(f.render.visible){if(f.circleRadius)c.beginPath(),c.arc(f.position.x,f.position.y,f.circleRadius,0,2*Math.PI);else{c.beginPath();c.moveTo(f.vertices[0].x,f.vertices[0].y);for(var g=1;g<f.vertices.length;g++)c.lineTo(f.vertices[g].x,f.vertices[g].y)}c.closePath();
var g=f.position.x-.5*a.options.width,f=f.position.y-.2*a.options.height,h=Math.abs(g)+Math.abs(f);c.shadowColor="rgba(0,0,0,0.15)";c.shadowOffsetX=.05*g;c.shadowOffsetY=.05*f;c.shadowBlur=1+12*Math.min(1,h/1E3);c.fill();c.shadowColor=null;c.shadowOffsetX=null;c.shadowOffsetY=null;c.shadowBlur=null}}};c.bodies=function(a,c,b){a=a.render;var e=a.options,f=e.showInternalEdges||!e.wireframes,g,h,k,q;for(k=0;k<c.length;k++)if(g=c[k],g.render.visible)for(q=1<g.parts.length?1:0;q<g.parts.length;q++)if(h=
g.parts[q],h.render.visible){e.showSleeping&&g.isSleeping?b.globalAlpha=.5*h.render.opacity:1!==h.render.opacity&&(b.globalAlpha=h.render.opacity);if(h.render.sprite&&h.render.sprite.texture&&!e.wireframes){var l=h.render.sprite,v;v=l.texture;var C=a.textures[v];C||(C=a.textures[v]=new Image,C.src=v);v=C;b.translate(h.position.x,h.position.y);b.rotate(h.angle);b.drawImage(v,v.width*-l.xOffset*l.xScale,v.height*-l.yOffset*l.yScale,v.width*l.xScale,v.height*l.yScale);b.rotate(-h.angle);b.translate(-h.position.x,
-h.position.y)}else{if(h.circleRadius)b.beginPath(),b.arc(h.position.x,h.position.y,h.circleRadius,0,2*Math.PI);else{b.beginPath();b.moveTo(h.vertices[0].x,h.vertices[0].y);for(l=1;l<h.vertices.length;l++)!h.vertices[l-1].isInternal||f?b.lineTo(h.vertices[l].x,h.vertices[l].y):b.moveTo(h.vertices[l].x,h.vertices[l].y),h.vertices[l].isInternal&&!f&&b.moveTo(h.vertices[(l+1)%h.vertices.length].x,h.vertices[(l+1)%h.vertices.length].y);b.lineTo(h.vertices[0].x,h.vertices[0].y);b.closePath()}e.wireframes?
(b.lineWidth=1,b.strokeStyle="#bbb"):(b.fillStyle=h.render.fillStyle,b.lineWidth=h.render.lineWidth,b.strokeStyle=h.render.strokeStyle,b.fill());b.stroke()}b.globalAlpha=1}};c.bodyWireframes=function(a,b,c){a=a.render.options.showInternalEdges;var e,f,g,h,l;c.beginPath();for(g=0;g<b.length;g++)if(e=b[g],e.render.visible)for(l=1<e.parts.length?1:0;l<e.parts.length;l++){f=e.parts[l];c.moveTo(f.vertices[0].x,f.vertices[0].y);for(h=1;h<f.vertices.length;h++)!f.vertices[h-1].isInternal||a?c.lineTo(f.vertices[h].x,
f.vertices[h].y):c.moveTo(f.vertices[h].x,f.vertices[h].y),f.vertices[h].isInternal&&!a&&c.moveTo(f.vertices[(h+1)%f.vertices.length].x,f.vertices[(h+1)%f.vertices.length].y);c.lineTo(f.vertices[0].x,f.vertices[0].y)}c.lineWidth=1;c.strokeStyle="#bbb";c.stroke()};c.bodyConvexHulls=function(a,b,c){var e,f;c.beginPath();for(e=0;e<b.length;e++)if(a=b[e],a.render.visible&&1!==a.parts.length){c.moveTo(a.vertices[0].x,a.vertices[0].y);for(f=1;f<a.vertices.length;f++)c.lineTo(a.vertices[f].x,a.vertices[f].y);
c.lineTo(a.vertices[0].x,a.vertices[0].y)}c.lineWidth=1;c.strokeStyle="rgba(255,255,255,0.2)";c.stroke()};c.vertexNumbers=function(a,b,c){var e,f;for(a=0;a<b.length;a++){var g=b[a].parts;for(f=1<g.length?1:0;f<g.length;f++){var h=g[f];for(e=0;e<h.vertices.length;e++)c.fillStyle="rgba(255,255,255,0.2)",c.fillText(a+"_"+e,h.position.x+.8*(h.vertices[e].x-h.position.x),h.position.y+.8*(h.vertices[e].y-h.position.y))}}};c.mousePosition=function(a,b,c){c.fillStyle="rgba(255,255,255,0.8)";c.fillText(b.position.x+
"  "+b.position.y,b.position.x+5,b.position.y-5)};c.bodyBounds=function(a,b,c){a=a.render.options;c.beginPath();for(var e=0;e<b.length;e++)if(b[e].render.visible)for(var f=b[e].parts,g=1<f.length?1:0;g<f.length;g++){var h=f[g];c.rect(h.bounds.min.x,h.bounds.min.y,h.bounds.max.x-h.bounds.min.x,h.bounds.max.y-h.bounds.min.y)}c.strokeStyle=a.wireframes?"rgba(255,255,255,0.08)":"rgba(0,0,0,0.1)";c.lineWidth=1;c.stroke()};c.bodyAxes=function(a,b,c){a=a.render.options;var e,f,g,h;c.beginPath();for(f=0;f<
b.length;f++){e=b[f];var l=e.parts;if(e.render.visible)if(a.showAxes)for(g=1<l.length?1:0;g<l.length;g++)for(e=l[g],h=0;h<e.axes.length;h++){var k=e.axes[h];c.moveTo(e.position.x,e.position.y);c.lineTo(e.position.x+20*k.x,e.position.y+20*k.y)}else for(g=1<l.length?1:0;g<l.length;g++)for(e=l[g],h=0;h<e.axes.length;h++)c.moveTo(e.position.x,e.position.y),c.lineTo((e.vertices[0].x+e.vertices[e.vertices.length-1].x)/2,(e.vertices[0].y+e.vertices[e.vertices.length-1].y)/2)}a.wireframes?c.strokeStyle="indianred":
(c.strokeStyle="rgba(0,0,0,0.8)",c.globalCompositeOperation="overlay");c.lineWidth=1;c.stroke();c.globalCompositeOperation="source-over"};c.bodyPositions=function(a,c,b){a=a.render.options;var e,f,g,h;b.beginPath();for(g=0;g<c.length;g++)if(e=c[g],e.render.visible)for(h=0;h<e.parts.length;h++)f=e.parts[h],b.arc(f.position.x,f.position.y,3,0,2*Math.PI,!1),b.closePath();b.fillStyle=a.wireframes?"indianred":"rgba(0,0,0,0.5)";b.fill();b.beginPath();for(g=0;g<c.length;g++)e=c[g],e.render.visible&&(b.arc(e.positionPrev.x,
e.positionPrev.y,2,0,2*Math.PI,!1),b.closePath());b.fillStyle="rgba(255,165,0,0.8)";b.fill()};c.bodyVelocity=function(a,b,c){c.beginPath();for(a=0;a<b.length;a++){var e=b[a];e.render.visible&&(c.moveTo(e.position.x,e.position.y),c.lineTo(e.position.x+2*(e.position.x-e.positionPrev.x),e.position.y+2*(e.position.y-e.positionPrev.y)))}c.lineWidth=3;c.strokeStyle="cornflowerblue";c.stroke()};c.bodyIds=function(a,b,c){var e;for(a=0;a<b.length;a++)if(b[a].render.visible){var f=b[a].parts;for(e=1<f.length?
1:0;e<f.length;e++){var g=f[e];c.font="12px Arial";c.fillStyle="rgba(255,255,255,0.5)";c.fillText(g.id,g.position.x+10,g.position.y-10)}}};c.collisions=function(a,b,c){a=a.render.options;var e,f,g;c.beginPath();for(g=0;g<b.length;g++)if(e=b[g],e.isActive)for(f=0;f<e.activeContacts.length;f++){var h=e.activeContacts[f].vertex;c.rect(h.x-1.5,h.y-1.5,3.5,3.5)}c.fillStyle=a.wireframes?"rgba(255,255,255,0.7)":"orange";c.fill();c.beginPath();for(g=0;g<b.length;g++)if(e=b[g],e.isActive&&(f=e.collision,0<
e.activeContacts.length)){var h=e.activeContacts[0].vertex.x,l=e.activeContacts[0].vertex.y;2===e.activeContacts.length&&(h=(e.activeContacts[0].vertex.x+e.activeContacts[1].vertex.x)/2,l=(e.activeContacts[0].vertex.y+e.activeContacts[1].vertex.y)/2);f.bodyB===f.supports[0].body||!0===f.bodyA.isStatic?c.moveTo(h-8*f.normal.x,l-8*f.normal.y):c.moveTo(h+8*f.normal.x,l+8*f.normal.y);c.lineTo(h,l)}c.strokeStyle=a.wireframes?"rgba(255,165,0,0.7)":"orange";c.lineWidth=1;c.stroke()};c.separations=function(a,
c,b){a=a.render.options;var e,f,g,h;b.beginPath();for(h=0;h<c.length;h++)if(e=c[h],e.isActive){e=e.collision;f=e.bodyA;g=e.bodyB;var l=1;g.isStatic||f.isStatic||(l=.5);g.isStatic&&(l=0);b.moveTo(g.position.x,g.position.y);b.lineTo(g.position.x-e.penetration.x*l,g.position.y-e.penetration.y*l);l=1;g.isStatic||f.isStatic||(l=.5);f.isStatic&&(l=0);b.moveTo(f.position.x,f.position.y);b.lineTo(f.position.x+e.penetration.x*l,f.position.y+e.penetration.y*l)}b.strokeStyle=a.wireframes?"rgba(255,165,0,0.5)":
"orange";b.stroke()};c.grid=function(a,c,b){b.strokeStyle=a.render.options.wireframes?"rgba(255,180,0,0.1)":"rgba(255,180,0,0.5)";b.beginPath();a=f.keys(c.buckets);for(var e=0;e<a.length;e++){var g=a[e];2>c.buckets[g].length||(g=g.split(","),b.rect(.5+parseInt(g[0],10)*c.bucketWidth,.5+parseInt(g[1],10)*c.bucketHeight,c.bucketWidth,c.bucketHeight))}b.lineWidth=1;b.stroke()};c.inspector=function(a,c){var b=a.selected,e=a.engine.render,f=e.options,g;f.hasBounds&&(c.scale(1/((e.bounds.max.x-e.bounds.min.x)/
e.options.width),1/((e.bounds.max.y-e.bounds.min.y)/e.options.height)),c.translate(-e.bounds.min.x,-e.bounds.min.y));for(e=0;e<b.length;e++){g=b[e].data;c.translate(.5,.5);c.lineWidth=1;c.strokeStyle="rgba(255,165,0,0.9)";c.setLineDash([1,2]);switch(g.type){case "body":g=g.bounds;c.beginPath();c.rect(Math.floor(g.min.x-3),Math.floor(g.min.y-3),Math.floor(g.max.x-g.min.x+6),Math.floor(g.max.y-g.min.y+6));c.closePath();c.stroke();break;case "constraint":var h=g.pointA;g.bodyA&&(h=g.pointB);c.beginPath();
c.arc(h.x,h.y,10,0,2*Math.PI);c.closePath();c.stroke()}c.setLineDash([]);c.translate(-.5,-.5)}null!==a.selectStart&&(c.translate(.5,.5),c.lineWidth=1,c.strokeStyle="rgba(255,165,0,0.6)",c.fillStyle="rgba(255,165,0,0.1)",g=a.selectBounds,c.beginPath(),c.rect(Math.floor(g.min.x),Math.floor(g.min.y),Math.floor(g.max.x-g.min.x),Math.floor(g.max.y-g.min.y)),c.closePath(),c.stroke(),c.fill(),c.translate(-.5,-.5));f.hasBounds&&c.setTransform(1,0,0,1,0,0)};var a=function(a,c){var b=document.createElement("canvas");
b.width=a;b.height=c;b.oncontextmenu=function(){return!1};b.onselectstart=function(){return!1};return b}})()},{"../body/Composite":2,"../collision/Grid":6,"../core/Common":14,"../core/Events":16,"../geometry/Bounds":24,"../geometry/Vector":26}],30:[function(a,b,e){var c={};b.exports=c;var f=a("../body/Composite"),h=a("../core/Common");(function(){c.create=function(a){var b=h.extend({controller:c,element:null,canvas:null,renderer:null,container:null,spriteContainer:null,pixiOptions:null,options:{width:800,
height:600,background:"#fafafa",wireframeBackground:"#222",hasBounds:!1,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1}},a),e=!b.options.wireframes&&"transparent"===b.options.background;b.pixiOptions=b.pixiOptions||{view:b.canvas,transparent:e,antialias:!0,backgroundColor:a.options.background};b.renderer=b.renderer||new PIXI.WebGLRenderer(b.options.width,
b.options.height,b.pixiOptions);b.container=b.container||new PIXI.Container;b.spriteContainer=b.spriteContainer||new PIXI.Container;b.canvas=b.canvas||b.renderer.view;b.bounds=b.bounds||{min:{x:0,y:0},max:{x:b.options.width,y:b.options.height}};b.textures={};b.sprites={};b.primitives={};b.container.addChild(b.spriteContainer);h.isElement(b.element)?b.element.appendChild(b.canvas):h.log('No "render.element" passed, "render.canvas" was not inserted into document.',"warn");b.canvas.oncontextmenu=function(){return!1};
b.canvas.onselectstart=function(){return!1};return b};c.clear=function(a){for(var b=a.container,c=a.spriteContainer;b.children[0];)b.removeChild(b.children[0]);for(;c.children[0];)c.removeChild(c.children[0]);c=a.sprites["bg-0"];a.textures={};a.sprites={};a.primitives={};(a.sprites["bg-0"]=c)&&b.addChildAt(c,0);a.container.addChild(a.spriteContainer);a.currentBackground=null;b.scale.set(1,1);b.position.set(0,0)};c.setBackground=function(b,c){if(b.currentBackground!==c){var e=c.indexOf&&-1!==c.indexOf("#"),
f=b.sprites["bg-0"];e?(e=h.colorToNumber(c),b.renderer.backgroundColor=e,f&&b.container.removeChild(f)):f||(f=a(b,c),f=b.sprites["bg-0"]=new PIXI.Sprite(f),f.position.x=0,f.position.y=0,b.container.addChildAt(f,0));b.currentBackground=c}};c.world=function(a){var b=a.render,e=a.world,h=b.renderer,k=b.container,m=b.options,p=f.allBodies(e),e=f.allConstraints(e),A=[];m.wireframes?c.setBackground(b,m.wireframeBackground):c.setBackground(b,m.background);var x=(b.bounds.max.x-b.bounds.min.x)/b.options.width,
u=(b.bounds.max.y-b.bounds.min.y)/b.options.height;if(m.hasBounds){for(m=0;m<p.length;m++){var t=p[m];t.render.sprite.visible=Bounds.overlaps(t.bounds,b.bounds)}for(m=0;m<e.length;m++){var t=e[m],w=t.bodyA,z=t.bodyB,y=t.pointA,B=t.pointB;w&&(y=Vector.add(w.position,t.pointA));z&&(B=Vector.add(z.position,t.pointB));y&&B&&(Bounds.contains(b.bounds,y)||Bounds.contains(b.bounds,B))&&A.push(t)}k.scale.set(1/x,1/u);k.position.set(1/x*-b.bounds.min.x,1/u*-b.bounds.min.y)}else A=e;for(m=0;m<p.length;m++)c.body(a,
p[m]);for(m=0;m<A.length;m++)c.constraint(a,A[m]);h.render(k)};c.constraint=function(a,b){var c=a.render,e=b.bodyA,f=b.bodyB,k=b.pointA,p=b.pointB,A=c.container,x=b.render,u="c-"+b.id,t=c.primitives[u];t||(t=c.primitives[u]=new PIXI.Graphics);x.visible&&b.pointA&&b.pointB?(-1===h.indexOf(A.children,t)&&A.addChild(t),t.clear(),t.beginFill(0,0),t.lineStyle(x.lineWidth,h.colorToNumber(x.strokeStyle),1),e?t.moveTo(e.position.x+k.x,e.position.y+k.y):t.moveTo(k.x,k.y),f?t.lineTo(f.position.x+p.x,f.position.y+
p.y):t.lineTo(p.x,p.y),t.endFill()):t.clear()};c.body=function(b,c){var e=b.render,f=c.render;if(f.visible)if(f.sprite&&f.sprite.texture){var r="b-"+c.id,m=e.sprites[r],p=e.spriteContainer;m||(m=e.sprites,e=a(e,c.render.sprite.texture),e=new PIXI.Sprite(e),e.anchor.x=c.render.sprite.xOffset,e.anchor.y=c.render.sprite.yOffset,m=m[r]=e);-1===h.indexOf(p.children,m)&&p.addChild(m);m.position.x=c.position.x;m.position.y=c.position.y;m.rotation=c.angle;m.scale.x=f.sprite.xScale||1;m.scale.y=f.sprite.yScale||
1}else{f="b-"+c.id;p=e.primitives[f];r=e.container;if(!p){var p=e.primitives,m=c.render,e=e.options,A=new PIXI.Graphics,x=h.colorToNumber(m.fillStyle),u=h.colorToNumber(m.strokeStyle),t=h.colorToNumber(m.strokeStyle),w=h.colorToNumber("#bbb"),z=h.colorToNumber("#CD5C5C"),y;A.clear();for(var B=1<c.parts.length?1:0;B<c.parts.length;B++){y=c.parts[B];e.wireframes?(A.beginFill(0,0),A.lineStyle(1,w,1)):(A.beginFill(x,1),A.lineStyle(m.lineWidth,u,1));A.moveTo(y.vertices[0].x-c.position.x,y.vertices[0].y-
c.position.y);for(var C=1;C<y.vertices.length;C++)A.lineTo(y.vertices[C].x-c.position.x,y.vertices[C].y-c.position.y);A.lineTo(y.vertices[0].x-c.position.x,y.vertices[0].y-c.position.y);A.endFill();if(e.showAngleIndicator||e.showAxes)A.beginFill(0,0),e.wireframes?A.lineStyle(1,z,1):A.lineStyle(1,t),A.moveTo(y.position.x-c.position.x,y.position.y-c.position.y),A.lineTo((y.vertices[0].x+y.vertices[y.vertices.length-1].x)/2-c.position.x,(y.vertices[0].y+y.vertices[y.vertices.length-1].y)/2-c.position.y),
A.endFill()}p=p[f]=A;p.initialAngle=c.angle}-1===h.indexOf(r.children,p)&&r.addChild(p);p.position.x=c.position.x;p.position.y=c.position.y;p.rotation=c.angle-p.initialAngle}};var a=function(a,b){var c=a.textures[b];c||(c=a.textures[b]=PIXI.Texture.fromImage(b));return c}})()},{"../body/Composite":2,"../core/Common":14}]},{},[28])(28)});
window._requestAF=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(d,a){window.setTimeout(d,1E3/60)}}();function Point(d,a){d||(d=0);a||(a=0);this.x=d;this.y=a}Point.prototype.add=function(d){return new Point(this.x+d.x,this.y+d.y)};Point.prototype.clone=function(){return new Point(this.x,this.y)};Point.prototype.copyFrom=function(d){this.x=d.x;this.y=d.y};
Point.prototype.equals=function(d){return this.x==d.x&&this.y==d.y};Point.prototype.normalize=function(d){var a=Math.sqrt(this.x*this.x+this.y*this.y);this.x*=d/a;this.y*=d/a};Point.prototype.offset=function(d,a){this.x+=d;this.y+=a};Point.prototype.setTo=function(d,a){this.x=d;this.y=a};Point.prototype.subtract=function(d){return new Point(this.x-d.x,this.y-d.y)};Point.distance=function(d,a){return Point._distance(d.x,d.y,a.x,a.y)};
Point.interpolate=function(d,a,b){return new Point(d.x+b*(a.x-d.x),d.y+b*(a.y-d.y))};Point.polar=function(d,a){return new Point(d*Math.cos(a),d*Math.sin(a))};Point._distance=function(d,a,b,e){return Math.sqrt((b-d)*(b-d)+(e-a)*(e-a))};Point._v4={};Point._m4={};Point._v4.create=function(){return new Float32Array(4)};Point._m4.create=function(d){var a=new Float32Array(16);a[0]=a[5]=a[10]=a[15]=1;d&&Point._m4.set(d,a);return a};
Point._v4.add=function(d,a,b){b[0]=d[0]+a[0];b[1]=d[1]+a[1];b[2]=d[2]+a[2];b[3]=d[3]+a[3]};Point._v4.set=function(d,a){a[0]=d[0];a[1]=d[1];a[2]=d[2];a[3]=d[3]};Point._m4.set=function(d,a){a[0]=d[0];a[1]=d[1];a[2]=d[2];a[3]=d[3];a[4]=d[4];a[5]=d[5];a[6]=d[6];a[7]=d[7];a[8]=d[8];a[9]=d[9];a[10]=d[10];a[11]=d[11];a[12]=d[12];a[13]=d[13];a[14]=d[14];a[15]=d[15]};
Point._m4.multiply=function(d,a,b){var e=d[0],c=d[1],f=d[2],h=d[3],k=d[4],g=d[5],q=d[6],l=d[7],v=d[8],r=d[9],m=d[10],p=d[11],A=d[12],x=d[13],u=d[14];d=d[15];var t=a[0],w=a[1],z=a[2],y=a[3];b[0]=t*e+w*k+z*v+y*A;b[1]=t*c+w*g+z*r+y*x;b[2]=t*f+w*q+z*m+y*u;b[3]=t*h+w*l+z*p+y*d;t=a[4];w=a[5];z=a[6];y=a[7];b[4]=t*e+w*k+z*v+y*A;b[5]=t*c+w*g+z*r+y*x;b[6]=t*f+w*q+z*m+y*u;b[7]=t*h+w*l+z*p+y*d;t=a[8];w=a[9];z=a[10];y=a[11];b[8]=t*e+w*k+z*v+y*A;b[9]=t*c+w*g+z*r+y*x;b[10]=t*f+w*q+z*m+y*u;b[11]=t*h+w*l+z*p+y*d;
t=a[12];w=a[13];z=a[14];y=a[15];b[12]=t*e+w*k+z*v+y*A;b[13]=t*c+w*g+z*r+y*x;b[14]=t*f+w*q+z*m+y*u;b[15]=t*h+w*l+z*p+y*d;return b};
Point._m4.inverse=function(d,a){var b=d[0],e=d[1],c=d[2],f=d[3],h=d[4],k=d[5],g=d[6],q=d[7],l=d[8],v=d[9],r=d[10],m=d[11],p=d[12],A=d[13],x=d[14],u=d[15],t=b*k-e*h,w=b*g-c*h,z=b*q-f*h,y=e*g-c*k,B=e*q-f*k,C=c*q-f*g,D=l*A-v*p,G=l*x-r*p,H=l*u-m*p,E=v*x-r*A,I=v*u-m*A,J=r*u-m*x,F=t*J-w*I+z*E+y*H-B*G+C*D;if(!F)return null;F=1/F;a[0]=(k*J-g*I+q*E)*F;a[1]=(c*I-e*J-f*E)*F;a[2]=(A*C-x*B+u*y)*F;a[3]=(r*B-v*C-m*y)*F;a[4]=(g*H-h*J-q*G)*F;a[5]=(b*J-c*H+f*G)*F;a[6]=(x*z-p*C-u*w)*F;a[7]=(l*C-r*z+m*w)*F;a[8]=(h*I-
k*H+q*D)*F;a[9]=(e*H-b*I-f*D)*F;a[10]=(p*B-A*z+u*t)*F;a[11]=(v*z-l*B-m*t)*F;a[12]=(k*G-h*E-g*D)*F;a[13]=(b*E-e*G+c*D)*F;a[14]=(A*w-p*y-x*t)*F;a[15]=(l*y-v*w+r*t)*F;return a};Point._m4.multiplyVec2=function(d,a,b){var e=a[0];a=a[1];b[0]=e*d[0]+a*d[4]+d[12];b[1]=e*d[1]+a*d[5]+d[13]};Point._m4.multiplyVec4=function(d,a,b){var e=a[0],c=a[1],f=a[2];a=a[3];b[0]=d[0]*e+d[4]*c+d[8]*f+d[12]*a;b[1]=d[1]*e+d[5]*c+d[9]*f+d[13]*a;b[2]=d[2]*e+d[6]*c+d[10]*f+d[14]*a;b[3]=d[3]*e+d[7]*c+d[11]*f+d[15]*a};
function Rectangle(d,a,b,e){d||(d=0);a||(a=0);b||(b=0);e||(e=0);this.x=d;this.y=a;this.width=b;this.height=e}Rectangle.prototype.clone=function(){return new Rectangle(this.x,this.y,this.width,this.height)};Rectangle.prototype.contains=function(d,a){return d>=this.x&&d<=this.x+this.width&&a>=this.y&&a<=this.y+this.height};Rectangle.prototype.containsPoint=function(d){return this.contains(d.x,d.y)};
Rectangle.prototype.containsRect=function(d){return this.x<=d.x&&this.y<=d.y&&d.x+d.width<=this.x+this.width&&d.y+d.height<=this.y+this.height};Rectangle.prototype.copyFrom=function(d){this.x=d.x;this.y=d.y;this.width=d.width;this.height=d.height};Rectangle.prototype.equals=function(d){return this.x==d.x&&this.y==d.y&&this.width==d.width&&this.height==d.height};Rectangle.prototype.inflate=function(d,a){this.x-=d;this.y-=a;this.width+=2*d;this.height+=2*a};
Rectangle.prototype.inflatePoint=function(d){this.inflate(d.x,d.y)};Rectangle.prototype.intersection=function(d){var a=Math.max(this.x,d.x),b=Math.max(this.y,d.y),e=Math.min(this.x+this.width,d.x+d.width);d=Math.min(this.y+this.height,d.y+d.height);return e<a||d<b?new Rectangle:new Rectangle(a,b,e-a,d-b)};Rectangle.prototype.intersects=function(d){return d.y+d.height<this.y||d.x>this.x+this.width||d.y>this.y+this.height||d.x+d.width<this.x?!1:!0};
Rectangle.prototype.isEmpty=function(){return 0>=this.width||0>=this.height};Rectangle.prototype.offset=function(d,a){this.x+=d;this.y+=a};Rectangle.prototype.offsetPoint=function(d){this.offset(d.x,d.y)};Rectangle.prototype.setEmpty=function(){this.x=this.y=this.width=this.height=0};Rectangle.prototype.setTo=function(d,a,b,e){this.x=d;this.y=a;this.width=b;this.height=e};
Rectangle.prototype.union=function(d){if(this.isEmpty())return d.clone();if(d.isEmpty())return this.clone();var a=this.clone();a._unionWith(d);return a};Rectangle._temp=new Float32Array(2);Rectangle.prototype._unionWith=function(d){d.isEmpty()||(this.isEmpty()?this.copyFrom(d):(this._unionWP(d.x,d.y),this._unionWP(d.x+d.width,d.y+d.height)))};
Rectangle.prototype._unionWP=function(d,a){var b=Math.min(this.x,d),e=Math.min(this.y,a);this.width=Math.max(this.x+this.width,d)-b;this.height=Math.max(this.y+this.height,a)-e;this.x=b;this.y=e};Rectangle.prototype._unionWL=function(d,a,b,e){0==this.width&&0==this.height?this._setP(d,a):this._unionWP(d,a);this._unionWP(b,e)};Rectangle.prototype._setP=function(d,a){this.x=d;this.y=a;this.width=this.height=0};
function Transform(){this._obj=null;this._vdirty=this._mdirty=!1;this._tmat=Point._m4.create();this._imat=Point._m4.create();this._atmat=Point._m4.create();this._aimat=Point._m4.create();this._pscal=Point._m4.create();this._cmat=Point._m4.create();this._cvec=Point._v4.create();this._cID=!0;this._scaleZ=this._scaleY=this._scaleX=1;this._rotationZ=this._rotationY=this._rotationX=0}Transform.prototype._getTMat=function(){var d=this._obj,a=this._tmat;this._checkMat();a[12]=d.x;a[13]=d.y;a[14]=d.z;return a};
Transform.prototype._getIMat=function(){Point._m4.inverse(this._getTMat(),this._imat);return this._imat};Transform.prototype._postScale=function(d,a){this._checkMat();var b=this._pscal;b[10]=b[15]=1;b[0]=d;b[5]=a;Point._m4.multiply(b,this._tmat,this._tmat);this._vdirty=!0};
Transform.prototype._valsToMat=function(){var d=this._tmat,a=this._scaleX,b=this._scaleY,e=this._scaleZ,c=-.01745329252*this._rotationX,f=-.01745329252*this._rotationY,h=-.01745329252*this._rotationZ,k=Math.cos(c),g=Math.cos(f),q=Math.cos(h),c=Math.sin(c),f=Math.sin(f),h=Math.sin(h);d[0]=g*q*a;d[1]=-g*h*a;d[2]=f*a;d[4]=(k*h+c*f*q)*b;d[5]=(k*q-c*f*h)*b;d[6]=-c*g*b;d[8]=(c*h-k*f*q)*e;d[9]=(c*q+k*f*h)*e;d[10]=k*g*e};
Transform.prototype._matToVals=function(){var d=this._tmat,a=d[0],b=d[1],e=d[2],c=d[4],f=d[5],h=d[6],k=d[8],g=d[9],d=d[10];this._scaleX=Math.sqrt(a*a+b*b+e*e);this._scaleY=Math.sqrt(c*c+f*f+h*h);this._scaleZ=Math.sqrt(k*k+g*g+d*d);c=1/this._scaleX;f=1/this._scaleY;k=1/this._scaleZ;h*=f;d*=k;this._rotationX=-57.29577951308*Math.atan2(-h,d);this._rotationY=-57.29577951308*Math.atan2(e*c,Math.sqrt(h*h+d*d));this._rotationZ=-57.29577951308*Math.atan2(-(b*c),a*c)};
Transform.prototype._checkVals=function(){this._vdirty&&(this._matToVals(),this._vdirty=!1)};Transform.prototype._checkMat=function(){this._mdirty&&(this._valsToMat(),this._mdirty=!1)};Transform.prototype._setOPos=function(d){d=this._tmat;this._obj.x=d[12];this._obj.y=d[13];this._obj.z=d[14]};
Transform.prototype._checkColorID=function(){var d=this._cmat,a=this._cvec;this._cID=1==d[15]&&1==d[0]&&0==d[1]&&0==d[2]&&0==d[3]&&0==d[4]&&1==d[5]&&0==d[6]&&0==d[7]&&0==d[8]&&0==d[9]&&1==d[10]&&0==d[11]&&0==d[12]&&0==d[13]&&0==d[14]&&1==d[15]&&0==a[0]&&0==a[1]&&0==a[2]&&0==a[3]};Transform.prototype._setMat3=function(d){var a=this._tmat;a[0]=d[0];a[1]=d[1];a[4]=d[3];a[5]=d[4];a[12]=d[6];a[13]=d[7]};
Transform.prototype._getMat3=function(d){var a=this._tmat;d[0]=a[0];d[1]=a[1];d[3]=a[4];d[4]=a[5];d[6]=a[12];d[7]=a[13]};Transform.prototype._setCMat5=function(d){for(var a=this._cmat,b=this._cvec,e=0;4>e;e++){b[e]=d[20+e];for(var c=0;4>c;c++)a[4*e+c]=d[5*e+c]}};Transform.prototype._getCMat5=function(d){var a=this._cmat,b=this._cvec;d[24]=1;for(var e=0;4>e;e++){d[20+e]=b[e];for(var c=0;4>c;c++)d[5*e+c]=a[4*e+c]}};
Transform.prototype.__defineSetter__("matrix",function(d){this._checkMat();this._setMat3(d);this._setOPos();this._vdirty=!0});Transform.prototype.__defineGetter__("matrix",function(){this._checkMat();var d=new Float32Array(9);this._getMat3(d);return d});Transform.prototype.__defineSetter__("matrix3D",function(d){this._checkMat();Point._m4.set(d,this._tmat);this._setOPos();this._vdirty=!0});Transform.prototype.__defineGetter__("matrix3D",function(){this._checkMat();return Point._m4.create(this._getTMat())});
Transform.prototype.__defineSetter__("colorTransform",function(d){this._setCMat5(d);this._checkColorID()});Transform.prototype.__defineGetter__("colorTransform",function(){var d=new Float32Array(25);this._getCMat5(d);return d});function EventDispatcher(){this.lsrs={};this.cals={}}EventDispatcher.efbc=[];EventDispatcher.prototype.hasEventListener=function(d){d=this.lsrs[d];return null==d?!1:0<d.length};EventDispatcher.prototype.addEventListener=function(d,a){this.addEventListener2(d,a,null)};
EventDispatcher.prototype.addEventListener2=function(d,a,b){null==this.lsrs[d]&&(this.lsrs[d]=[],this.cals[d]=[]);this.lsrs[d].push(a);this.cals[d].push(b);d==Event.ENTER_FRAME&&(d=EventDispatcher.efbc,0>d.indexOf(this)&&d.push(this))};EventDispatcher.prototype.removeEventListener=function(d,a){var b=this.lsrs[d];if(null!=b){var e=b.indexOf(a);if(!(0>e)){var c=this.cals[d];b.splice(e,1);c.splice(e,1);d==Event.ENTER_FRAME&&0==b.length&&(b=EventDispatcher.efbc,b.splice(b.indexOf(this),1))}}};
EventDispatcher.prototype.dispatchEvent=function(d){d.currentTarget=this;null==d.target&&(d.target=this);var a=this.lsrs[d.type];if(null!=a)for(var b=this.cals[d.type],e=0;e<a.length;e++)if(null==b[e])a[e](d);else a[e].call(b[e],d)};function Event(d,a){a||(a=!1);this.type=d;this.currentTarget=this.target=null;this.bubbles=a}Event.ENTER_FRAME="enterFrame";Event.RESIZE="resize";Event.ADDED_TO_STAGE="addedToStage";Event.REMOVED_FROM_STAGE="removedFromStage";Event.CHANGE="change";Event.OPEN="open";
Event.PROGRESS="progress";Event.COMPLETE="complete";function MouseEvent(d,a){Event.call(this,d,a);this.movementY=this.movementX=0}MouseEvent.prototype=new Event;MouseEvent.CLICK="click";MouseEvent.MOUSE_DOWN="mouseDown";MouseEvent.MOUSE_UP="mouseUp";MouseEvent.MIDDLE_CLICK="middleClick";MouseEvent.MIDDLE_MOUSE_DOWN="middleMouseDown";MouseEvent.MIDDLE_MOUSE_UP="middleMouseUp";MouseEvent.RIGHT_CLICK="rightClick";MouseEvent.RIGHT_MOUSE_DOWN="rightMouseDown";MouseEvent.RIGHT_MOUSE_UP="rightMouseUp";
MouseEvent.MOUSE_MOVE="mouseMove";MouseEvent.MOUSE_OVER="mouseOver";MouseEvent.MOUSE_OUT="mouseOut";function TouchEvent(d,a){Event.call(this,d,a);this.stageY=this.stageX=0;this.touchPointID=-1}TouchEvent.prototype=new Event;TouchEvent.prototype._setFromDom=function(d){var a=window.devicePixelRatio||1;this.stageX=d.clientX*a;this.stageY=d.clientY*a;this.touchPointID=d.identifier};TouchEvent.TOUCH_BEGIN="touchBegin";TouchEvent.TOUCH_END="touchEnd";TouchEvent.TOUCH_MOVE="touchMove";
TouchEvent.TOUCH_OUT="touchOut";TouchEvent.TOUCH_OVER="touchOver";TouchEvent.TOUCH_TAP="touchTap";function KeyboardEvent(d,a){Event.call(this,d,a);this.shiftKey=this.ctrlKey=this.altKey=!1;this.charCode=this.keyCode=0}KeyboardEvent.prototype=new Event;KeyboardEvent.prototype._setFromDom=function(d){this.altKey=d.altKey;this.ctrlKey=d.ctrlKey;this.shiftKey=d.shiftKey;this.keyCode=d.keyCode;this.charCode=d.charCode};KeyboardEvent.KEY_DOWN="keyDown";KeyboardEvent.KEY_UP="keyUp";
var BlendMode={NORMAL:"normal",ADD:"add",SUBTRACT:"subtract",MULTIPLY:"multiply",SCREEN:"screen",ERASE:"erase",ALPHA:"alpha"};
function DisplayObject(){EventDispatcher.call(this);this.visible=!0;this.stage=this.parent=null;this.transform=new Transform;this.transform._obj=this;this.blendMode=BlendMode.NORMAL;this.z=this.y=this.x=0;this._trect=new Rectangle;this._tempP=new Point;this._torg=Point._v4.create();this._tvec4_0=Point._v4.create();this._tvec4_1=Point._v4.create();this._tempm=Point._m4.create();this._atsEv=new Event(Event.ADDED_TO_STAGE);this._rfsEv=new Event(Event.REMOVED_FROM_STAGE);this._atsEv.target=this._rfsEv.target=
this}DisplayObject.prototype=new EventDispatcher;DisplayObject.prototype.dispatchEvent=function(d){EventDispatcher.prototype.dispatchEvent.call(this,d);d.bubbles&&null!=this.parent&&this.parent.dispatchEvent(d)};DisplayObject.prototype._globalToLocal=function(d,a){var b=this._torg;Stage._main._getOrigin(b);Point._m4.multiplyVec4(this._getAIMat(),b,b);var e=this._tvec4_1;e[0]=d.x;e[1]=d.y;e[2]=0;e[3]=1;Point._m4.multiplyVec4(this._getAIMat(),e,e);this._lineIsc(b,e,a)};
DisplayObject.prototype.globalToLocal=function(d){var a=new Point;this._globalToLocal(d,a);return a};DisplayObject.prototype.localToGlobal=function(d){var a=this._torg;Stage._main._getOrigin(a);var b=this._tvec4_1;b[0]=d.x;b[1]=d.y;b[2]=0;b[3]=1;Point._m4.multiplyVec4(this._getATMat(),b,b);d=new Point;this._lineIsc(a,b,d);return d};DisplayObject.prototype._lineIsc=function(d,a,b){var e=a[0]-d[0],c=a[1]-d[1],f=a[2]-d[2];a=Math.sqrt(e*e+c*c+f*f);f=-d[2]/(f/a);b.x=d[0]+e/a*f;b.y=d[1]+c/a*f};
DisplayObject.prototype._transfRect=function(d,a,b,e){var c=this._tvec4_0,f=this._tvec4_1,h=new Point,k=Infinity,g=Infinity,q=-Infinity,l=-Infinity;c[0]=b.x;c[1]=b.y;c[2]=0;c[3]=1;Point._m4.multiplyVec4(d,c,f);this._lineIsc(a,f,h);k=Math.min(k,h.x);g=Math.min(g,h.y);q=Math.max(q,h.x);l=Math.max(l,h.y);c[0]=b.x+b.width;c[1]=b.y;c[2]=0;c[3]=1;Point._m4.multiplyVec4(d,c,f);this._lineIsc(a,f,h);k=Math.min(k,h.x);g=Math.min(g,h.y);q=Math.max(q,h.x);l=Math.max(l,h.y);c[0]=b.x;c[1]=b.y+b.height;c[2]=0;c[3]=
1;Point._m4.multiplyVec4(d,c,f);this._lineIsc(a,f,h);k=Math.min(k,h.x);g=Math.min(g,h.y);q=Math.max(q,h.x);l=Math.max(l,h.y);c[0]=b.x+b.width;c[1]=b.y+b.height;c[2]=0;c[3]=1;Point._m4.multiplyVec4(d,c,f);this._lineIsc(a,f,h);k=Math.min(k,h.x);g=Math.min(g,h.y);q=Math.max(q,h.x);l=Math.max(l,h.y);e.x=k;e.y=g;e.width=q-k;e.height=l-g};DisplayObject.prototype._getLocRect=function(){};
DisplayObject.prototype._getRect=function(d,a,b){Point._m4.multiply(d,this._getATMat(),this._tempm);this._transfRect(this._tempm,a,this._getLocRect(),this._trect);return this._trect};DisplayObject.prototype._getR=function(d,a){Stage._main._getOrigin(this._torg);Point._m4.multiplyVec4(d._getAIMat(),this._torg,this._torg);return this._getRect(d._getAIMat(),this._torg,a)};
DisplayObject.prototype._getParR=function(d,a){null==DisplayObject._tdo&&(DisplayObject._tdo=new DisplayObject);var b=null==this.parent;b&&(this.parent=DisplayObject._tdo);var e=this._getR(this.parent,a);b&&(this.parent=null);return e};DisplayObject.prototype.getRect=function(d){return this._getR(d,!1).clone()};DisplayObject.prototype.getBounds=function(d){return this._getR(d,!0).clone()};
DisplayObject.prototype._htpLocal=function(d,a){var b=this._tempP;this._lineIsc(d,a,b);return this._getLocRect().contains(b.x,b.y)};DisplayObject.prototype.hitTestPoint=function(d,a,b){null==b&&(b=!1);var e=this._torg;Stage._main._getOrigin(e);Point._m4.multiplyVec4(this._getAIMat(),e,e);var c=this._tvec4_1;c[0]=d;c[1]=a;c[2]=0;c[3]=1;Point._m4.multiplyVec4(this._getAIMat(),c,c);return b?this._htpLocal(e,c):this._getR(Stage._main,!1).contains(d,a)};
DisplayObject.prototype.hitTestObject=function(d){var a=this._getR(Stage._main,!1);d=d._getR(Stage._main,!1);return a.intersects(d)};DisplayObject.prototype._loseFocus=function(){};DisplayObject.prototype._getTarget=function(d,a){return null};DisplayObject.prototype._setStage=function(d){var a=this.stage;this.stage=d;null==a&&null!=d&&this.dispatchEvent(this._atsEv);null!=a&&null==d&&this.dispatchEvent(this._rfsEv)};
DisplayObject.prototype._preRender=function(d){var a=this.transform._getTMat();d._mstack.push(a);d._cmstack.push(this.transform._cmat,this.transform._cvec,this.transform._cID,this.blendMode)};DisplayObject.prototype._render=function(d){};DisplayObject.prototype._renderAll=function(d){this.visible&&(this._preRender(d),this._render(d),d._mstack.pop(),d._cmstack.pop())};
DisplayObject.prototype._getATMat=function(){if(null==this.parent)return this.transform._getTMat();Point._m4.multiply(this.parent._getATMat(),this.transform._getTMat(),this.transform._atmat);return this.transform._atmat};DisplayObject.prototype._getAIMat=function(){if(null==this.parent)return this.transform._getIMat();Point._m4.multiply(this.transform._getIMat(),this.parent._getAIMat(),this.transform._aimat);return this.transform._aimat};
DisplayObject.prototype._getMouse=function(){var d=this._tempP;d.setTo(Stage._mouseX,Stage._mouseY);this._globalToLocal(d,d);return d};this.dp=DisplayObject.prototype;dp.ds=dp.__defineSetter__;dp.dg=dp.__defineGetter__;dp.ds("scaleX",function(d){this.transform._checkVals();this.transform._scaleX=d;this.transform._mdirty=!0});dp.ds("scaleY",function(d){this.transform._checkVals();this.transform._scaleY=d;this.transform._mdirty=!0});
dp.ds("scaleZ",function(d){this.transform._checkVals();this.transform._scaleZ=d;this.transform._mdirty=!0});dp.dg("scaleX",function(){this.transform._checkVals();return this.transform._scaleX});dp.dg("scaleY",function(){this.transform._checkVals();return this.transform._scaleY});dp.dg("scaleZ",function(){this.transform._checkVals();return this.transform._scaleZ});dp.ds("rotationX",function(d){this.transform._checkVals();this.transform._rotationX=d;this.transform._mdirty=!0});
dp.ds("rotationY",function(d){this.transform._checkVals();this.transform._rotationY=d;this.transform._mdirty=!0});dp.ds("rotationZ",function(d){this.transform._checkVals();this.transform._rotationZ=d;this.transform._mdirty=!0});dp.ds("rotation",function(d){this.transform._checkVals();this.transform._rotationZ=d;this.transform._mdirty=!0});dp.dg("rotationX",function(){this.transform._checkVals();return this.transform._rotationX});dp.dg("rotationY",function(){this.transform._checkVals();return this.transform._rotationY});
dp.dg("rotationZ",function(){this.transform._checkVals();return this.transform._rotationZ});dp.dg("rotation",function(){this.transform._checkVals();return this.transform._rotationZ});dp.ds("width",function(d){this.transform._postScale(d/this.width,1)});dp.ds("height",function(d){this.transform._postScale(1,d/this.height)});dp.dg("width",function(){this.transform._checkVals();return this._getParR(this,!0).width});dp.dg("height",function(){this.transform._checkVals();return this._getParR(this,!0).height});
dp.ds("alpha",function(d){this.transform._cmat[15]=d;this.transform._checkColorID()});dp.dg("alpha",function(){return this.transform._cmat[15]});dp.dg("mouseX",function(){return this._getMouse().x});dp.dg("mouseY",function(){return this._getMouse().y});delete dp.ds;delete dp.dg;delete this.dp;function InteractiveObject(){DisplayObject.call(this);this.buttonMode=!1;this.mouseChildren=this.mouseEnabled=!0}InteractiveObject.prototype=new DisplayObject;
InteractiveObject.prototype._getTarget=function(d,a){if(!this.visible||!this.mouseEnabled)return null;var b=this._getLocRect();if(null==b)return null;var e=this._tvec4_0,c=this._tvec4_1;Point._m4.multiplyVec4(this.transform._getIMat(),d,e);Point._m4.multiplyVec4(this.transform._getIMat(),a,c);var f=this._tempP;this._lineIsc(e,c,f);return b.contains(f.x,f.y)?this:null};function DisplayObjectContainer(){InteractiveObject.call(this);this._tempR=new Rectangle;this.numChildren=0;this._children=[]}
DisplayObjectContainer.prototype=new InteractiveObject;DisplayObjectContainer.prototype._getRect=function(d,a,b){var e=this._trect;e.setEmpty();for(var c=0;c<this.numChildren;c++){var f=this._children[c];f.visible&&e._unionWith(f._getRect(d,a,b))}return e};
DisplayObjectContainer.prototype._htpLocal=function(d,a){for(var b=this._children.length,e=0;e<b;e++){var c=this._children[e];if(c.visible){var b=c._tvec4_0,e=c._tvec4_1,f=c.transform._getIMat();Point._m4.multiplyVec4(f,d,b);Point._m4.multiplyVec4(f,a,e);return c._htpLocal(b,e)}}return!1};DisplayObjectContainer.prototype.addChild=function(d){this._children.push(d);d.parent=this;d._setStage(this.stage);++this.numChildren};
DisplayObjectContainer.prototype.removeChild=function(d){var a=this._children.indexOf(d);0>a||(this._children.splice(a,1),d.parent=null,d._setStage(null),--this.numChildren)};DisplayObjectContainer.prototype.removeChildAt=function(d){this.removeChild(this._children[d])};DisplayObjectContainer.prototype.contains=function(d){return 0<=this._children.indexOf(d)};DisplayObjectContainer.prototype.getChildIndex=function(d){return this._children.indexOf(d)};
DisplayObjectContainer.prototype.setChildIndex=function(d,a){var b=this._children.indexOf(d);if(a>b){for(b+=1;b<=a;b++)this._children[b-1]=this._children[b];this._children[a]=d}else if(a<b){for(--b;b>=a;b--)this._children[b+1]=this._children[b];this._children[a]=d}};DisplayObjectContainer.prototype.getChildAt=function(d){return this._children[d]};DisplayObjectContainer.prototype._render=function(d){for(var a=0;a<this.numChildren;a++)this._children[a]._renderAll(d)};
DisplayObjectContainer.prototype._getTarget=function(d,a){if(!this.visible||!this.mouseChildren&&!this.mouseEnabled)return null;var b=this._tvec4_0,e=this._tvec4_1,c=this.transform._getIMat();Point._m4.multiplyVec4(c,d,b);Point._m4.multiplyVec4(c,a,e);for(var c=null,f=this.numChildren-1;-1<f;f--){var h=this._children[f]._getTarget(b,e);if(null!=h){c=h;break}}return this.mouseChildren||null==c?c:this};
DisplayObjectContainer.prototype._setStage=function(d){InteractiveObject.prototype._setStage.call(this,d);for(var a=0;a<this.numChildren;a++)this._children[a]._setStage(d)};
function BitmapData(d){this.height=this.width=0;this.rect=new Rectangle;this.loader=new EventDispatcher;this.loader.bitmapData=this;this._rheight=this._rwidth=0;this._vBuffer=this._tcBuffer=this._texture=this._rrect=null;this._loaded=!1;this._dirty=!0;this._gpuAllocated=!1;this._ubuffer=this._buffer=null;if(null!=d){var a=document.createElement("img");a.onload=function(b){this._initFromImg(a,a.width,a.height);b=new Event(Event.COMPLETE);this.loader.dispatchEvent(b)}.bind(this);a.src=d}}
BitmapData.empty=function(d,a,b){null==b&&(b=4294967295);var e=new BitmapData(null);e._initFromImg(null,d,a,b);return e};BitmapData.prototype.setPixel=function(d,a,b){d=a*this.width+d;a=this._ubuffer;a[d]=(a[d]&4278190080)+b;this._dirty=!0};BitmapData.prototype.setPixel32=function(d,a,b){this._ubuffer[a*this.width+d]=b;this._dirty=!0};BitmapData.prototype.setPixels=function(d,a){this._copyRectBuff(a,d,this._buffer,this.rect);this._dirty=!0};
BitmapData.prototype.getPixel=function(d,a){return this._ubuffer[a*this.width+d]&16777215};BitmapData.prototype.getPixel32=function(d,a){return this._ubuffer[a*this.width+d]};BitmapData.prototype.getPixels=function(d,a){a||(a=new Uint8Array(d.width*d.height*4));this._copyRectBuff(this._buffer,this.rect,a,d);return a};
BitmapData.prototype.draw=function(d){this._dirty&&this._syncWithGPU();this._setTexAsFB();d._render(Stage._main);Stage._main._setFramebuffer(null,Stage._main.stageWidth,Stage._main.stageHeight,!1);Stage._setTEX(this._texture);gl.generateMipmap(gl.TEXTURE_2D);d=this._buffer;var a=this.rect;this._setTexAsFB();gl.readPixels(a.x,a.y,a.width,a.height,gl.RGBA,gl.UNSIGNED_BYTE,d);Stage._main._setFramebuffer(null,Stage._main.stageWidth,Stage._main.stageHeight,!1)};
BitmapData.prototype._syncWithGPU=function(){var d=this.rect,a=this._buffer;if(!this._gpuAllocated){var b=d.width,e=d.height,c=b/this._rwidth,f=e/this._rheight;this._texture=gl.createTexture();this._tcBuffer=gl.createBuffer();this._vBuffer=gl.createBuffer();Stage._setBF(this._tcBuffer);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([0,0,c,0,0,f,c,f]),gl.STATIC_DRAW);Stage._setBF(this._vBuffer);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([0,0,0,b,0,0,0,e,0,b,e,0]),gl.STATIC_DRAW);b=new Uint8Array(this._rwidth*
this._rheight*4);e=new Uint32Array(b.buffer);for(c=0;c<e.length;c++)e[c]=16777215;Stage._setTEX(this._texture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,this._rwidth,this._rheight,0,gl.RGBA,gl.UNSIGNED_BYTE,b);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_LINEAR);this._gpuAllocated=!0}Stage._setTEX(this._texture);gl.texSubImage2D(gl.TEXTURE_2D,0,d.x,d.y,d.width,d.height,gl.RGBA,gl.UNSIGNED_BYTE,a);gl.generateMipmap(gl.TEXTURE_2D);
this._dirty=!1};BitmapData.prototype._setTexAsFB=function(){if(null==BitmapData._fbo){BitmapData._fbo=gl.createFramebuffer();var d=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,d);gl.bindFramebuffer(gl.FRAMEBUFFER,BitmapData._fbo);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,d)}Stage._main._setFramebuffer(BitmapData._fbo,this._rwidth,this._rheight,!0);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this._texture,0)};
BitmapData.prototype._initFromImg=function(d,a,b,e){this._loaded=!0;this.width=a;this.height=b;this.rect=new Rectangle(0,0,a,b);this._rwidth=BitmapData._nhpot(a);this._rheight=BitmapData._nhpot(b);this._rrect=new Rectangle(0,0,this._rwidth,this._rheight);var c=BitmapData._canv;c.width=a;c.height=b;c=BitmapData._ctx;null!=d&&c.drawImage(d,0,0);a=c.getImageData(0,0,a,b);this._buffer=window.CanvasPixelArray&&a.data instanceof CanvasPixelArray?new Uint8Array(a.data):new Uint8Array(a.data.buffer);this._ubuffer=
new Uint32Array(this._buffer.buffer);if(null==d)for(d=0,a=this._ubuffer;d<a.length;d++)a[d]=e};BitmapData.prototype._copyRectBuff=function(d,a,b,e){d=new Uint32Array(d.buffer);b=new Uint32Array(b.buffer);for(var c=a.intersection(e),f=Math.max(0,c.x-a.x),h=Math.max(0,c.x-e.x),k=Math.max(0,c.y-a.y),g=Math.max(0,c.y-e.y),q=c.width,c=c.height,l=0;l<c;l++)for(var v=(k+l)*a.width+f,r=(g+l)*e.width+h,m=0;m<q;m++)b[r++]=d[v++]};BitmapData._canv=document.createElement("canvas");BitmapData._ctx=BitmapData._canv.getContext("2d");
BitmapData._ipot=function(d){return 0==(d&d-1)};BitmapData._nhpot=function(d){--d;for(var a=1;32>a;a<<=1)d|=d>>a;return d+1};function Bitmap(d){DisplayObject.call(this);this.bitmapData=d}Bitmap.prototype=new InteractiveObject;Bitmap.prototype._getLocRect=function(){return this.bitmapData.rect};
Bitmap.prototype._render=function(d){var a=this.bitmapData;a._loaded&&(a._dirty&&a._syncWithGPU(),gl.uniformMatrix4fv(d._sprg.tMatUniform,!1,d._mstack.top()),d._cmstack.update(),Stage._setVC(a._vBuffer),Stage._setTC(a._tcBuffer),Stage._setUT(1),Stage._setTEX(a._texture),Stage._setEBF(d._unitIBuffer),gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0))};var gl;
function Stage(d,a){a=a||null;DisplayObjectContainer.call(this);document.body.setAttribute("style","margin:0; overflow:hidden");var b=document.createElement("meta");b.setAttribute("name","viewport");b.setAttribute("content","width=device-width, minimum-scale=1.0, maximum-scale=1.0, initial-scale=1.0");document.getElementsByTagName("head")[0].appendChild(b);this.stage=this;this.stageHeight=this.stageWidth=0;this.focus=null;this._focii=[null,null,null];this._mousefocus=null;this._knM=!1;this._mstack=
new Stage._MStack;this._cmstack=new Stage._CMStack;this._sprg=null;this._svec4_0=Point._v4.create();this._svec4_1=Point._v4.create();this._pmat=Point._m4.create([1,0,0,0,0,1,0,0,0,0,1,1,0,0,0,1]);this._umat=Point._m4.create([2,0,0,0,0,-2,0,0,0,0,2,0,-1,1,0,1]);this._smat=Point._m4.create([0,0,0,0,0,0,0,0,0,0,.001,0,0,0,0,1]);this._mcEvs=[new MouseEvent(MouseEvent.CLICK,!0),new MouseEvent(MouseEvent.MIDDLE_CLICK,!0),new MouseEvent(MouseEvent.RIGHT_CLICK,!0)];this._mdEvs=[new MouseEvent(MouseEvent.MOUSE_DOWN,
!0),new MouseEvent(MouseEvent.MIDDLE_MOUSE_DOWN,!0),new MouseEvent(MouseEvent.RIGHT_MOUSE_DOWN,!0)];this._muEvs=[new MouseEvent(MouseEvent.MOUSE_UP,!0),new MouseEvent(MouseEvent.MIDDLE_MOUSE_UP,!0),new MouseEvent(MouseEvent.RIGHT_MOUSE_UP,!0)];this._smd=[!1,!1,!1];this._smu=[!1,!1,!1];this._srs=this._smm=!1;this._touches=[];for(b=0;30>b;b++)this._touches.push({touch:null,target:null,act:0});this._canvas=this.canvas=document.getElementById(d);Stage._main=this;var e={alpha:!0,antialias:!0,depth:!0,
premultipliedAlpha:!0},b=this.canvas;(gl=b.getContext("webgl",e))||(gl=b.getContext("experimental-webgl",e));gl||alert("Could not initialize WebGL. Try to update your browser or graphic drivers.");gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);e=document;e.addEventListener("contextmenu",Stage._ctxt,!1);e.addEventListener("dragstart",Stage._blck,!1);b.addEventListener("touchstart",Stage._onTD,!1);b.addEventListener("touchmove",Stage._onTM,!1);b.addEventListener("touchend",Stage._onTU,!1);e.addEventListener("touchstart",
Stage._blck,!1);b.addEventListener("touchmove",Stage._blck,!1);b.addEventListener("touchend",Stage._blck,!1);b.addEventListener("mousedown",Stage._onMD,!1);b.addEventListener("mousemove",Stage._onMM,!1);b.addEventListener("mouseup",Stage._onMU,!1);b.addEventListener("mousemove",Stage._blck,!1);b.addEventListener("mouseup",Stage._blck,!1);e.addEventListener("keydown",Stage._onKD,!1);e.addEventListener("keyup",Stage._onKU,!1);e.addEventListener("keydown",Stage._blck,!1);e.addEventListener("keyup",Stage._blck,
!1);window.addEventListener("resize",Stage._onRS,!1);this._initShaders();this._initBuffers();gl.clearColor(0,0,0,0);gl.enable(gl.BLEND);gl.blendEquation(gl.FUNC_ADD);gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA);gl.enable(gl.DEPTH_TEST);gl.depthFunc(gl.LEQUAL);this._resize(a);this._srs=!0;_requestAF(Stage._tick)}Stage.prototype=new DisplayObjectContainer;Stage.prototype._getOrigin=function(d){d[0]=this.stageWidth/2;d[1]=this.stageHeight/2;d[2]=-500;d[3]=1};Stage._mouseX=0;Stage._mouseY=0;
Stage._curBF=-1;Stage._curEBF=-1;Stage._curVC=-1;Stage._curTC=-1;Stage._curUT=-1;Stage._curTEX=-1;Stage._curBMD="normal";Stage._setBF=function(d){Stage._curBF!=d&&(gl.bindBuffer(gl.ARRAY_BUFFER,d),Stage._curBF=d)};Stage._setEBF=function(d){Stage._curEBF!=d&&(gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,d),Stage._curEBF=d)};Stage._setVC=function(d){Stage._curVC!=d&&(gl.bindBuffer(gl.ARRAY_BUFFER,d),gl.vertexAttribPointer(Stage._main._sprg.vpa,3,gl.FLOAT,!1,0,0),Stage._curVC=Stage._curBF=d)};
Stage._setTC=function(d){Stage._curTC!=d&&(gl.bindBuffer(gl.ARRAY_BUFFER,d),gl.vertexAttribPointer(Stage._main._sprg.tca,2,gl.FLOAT,!1,0,0),Stage._curTC=Stage._curBF=d)};Stage._setUT=function(d){Stage._curUT!=d&&(gl.uniform1i(Stage._main._sprg.useTex,d),Stage._curUT=d)};Stage._setTEX=function(d){Stage._curTEX!=d&&(gl.bindTexture(gl.TEXTURE_2D,d),Stage._curTEX=d)};
Stage._setBMD=function(d){Stage._curBMD!=d&&(d==BlendMode.NORMAL?(gl.blendEquation(gl.FUNC_ADD),gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA)):d==BlendMode.MULTIPLY?(gl.blendEquation(gl.FUNC_ADD),gl.blendFunc(gl.DST_COLOR,gl.ONE_MINUS_SRC_ALPHA)):d==BlendMode.ADD?(gl.blendEquation(gl.FUNC_ADD),gl.blendFunc(gl.ONE,gl.ONE)):d==BlendMode.SUBTRACT?(gl.blendEquationSeparate(gl.FUNC_REVERSE_SUBTRACT,gl.FUNC_ADD),gl.blendFunc(gl.ONE,gl.ONE)):d==BlendMode.SCREEN?(gl.blendEquation(gl.FUNC_ADD),gl.blendFunc(gl.ONE,
gl.ONE_MINUS_SRC_COLOR)):d==BlendMode.ERASE?(gl.blendEquation(gl.FUNC_ADD),gl.blendFunc(gl.ZERO,gl.ONE_MINUS_SRC_ALPHA)):d==BlendMode.ALPHA&&(gl.blendEquation(gl.FUNC_ADD),gl.blendFunc(gl.ZERO,gl.SRC_ALPHA)),Stage._curBMD=d)};Stage._okKeys=[112,113,114,115,116,117,118,119,120,121,122,123,13,16,18,27];Stage._isTD=function(){return!!("ontouchstart"in window)};Stage._ctxt=function(d){Stage._main.hasEventListener(MouseEvent.RIGHT_CLICK)&&d.preventDefault()};
Stage._onTD=function(d){Stage._setStageMouse(d.touches.item(0));Stage._main._smd[0]=!0;Stage._main._knM=!0;for(var a=Stage._main,b=0;b<d.changedTouches.length;b++){var e=d.changedTouches.item(b),c=a._touches[e.identifier];c.touch=e;c.act=1}};Stage._onTM=function(d){Stage._setStageMouse(d.touches.item(0));Stage._main._smm=!0;Stage._main._knM=!0;for(var a=Stage._main,b=0;b<d.changedTouches.length;b++){var e=d.changedTouches.item(b),c=a._touches[e.identifier];c.touch=e;c.act=2}};
Stage._onTU=function(d){Stage._main._smu[0]=!0;Stage._main._knM=!0;for(var a=Stage._main,b=0;b<d.changedTouches.length;b++){var e=d.changedTouches.item(b),c=a._touches[e.identifier];c.touch=e;c.act=3}};Stage._onMD=function(d){Stage._setStageMouse(d);Stage._main._smd[d.button]=!0;Stage._main._knM=!0};Stage._onMM=function(d){Stage._setStageMouse(d);Stage._main._smm=!0;Stage._main._knM=!0};Stage._onMU=function(d){Stage._main._smu[d.button]=!0;Stage._main._knM=!0};
Stage._onKD=function(d){var a=Stage._main,b=new KeyboardEvent(KeyboardEvent.KEY_DOWN,!0);b._setFromDom(d);a.focus&&a.focus.stage?a.focus.dispatchEvent(b):a.dispatchEvent(b)};Stage._onKU=function(d){var a=Stage._main,b=new KeyboardEvent(KeyboardEvent.KEY_UP,!0);b._setFromDom(d);a.focus&&a.focus.stage?a.focus.dispatchEvent(b):a.dispatchEvent(b)};Stage._blck=function(d){null!=d.keyCode?"textarea"!=d.target.tagName.toLowerCase()&&-1==Stage._okKeys.indexOf(d.keyCode)&&d.preventDefault():d.preventDefault()};
Stage._onRS=function(d){Stage._main._srs=!0};Stage.prototype._resize=function(d){this.options=this.options||d||null;var a;this.options?(d=Math.round(this.options.w),a=Math.round(this.options.h)):(d=window.innerWidth,a=window.innerHeight);var b=window.devicePixelRatio||1,e=d*b,b=a*b;this._canvas.style.width=d+"px";this._canvas.style.height=a+"px";this.stageWidth=e;this.stageHeight=b;this._canvas.width=e;this._canvas.height=b;this._setFramebuffer(null,e,b,!1)};
Stage.prototype._getShader=function(d,a,b){b=b?d.createShader(d.FRAGMENT_SHADER):d.createShader(d.VERTEX_SHADER);d.shaderSource(b,a);d.compileShader(b);return d.getShaderParameter(b,d.COMPILE_STATUS)?b:(alert(d.getShaderInfoLog(b)),null)};
Stage.prototype._initShaders=function(){var d=this._getShader(gl,"\r\n\t\t\tprecision mediump float;\r\n\t\t\tvarying vec2 texCoord;\r\n\t\t\t\r\n\t\t\tuniform sampler2D uSampler;\r\n\t\t\tuniform vec4 color;\r\n\t\t\tuniform bool useTex;\r\n\t\t\t\r\n\t\t\tuniform mat4 cMat;\r\n\t\t\tuniform vec4 cVec;\r\n\t\t\t\r\n\t\t\tvoid main(void) {\r\n\t\t\t\tvec4 c;\r\n\t\t\t\tif(useTex) { c = texture2D(uSampler, texCoord);  c.xyz /= c.w; }\r\n\t\t\t\telse c = color;\r\n\t\t\t\tc = (cMat*c)+cVec;\n\r\n\t\t\t\tc.xyz *= min(c.w, 1.0);\n\r\n\t\t\t\tgl_FragColor = c;\r\n\t\t\t}",!0),
a=this._getShader(gl,"\r\n\t\t\tattribute vec3 verPos;\r\n\t\t\tattribute vec2 texPos;\r\n\t\t\t\r\n\t\t\tuniform mat4 tMat;\r\n\t\t\t\r\n\t\t\tvarying vec2 texCoord;\r\n\t\t\t\r\n\t\t\tvoid main(void) {\r\n\t\t\t\tgl_Position = tMat * vec4(verPos, 1.0);\r\n\t\t\t\ttexCoord = texPos;\r\n\t\t\t}",!1);this._sprg=gl.createProgram();gl.attachShader(this._sprg,a);gl.attachShader(this._sprg,d);gl.linkProgram(this._sprg);gl.getProgramParameter(this._sprg,gl.LINK_STATUS)||alert("Could not initialise shaders");
gl.useProgram(this._sprg);this._sprg.vpa=gl.getAttribLocation(this._sprg,"verPos");this._sprg.tca=gl.getAttribLocation(this._sprg,"texPos");gl.enableVertexAttribArray(this._sprg.tca);gl.enableVertexAttribArray(this._sprg.vpa);this._sprg.tMatUniform=gl.getUniformLocation(this._sprg,"tMat");this._sprg.cMatUniform=gl.getUniformLocation(this._sprg,"cMat");this._sprg.cVecUniform=gl.getUniformLocation(this._sprg,"cVec");this._sprg.samplerUniform=gl.getUniformLocation(this._sprg,"uSampler");this._sprg.useTex=
gl.getUniformLocation(this._sprg,"useTex");this._sprg.color=gl.getUniformLocation(this._sprg,"color")};Stage.prototype._initBuffers=function(){this._unitIBuffer=gl.createBuffer();Stage._setEBF(this._unitIBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,2,3]),gl.STATIC_DRAW)};
Stage.prototype._setFramebuffer=function(d,a,b,e){this._mstack.clear();this._mstack.push(this._pmat,0);e?(this._umat[5]=2,this._umat[13]=-1):(this._umat[5]=-2,this._umat[13]=1);this._mstack.push(this._umat);this._smat[0]=1/a;this._smat[5]=1/b;this._mstack.push(this._smat);gl.bindFramebuffer(gl.FRAMEBUFFER,d);d&&gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_COMPONENT16,a,b);gl.viewport(0,0,a,b)};
Stage._setStageMouse=function(d){var a=window.devicePixelRatio||1;Stage._mouseX=d.clientX*a;Stage._mouseY=d.clientY*a};
Stage.prototype._drawScene=function(){this._srs&&(this._resize(),this.dispatchEvent(new Event(Event.RESIZE)),this._srs=!1);gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);if(this._knM){var d=this._svec4_0;this._getOrigin(d);var a=this._svec4_1;a[0]=Stage._mouseX;a[1]=Stage._mouseY;a[2]=0;a[3]=1;var a=this._getTarget(d,a),b=this._mousefocus||this,d=a||this;if(a!=this._mousefocus){if(b!=this){var e=new MouseEvent(MouseEvent.MOUSE_OUT,!0);e.target=b;b.dispatchEvent(e)}d!=this&&(e=new MouseEvent(MouseEvent.MOUSE_OVER,
!0),e.target=d,d.dispatchEvent(e))}this._smd[0]&&this.focus&&a!=this.focus&&this.focus._loseFocus();for(var c=0;3>c;c++)this._mcEvs[c].target=this._mdEvs[c].target=this._muEvs[c].target=d,this._smd[c]&&(d.dispatchEvent(this._mdEvs[c]),this._focii[c]=this.focus=a),this._smu[c]&&(d.dispatchEvent(this._muEvs[c]),a==this._focii[c]&&d.dispatchEvent(this._mcEvs[c])),this._smd[c]=this._smu[c]=!1;this._smm&&(e=new MouseEvent(MouseEvent.MOUSE_MOVE,!0),e.target=d,d.dispatchEvent(e),this._smm=!1);this._mousefocus=
a;for(var c=!1,f=d;null!=f.parent;)c|=f.buttonMode,f=f.parent;c=c?"pointer":"default";d instanceof TextField&&d.selectable&&(c="text");this._canvas.style.cursor=c}f=window.devicePixelRatio||1;for(c=0;c<this._touches.length;c++){var h=this._touches[c];0!=h.act&&(d=this._svec4_0,this._getOrigin(d),a=this._svec4_1,a[0]=h.touch.clientX*f,a[1]=h.touch.clientY*f,a[2]=0,a[3]=1,a=this._getTarget(d,a),b=h.target||this,d=a||this,a!=h.target&&(b!=this&&(e=new TouchEvent(TouchEvent.TOUCH_OUT,!0),e._setFromDom(h.touch),
e.target=b,b.dispatchEvent(e)),d!=this&&(e=new TouchEvent(TouchEvent.TOUCH_OVER,!0),e._setFromDom(h.touch),e.target=d,d.dispatchEvent(e))),1==h.act&&(e=new TouchEvent(TouchEvent.TOUCH_BEGIN,!0)),2==h.act&&(e=new TouchEvent(TouchEvent.TOUCH_MOVE,!0)),3==h.act&&(e=new TouchEvent(TouchEvent.TOUCH_END,!0)),e._setFromDom(h.touch),e.target=d,d.dispatchEvent(e),3==h.act&&a==h.target&&(e=new TouchEvent(TouchEvent.TOUCH_TAP,!0),e._setFromDom(h.touch),e.target=d,d.dispatchEvent(e)),h.act=0,h.target=3==h.act?
null:a)}d=EventDispatcher.efbc;e=new Event(Event.ENTER_FRAME,!1);for(c=0;c<d.length;c++)e.target=d[c],d[c].dispatchEvent(e);this._renderAll(this)};Stage._tick=function(){_requestAF(Stage._tick);Stage.prototype._drawScene.call(Stage._main)};Stage._MStack=function(){this.mats=[];this.size=1;for(var d=0;30>d;d++)this.mats.push(Point._m4.create())};Stage._MStack.prototype.clear=function(){this.size=1};Stage._MStack.prototype.push=function(d){var a=this.size++;Point._m4.multiply(this.mats[a-1],d,this.mats[a])};
Stage._MStack.prototype.pop=function(){this.size--};Stage._MStack.prototype.top=function(){return this.mats[this.size-1]};Stage._CMStack=function(){this.mats=[];this.vecs=[];this.isID=[];this.bmds=[];this.lnnm=[];this.size=1;this.dirty=!0;for(var d=0;30>d;d++)this.mats.push(Point._m4.create()),this.vecs.push(new Float32Array(4)),this.isID.push(!0),this.bmds.push(BlendMode.NORMAL),this.lnnm.push(0)};
Stage._CMStack.prototype.push=function(d,a,b,e){var c=this.size++;(this.isID[c]=b)?(Point._m4.set(this.mats[c-1],this.mats[c]),Point._v4.set(this.vecs[c-1],this.vecs[c])):(Point._m4.multiply(this.mats[c-1],d,this.mats[c]),Point._m4.multiplyVec4(this.mats[c-1],a,this.vecs[c]),Point._v4.add(this.vecs[c-1],this.vecs[c],this.vecs[c]));b||(this.dirty=!0);this.bmds[c]=e;this.lnnm[c]=e==BlendMode.NORMAL?this.lnnm[c-1]:c};
Stage._CMStack.prototype.update=function(){if(this.dirty){var d=Stage._main,a=this.size-1;gl.uniformMatrix4fv(d._sprg.cMatUniform,!1,this.mats[a]);gl.uniform4fv(d._sprg.cVecUniform,this.vecs[a]);this.dirty=!1}Stage._setBMD(this.bmds[this.lnnm[this.size-1]])};Stage._CMStack.prototype.pop=function(){this.isID[this.size-1]||(this.dirty=!0);this.size--};
function Graphics(){this._conf={ftype:0,fbdata:null,fcolor:null,lwidth:0,lcolor:null};this._points=[0,0];this._fills=[];this._afills=[];this._lfill=null;this._rect=new Rectangle(0,0,0,0);this._srect=new Rectangle(0,0,0,0);this._startNewFill()}Graphics._delTgs={};Graphics._delNum=0;Graphics.prototype._startNewFill=function(){this._endLine();var d=new Graphics.Fill(this._points.length/2-1,this._conf);this._fills.push(d);this._afills.push(d);this._lfill=d};
Graphics.prototype._startLine=function(){var d=this._points.length/2,a=this._fills[this._fills.length-1],b=a.lines.length;0<b&&a.lines[b-1].isEmpty()?a.lines[b-1].Set(d-1,this._conf):a.lines.push(new Graphics.Line(d-1,this._conf))};Graphics.prototype._endLine=function(){if(0!=this._fills.length){var d=this._points.length/2,a=this._fills[this._fills.length-1];0!=a.lines.length&&(a.lines[a.lines.length-1].end=d-1)}};
Graphics.prototype._render=function(d){this._endLine();gl.uniformMatrix4fv(d._sprg.tMatUniform,!1,d._mstack.top());d._cmstack.update();for(var a=0;a<this._afills.length;a++)this._afills[a].render(d,this._points,this._rect)};Graphics.prototype.lineStyle=function(d,a,b){a||(a=0);b||(b=1);this._conf.lwidth=d;this._conf.lcolor=Graphics.makeColor(a,b);this._endLine();this._startLine()};
Graphics.prototype.beginFill=function(d,a){null==a&&(a=1);this._conf.ftype=1;this._conf.fcolor=Graphics.makeColor(d,a);this._startNewFill()};Graphics.prototype.beginBitmapFill=function(d){this._conf.ftype=2;this._conf.fbdata=d;this._startNewFill()};Graphics.prototype.endFill=function(){this._conf.ftype=0;this._startNewFill()};Graphics.prototype.moveTo=function(d,a){this._endLine();this._points.push(d,a);this._startLine()};
Graphics.prototype.lineTo=function(d,a){var b=this._points;if(d!=b[b.length-2]||a!=b[b.length-1])0<b.length&&0<this._conf.ftype&&this._rect._unionWL(b[b.length-2],b[b.length-1],d,a),0<this._conf.lwidth&&this._srect._unionWL(b[b.length-2],b[b.length-1],d,a),b.push(d,a)};Graphics.prototype.curveTo=function(d,a,b,e){var c=this._points,f=c[c.length-2],c=c[c.length-1],h=2/3;this.cubicCurveTo(f+h*(d-f),c+h*(a-c),b+h*(d-b),e+h*(a-e),b,e)};
Graphics.prototype.cubicCurveTo=function(d,a,b,e,c,f,h){h||(h=40);for(var k=this._points,g=k[k.length-2],k=k[k.length-1],q=d-g,l=a-k,v=b-d,r=e-a,m=c-b,p=f-e,A=1/h,x=1;x<h;x++){var u=x*A,t=g+u*q,w=k+u*l,z=d+u*v,y=a+u*r,t=t+u*(z-t),w=w+u*(y-w);this.lineTo(t+u*(z+u*(b+u*m-z)-t),w+u*(y+u*(e+u*p-y)-w))}this.lineTo(c,f)};Graphics.prototype.drawCircle=function(d,a,b){this.drawEllipse(d,a,2*b,2*b)};
Graphics.prototype.drawEllipse=function(d,a,b,e){b/=2;e/=2;this.moveTo(d,a-e);this.cubicCurveTo(d+.553*b,a-e,d+b,a-.553*e,d+b,a,16);this.cubicCurveTo(d+b,a+.553*e,d+.553*b,a+e,d,a+e,16);this.cubicCurveTo(d-.553*b,a+e,d-b,a+.553*e,d-b,a,16);this.cubicCurveTo(d-b,a-.553*e,d-.553*b,a-e,d,a-e,16)};Graphics.prototype.drawRect=function(d,a,b,e){this.moveTo(d,a);this.lineTo(d+b,a);this.lineTo(d+b,a+e);this.lineTo(d,a+e);this.lineTo(d,a)};
Graphics.prototype.drawRoundRect=function(d,a,b,e,c,f){c/=2;f/=2;var h=d+c,k=d+b-c,g=a+f,q=a+e-f;this.moveTo(h,a);this.lineTo(k,a);this.cubicCurveTo(k+.553*c,a,d+b,g-.553*f,d+b,g,16);this.lineTo(d+b,q);this.cubicCurveTo(d+b,q+.553*f,k+.553*c,a+e,k,a+e,16);this.lineTo(h,a+e);this.cubicCurveTo(h-.553*c,a+e,d,q+.553*f,d,q,16);this.lineTo(d,g);this.cubicCurveTo(d,g-.553*f,h-.553*c,a,h,a,16)};
Graphics.prototype.drawTriangles=function(d,a,b){Graphics.Fill.updateRect(d,this._rect);for(var e=[],c=0;c<d.length;c+=2)e.push(d[c],d[c+1],0);d=Graphics._makeTgs(e,a,b,this._conf.fcolor,this._conf.fbdata);this._afills.push(d);this._lfill=d};Graphics.prototype.drawTriangles3D=function(d,a,b){d=Graphics._makeTgs(d,a,b,this._conf.fcolor,this._conf.fbdata);this._afills.push(d);this._lfill=d};
Graphics.prototype.clear=function(){this._conf.ftype=0;this._conf.bdata=null;this._conf.fcolor=null;this._conf.lwidth=0;this._points=[0,0];this._fills=[];for(var d=0;d<this._afills.length;d++){var a=this._afills[d];if(a instanceof Graphics.Fill){a.tgs&&Graphics._freeTgs(a.tgs);for(var b=0;b<a.lineTGS.length;b++)Graphics._freeTgs(a.lineTGS[b])}else Graphics._freeTgs(a)}this._afills=[];this._lfill=null;this._rect.setEmpty();this._startNewFill()};
Graphics.prototype._getLocRect=function(d){return 0==d?this._rect:this._rect.union(this._srect)};Graphics.prototype._hits=function(d,a){return this._rect.contains(d,a)};Graphics.makeColor=function(d,a){var b=new Float32Array(4);b[0]=.0039215686*(d>>16&255);b[1]=.0039215686*(d>>8&255);b[2]=.0039215686*(d&255);b[3]=a;return b};Graphics.equalColor=function(d,a){return d[0]==a[0]&&d[1]==a[1]&&d[2]==a[2]&&d[3]==a[3]};Graphics.len=function(d,a){return Math.sqrt(d*d+a*a)};
Graphics.Fill=function(d,a){this.type=a.ftype;this.color=a.fcolor;this.bdata=a.fbdata;this.lines=[new Graphics.Line(d,a)];this.lineTGS=[];this.dirty=!0;this.tgs=null};
Graphics.Fill.prototype.Build=function(d,a){for(var b=[],e=[],c=[],f=null,h=-1,k=null,g=0;g<this.lines.length;g++){var q=this.lines[g];if(q.begin!=q.end){var l=2*q.begin,v=2*q.end,r=d[l]==d[v]&&d[l+1]==d[v+1];r&&(v-=2);0<q.width&&(null!=f&&q.width==h&&Graphics.equalColor(k,q.color)||(f={vrt:[],ind:[],color:q.color},c.push(f),h=q.width,k=q.color),Graphics.Line.GetTriangles(d,l,v,q,0!=this.type||r,f.ind,f.vrt));if(0!=this.type&&2<v-l){q=d.slice(2*q.begin,2*q.end+2);r&&(q.pop(),q.pop());0>Graphics.PolyK.GetArea(q)&&
(q=Graphics.PolyK.Reverse(q));r=b.length/3;l=Graphics.PolyK.Triangulate(q);for(v=0;v<l.length;v++)e.push(l[v]+r);for(v=0;v<q.length/2;v++)b.push(q[2*v],q[2*v+1],0)}}}for(v=0;v<c.length;v++)this.lineTGS.push(Graphics._makeTgs(c[v].vrt,c[v].ind,null,c[v].color));0<b.length&&(this.tgs=Graphics._makeTgs(b,e,null,this.color,this.bdata))};Graphics.Fill.prototype.isEmpty=function(){return 0==this.lines.length?!0:this.lines[0].isEmpty()};
Graphics.Fill.prototype.render=function(d,a,b){this.dirty&&(this.Build(a,b),this.dirty=!1);this.tgs&&this.tgs.render(d);for(a=0;a<this.lineTGS.length;a++)this.lineTGS[a].render(d)};Graphics.Fill.updateRect=function(d,a){var b=Infinity,e=Infinity,c=-Infinity,f=-Infinity;a.isEmpty()||(b=a.x,e=a.y,c=a.x+a.width,f=a.y+a.height);for(var h=0;h<d.length;h+=2)b=Math.min(b,d[h]),e=Math.min(e,d[h+1]),c=Math.max(c,d[h]),f=Math.max(f,d[h+1]);a.x=b;a.y=e;a.width=c-b;a.height=f-e};
Graphics.Line=function(d,a){this.begin=d;this.end=-1;this.width=a.lwidth;this.color=a.lcolor};Graphics.Line.prototype.Set=function(d,a){this.begin=d;this.end=-1;this.width=a.lwidth;this.color=a.lcolor};Graphics.Line.prototype.isEmpty=function(){return this.begin==this.end};
Graphics.Line.GetTriangles=function(d,a,b,e,c,f,h){var k=h.length/3,g=b-a-2;c?Graphics.Line.AddJoint(d,b,a,a+2,e.width,h):Graphics.Line.AddEnd(d,a,a+2,!0,e.width,h);for(b=0;b<g;b+=2)Graphics.Line.AddJoint(d,a+b,a+b+2,a+b+4,e.width,h),f.push(k+b+0,k+b+1,k+b+2,k+b+1,k+b+2,k+b+3);c?(Graphics.Line.AddJoint(d,a+g,a+g+2,a,e.width,h),f.push(k+g+0,k+g+1,k+g+2,k+g+1,k+g+2,k+g+3),f.push(k+g+2,k+g+3,k+0,k+g+3,k+0,k+1)):(Graphics.Line.AddEnd(d,a+g,a+g+2,!1,e.width,h),f.push(k+0+g,k+1+g,k+2+g,k+1+g,k+2+g,k+3+
g))};Graphics.Line.AddEnd=function(d,a,b,e,c,f){var h=d[a];a=d[a+1];var k=d[b];d=d[b+1];c=.5*c/Graphics.len(h-k,a-d);b=c*(a-d);dy=-c*(h-k);e?f.push(h+b,a+dy,0,h-b,a-dy,0):f.push(k+b,d+dy,0,k-b,d-dy,0)};
Graphics.Line.AddJoint=function(d,a,b,e,c,f){var h=new Point,k=new Point,g=new Point,q=new Point,l=new Point,v=d[a];a=d[a+1];var r=d[b];b=d[b+1];var m=d[e];d=d[e+1];var p=.5*c/Graphics.len(v-r,a-b);e=.5*c/Graphics.len(r-m,b-d);c=p*(a-b);var p=-p*(v-r),A=e*(b-d);e=-e*(r-m);1E-7>Math.abs(c-A)+Math.abs(p-e)?(f.push(r+c,b+p,0),f.push(r-c,b-p,0)):(h.setTo(v+c,a+p),k.setTo(r+c,b+p),g.setTo(r+A,b+e),q.setTo(m+A,d+e),Graphics.PolyK._GetLineIntersection(h,k,g,q,l),f.push(l.x,l.y,0),h.setTo(v-c,a-p),k.setTo(r-
c,b-p),g.setTo(r-A,b-e),q.setTo(m-A,d-e),Graphics.PolyK._GetLineIntersection(h,k,g,q,l),f.push(l.x,l.y,0))};Graphics._makeTgs=function(d,a,b,e,c){var f=Graphics._delTgs["t_"+d.length+"_"+a.length];if(null==f||0==f.length)return new Graphics.Tgs(d,a,b,e,c);f=f.pop();Graphics._delNum--;f.Set(d,a,b,e,c);return f};Graphics._freeTgs=function(d){var a=Graphics._delTgs[d.name];null==a&&(a=[]);a.push(d);Graphics._delNum++;Graphics._delTgs[d.name]=a};
Graphics.Tgs=function(d,a,b,e,c){this.color=e;this.bdata=c;this.name="t_"+d.length+"_"+a.length;this.useTex=null!=c;this.dirtyUVT=!0;this.emptyUVT=null==b;(this.useIndex=65536>=d.length/3)?(this.ind=new Uint16Array(a),this.vrt=new Float32Array(d),this.uvt=b?new Float32Array(b):new Float32Array(2*d.length/3),this.ibuf=gl.createBuffer(),Stage._setEBF(this.ibuf),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this.ind,gl.STATIC_DRAW)):(this.vrt=new Float32Array(3*a.length),Graphics.Tgs.unwrapF32(a,d,3,this.vrt),
this.uvt=new Float32Array(2*a.length),b&&Graphics.Tgs.unwrapF32(a,b,2,this.uvt));this.vbuf=gl.createBuffer();Stage._setBF(this.vbuf);gl.bufferData(gl.ARRAY_BUFFER,this.vrt,gl.STATIC_DRAW);this.tbuf=gl.createBuffer();Stage._setBF(this.tbuf);gl.bufferData(gl.ARRAY_BUFFER,this.uvt,gl.STATIC_DRAW)};
Graphics.Tgs.prototype.Set=function(d,a,b,e,c){this.color=e;this.bdata=c;this.useTex=null!=c;this.dirtyUVT=!0;this.emptyUVT=null==b;if(this.useIndex){e=a.length;c=d.length;for(var f=0;f<e;f++)this.ind[f]=a[f];for(f=0;f<c;f++)this.vrt[f]=d[f];if(b)for(f=0;f<b.length;f++)this.uvt[f]=b[f];Stage._setEBF(this.ibuf);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this.ind,gl.STATIC_DRAW)}else Graphics.Tgs.unwrapF32(a,d,3,this.vrt),b&&Graphics.Tgs.unwrapF32(a,b,2,this.uvt);Stage._setBF(this.vbuf);gl.bufferData(gl.ARRAY_BUFFER,
this.vrt,gl.STATIC_DRAW);Stage._setBF(this.tbuf);gl.bufferData(gl.ARRAY_BUFFER,this.uvt,gl.STATIC_DRAW)};
Graphics.Tgs.prototype.render=function(d){if(this.useTex){d=this.bdata;if(0==d._loaded)return;d._dirty&&d._syncWithGPU();if(this.dirtyUVT){this.dirtyUVT=!1;if(this.emptyUVT){this.emptyUVT=!1;for(var a=1/d._rwidth,b=1/d._rheight,e=0;e<this.uvt.length;e++)this.uvt[2*e]=a*this.vrt[3*e],this.uvt[2*e+1]=b*this.vrt[3*e+1]}else if(d.width!=d._rwidth||d.height!=d._rheight)for(a=d.width/d._rwidth,b=d.height/d._rheight,e=0;e<this.uvt.length;e++)this.uvt[2*e]*=a,this.uvt[2*e+1]*=b;Stage._setBF(this.tbuf);gl.bufferSubData(gl.ARRAY_BUFFER,
0,this.uvt)}Stage._setUT(1);Stage._setTEX(d._texture)}else Stage._setUT(0),gl.uniform4fv(d._sprg.color,this.color);Stage._setTC(this.tbuf);Stage._setVC(this.vbuf);this.useIndex?(Stage._setEBF(this.ibuf),gl.drawElements(gl.TRIANGLES,this.ind.length,gl.UNSIGNED_SHORT,0)):gl.drawArrays(gl.TRIANGLES,0,this.vrt.length/3)};Graphics.Tgs.unwrapF32=function(d,a,b,e){for(var c=d.length,f=0;f<c;f++)for(var h=0;h<b;h++)e[f*b+h]=a[d[f]*b+h]};Graphics.PolyK={};
Graphics.PolyK.Triangulate=function(d){var a=d.length>>1;if(3>a)return[];var b=[];if(Graphics.PolyK.IsConvex(d)){for(var e=1;e<a-1;e++)b.push(0,e,e+1);return b}for(var c=[],e=0;e<a;e++)c.push(e);for(e=0;3<a;){var f=c[(e+0)%a],h=c[(e+1)%a],k=c[(e+2)%a],g=d[2*f],q=d[2*f+1],l=d[2*h],v=d[2*h+1],r=d[2*k],m=d[2*k+1],p=!1;if(Graphics.PolyK._convex(g,q,l,v,r,m))for(var p=!0,A=0;A<a;A++){var x=c[A];if(x!=f&&x!=h&&x!=k&&Graphics.PolyK._PointInTriangle(d[2*x],d[2*x+1],g,q,l,v,r,m)){p=!1;break}}if(p)b.push(f,
h,k),c.splice((e+1)%a,1),a--,e=0;else if(e++>3*a)break}b.push(c[0],c[1],c[2]);return b};Graphics.PolyK.IsConvex=function(d){if(6>d.length)return!0;for(var a=d.length-4,b=0;b<a;b+=2)if(!Graphics.PolyK._convex(d[b],d[b+1],d[b+2],d[b+3],d[b+4],d[b+5]))return!1;return Graphics.PolyK._convex(d[a],d[a+1],d[a+2],d[a+3],d[0],d[1])&&Graphics.PolyK._convex(d[a+2],d[a+3],d[0],d[1],d[2],d[3])?!0:!1};Graphics.PolyK._convex=function(d,a,b,e,c,f){return 0<=(a-e)*(c-b)+(b-d)*(f-e)};
Graphics.PolyK._PointInTriangle=function(d,a,b,e,c,f,h,k){h-=b;k-=e;c-=b;f-=e;d-=b;b=a-e;a=h*h+k*k;e=h*c+k*f;h=h*d+k*b;k=c*c+f*f;c=c*d+f*b;f=1/(a*k-e*e);k=(k*h-e*c)*f;h=(a*c-e*h)*f;return 0<=k&&0<=h&&1>k+h};Graphics.PolyK._GetLineIntersection=function(d,a,b,e,c){var f=d.x-a.x,h=b.x-e.x,k=d.y-a.y,g=b.y-e.y,q=f*g-k*h;if(0==q)return null;d=d.x*a.y-d.y*a.x;b=b.x*e.y-b.y*e.x;c.x=(d*h-f*b)/q;c.y=(d*g-k*b)/q};
Graphics.PolyK.GetArea=function(d){if(6>d.length)return 0;for(var a=d.length-2,b=0,e=0;e<a;e+=2)b+=(d[e+2]-d[e])*(d[e+1]+d[e+3]);b+=(d[0]-d[a])*(d[a+1]+d[1]);return.5*-b};Graphics.PolyK.Reverse=function(d){for(var a=[],b=d.length-2;0<=b;b-=2)a.push(d[b],d[b+1]);return a};function Sprite(){DisplayObjectContainer.call(this);this._trect2=new Rectangle;this.graphics=new Graphics}Sprite.prototype=new DisplayObjectContainer;
Sprite.prototype._getRect=function(d,a,b){var e=DisplayObjectContainer.prototype._getRect.call(this,d,a,b);b=this.graphics._getLocRect(b);Point._m4.multiply(d,this._getATMat(),this._tempm);this._transfRect(this._tempm,a,b,this._trect2);return e.union(this._trect2)};Sprite.prototype._render=function(d){this.graphics._render(d);DisplayObjectContainer.prototype._render.call(this,d)};
Sprite.prototype._getTarget=function(d,a){if(!this.visible||!this.mouseChildren&&!this.mouseEnabled)return null;var b=DisplayObjectContainer.prototype._getTarget.call(this,d,a);if(null!=b)return b;if(!this.mouseEnabled)return null;var b=this._tvec4_0,e=this._tvec4_1,c=this.transform._getIMat();Point._m4.multiplyVec4(c,d,b);Point._m4.multiplyVec4(c,a,e);c=this._tempP;this._lineIsc(b,e,c);return this.graphics._hits(c.x,c.y)?this:null};
Sprite.prototype._htpLocal=function(d,a){var b=this._tempP;this._lineIsc(d,a,b);return this.graphics._hits(b.x,b.y)?!0:DisplayObjectContainer.prototype._htpLocal.call(this,d,a)};var TextFormatAlign={LEFT:"left",CENTER:"center",RIGHT:"right",JUSTIFY:"justify"};
function TextFormat(d,a,b,e,c,f,h){this.font=d?d:"Times New Roman";this.size=a?a:12;this.color=b?b:0;this.bold=e?e:!1;this.italic=c?c:!1;this.align=f?f:TextFormatAlign.LEFT;this.leading=h?h:0;this.maxW=0;this.data={image:null,tw:0,th:0,rw:0,rh:0}}TextFormat.prototype.clone=function(){return new TextFormat(this.font,this.size,this.color,this.bold,this.italic,this.align,this.leading)};
TextFormat.prototype.set=function(d){this.font=d.font;this.size=d.size;this.color=d.color;this.bold=d.bold;this.italic=d.italic;this.align=d.align;this.leading=d.leading};TextFormat.prototype.setContext=function(d){var a=this.color;d.textBaseline="top";d.fillStyle=d.strokeStyle="rgb("+(a>>16&255)+","+(a>>8&255)+","+(a&255)+")";d.font=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.size+"px "+this.font};
TextFormat.prototype.getImageData=function(d,a){var b=TextFormat._canvas,e=TextFormat._ctxext,c=this.data;b.width=c.rw=this._nhpt(a._areaW);b.height=c.rh=this._nhpt(a._areaH);a._background&&(e.fillStyle="rgba(255,255,255,1)",e.fillRect(0,0,a._areaW,a._areaH));a._border&&(e.strokeStyle="rgb(0,0,0)",e.beginPath(),e.rect(.5,.5,a._areaW-1,a._areaH-1),e.stroke());this.setContext(e);var f=[];this.maxW=0;for(var h=d.split("\n"),k=0,g=0,q=1.25*this.size,l=0,v=0;v<h.length;v++)var r=this.renderPar(h[v],g,
q,e,a,l,f),k=k+r,g=g+r*(q+this.leading),l=l+(h[v].length+1);this.align==TextFormatAlign.JUSTIFY&&(this.maxW=Math.max(this.maxW,a._areaW));c.tw=this.maxW;c.th=(q+this.leading)*k-this.leading;a._metrics=f;if(a._selectable&&a._select&&a._select.from<a._select.to)if(q=a._select,k=a.getLineIndexOfChar(q.from),h=a.getLineIndexOfChar(q.to-1),g=a.getCharBoundaries(q.from),q=a.getCharBoundaries(q.to-1),e.fillStyle="rgba(0,0,0,0.25)",k==h)e.fillRect(g.x,g.y,q.x+q.width-g.x,q.y+q.height-g.y);else{e.fillRect(g.x,
g.y,f[k].x+f[k].width-g.x,f[k].y+f[k].height-g.y);for(k+=1;k<h;k++)e.fillRect(f[k].x,f[k].y,f[k].width,f[k].height);e.fillRect(f[h].x,f[h].y,q.x+q.width-f[h].x,q.y+q.height-f[h].y)}else"input"==a._type&&-1<a._curPos&&(g=a.getCharBoundaries(a._curPos),e.beginPath(),e.moveTo(Math.round(g.x)+.5,g.y),e.lineTo(Math.round(g.x)+.5,g.y+g.height),e.stroke());c.canvas=b;b=e.getImageData(0,0,c.rw,c.rh);c.ui8buff=window.CanvasPixelArray&&b.data instanceof CanvasPixelArray?new Uint8Array(b.data):new Uint8Array(b.data.buffer);
return c};
TextFormat.prototype.renderPar=function(d,a,b,e,c,f,h){var k;k=c._wordWrap?d.split(" "):[d];d=e.measureText(" ").width;var g=0;c=c._areaW;for(var q=0,l=[[]],v=[],r=0;r<k.length;r++){var m=k[r],p=e.measureText(m).width;g+p<=c||0==g?(l[q].push(m),g+=p+d):(v.push(c-g+d),l.push([]),q++,g=0,r--)}v.push(c-g+d);for(r=0;r<l.length;r++){k={x:0,y:0,width:0,height:0,charOffset:f,words:[]};k.height=1.25*this.size+this.leading;var A=l[r];this.maxW=Math.max(this.maxW,c-v[r]);var x,u=a+(b+this.leading)*r,g=0;x=
d;this.align==TextFormatAlign.CENTER&&(g=.5*v[r]);this.align==TextFormatAlign.RIGHT&&(g=v[r]);this.align==TextFormatAlign.JUSTIFY&&(x=d+v[r]/(A.length-1));k.x=g;k.y=u;for(var t=0;t<A.length;t++)m=A[t],e.fillText(m,g,u),p=e.measureText(m).width,k.words.push({x:g,y:u,width:p,height:k.height,charOffset:f,word:m}),g=r<l.length-1?g+(p+x):g+(p+d),f+=m.length+1;k.width=g-k.x;r==l.length-1&&(k.width-=d);h.push(k)}return q+1};
TextFormat.prototype._nhpt=function(d){--d;for(var a=1;32>a;a<<=1)d|=d>>a;return d+1};TextFormat._canvas=document.createElement("canvas");TextFormat._ctxext=TextFormat._canvas.getContext("2d");
function TextField(){InteractiveObject.call(this);this._tarea=document.createElement("textarea");this._tareaAdded=!1;this._tarea.setAttribute("style","font-family:Times New Roman; font-size:12px; z-index:-1; \r\n\t\t\t\t\t\t\t\t\t\t\tposition:absolute; top:0px; left:0px; opacity:0; pointer-events:none; user-select:none; width:100px; height:100px;");this._tarea.addEventListener("input",this._tfInput.bind(this),!1);this._stage=null;this._type="dynamic";this._selectable=!0;this._mdown=!1;this._curPos=
-1;this._metrics=this._select=null;this._wordWrap=!1;this._textH=this._textW=0;this._areaH=this._areaW=100;this._text="";this._tForm=new TextFormat;this._rheight=this._rwidth=0;this._border=this._background=!1;this._texture=gl.createTexture();this._tcArray=new Float32Array([0,0,0,0,0,0,0,0]);this._tcBuffer=gl.createBuffer();Stage._setBF(this._tcBuffer);gl.bufferData(gl.ARRAY_BUFFER,this._tcArray,gl.STATIC_DRAW);this._fArray=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0]);this._vBuffer=gl.createBuffer();
Stage._setBF(this._vBuffer);gl.bufferData(gl.ARRAY_BUFFER,this._fArray,gl.STATIC_DRAW);this.addEventListener2(Event.ADDED_TO_STAGE,this._tfATS,this);this.addEventListener2(Event.REMOVED_FROM_STAGE,this._tfRFS,this);this.addEventListener2(MouseEvent.MOUSE_DOWN,this._tfMD,this);this.addEventListener2(KeyboardEvent.KEY_UP,this._tfKU,this);this._brect=new Rectangle}TextField.prototype=new InteractiveObject;TextField.prototype._getLocRect=function(){return this._brect};
TextField.prototype._loseFocus=function(){this._tareaAdded&&document.body.removeChild(this._tarea);this._tareaAdded=!1;this._curPos=-1;this._update()};TextField.prototype._tfKU=function(d){this._tfInput(null)};TextField.prototype._tfInput=function(d){"input"==this._type&&(this._text=this._tarea.value,this._select=null,this._curPos=this._tarea.selectionStart,this.setSelection(this._tarea.selectionStart,this._tarea.selectionEnd))};
TextField.prototype._tfATS=function(d){this._stage=this.stage;this.stage.addEventListener2(MouseEvent.MOUSE_MOVE,this._tfMM,this);this.stage.addEventListener2(MouseEvent.MOUSE_UP,this._tfMU,this)};TextField.prototype._tfRFS=function(d){this._stage.removeEventListener(MouseEvent.MOUSE_MOVE,this._tfMM);this._stage.removeEventListener(MouseEvent.MOUSE_UP,this._tfMU);this._loseFocus()};
TextField.prototype._tfMD=function(d){this._selectable&&("input"==this._type&&(this._tareaAdded=!0,document.body.appendChild(this._tarea),this._tarea.value=this._text,this._tarea.focus()),d=this.getCharIndexAtPoint(this.mouseX,this.mouseY),this._mdown=!0,this._curPos=d,this.setSelection(d,d),this._update())};TextField.prototype._tfMM=function(d){this._selectable&&this._mdown&&(d=this.getCharIndexAtPoint(this.mouseX,this.mouseY),this.setSelection(this._curPos,d))};
TextField.prototype._tfMU=function(d){this._selectable&&(this._mdown=!1)};TextField.prototype.appendText=function(d){this._text+=d;this._update()};
TextField.prototype.getCharBoundaries=function(d){var a=TextFormat._ctxext;this._tForm.setContext(a);var b=this._metrics,e=this.getLineIndexOfChar(d);if(0==b[e].words.length)return new Rectangle(b[e].x,b[e].y,b[e].width,b[e].height);for(var c=0;c+1<b[e].words.length&&b[e].words[c+1].charOffset<=d;)c++;var f=b[e].words[c],h=f.word.substring(0,d-f.charOffset),f=new Rectangle(f.x+a.measureText(h).width,f.y,0,f.height);f.width=a.measureText(this._text.charAt(d)).width;(a=b[e].words[c+1])&&a.charOffset==
d+1&&(f.width=a.x-f.x);return f};TextField.prototype.getCharIndexAtPoint=function(d,a){if(0==this._text.length)return 0;var b=TextFormat._ctxext;this._tForm.setContext(b);var e=this._metrics,c=this.getLineIndexAtPoint(d,a);d=Math.max(e[c].x,Math.min(e[c].x+e[c].width,d));for(var f=0;f+1<e[c].words.length&&e[c].words[f+1].x<=d;)f++;c=e[c].words[f];e=c.charOffset;for(c=c.x;;)if(f=b.measureText(this._text.charAt(e)).width,c+.5*f<d&&0!=f)c+=f,e++;else break;return e};
TextField.prototype.getLineIndexAtPoint=function(d,a){for(var b=this._metrics,e=0;e+1<b.length&&b[e+1].y<=a;)e++;return e};TextField.prototype.getLineIndexOfChar=function(d){for(var a=this._metrics,b=0;b+1<a.length&&a[b+1].charOffset<=d;)b++;return b};TextField.prototype.getTextFormat=function(d){return this._tForm.clone()};
TextField.prototype.setTextFormat=function(d){this._tForm.set(d);this._tarea.style.fontFamily=d.font;this._tarea.style.fontSize=d.size+"px";this._tarea.style.textAlign=d.align;this._update()};TextField.prototype.setSelection=function(d,a){var b=Math.min(d,a),e=Math.max(d,a),c=this._select;if(null==c||c.from!=b||c.to!=e)this._select={from:b,to:e},this._tarea.selectionStart=b,this._tarea.selectionEnd=e,this._update()};
TextField.prototype._update=function(){var d=this._brect.width=this._areaW,a=this._brect.height=this._areaH;if(0!=d&&0!=a){var b=this._tForm.getImageData(this._text,this);this._textW=b.tw;this._textH=b.th;if(b.rw!=this._rwidth||b.rh!=this._rheight)gl.deleteTexture(this._texture),this._texture=gl.createTexture();Stage._setTEX(this._texture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,b.rw,b.rh,0,gl.RGBA,gl.UNSIGNED_BYTE,b.ui8buff);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,
gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_LINEAR);gl.generateMipmap(gl.TEXTURE_2D);this._rwidth=b.rw;this._rheight=b.rh;var e=a/b.rh,c=this._tcArray;c[2]=c[6]=d/b.rw;c[5]=c[7]=e;Stage._setBF(this._tcBuffer);gl.vertexAttribPointer(Stage._main._sprg.tca,2,gl.FLOAT,!1,0,0);gl.bufferSubData(gl.ARRAY_BUFFER,0,c);b=this._fArray;b[3]=b[9]=d;b[7]=b[10]=a;Stage._setBF(this._vBuffer);gl.vertexAttribPointer(Stage._main._sprg.vpa,3,gl.FLOAT,!1,0,0);gl.bufferSubData(gl.ARRAY_BUFFER,0,b)}};
TextField.prototype._render=function(d){0!=this._areaW&&0!=this._areaH&&(gl.uniformMatrix4fv(d._sprg.tMatUniform,!1,d._mstack.top()),d._cmstack.update(),Stage._setVC(this._vBuffer),Stage._setTC(this._tcBuffer),Stage._setUT(1),Stage._setTEX(this._texture),Stage._setEBF(d._unitIBuffer),gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0))};this.tp=TextField.prototype;tp.ds=tp.__defineSetter__;tp.dg=tp.__defineGetter__;tp.dg("textWidth",function(){return this._textW});tp.dg("textHeight",function(){return this._textH});
tp.ds("wordWrap",function(d){this._wordWrap=d;this._update()});tp.dg("wordWrap",function(){return this._wordWrap});tp.ds("width",function(d){this._areaW=Math.max(0,d);this._tarea.style.width=this._areaW+"px";this._update()});tp.dg("width",function(){return this._areaW});tp.ds("height",function(d){this._areaH=Math.max(0,d);this._tarea.style.height=this._areaH+"px";this._update()});tp.dg("height",function(){return this._areaH});tp.ds("text",function(d){this._text=d+"";this._update()});
tp.dg("text",function(){return this._text});tp.ds("selectable",function(d){this._selectable=d;this._update()});tp.dg("selectable",function(){return this._selectable});tp.ds("type",function(d){this._type=d;this._update()});tp.dg("type",function(){return this._type});tp.ds("background",function(d){this._background=d;this._update()});tp.dg("background",function(){return this._background});tp.ds("border",function(d){this._border=d;this._update()});tp.dg("border",function(){return this._border});delete tp.ds;
delete tp.dg;delete this.tp;var world,gameVars={bodies:[],actors:[]};gameVars.up;gameVars["char"]={};gameVars.fontLoader=0;
function Start(){function d(){this.callbacks=[g]}function a(a){gameVars.score+=Math.round(a);t.addCallback(function(){gameVars.scoreView.text=gameVars.score;gameVars.scoreView.x=(u.w/2-gameVars.scoreView._textW/q/1.5)*q;gameVars.scoreView.width=gameVars.scoreView._textW;gameVars.scoreView.height=gameVars.scoreView._textH;t.destroyCallback(this)})}function b(){gameVars.speed=Math.floor(Math.floor(Math.random()*(gameVars.speed_range[1]-gameVars.speed_range[0]))+gameVars.speed_range[0]+Math.floor(Math.random()*
(gameVars.score/100+1))/gameVars.speed_reducer);var a=0;200>gameVars.score/gameVars.teir_reducer?a=0:400>gameVars.score/gameVars.teir_reducer?a=1:800>gameVars.score/gameVars.teir_reducer?a=2:1600>gameVars.score/gameVars.teir_reducer?a=3:2400>gameVars.score/gameVars.teir_reducer?a=4:2400<=gameVars.score/gameVars.teir_reducer&&(a=5);a=gameVars.timings_teirs[a];e(gameVars.speed,Math.floor(Math.random()*(a[1]-a[0]))+a[0])}function e(a,d){if(!gameVars.over){var e=gameVars.sizes[Math.floor(Math.random()*
gameVars.sizes.length)],g={};g.body=f(g,gameVars.sidesOps[Math.floor(Math.random()*gameVars.sidesOps.length)],e,a);g.sprite=c(g,e);gameVars.actors.push(g);v.add(p.world,g.body);setTimeout(function(){b()},d)}}function c(a,b){var c=[],c=699>gameVars.score?"red black red black red black red black".split(" "):"red black blue grey green yellow orange purple".split(" "),d=c[0];gameVars.texture=new BitmapData("./images/bunny.png");var e=26,f=37,g=Math.floor(100*Math.random());47<g&&94>g?(d=c[1],gameVars.texture=
new BitmapData("./images/bigball.png"),f=e=200):95==g?d=c[2]:96==g?d=c[3]:97==g?d=c[4]:98==g?d=c[5]:99==g?d=c[6]:100==g&&(d=c[7]);c=new Bitmap(gameVars.texture);g=new Sprite;a.sprite=g;g.color=d;g.ss=b;g.addChild(c);g.x=(a.body.position.x-b)*q;g.y=(a.body.position.y-b)*q;g.scaleX=b/(e/q);g.scaleY=b/(f/q);g.zIndex=98;x.addChild(g);x.updateLayersOrder();return g}function f(a,b,c,d){var e,f,g=.5>Math.random()?!0:!1;d/=100;switch(b){case 1:b=u.w+c/2;e=(Math.round(Math.random()*u.h)+c)/2;f=r.circle(b,
e,c/2);f.name="right";1==g?e>u.h/2?Matter.Body.setVelocity(f,{x:-d,y:-d}):Matter.Body.setVelocity(f,{x:-d,y:d}):Matter.Body.setVelocity(f,{x:-d,y:0});break;case 2:e=(Math.round(Math.random()*u.h)+c)/2;f=r.circle(0-c/2,e,c/2);f.name="left";1==g?e>u.h/2?Matter.Body.setVelocity(f,{x:d,y:-d}):Matter.Body.setVelocity(f,{x:d,y:d}):Matter.Body.setVelocity(f,{x:d,y:0});break;case 3:b=(Math.round(Math.random()*u.w)+c)/2;e=u.h+c/2;f=r.circle(b,e,c/2);f.name="bottom";1==g?b>u.w/2?Matter.Body.setVelocity(f,{x:-d,
y:-d}):Matter.Body.setVelocity(f,{x:d,y:-d}):Matter.Body.setVelocity(f,{x:0,y:-d});break;case 4:b=(Math.round(Math.random()*u.w)+c)/2,f=r.circle(b,0-c/2,c/2),f.name="top",1==g?b>u.w/2?Matter.Body.setVelocity(f,{x:-d,y:d}):Matter.Body.setVelocity(f,{x:d,y:d}):Matter.Body.setVelocity(f,{x:0,y:d})}f.friction=0;f.frictionAir=0;f.collisionFilter.category=2;f.collisionFilter.mask=1;gameVars.bodies.push(f);return a.body=f}function h(a){v.remove(p.world,gameVars.bodies[a]);x.removeChild(gameVars.actors[a].sprite);
gameVars.bodies.splice(a,1);gameVars.actors.splice(a,1)}function k(){3>=gameVars.fontLoader&&(a(0),gameVars.fontLoader++);for(n in gameVars.bodies){var c=gameVars.bodies[n];(c.position.x-100>u.w||c.position.y-100>u.h||0>c.position.x+100||0>c.position.y+100)&&h(n)}}function g(){for(var a=0;a<gameVars.actors.length;a++){var c=gameVars.bodies[a],b=gameVars.actors[a].sprite,d=c.position,e=c.circleRadius;b.x=(d.x-e)*q;b.y=(d.y-e)*q;b.rotation=180*c.angle/Math.PI}}d.prototype.animate=function(a){a=fps.getFPS();
document.querySelector("#fps")&&(document.querySelector("#fps").innerHTML=a);if(t.callbacks)for(var c in t.callbacks)t.callbacks[c]()};d.prototype.addCallback=function(a){this.callbacks.push(a)};d.prototype.destroyCallback=function(a){this.callbacks.splice(this.callbacks.indexOf(a),1)};var q=window.devicePixelRatio,l=Matter.Engine,v=Matter.World,r=Matter.Bodies,m=Matter.Events,p=l.create(),A=Matter.MouseConstraint.create(p,{mouse:Matter.Mouse.create(document.getElementById("c"))});p.world.gravity=
{scale:.001,x:0,y:0};var x=new Stage("c",{w:window.innerWidth,h:window.innerHeight});x.updateLayersOrder=function(){x._children.sort(function(a,c){a.zIndex=a.zIndex||0;c.zIndex=c.zIndex||0;return c.zIndex-a.zIndex})};document.stage=x;var u={h:document.stage.stageHeight/q,w:document.stage.stageWidth/q},t=new d;x.addEventListener(Event.ENTER_FRAME,t.animate);var w=new BitmapData("./images/bg.png"),z=new Sprite;gameVars.bg=z;z.graphics.beginBitmapFill(w);z.graphics.drawRect(0,0,2*u.w,2*u.h);z.scaleY=
z.scaleX=q/2;z.zIndex=100;x.addChild(z);x.updateLayersOrder();gameVars["char"].body=r.rectangle(u.w/2,u.h/2,40,40,{isStatic:!0});gameVars["char"].sprite=function(){var a=new BitmapData("./images/grid.png"),a=new MBitmap(a,6,11);a.x=gameVars["char"].body.vertices[0].x*q;a.y=gameVars["char"].body.vertices[0].y*q;a.scaleX=a.scaleY=40/(160/q);a.play();a.w=40*q;a.h=40*q;return a}();gameVars["char"].sprite.zIndex=1;v.add(p.world,gameVars["char"].body);x.addChild(gameVars["char"].sprite);x.updateLayersOrder();
w=new TextFormat("Conductive",30*q,0,!1,!1,"center");gameVars.scoreView=new TextField;gameVars.scoreView.selectable=!1;gameVars.scoreView.setTextFormat(w);gameVars.scoreView.text="0";gameVars.scoreView.x=(u.w/2-gameVars.scoreView._textW/q/1.5)*q;gameVars.scoreView.y=(u.h/2-100)*q;gameVars.scoreView.width=gameVars.scoreView._textW;gameVars.scoreView.height=gameVars.scoreView._textH;gameVars.score=0;gameVars.scoreView.zIndex=99;x.addChild(gameVars.scoreView);x.updateLayersOrder();gameVars.teir_reducer=
1;gameVars.speed_reducer=1;gameVars.score=0;gameVars.invincible=!1;gameVars.lives=1;gameVars.timings_teirs=[[500,1E3],[400,700],[300,500],[200,400],[100,250],[50,125]];gameVars.speed_range=[200,225];gameVars.speed=0;gameVars.sizes=[30,40,50,60];gameVars.sidesOps=[1,2,3,4];l.run(p);b();t.addCallback(k);m.on(A,"mousemove",function(a){Matter.Body.setPosition(gameVars["char"].body,Matter.Vector.create(a.mouse.position.x/q,a.mouse.position.y/q));gameVars["char"].sprite.x=a.mouse.position.x-gameVars["char"].sprite.w/
2;gameVars["char"].sprite.y=a.mouse.position.y-gameVars["char"].sprite.h/2});m.on(p,"collisionStart",function(c){c=c.pairs;for(n in c){var b=gameVars.bodies.indexOf(c[n].bodyB);if(-1!=b){var d=gameVars.actors[b].sprite.color,e=gameVars.actors[b].sprite.ss/2;if("black"==d)h(b),a(e);else if("red"==d)if(h(b),gameVars.invincible||1!=gameVars.lives)gameVars.invincible||manageLives(-1);else{for(b=gameVars.actors;b.length;)null==b[0]?b.splice(0,1):h(0);t.destroyCallback(g);t.destroyCallback(k);gameVars.over=
!0;b=new TextFormat("Conductive",30*q,0,!1,!1,"left");gameVars.gameOverView=new TextField;gameVars.gameOverView.selectable=!1;gameVars.gameOverView.setTextFormat(b);gameVars.gameOverView.text="Game Over";gameVars.gameOverView.x=(u.w/2-gameVars.gameOverView._textW/q/1.5)*q;gameVars.gameOverView.y=(u.h/2-100)*q;gameVars.gameOverView.width=gameVars.gameOverView._textW;gameVars.gameOverView.height=gameVars.gameOverView._textH;gameVars.gameOverView.zIndex=99;x.addChild(gameVars.gameOverView);x.updateLayersOrder();
b=new TextFormat("Conductive",30*q,0,!1,!1,"left");gameVars.startButtonView=new TextField;gameVars.startButtonView.selectable=!1;gameVars.startButtonView.setTextFormat(b);gameVars.startButtonView.text="Start Game";gameVars.startButtonView.x=u.w/2;gameVars.startButtonView.y=(u.h/2+100)*q;gameVars.startButtonView.width=gameVars.startButtonView._textW;gameVars.startButtonView.height=gameVars.startButtonView._textH;gameVars.startButtonView.zIndex=98;x.addChild(gameVars.startButtonView);x.updateLayersOrder();
gameVars.scoreView.y=u.h/2;gameVars.started=!1;1==gameVars.storage.available&&window.localStorage.high_score&&window.localStorage.high_score<gameVars.score&&(window.localStorage.high_score=gameVars.score)}else"blue"==d?(h(b),setInvincible()):"grey"==d?(h(b),setSlowTime()):"green"==d?(h(b),gameVars.teir_reducer+=2):"yellow"==d?(h(b),gameVars.speed_reducer+=10):"orange"==d?(h(b),a(1E3)):"purple"==d?(h(b),manageLives(1)):"violet"==d?(h(b),setMagenetic()):"gainsboro"==d&&(h(b),setWarp())}}})}
var fps={startTime:0,frameNumber:0,getFPS:function(){this.frameNumber++;var d=((new Date).getTime()-this.startTime)/1E3,a=Math.floor(this.frameNumber/d);1<d&&(this.startTime=(new Date).getTime(),this.frameNumber=0);return a}};function MBitmap(d,a,b){Sprite.call(this);this.bitmapData=d;this.totalFrames=a*b;this.currentFrame=0;this.isPlaying=!1;this._rows=a;this._cols=b;this._frames=[];this._time=0;this._step=1;0==d.width?d.loader.addEventListener2(Event.COMPLETE,this._init,this):this._init()}
MBitmap.prototype=new Sprite;MBitmap.prototype._init=function(d){d=1/this._cols;for(var a=1/this._rows,b=this.bitmapData.width*d,e=this.bitmapData.height*a,c=0;c<this._rows;c++)for(var f=0;f<this._cols;f++){var h=new Graphics;h.beginBitmapFill(this.bitmapData);h.drawTriangles([0,0,b,0,0,e,b,e],[0,1,2,1,2,3],[f*d,c*a,(f+1)*d,c*a,f*d,(c+1)*a,(f+1)*d,(c+1)*a]);this._frames.push(h)}this.graphics=this._frames[this.currentFrame]};
MBitmap.prototype.gotoAndStop=function(d){this.currentFrame=(d+this.totalFrames)%this.totalFrames;this.bitmapData.width&&(this.graphics=this._frames[d%this.totalFrames])};MBitmap.prototype.nextFrame=function(){this.gotoAndStop(this.currentFrame+1)};MBitmap.prototype.prevFrame=function(){this.gotoAndStop(this.currentFrame-1)};MBitmap.prototype.gotoAndPlay=function(d,a){this.gotoAndStop(d);this.play(a)};
MBitmap.prototype.play=function(d){this._step=d?d:1;this.isPlaying=!0;this.addEventListener2(Event.ENTER_FRAME,this._ef,this)};MBitmap.prototype.stop=function(){this.isPlaying=!1;this.removeEventListener(Event.ENTER_FRAME,this._ef)};MBitmap.prototype._ef=function(d){0==this._time++%this._step&&this.nextFrame()};function storageAvailable(d){try{var a=window[d];a.setItem("__storage_test__","__storage_test__");a.removeItem("__storage_test__");return!0}catch(b){return!1}}
storageAvailable("localStorage")?(window.localStorage.high_score||(window.localStorage.high_score=0),gameVars.storage={available:!0}):game.storage={available:!1};Start();
