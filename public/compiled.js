(function e$$0(h,v,b){function a(c,k){if(!v[c]){if(!h[c]){var g="function"==typeof require&&require;if(!k&&g)return g(c,!0);if(d)return d(c,!0);g=Error("Cannot find module '"+c+"'");throw g.code="MODULE_NOT_FOUND",g;}g=v[c]={exports:{}};h[c][0].call(g.exports,function(b){var d=h[c][1][b];return a(d?d:b)},g,g.exports,e$$0,h,v,b)}return v[c].exports}for(var d="function"==typeof require&&require,c=0;c<b.length;c++)a(b[c]);return a})({1:[function(e,h,v){function b(a){this._node=a;this._projectionType=
b.ORTHOGRAPHIC_PROJECTION;this._far=this._near=this._focalDepth=0;this._requestingUpdate=!1;this._id=a.addComponent(this);this._viewTransform=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this._perspectiveDirty=this._viewDirty=!1;this.setFlat()}var a=e("../core/Commands");b.FRUSTUM_PROJECTION=0;b.PINHOLE_PROJECTION=1;b.ORTHOGRAPHIC_PROJECTION=2;b.prototype.toString=function(){return"Camera"};b.prototype.getValue=function(){return{component:this.toString(),projectionType:this._projectionType,
focalDepth:this._focalDepth,near:this._near,far:this._far}};b.prototype.setValue=function(a){return this.toString()===a.component?(this.set(a.projectionType,a.focalDepth,a.near,a.far),!0):!1};b.prototype.set=function(a,b,f,k){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);this._projectionType=a;this._focalDepth=b;this._near=f;this._far=k;return this};b.prototype.setDepth=function(a){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=
!0);this._perspectiveDirty=!0;this._projectionType=b.PINHOLE_PROJECTION;this._focalDepth=a;this._far=this._near=0;return this};b.prototype.setFrustum=function(a,c){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);this._perspectiveDirty=!0;this._projectionType=b.FRUSTUM_PROJECTION;this._focalDepth=0;this._near=a;this._far=c;return this};b.prototype.setFlat=function(){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);this._perspectiveDirty=
!0;this._projectionType=b.ORTHOGRAPHIC_PROJECTION;this._far=this._near=this._focalDepth=0;return this};b.prototype.onUpdate=function(){this._requestingUpdate=!1;var d=this._node.getLocation();this._node.sendDrawCommand(a.WITH).sendDrawCommand(d);if(this._perspectiveDirty)switch(this._perspectiveDirty=!1,this._projectionType){case b.FRUSTUM_PROJECTION:this._node.sendDrawCommand(a.FRUSTRUM_PROJECTION);this._node.sendDrawCommand(this._near);this._node.sendDrawCommand(this._far);break;case b.PINHOLE_PROJECTION:this._node.sendDrawCommand(a.PINHOLE_PROJECTION);
this._node.sendDrawCommand(this._focalDepth);break;case b.ORTHOGRAPHIC_PROJECTION:this._node.sendDrawCommand(a.ORTHOGRAPHIC_PROJECTION)}this._viewDirty&&(this._viewDirty=!1,this._node.sendDrawCommand(a.CHANGE_VIEW_TRANSFORM),this._node.sendDrawCommand(this._viewTransform[0]),this._node.sendDrawCommand(this._viewTransform[1]),this._node.sendDrawCommand(this._viewTransform[2]),this._node.sendDrawCommand(this._viewTransform[3]),this._node.sendDrawCommand(this._viewTransform[4]),this._node.sendDrawCommand(this._viewTransform[5]),
this._node.sendDrawCommand(this._viewTransform[6]),this._node.sendDrawCommand(this._viewTransform[7]),this._node.sendDrawCommand(this._viewTransform[8]),this._node.sendDrawCommand(this._viewTransform[9]),this._node.sendDrawCommand(this._viewTransform[10]),this._node.sendDrawCommand(this._viewTransform[11]),this._node.sendDrawCommand(this._viewTransform[12]),this._node.sendDrawCommand(this._viewTransform[13]),this._node.sendDrawCommand(this._viewTransform[14]),this._node.sendDrawCommand(this._viewTransform[15]))};
b.prototype.onTransformChange=function(a){this._viewDirty=!0;this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);var b=a[0],f=a[1],k=a[2],g=a[3],q=a[4],l=a[5],n=a[6],p=a[7],t=a[8],m=a[9],A=a[10],r=a[11],u=a[12],e=a[13],y=a[14];a=a[15];var z=b*l-f*q,x=b*n-k*q,B=b*p-g*q,O=f*n-k*l,N=f*p-g*l,I=k*p-g*n,w=t*e-m*u,J=t*y-A*u,h=t*a-r*u,G=m*y-A*e,F=m*a-r*e,D=A*a-r*y,C=1/(z*D-x*F+B*G+O*h-N*J+I*w);this._viewTransform[0]=(l*D-n*F+p*G)*C;this._viewTransform[1]=(k*F-f*D-g*G)*C;
this._viewTransform[2]=(e*I-y*N+a*O)*C;this._viewTransform[3]=(A*N-m*I-r*O)*C;this._viewTransform[4]=(n*h-q*D-p*J)*C;this._viewTransform[5]=(b*D-k*h+g*J)*C;this._viewTransform[6]=(y*B-u*I-a*x)*C;this._viewTransform[7]=(t*I-A*B+r*x)*C;this._viewTransform[8]=(q*F-l*h+p*w)*C;this._viewTransform[9]=(f*h-b*F-g*w)*C;this._viewTransform[10]=(u*N-e*B+a*z)*C;this._viewTransform[11]=(m*B-t*N-r*z)*C;this._viewTransform[12]=(l*J-q*G-n*w)*C;this._viewTransform[13]=(b*G-f*J+k*w)*C;this._viewTransform[14]=(e*x-
u*O-y*z)*C;this._viewTransform[15]=(t*O-m*x+A*z)*C};h.exports=b},{"../core/Commands":5}],2:[function(e,h,v){function b(b){this._node=b;this._id=b.addComponent(this);this._requestingUpdate=!1;b=b.getPosition();this._x=new a(b[0]);this._y=new a(b[1]);this._z=new a(b[2])}var a=e("../transitions/Transitionable");b.prototype.toString=function(){return"Position"};b.prototype.getValue=function(){return{component:this.toString(),x:this._x.get(),y:this._y.get(),z:this._z.get()}};b.prototype.setValue=function(a){return this.toString()===
a.component?(this.set(a.x,a.y,a.z),!0):!1};b.prototype.getX=function(){return this._x.get()};b.prototype.getY=function(){return this._y.get()};b.prototype.getZ=function(){return this._z.get()};b.prototype.isActive=function(){return this._x.isActive()||this._y.isActive()||this._z.isActive()};b.prototype._checkUpdate=function(){this.isActive()?this._node.requestUpdateOnNextTick(this._id):this._requestingUpdate=!1};b.prototype.update=function(){this._node.setPosition(this._x.get(),this._y.get(),this._z.get());
this._checkUpdate()};b.prototype.onUpdate=b.prototype.update;b.prototype.setX=function(a,b,f){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);this._x.set(a,b,f);return this};b.prototype.setY=function(a,b,f){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);this._y.set(a,b,f);return this};b.prototype.setZ=function(a,b,f){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);this._z.set(a,b,
f);return this};b.prototype.set=function(a,b,f,k,g){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);var q,l,n;null!=f?n=g:null!=b?l=g:null!=a&&(q=g);null!=a&&this._x.set(a,k,q);null!=b&&this._y.set(b,k,l);null!=f&&this._z.set(f,k,n);return this};b.prototype.halt=function(){this._x.halt();this._y.halt();this._z.halt();return this};h.exports=b},{"../transitions/Transitionable":73}],3:[function(e,h,v){function b(){"undefined"!==typeof self&&self.window!==self&&
this._enterWorkerMode()}b.prototype._enterWorkerMode=function(){this._workerMode=!0;var a=this;self.addEventListener("message",function(b){a.onMessage(b.data)})};b.prototype.onMessage=null;b.prototype.sendMessage=function(a){if(this._workerMode)self.postMessage(a);else this.onmessage(a)};b.prototype.onmessage=null;b.prototype.postMessage=function(a){return this.onMessage(a)};h.exports=b},{}],4:[function(e,h,v){function b(){this._frame=this._time=0;this._timerQueue=[];this._updatingIndex=0;this._scale=
1;this._scaledTime=this._time}b.prototype.setScale=function(a){this._scale=a;return this};b.prototype.getScale=function(){return this._scale};b.prototype.step=function(a){this._frame++;this._scaledTime+=(a-this._time)*this._scale;this._time=a;for(a=0;a<this._timerQueue.length;a++)this._timerQueue[a](this._scaledTime)&&this._timerQueue.splice(a,1);return this};b.prototype.now=function(){return this._scaledTime};b.prototype.getTime=b.prototype.now;b.prototype.getFrame=function(){return this._frame};
b.prototype.setTimeout=function(a,b){var c=Array.prototype.slice.call(arguments,2),f=this._time,k=function(g){return g-f>=b?(a.apply(null,c),!0):!1};this._timerQueue.push(k);return k};b.prototype.setInterval=function(a,b){var c=Array.prototype.slice.call(arguments,2),f=this._time,k=function(g){g-f>=b&&(a.apply(null,c),f=g);return!1};this._timerQueue.push(k);return k};b.prototype.clearTimer=function(a){a=this._timerQueue.indexOf(a);-1!==a&&this._timerQueue.splice(a,1);return this};h.exports=b},{}],
5:[function(e,h,v){h.exports={INIT_DOM:0,DOM_RENDER_SIZE:1,CHANGE_TRANSFORM:2,CHANGE_SIZE:3,CHANGE_PROPERTY:4,CHANGE_CONTENT:5,CHANGE_ATTRIBUTE:6,ADD_CLASS:7,REMOVE_CLASS:8,SUBSCRIBE:9,GL_SET_DRAW_OPTIONS:10,GL_AMBIENT_LIGHT:11,GL_LIGHT_POSITION:12,GL_LIGHT_COLOR:13,MATERIAL_INPUT:14,GL_SET_GEOMETRY:15,GL_UNIFORMS:16,GL_BUFFER_DATA:17,GL_CUTOUT_STATE:18,GL_MESH_VISIBILITY:19,GL_REMOVE_MESH:20,PINHOLE_PROJECTION:21,ORTHOGRAPHIC_PROJECTION:22,CHANGE_VIEW_TRANSFORM:23,WITH:24,FRAME:25,ENGINE:26,START:27,
STOP:28,TIME:29,TRIGGER:30,NEED_SIZE_FOR:31,DOM:32,READY:33,ALLOW_DEFAULT:34,PREVENT_DEFAULT:35}},{}],6:[function(e,h,v){function b(){this._nodes={};this._queue=[]}var a=e("./Event"),d=e("./Path");b.prototype._setUpdater=function(a){this._updater=a;for(var b in this._nodes)this._nodes[b]._setUpdater(a)};b.prototype.addChildrenToQueue=function(a){a=a.getChildren();for(var b,d=0,g=a.length;d<g;d++)(b=a[d])&&this._queue.push(b)};b.prototype.next=function(){return this._queue.shift()};b.prototype.breadthFirstNext=
function(){var a=this._queue.shift();if(a)return this.addChildrenToQueue(a),a};b.prototype.mount=function(a,b){if(!b)throw Error("Dispatch: no node passed to mount at: "+a);if(this._nodes[a])throw Error("Dispatch: there is a node already registered at: "+a);b._setUpdater(this._updater);this._nodes[a]=b;var k=d.parent(a),g=k?this._nodes[k]:b;if(!g)throw Error("Parent to path: "+a+" doesn't exist at expected path: "+k);var k=b.getChildren(),q=b.getComponents(),l,n;g.isMounted()&&b._setMounted(!0,a);
g.isShown()&&b._setShown(!0);if(g.isMounted()){b._setParent(g);if(b.onMount)b.onMount(a);l=0;for(n=q.length;l<n;l++)if(q[l]&&q[l].onMount)q[l].onMount(b,l);l=0;for(n=k.length;l<n;l++)k[l]&&k[l].mount?k[l].mount(a+"/"+l):k[l]&&this.mount(a+"/"+l,k[l])}if(g.isShown()){if(b.onShow)b.onShow();l=0;for(n=q.length;l<n;l++)if(q[l]&&q[l].onShow)q[l].onShow()}};b.prototype.dismount=function(a){var b=this._nodes[a];if(!b)throw Error("No node registered to path: "+a);var d=b.getChildren(),g=b.getComponents(),
q,l;if(b.isShown()){b._setShown(!1);if(b.onHide)b.onHide();q=0;for(l=g.length;q<l;q++)if(g[q]&&g[q].onHide)g[q].onHide()}if(b.isMounted()){if(b.onDismount)b.onDismount(a);q=0;for(l=d.length;q<l;q++)d[q]&&d[q].dismount?d[q].dismount():d[q]&&this.dismount(a+"/"+q);q=0;for(l=g.length;q<l;q++)if(g[q]&&g[q].onDismount)g[q].onDismount();b._setMounted(!1);b._setParent(null)}delete this._nodes[a]};b.prototype.getNode=function(a){return this._nodes[a]};b.prototype.show=function(a){var b=this._nodes[a];if(!b)throw Error("No node registered to path: "+
a);if(b.onShow)b.onShow();for(this.addChildrenToQueue(b);a=this.breadthFirstNext();)this.show(a.getLocation())};b.prototype.hide=function(a){var b=this._nodes[a];if(!b)throw Error("No node registered to path: "+a);if(b.onHide)b.onHide();for(this.addChildrenToQueue(b);a=this.breadthFirstNext();)this.hide(a.getLocation())};b.prototype.lookupNode=function(a){if(!a)throw Error("lookupNode must be called with a path");this._queue.length=0;var b=this._queue,d=b.length=0,g,q=a.length;for(g=0;g<q;g++)"/"===
a[g]&&(b.push(a.substring(d,g)),d=g+1);0<g-d&&b.push(a.substring(d,g));a=0;for(d=b.length;a<d;a++)b[a]=this._nodes[b[a]];return b[b.length-1]};b.prototype.dispatch=function(a,b,d){if(!a)throw Error("dispatch requires a path as it's first argument");if(!b)throw Error("dispatch requires an event name as it's second argument");var g=this._nodes[a];if(!g)throw Error("No node registered at path: "+a);for(this.addChildrenToQueue(g);a=this.breadthFirstNext();)if(a&&a.onReceive)a.onReceive(b,d);else if(a)for(g=
0;g<a.getComponents().length;g++)if(a._components[g].onReceive)a._components[g].onReceive(b,d)};b.prototype.dispatchUIEvent=function(b,d,k){if(!b)throw Error("dispatchUIEvent needs a valid path to dispatch to");if(!d)throw Error("dispatchUIEvent needs an event name as its second argument");a.call(k);if(b=this.getNode(b)){var g,q,l;for(k.node=b;b;){if(b.onReceive)b.onReceive(d,k);g=b.getComponents();q=0;for(l=g.length;q<l;q++)if(g[q]&&g[q].onReceive)g[q].onReceive(d,k);if(k.propagationStopped)break;
g=b.getParent();if(g===b)break;b=g}}};h.exports=new b},{"./Event":7,"./Path":10}],7:[function(e,h,v){function b(){this.propagationStopped=!0}h.exports=function(){this.propagationStopped=!1;this.stopPropagation=b}},{}],8:[function(e,h,v){function b(){var b=this;f._setUpdater(this);this._updateQueue=[];this._nextUpdateQueue=[];this._scenes={};this._messages=A;this._inUpdate=!1;this._clock=new a;this._channel=new c;this._channel.onMessage=function(a){b.handleMessage(a)}}var a=e("./Clock"),d=e("./Scene"),
c=e("./Channel"),f=e("./Dispatch"),k=e("../renderers/UIManager"),g=e("../renderers/Compositor"),q=e("../render-loops/RequestAnimationFrameLoop"),l=e("./TransformSystem"),n=e("./SizeSystem"),p=e("./Commands"),t=[p.ENGINE,p.START],m=[p.ENGINE,p.STOP],A=[p.TIME,null];b.prototype.init=function(a){this.compositor=a&&a.compositor||new g;this.renderLoop=a&&a.renderLoop||new q;this.uiManager=new k(this.getChannel(),this.compositor,this.renderLoop);return this};b.prototype.setChannel=function(a){this._channel=
a;return this};b.prototype.getChannel=function(){return this._channel};b.prototype._update=function(){this._inUpdate=!0;var a=this._clock.now(),b=this._nextUpdateQueue,g=this._updateQueue;this._messages[1]=a;n.update();for(l.onUpdate();b.length;)g.unshift(b.pop());for(;g.length;)if((b=g.shift())&&b.update&&b.update(a),b&&b.onUpdate)b.onUpdate(a);this._inUpdate=!1};b.prototype.requestUpdate=function(a){if(!a)throw Error("requestUpdate must be called with a class to be updated");this._inUpdate?this.requestUpdateOnNextTick(a):
this._updateQueue.push(a)};b.prototype.requestUpdateOnNextTick=function(a){this._nextUpdateQueue.push(a)};b.prototype.handleMessage=function(a){if(!a)throw Error("onMessage must be called with an array of messages");for(var b;0<a.length;)switch(b=a.shift(),b){case p.WITH:this.handleWith(a);break;case p.FRAME:this.handleFrame(a);break;default:throw Error("received unknown command: "+b);}return this};b.prototype.handleWith=function(a){var b=a.shift(),g=a.shift();switch(g){case p.TRIGGER:g=a.shift();
a=a.shift();f.dispatchUIEvent(b,g,a);break;default:throw Error("received unknown command: "+g);}return this};b.prototype.handleFrame=function(a){if(!a)throw Error("handleFrame must be called with an array of messages");if(!a.length)throw Error("FRAME must be sent with a time");this.step(a.shift());return this};b.prototype.step=function(a){if(null==a)throw Error("step must be called with a time");this._clock.step(a);this._update();if(this._messages.length)for(this._channel.sendMessage(this._messages);2<
this._messages.length;)this._messages.pop();return this};b.prototype.getContext=function(a){if(!a)throw Error("getContext must be called with a selector");var b=a.indexOf("/");a=-1===b?a:a.substring(0,b);return this._scenes[a]};b.prototype.getClock=function(){return this._clock};b.prototype.message=function(a){this._messages.push(a);return this};b.prototype.createScene=function(a){a=a||"body";this._scenes[a]&&this._scenes[a].dismount();this._scenes[a]=new d(a,this);return this._scenes[a]};b.prototype.addScene=
function(a){var b=a._selector,g=this._scenes[b];g&&g!==a&&g.dismount();a.isMounted()||a.mount();this._scenes[b]=a;return this};b.prototype.removeScene=function(a){var b=a._selector,g=this._scenes[b];g&&g===a&&(a.isMounted()&&a.dismount(),delete this._scenes[b]);return this};b.prototype.startRenderLoop=function(){this._channel.sendMessage(t);return this};b.prototype.stopRenderLoop=function(){this._channel.sendMessage(m);return this};b.prototype.startEngine=function(){console.warn("FamousEngine.startEngine is deprecated! Use FamousEngine.startRenderLoop instead!");
return this.startRenderLoop()};b.prototype.stopEngine=function(){console.warn("FamousEngine.stopEngine is deprecated! Use FamousEngine.stopRenderLoop instead!");return this.stopRenderLoop()};h.exports=new b},{"../render-loops/RequestAnimationFrameLoop":67,"../renderers/Compositor":68,"../renderers/UIManager":70,"./Channel":3,"./Clock":4,"./Commands":5,"./Dispatch":6,"./Scene":12,"./SizeSystem":14,"./TransformSystem":16}],9:[function(e,h,v){function b(){this._shown=this._mounted=this._inUpdate=this._requestingUpdate=
!1;this._updater=null;this._opacity=1;this._UIEvents=[];this._updateQueue=[];this._nextUpdateQueue=[];this._freedComponentIndicies=[];this._components=[];this._freedChildIndicies=[];this._children=[];this._sizeID=this._transformID=this._id=this._parent=null;this.constructor.INIT_DEFAULT_COMPONENTS&&this._init()}var a=e("./SizeSystem"),d=e("./Dispatch"),c=e("./TransformSystem"),f=e("./Size"),k=e("./Transform");b.RELATIVE_SIZE=0;b.ABSOLUTE_SIZE=1;b.RENDER_SIZE=2;b.DEFAULT_SIZE=0;b.INIT_DEFAULT_COMPONENTS=
!0;b.prototype._init=function(){this._transformID=this.addComponent(new k);this._sizeID=this.addComponent(new f)};b.prototype._setParent=function(a){this._parent&&-1!==this._parent.getChildren().indexOf(this)&&this._parent.removeChild(this);this._parent=a};b.prototype._setMounted=function(a,b){this._mounted=a;this._id=b?b:null};b.prototype._setShown=function(a){this._shown=a};b.prototype._setUpdater=function(a){this._updater=a;this._requestingUpdate&&this._updater.requestUpdate(this)};b.prototype.getLocation=
function(){return this._id};b.prototype.getId=b.prototype.getLocation;b.prototype.emit=function(a,b){d.dispatch(this.getLocation(),a,b);return this};b.prototype.sendDrawCommand=function(a){this._updater.message(a);return this};b.prototype.getValue=function(){var b=this._children.length,d=this._components.length,l=0,f={location:this.getId(),spec:{location:this.getId(),showState:{mounted:this.isMounted(),shown:this.isShown(),opacity:this.getOpacity()||null},offsets:{mountPoint:[0,0,0],align:[0,0,0],
origin:[0,0,0]},vectors:{position:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1]},size:{sizeMode:[0,0,0],proportional:[1,1,1],differential:[0,0,0],absolute:[0,0,0],render:[0,0,0]}},UIEvents:this._UIEvents,components:[],children:[]};if(f.location){for(var k=c.get(this.getId()),t=a.get(this.getId()),l=0;3>l;l++)f.spec.offsets.mountPoint[l]=k.offsets.mountPoint[l],f.spec.offsets.align[l]=k.offsets.align[l],f.spec.offsets.origin[l]=k.offsets.origin[l],f.spec.vectors.position[l]=k.vectors.position[l],f.spec.vectors.rotation[l]=
k.vectors.rotation[l],f.spec.vectors.scale[l]=k.vectors.scale[l],f.spec.size.sizeMode[l]=t.sizeMode[l],f.spec.size.proportional[l]=t.proportionalSize[l],f.spec.size.differential[l]=t.differentialSize[l],f.spec.size.absolute[l]=t.absoluteSize[l],f.spec.size.render[l]=t.renderSize[l];f.spec.vectors.rotation[3]=k.vectors.rotation[3]}for(l=0;l<b;l++)this._children[l]&&this._children[l].getValue&&f.children.push(this._children[l].getValue());for(l=0;l<d;l++)this._components[l]&&this._components[l].getValue&&
f.components.push(this._components[l].getValue());return f};b.prototype.getComputedValue=function(){console.warn("Node.getComputedValue is depricated. Use Node.getValue instead");for(var b=this._children.length,d={location:this.getId(),computedValues:{transform:this.isMounted()?c.get(this.getLocation()).getLocalTransform():null,size:this.isMounted()?a.get(this.getLocation()).get():null},children:[]},f=0;f<b;f++)this._children[f]&&this._children[f].getComputedValue&&d.children.push(this._children[f].getComputedValue());
return d};b.prototype.getChildren=function(){return this._children};b.prototype.getParent=function(){return this._parent};b.prototype.requestUpdate=function(a){if(this._inUpdate||!this.isMounted())return this.requestUpdateOnNextTick(a);this._updateQueue.push(a);this._requestingUpdate||this._requestUpdate();return this};b.prototype.requestUpdateOnNextTick=function(a){-1==this._nextUpdateQueue.indexOf(a)&&this._nextUpdateQueue.push(a);return this};b.prototype.isMounted=function(){return this._mounted};
b.prototype.isShown=function(){return this._shown};b.prototype.getOpacity=function(){return this._opacity};b.prototype.getMountPoint=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._transformID).getMountPoint();if(this.isMounted())return c.get(this.getLocation()).getMountPoint();throw Error("This node does not have access to a transform component");};b.prototype.getAlign=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._transformID).getAlign();
if(this.isMounted())return c.get(this.getLocation()).getAlign();throw Error("This node does not have access to a transform component");};b.prototype.getOrigin=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._transformID).getOrigin();if(this.isMounted())return c.get(this.getLocation()).getOrigin();throw Error("This node does not have access to a transform component");};b.prototype.getPosition=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._transformID).getPosition();
if(this.isMounted())return c.get(this.getLocation()).getPosition();throw Error("This node does not have access to a transform component");};b.prototype.getRotation=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._transformID).getRotation();if(this.isMounted())return c.get(this.getLocation()).getRotation();throw Error("This node does not have access to a transform component");};b.prototype.getScale=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._transformID).getScale();
if(this.isMounted())return c.get(this.getLocation()).getScale();throw Error("This node does not have access to a transform component");};b.prototype.getSizeMode=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._sizeID).getSizeMode();if(this.isMounted())return a.get(this.getLocation()).getSizeMode();throw Error("This node does not have access to a size component");};b.prototype.getProportionalSize=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._sizeID).getProportional();
if(this.isMounted())return a.get(this.getLocation()).getProportional();throw Error("This node does not have access to a size component");};b.prototype.getDifferentialSize=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._sizeID).getDifferential();if(this.isMounted())return a.get(this.getLocation()).getDifferential();throw Error("This node does not have access to a size component");};b.prototype.getAbsoluteSize=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._sizeID).getAbsolute();
if(this.isMounted())return a.get(this.getLocation()).getAbsolute();throw Error("This node does not have access to a size component");};b.prototype.getRenderSize=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._sizeID).getRender();if(this.isMounted())return a.get(this.getLocation()).getRender();throw Error("This node does not have access to a size component");};b.prototype.getSize=function(){if(this.constructor.INIT_DEFAULT_COMPONENTS)return this.getComponent(this._sizeID).get();
if(this.isMounted())return a.get(this.getLocation()).get();throw Error("This node does not have access to a size component");};b.prototype.getTransform=function(){return c.get(this.getLocation())};b.prototype.getUIEvents=function(){return this._UIEvents};b.prototype.addChild=function(a){var d=a?this._children.indexOf(a):-1;a=a?a:new b;-1===d&&(d=this._freedChildIndicies.length?this._freedChildIndicies.pop():this._children.length,this._children[d]=a);this.isMounted()&&a.mount(this.getLocation()+"/"+
d);return a};b.prototype.removeChild=function(a){var b=this._children.indexOf(a);if(-1<b)return this._freedChildIndicies.push(b),this._children[b]=null,a.isMounted()&&a.dismount(),!0;throw Error("Node is not a child of this node");};b.prototype.addComponent=function(a){var b=this._components.indexOf(a);if(-1===b){b=this._freedComponentIndicies.length?this._freedComponentIndicies.pop():this._components.length;this._components[b]=a;if(this.isMounted()&&a.onMount)a.onMount(this,b);if(this.isShown()&&
a.onShow)a.onShow()}return b};b.prototype.getComponent=function(a){return this._components[a]};b.prototype.removeComponent=function(a){var b=this._components.indexOf(a);if(-1!==b){this._freedComponentIndicies.push(b);if(this.isShown()&&a.onHide)a.onHide();if(this.isMounted()&&a.onDismount)a.onDismount();this._components.splice(b,1)}return a};b.prototype.removeUIEvent=function(a){var b=this.getUIEvents(),d=this._components,f=b.indexOf(a);if(-1!==f){b.splice(f,1);for(var f=0,c=d.length;f<c;f++)if((b=
d[f])&&b.onRemoveUIEvent)b.onRemoveUIEvent(a)}};b.prototype.addUIEvent=function(a){var b=this.getUIEvents(),d=this._components;if(-1===b.indexOf(a)){b.push(a);for(var f=0,c=d.length;f<c;f++)if((b=d[f])&&b.onAddUIEvent)b.onAddUIEvent(a)}};b.prototype._requestUpdate=function(a){if(a||!this._requestingUpdate)this._updater&&this._updater.requestUpdate(this),this._requestingUpdate=!0};b.prototype._vecOptionalSet=function(a,b,d){return null!=d&&a[b]!==d?(a[b]=d,this._requestingUpdate||this._requestUpdate(),
!0):!1};b.prototype.show=function(){d.show(this.getLocation());this._shown=!0;return this};b.prototype.hide=function(){d.hide(this.getLocation());this._shown=!1;return this};b.prototype.setAlign=function(a,b,d){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._transformID).setAlign(a,b,d);else if(this.isMounted())c.get(this.getLocation()).setAlign(a,b,d);else throw Error("This node does not have access to a transform component");return this};b.prototype.setMountPoint=function(a,
b,d){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._transformID).setMountPoint(a,b,d);else if(this.isMounted())c.get(this.getLocation()).setMountPoint(a,b,d);else throw Error("This node does not have access to a transform component");return this};b.prototype.setOrigin=function(a,b,d){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._transformID).setOrigin(a,b,d);else if(this.isMounted())c.get(this.getLocation()).setOrigin(a,b,d);else throw Error("This node does not have access to a transform component");
return this};b.prototype.setPosition=function(a,b,d){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._transformID).setPosition(a,b,d);else if(this.isMounted())c.get(this.getLocation()).setPosition(a,b,d);else throw Error("This node does not have access to a transform component");return this};b.prototype.setRotation=function(a,b,d,f){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._transformID).setRotation(a,b,d,f);else if(this.isMounted())c.get(this.getLocation()).setRotation(a,
b,d,f);else throw Error("This node does not have access to a transform component");return this};b.prototype.setScale=function(a,b,d){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._transformID).setScale(a,b,d);else if(this.isMounted())c.get(this.getLocation()).setScale(a,b,d);else throw Error("This node does not have access to a transform component");return this};b.prototype.setOpacity=function(a){if(a!==this._opacity){this._opacity=a;this._requestingUpdate||this._requestUpdate();
for(var b=0,d=this._components,f=d.length,c;b<f;b++)if((c=d[b])&&c.onOpacityChange)c.onOpacityChange(a)}return this};b.prototype.setSizeMode=function(b,d,f){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._sizeID).setSizeMode(b,d,f);else if(this.isMounted())a.get(this.getLocation()).setSizeMode(b,d,f);else throw Error("This node does not have access to a size component");return this};b.prototype.setProportionalSize=function(b,d,f){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._sizeID).setProportional(b,
d,f);else if(this.isMounted())a.get(this.getLocation()).setProportional(b,d,f);else throw Error("This node does not have access to a size component");return this};b.prototype.setDifferentialSize=function(b,d,f){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._sizeID).setDifferential(b,d,f);else if(this.isMounted())a.get(this.getLocation()).setDifferential(b,d,f);else throw Error("This node does not have access to a size component");return this};b.prototype.setAbsoluteSize=function(b,
d,f){if(this.constructor.INIT_DEFAULT_COMPONENTS)this.getComponent(this._sizeID).setAbsolute(b,d,f);else if(this.isMounted())a.get(this.getLocation()).setAbsolute(b,d,f);else throw Error("This node does not have access to a size component");return this};b.prototype.getFrame=function(){return this._updater.getFrame()};b.prototype.getComponents=function(){return this._components};b.prototype.update=function(a){this._inUpdate=!0;var b;if(this.onUpdate)this.onUpdate();for(;this._nextUpdateQueue&&this._nextUpdateQueue.length;)this._updateQueue.unshift(this._nextUpdateQueue.pop());
for(;this._updateQueue&&this._updateQueue.length;)if((b=this._components[this._updateQueue.shift()])&&b.onUpdate)b.onUpdate(a);this._requestingUpdate=this._inUpdate=!1;this.isMounted()?this._nextUpdateQueue.length&&(this._updater.requestUpdateOnNextTick(this),this._requestingUpdate=!0):this._id=this._parent=null;return this};b.prototype.mount=function(b){if(this.isMounted())throw Error("Node is already mounted at: "+this.getLocation());this.constructor.INIT_DEFAULT_COMPONENTS?(c.registerTransformAtPath(b,
this.getComponent(this._transformID)),a.registerSizeAtPath(b,this.getComponent(this._sizeID))):(c.registerTransformAtPath(b),a.registerSizeAtPath(b));d.mount(b,this);this._requestingUpdate||this._requestUpdate();return this};b.prototype.dismount=function(){if(!this.isMounted())throw Error("Node is not mounted");var b=this.getLocation();c.deregisterTransformAtPath(b);a.deregisterSizeAtPath(b);d.dismount(b);this._requestingUpdate||this._requestUpdate();return this};h.exports=b},{"./Dispatch":6,"./Size":13,
"./SizeSystem":14,"./Transform":15,"./TransformSystem":16}],10:[function(e,h,v){function b(){}b.prototype.hasTrailingSlash=function(a){return"/"===a[a.length-1]};b.prototype.depth=function(a){for(var b=0,c=a.length,c=this.hasTrailingSlash(a)?c-1:c,f=0;f<c;f++)b+="/"===a[f]?1:0;return b};b.prototype.index=function(a){for(var b=this.hasTrailingSlash(a)?a.length-1:a.length;b--&&"/"!==a[b];);a=parseInt(a.substring(b+1));return isNaN(a)?0:a};b.prototype.indexAtDepth=function(a,b){for(var c=0,f=a.length,
k=0;c<f;c++)if("/"===a[c]&&k++,k===b){a=a.substring(c?c+1:c);k=a.indexOf("/");a=-1===k?a:a.substring(0,k);k=parseInt(a);break}return isNaN(k)?a:k};b.prototype.parent=function(a){return a.substring(0,a.lastIndexOf("/",a.length-2))};b.prototype.isChildOf=function(a,b){return this.isDescendentOf(a,b)&&this.depth(a)===this.depth(b)+1};b.prototype.isDescendentOf=function(a,b){if(a===b)return!1;a=this.hasTrailingSlash(a)?a:a+"/";b=this.hasTrailingSlash(b)?b:b+"/";return this.depth(b)<this.depth(a)&&0===
a.indexOf(b)};b.prototype.getSelector=function(a){var b=a.indexOf("/");return-1===b?a:a.substring(0,b)};h.exports=new b},{}],11:[function(e,h,v){function b(){this.items=[];this.paths=[];this.memo={}}var a=e("./Path");b.prototype.insert=function(b,c){var f=this.paths;if(-1!==f.indexOf(b))throw Error("item already exists at path: "+b);for(var k=0,g=a.depth(b),q=a.index(b);f[k]&&g>=a.depth(f[k]);)k++;for(;f[k]&&g===a.depth(f[k])&&q<a.index(f[k]);)k++;f.splice(k,0,b);this.items.splice(k,0,c);this.memo[b]=
k;for(f=this.paths.length;k<f;k++)this.memo[this.paths[k]]=null};b.prototype.remove=function(a){var b=this.paths,f=this.memo[a]?this.memo[a]:b.indexOf(a);if(-1===f)throw Error("Cannot remove. No item exists at path: "+a);b.splice(f,1);this.items.splice(f,1);this.memo[a]=null;for(a=this.paths.length;f<a;f++)this.memo[this.paths[f]]=null};b.prototype.get=function(a){if(this.memo[a])return this.items[this.memo[a]];var b=this.paths.indexOf(a);if(-1!==b)return this.memo[a]=b,this.items[b]};b.prototype.getItems=
function(){return this.items};b.prototype.getPaths=function(){return this.paths};h.exports=b},{"./Path":10}],12:[function(e,h,v){function b(b,d){if(!b)throw Error("Scene needs to be created with a DOM selector");if(!d)throw Error("Scene needs to be created with a class like Famous");a.call(this);this._globalUpdater=d;this._selector=b;this.mount(b);this._globalUpdater.message(c.NEED_SIZE_FOR).message(b);this.show()}var a=e("./Node"),d=e("./Dispatch"),c=e("./Commands"),f=e("./TransformSystem"),k=e("./SizeSystem");
b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.getUpdater=function(){return this._updater};b.prototype.getSelector=function(){return this._selector};b.prototype.getDispatch=function(){console.warn("Scene#getDispatch is deprecated, require the dispatch directly");return d};b.prototype.onReceive=function(a,b){if("CONTEXT_RESIZE"===a){if(2>b.length)throw Error("CONTEXT_RESIZE's payload needs to be at least a pair of pixel sizes");this.setSizeMode("absolute","absolute","absolute");
this.setAbsoluteSize(b[0],b[1],b[2]?b[2]:0);this._updater.message(c.WITH).message(this._selector).message(c.READY)}};b.prototype.mount=function(a){if(this.isMounted())throw Error("Scene is already mounted at: "+this.getLocation());d.mount(a,this);this._id=a;this._mounted=!0;this._parent=this;f.registerTransformAtPath(a);k.registerSizeAtPath(a)};h.exports=b},{"./Commands":5,"./Dispatch":6,"./Node":9,"./SizeSystem":14,"./TransformSystem":16}],13:[function(e,h,v){function b(a){this.finalSize=new Float32Array(3);
this.sizeChanged=!1;this.sizeMode=new Uint8Array(3);this.sizeModeChanged=!1;this.absoluteSize=new Float32Array(3);this.absoluteSizeChanged=!1;this.proportionalSize=new Float32Array(f);this.proportionalSizeChanged=!1;this.differentialSize=new Float32Array(3);this.differentialSizeChanged=!1;this.renderSize=new Float32Array(3);this.renderSizeChanged=!1;this.parent=null!=a?a:null}function a(a,b,d){return null!=d&&a[b]!==d?(a[b]=d,!0):!1}function d(b,d,f,c){var k=!1,k=a(b,0,d)||k,k=a(b,1,f)||k;return k=
a(b,2,c)||k}function c(a){if(a.constructor===String)switch(a.toLowerCase()){case "relative":case "default":return b.RELATIVE;case "absolute":return b.ABSOLUTE;case "render":return b.RENDER;default:throw Error("unknown size mode: "+a);}else if(0>a||a>b.RENDER)throw Error("unknown size mode: "+a);return a}var f=[1,1,1],k=[0,0,0];b.RELATIVE=0;b.ABSOLUTE=1;b.RENDER=2;b.DEFAULT=b.RELATIVE;b.prototype.setParent=function(a){this.parent=a;return this};b.prototype.getParent=function(){return this.parent};
b.prototype.setSizeMode=function(a,b,f){null!=a&&(a=c(a));null!=b&&(b=c(b));null!=f&&(f=c(f));this.sizeModeChanged=d(this.sizeMode,a,b,f);return this};b.prototype.getSizeMode=function(){return this.sizeMode};b.prototype.setAbsolute=function(a,b,f){this.absoluteSizeChanged=d(this.absoluteSize,a,b,f);return this};b.prototype.getAbsolute=function(){return this.absoluteSize};b.prototype.setProportional=function(a,b,f){this.proportionalSizeChanged=d(this.proportionalSize,a,b,f);return this};b.prototype.getProportional=
function(){return this.proportionalSize};b.prototype.setDifferential=function(a,b,f){this.differentialSizeChanged=d(this.differentialSize,a,b,f);return this};b.prototype.getDifferential=function(){return this.differentialSize};b.prototype.get=function(){return this.finalSize};b.prototype.fromComponents=function(a){for(var d=this.sizeMode,f=this.finalSize,c=this.parent?this.parent.get():k,p,t=!1,m=a.length,A,r=0;3>r;r++){p=f[r];switch(d[r]){case b.RELATIVE:f[r]=c[r]*this.proportionalSize[r]+this.differentialSize[r];
break;case b.ABSOLUTE:f[r]=this.absoluteSize[r];break;case b.RENDER:var u;for(A=0;A<m;A++)(u=a[A])&&u.getRenderSize&&(u=u.getRenderSize()[r],f[r]=f[r]<u||0===f[r]?u:f[r])}t=t||p!==f[r]}return this.sizeChanged=t};h.exports=b},{}],14:[function(e,h,v){function b(){this.pathStore=new a}var a=e("./PathStore"),d=e("./Size"),c=e("./Dispatch"),f=e("./Path");b.prototype.registerSizeAtPath=function(a,b){if(!f.depth(a))return this.pathStore.insert(a,b?b:new d);var q=this.pathStore.get(f.parent(a));if(!q)throw Error("No parent size registered at expected path: "+
f.parent(a));b&&b.setParent(q);this.pathStore.insert(a,b?b:new d(q))};b.prototype.deregisterSizeAtPath=function(a){this.pathStore.remove(a)};b.prototype.get=function(a){return this.pathStore.get(a)};b.prototype.update=function(){var a=this.pathStore.getItems(),b=this.pathStore.getPaths(),d,f,n,p,t;n=0;for(p=a.length;n<p;n++)if(d=c.getNode(b[n]),t=d.getComponents(),d){f=a[n];if(f.sizeModeChanged){var m=d,A=t,r=f,u=r.getSizeMode(),e=u[0],y=u[1],u=u[2];if(m.onSizeModeChange)m.onSizeModeChange(e,y,u);
for(var m=0,z=A.length;m<z;m++)if(A[m]&&A[m].onSizeModeChange)A[m].onSizeModeChange(e,y,u);r.sizeModeChanged=!1}if(f.absoluteSizeChanged){m=d;A=t;r=f;u=r.getAbsolute();e=u[0];y=u[1];u=u[2];if(m.onAbsoluteSizeChange)m.onAbsoluteSizeChange(e,y,u);m=0;for(z=A.length;m<z;m++)if(A[m]&&A[m].onAbsoluteSizeChange)A[m].onAbsoluteSizeChange(e,y,u);r.absoluteSizeChanged=!1}if(f.proportionalSizeChanged){m=d;A=t;r=f;u=r.getProportional();e=u[0];y=u[1];u=u[2];if(m.onProportionalSizeChange)m.onProportionalSizeChange(e,
y,u);m=0;for(z=A.length;m<z;m++)if(A[m]&&A[m].onProportionalSizeChange)A[m].onProportionalSizeChange(e,y,u);r.proportionalSizeChanged=!1}if(f.differentialSizeChanged){m=d;A=t;r=f;u=r.getDifferential();e=u[0];y=u[1];u=u[2];if(m.onDifferentialSizeChange)m.onDifferentialSizeChange(e,y,u);m=0;for(z=A.length;m<z;m++)if(A[m]&&A[m].onDifferentialSizeChange)A[m].onDifferentialSizeChange(e,y,u);r.differentialSizeChanged=!1}if(f.renderSizeChanged){m=d;A=t;r=f;u=r.getRenderSize();e=u[0];y=u[1];u=u[2];if(m.onRenderSizeChange)m.onRenderSizeChange(e,
y,u);m=0;for(z=A.length;m<z;m++)if(A[m]&&A[m].onRenderSizeChange)A[m].onRenderSizeChange(e,y,u);r.renderSizeChanged=!1}if(f.fromComponents(t)){e=f.get();A=e[0];r=e[1];e=e[2];if(d.onSizeChange)d.onSizeChange(A,r,e);d=0;for(y=t.length;d<y;d++)if(t[d]&&t[d].onSizeChange)t[d].onSizeChange(A,r,e);f.sizeChanged=!1}}};h.exports=new b},{"./Dispatch":6,"./Path":10,"./PathStore":11,"./Size":13}],15:[function(e,h,v){function b(a){this.local=new Float32Array(b.IDENT);this.global=new Float32Array(b.IDENT);this.offsets=
{align:new Float32Array(3),alignChanged:!1,mountPoint:new Float32Array(3),mountPointChanged:!1,origin:new Float32Array(3),originChanged:!1};this.vectors={position:new Float32Array(3),positionChanged:!1,rotation:new Float32Array(c),rotationChanged:!1,scale:new Float32Array(f),scaleChanged:!1};this._lastEulerVals=[0,0,0];this._lastEuler=!1;this.parent=a?a:null;this.breakPoint=!1}function a(a,b,d){return null!=d&&a[b]!==d?(a[b]=d,!0):!1}function d(b,d,f,c,n){var p=!1,p=a(b,0,d)||p,p=a(b,1,f)||p,p=a(b,
2,c)||p;null!=n&&(p=a(b,3,n)||p);return p}var c=[0,0,0,1],f=[1,1,1];b.IDENT=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];b.WORLD_CHANGED=1;b.LOCAL_CHANGED=2;b.prototype.reset=function(){this.parent=null;this.breakPoint=!1};b.prototype.setParent=function(a){this.parent=a};b.prototype.getParent=function(){return this.parent};b.prototype.setBreakPoint=function(){this.breakPoint=!0};b.prototype.isBreakPoint=function(){return this.breakPoint};b.prototype.getLocalTransform=function(){return this.local};b.prototype.getWorldTransform=
function(){if(!this.isBreakPoint())throw Error("This transform is not calculating world transforms");return this.global};b.prototype.calculate=function(a){if(!this.parent||this.parent.isBreakPoint()){var d=this.getLocalTransform(),f=a.getSize(),c=this.vectors,n=this.offsets,p=a.getParent().getSize(),t=0,m=d[0],A=d[1],r=d[2],u=d[4],e=d[5],y=d[6],z=d[8],x=d[9],B=d[10],O=d[12],h=d[13],I=d[14],w=c.position[0],J=c.position[1],H=c.position[2],G=c.rotation[0],F=c.rotation[1],D=c.rotation[2],C=c.rotation[3],
E=c.scale[0],K=c.scale[1],M=c.scale[2],Q=n.align[0]*p[0],S=n.align[1]*p[1],v=n.align[2]*p[2],W=n.mountPoint[0]*f[0],T=n.mountPoint[1]*f[1],ha=n.mountPoint[2]*f[2],X=n.origin[0]*f[0],Y=n.origin[1]*f[1],Z=n.origin[2]*f[2],ba=C*G,ca=C*F,La=C*D,Ma=G*G,Na=F*F,Oa=D*D,Pa=G*F,Qa=G*D,Ra=F*D;d[0]=(1-2*(Na+Oa))*E;d[1]=2*(Pa+La)*E;d[2]=2*(Qa-ca)*E;d[3]=0;d[4]=2*(Pa-La)*K;d[5]=(1-2*(Ma+Oa))*K;d[6]=2*(Ra+ba)*K;d[7]=0;d[8]=2*(Qa+ca)*M;d[9]=2*(Ra-ba)*M;d[10]=(1-2*(Ma+Na))*M;d[11]=0;d[12]=Q+w-W+X-(d[0]*X+d[4]*Y+d[8]*
Z);d[13]=S+J-T+Y-(d[1]*X+d[5]*Y+d[9]*Z);d[14]=v+H-ha+Z-(d[2]*X+d[6]*Y+d[10]*Z);d[15]=1;this.isBreakPoint()&&this.calculateWorldMatrix()&&(t|=b.WORLD_CHANGED);if(m!==d[0]||A!==d[1]||r!==d[2]||u!==d[4]||e!==d[5]||y!==d[6]||z!==d[8]||x!==d[9]||B!==d[10]||O!==d[12]||h!==d[13]||I!==d[14])t|=b.LOCAL_CHANGED;return t}var P=this.getLocalTransform(),R=this.parent.getLocalTransform(),aa=a.getSize(),U=this.vectors,V=this.offsets,Da=a.getParent().getSize(),da=!1,ab=P[0],bb=P[1],cb=P[2],db=P[4],eb=P[5],fb=P[6],
gb=P[8],hb=P[9],ib=P[10],jb=P[12],kb=P[13],lb=P[14],ia=R[0],ja=R[1],ka=R[2],la=R[4],ma=R[5],na=R[6],oa=R[8],pa=R[9],qa=R[10],mb=R[12],nb=R[13],ob=R[14],ea=U.rotation[0],fa=U.rotation[1],ga=U.rotation[2],Ea=U.rotation[3],Fa=U.scale[0],Ga=U.scale[1],Ha=U.scale[2],ra=V.origin[0]*aa[0],sa=V.origin[1]*aa[1],ta=V.origin[2]*aa[2],Sa=Ea*ea,Ta=Ea*fa,Ua=Ea*ga,Va=ea*ea,Wa=fa*fa,Xa=ga*ga,Ya=ea*fa,Za=ea*ga,$a=fa*ga,ua=(1-2*(Wa+Xa))*Fa,va=2*(Ya+Ua)*Fa,wa=2*(Za-Ta)*Fa,xa=2*(Ya-Ua)*Ga,ya=(1-2*(Va+Xa))*Ga,za=2*($a+
Sa)*Ga,Aa=2*(Za+Ta)*Ha,Ba=2*($a-Sa)*Ha,Ca=(1-2*(Va+Wa))*Ha,Ia=V.align[0]*Da[0]+U.position[0]-V.mountPoint[0]*aa[0]+ra-(ua*ra+xa*sa+Aa*ta),Ja=V.align[1]*Da[1]+U.position[1]-V.mountPoint[1]*aa[1]+sa-(va*ra+ya*sa+Ba*ta),Ka=V.align[2]*Da[2]+U.position[2]-V.mountPoint[2]*aa[2]+ta-(wa*ra+za*sa+Ca*ta);P[0]=ia*ua+la*va+oa*wa;P[1]=ja*ua+ma*va+pa*wa;P[2]=ka*ua+na*va+qa*wa;P[3]=0;P[4]=ia*xa+la*ya+oa*za;P[5]=ja*xa+ma*ya+pa*za;P[6]=ka*xa+na*ya+qa*za;P[7]=0;P[8]=ia*Aa+la*Ba+oa*Ca;P[9]=ja*Aa+ma*Ba+pa*Ca;P[10]=ka*
Aa+na*Ba+qa*Ca;P[11]=0;P[12]=ia*Ia+la*Ja+oa*Ka+mb;P[13]=ja*Ia+ma*Ja+pa*Ka+nb;P[14]=ka*Ia+na*Ja+qa*Ka+ob;P[15]=1;this.isBreakPoint()&&this.calculateWorldMatrix()&&(da|=b.WORLD_CHANGED);if(ab!==P[0]||bb!==P[1]||cb!==P[2]||db!==P[4]||eb!==P[5]||fb!==P[6]||gb!==P[8]||hb!==P[9]||ib!==P[10]||jb!==P[12]||kb!==P[13]||lb!==P[14])da|=b.LOCAL_CHANGED;return da};b.prototype.getPosition=function(){return this.vectors.position};b.prototype.setPosition=function(a,b,f){this.vectors.positionChanged=d(this.vectors.position,
a,b,f)};b.prototype.getRotation=function(){return this.vectors.rotation};b.prototype.setRotation=function(a,b,f,c){var n=this.vectors.rotation,p,t,m;if(null!=c)p=a,t=b,m=f,this._lastEulerVals[0]=null,this._lastEulerVals[1]=null,this._lastEulerVals[2]=null,this._lastEuler=!1;else{if(null==a||null==b||null==f)this._lastEuler?(a=null==a?this._lastEulerVals[0]:a,b=null==b?this._lastEulerVals[1]:b,f=null==f?this._lastEulerVals[2]:f):(c=-2*(n[1]*n[2]-n[3]*n[0]),.99999<Math.abs(c)?(b=null==b?.5*Math.PI*
c:b,a=null==a?Math.atan2(-n[0]*n[2]+n[3]*n[1],.5-n[1]*n[1]-n[2]*n[2]):a,f=null==f?0:f):(b=null==b?Math.asin(c):b,a=null==a?Math.atan2(n[0]*n[2]+n[3]*n[1],.5-n[0]*n[0]-n[1]*n[1]):a,f=null==f?Math.atan2(n[0]*n[1]+n[3]*n[2],.5-n[0]*n[0]-n[2]*n[2]):f));var A=.5*a;m=.5*b;var r=.5*f;c=Math.sin(A);p=Math.sin(m);t=Math.sin(r);var A=Math.cos(A),u=Math.cos(m),e=Math.cos(r),r=p*t;m=u*t;var y=p*e,u=u*e;p=c*u+A*r;t=A*y-c*m;m=A*m+c*y;c=A*u-c*r;this._lastEuler=!0;this._lastEulerVals[0]=a;this._lastEulerVals[1]=
b;this._lastEulerVals[2]=f}this.vectors.rotationChanged=d(n,p,t,m,c)};b.prototype.getScale=function(){return this.vectors.scale};b.prototype.setScale=function(a,b,f){this.vectors.scaleChanged=d(this.vectors.scale,a,b,f)};b.prototype.getAlign=function(){return this.offsets.align};b.prototype.setAlign=function(a,b,f){this.offsets.alignChanged=d(this.offsets.align,a,b,null!=f?f-.5:f)};b.prototype.getMountPoint=function(){return this.offsets.mountPoint};b.prototype.setMountPoint=function(a,b,f){this.offsets.mountPointChanged=
d(this.offsets.mountPoint,a,b,null!=f?f-.5:f)};b.prototype.getOrigin=function(){return this.offsets.origin};b.prototype.setOrigin=function(a,b,f){this.offsets.originChanged=d(this.offsets.origin,a,b,null!=f?f-.5:f)};b.prototype.calculateWorldMatrix=function(){for(var a=this.parent;a&&!a.isBreakPoint();)a=a.parent;if(a){var b=this.global,d=a.getWorldTransform(),a=this.local,f=d[0],c=d[1],p=d[2],t=d[4],m=d[5],A=d[6],r=d[8],u=d[9],e=d[10],y=d[12],z=d[13],d=d[14],x=!1,B,O=a[0],h=a[1],I=a[2],w=a[3];B=
O*f+h*t+I*r+w*y;x=x?x:b[0]===B;b[0]=B;B=O*c+h*m+I*u+w*z;x=x?x:b[1]===B;b[1]=B;B=O*p+h*A+I*e+w*d;x=x?x:b[2]===B;b[2]=B;b[3]=0;O=a[4];h=a[5];I=a[6];w=a[7];B=O*f+h*t+I*r+w*y;x=x?x:b[4]===B;b[4]=B;B=O*c+h*m+I*u+w*z;x=x?x:b[5]===B;b[5]=B;B=O*p+h*A+I*e+w*d;x=x?x:b[6]===B;b[6]=B;b[7]=0;O=a[8];h=a[9];I=a[10];w=a[11];B=O*f+h*t+I*r+w*y;x=x?x:b[8]===B;b[8]=B;B=O*c+h*m+I*u+w*z;x=x?x:b[9]===B;b[9]=B;B=O*p+h*A+I*e+w*d;x=x?x:b[10]===B;b[10]=B;b[11]=0;O=a[12];h=a[13];I=a[14];w=a[15];B=O*f+h*t+I*r+w*y;x=x?x:b[12]===
B;b[12]=B;B=O*c+h*m+I*u+w*z;x=x?x:b[13]===B;b[13]=B;B=O*p+h*A+I*e+w*d;x=x?x:b[14]===B;b[14]=B;b[15]=1;return x}for(b=0;16>b;b++)this.global[b]=this.local[b];return!1};h.exports=b},{}],16:[function(e,h,v){function b(){this.pathStore=new f}var a=e("./Path"),d=e("./Transform"),c=e("./Dispatch"),f=e("./PathStore");b.prototype.registerTransformAtPath=function(b,f){if(!a.depth(b))return this.pathStore.insert(b,f?f:new d);var c=this.pathStore.get(a.parent(b));if(!c)throw Error("No parent transform registered at expected path: "+
a.parent(b));f&&f.setParent(c);this.pathStore.insert(b,f?f:new d(c))};b.prototype.deregisterTransformAtPath=function(a){this.pathStore.remove(a)};b.prototype.makeBreakPointAt=function(a){var b=this.pathStore.get(a);if(!b)throw Error("No transform Registered at path: "+a);b.setBreakPoint()};b.prototype.get=function(a){return this.pathStore.get(a)};b.prototype.onUpdate=function(){for(var a=this.pathStore.getItems(),b=this.pathStore.getPaths(),f,l,n,p,t,m=0,A=a.length;m<A;m++)if(n=c.getNode(b[m])){t=
n.getComponents();f=a[m];l=f.vectors;p=f.offsets;if(p.alignChanged){var r=t,u=p,e=u.align[0],y=u.align[1],z=u.align[2];if(n.onAlignChange)n.onAlignChange(e,y,z);for(var x=0,B=r.length;x<B;x++)if(r[x]&&r[x].onAlignChange)r[x].onAlignChange(e,y,z);u.alignChanged=!1}if(p.mountPointChanged){r=t;u=p;e=u.mountPoint[0];y=u.mountPoint[1];z=u.mountPoint[2];if(n.onMountPointChange)n.onMountPointChange(e,y,z);x=0;for(B=r.length;x<B;x++)if(r[x]&&r[x].onMountPointChange)r[x].onMountPointChange(e,y,z);u.mountPointChanged=
!1}if(p.originChanged){r=t;u=p.origin[0];e=p.origin[1];y=p.origin[2];if(n.onOriginChange)n.onOriginChange(u,e,y);z=0;for(x=r.length;z<x;z++)if(r[z]&&r[z].onOriginChange)r[z].onOriginChange(u,e,y);p.originChanged=!1}if(l.positionChanged){p=t;r=l;u=r.position[0];e=r.position[1];y=r.position[2];if(n.onPositionChange)n.onPositionChange(u,e,y);z=0;for(x=p.length;z<x;z++)if(p[z]&&p[z].onPositionChange)p[z].onPositionChange(u,e,y);r.positionChanged=!1}if(l.rotationChanged){p=t;r=l;u=r.rotation[0];e=r.rotation[1];
y=r.rotation[2];z=r.rotation[3];if(n.onRotationChange)n.onRotationChange(u,e,y,z);x=0;for(B=p.length;x<B;x++)if(p[x]&&p[x].onRotationChange)p[x].onRotationChange(u,e,y,z);r.rotationChanged=!1}if(l.scaleChanged){p=t;r=l.scale[0];u=l.scale[1];e=l.scale[2];if(n.onScaleChange)n.onScaleChange(r,u,e);y=0;for(z=p.length;y<z;y++)if(p[y]&&p[y].onScaleChange)p[y].onScaleChange(r,u,e);l.scaleChanged=!1}if(l=f.calculate(n)){p=t;r=f;if(n.onTransformChange)n.onTransformChange(r);u=0;for(e=p.length;u<e;u++)if(p[u]&&
p[u].onTransformChange)p[u].onTransformChange(r);if(l&d.LOCAL_CHANGED){p=t;r=f.getLocalTransform();if(n.onLocalTransformChange)n.onLocalTransformChange(r);u=0;for(e=p.length;u<e;u++)if(p[u]&&p[u].onLocalTransformChange)p[u].onLocalTransformChange(r)}if(l&d.WORLD_CHANGED){f=f.getWorldTransform();if(n.onWorldTransformChange)n.onWorldTransformChange(f);n=0;for(l=t.length;n<l;n++)if(t[n]&&t[n].onWorldTransformChange)t[n].onWorldTransformChange(f)}}}};h.exports=new b},{"./Dispatch":6,"./Path":10,"./PathStore":11,
"./Transform":15}],17:[function(e,h,v){function b(b,d){if(!b)throw Error("DOMElement must be instantiated on a node");this._changeQueue=[];this._requestRenderSize=this._renderSized=this._requestingUpdate=!1;this._UIEvents=b.getUIEvents().slice(0);this._classes=["famous-dom-element"];this._requestingEventListeners=[];this._styles={};this._attributes={};this._content="";this._tagName=d&&d.tagName?d.tagName:"div";this._renderSize=[0,0,0];this._id=b?b.addComponent(this):null;this._node=b;this.onSizeModeChange.apply(this,
b.getSizeMode());this._callbacks=new a;this.setProperty("display",b.isShown()?"block":"none");this.onOpacityChange(b.getOpacity());if(d){var c,q;if(d.classes)for(c=0;c<d.classes.length;c++)this.addClass(d.classes[c]);if(d.attributes)for(q in d.attributes)this.setAttribute(q,d.attributes[q]);if(d.properties)for(q in d.properties)this.setProperty(q,d.properties[q]);d.id&&this.setId(d.id);d.content&&this.setContent(d.content);!1===d.cutout&&this.setCutoutState(d.cutout)}}var a=e("../utilities/CallbackStore"),
d=e("../core/TransformSystem"),c=e("../core/Commands");b.prototype.getValue=function(){return{classes:this._classes,styles:this._styles,attributes:this._attributes,content:this._content,id:this._attributes.id,tagName:this._tagName}};b.prototype.onUpdate=function(){var a=this._node,b=this._changeQueue,d=b.length;if(d&&a){a.sendDrawCommand(c.WITH);for(a.sendDrawCommand(a.getLocation());d--;)a.sendDrawCommand(b.shift());this._requestRenderSize&&(a.sendDrawCommand(c.DOM_RENDER_SIZE),a.sendDrawCommand(a.getLocation()),
this._requestRenderSize=!1)}this._requestingUpdate=!1};b.prototype.onMount=function(a,b){this._node=a;this._id=b;this._UIEvents=a.getUIEvents().slice(0);d.makeBreakPointAt(a.getLocation());this.draw();this.setAttribute("data-fa-path",a.getLocation())};b.prototype.onDismount=function(){this.setProperty("display","none");this.setAttribute("data-fa-path","");this.setCutoutState(!1);this.onUpdate();this._initialized=!1};b.prototype.remove=function(){var a=document.querySelector('[data-fa-path="'+this._attributes["data-fa-path"]+
'"');a&&a.remove();this.setCutoutState(!1);this.onUpdate();this._initialized=!1};b.prototype.onShow=function(){this.setProperty("display","block")};b.prototype.onHide=function(){this.setProperty("display","none")};b.prototype.setCutoutState=function(a){this._initialized&&this._changeQueue.push(c.GL_CUTOUT_STATE,a);this._requestingUpdate||this._requestUpdate();return this};b.prototype.onTransformChange=function(a){this._changeQueue.push(c.CHANGE_TRANSFORM);a=a.getLocalTransform();for(var b=0,d=a.length;b<
d;b++)this._changeQueue.push(a[b]);this._requestingUpdate||this._requestUpdate()};b.prototype.onSizeChange=function(a,b){var d=this._node.getSizeMode(),q=2!==d[0],d=2!==d[1];this._initialized&&this._changeQueue.push(c.CHANGE_SIZE,q?a:q,d?b:d);this._requestingUpdate||this._requestUpdate();return this};b.prototype.onOpacityChange=function(a){return this.setProperty("opacity",a)};b.prototype.onAddUIEvent=function(a){-1===this._UIEvents.indexOf(a)?(this._subscribe(a),this._UIEvents.push(a)):this._inDraw&&
this._subscribe(a);return this};b.prototype.onRemoveUIEvent=function(a){var b=this._UIEvents.indexOf(a);-1!==b?(this._unsubscribe(a),this._UIEvents.splice(b,1)):this._inDraw&&this._unsubscribe(a);return this};b.prototype._subscribe=function(a){this._initialized&&this._changeQueue.push(c.SUBSCRIBE,a);this._requestingUpdate||this._requestUpdate()};b.prototype.preventDefault=function(a){this._initialized&&this._changeQueue.push(c.PREVENT_DEFAULT,a);this._requestingUpdate||this._requestUpdate()};b.prototype.allowDefault=
function(a){this._initialized&&this._changeQueue.push(c.ALLOW_DEFAULT,a);this._requestingUpdate||this._requestUpdate()};b.prototype._unsubscribe=function(a){this._initialized&&this._changeQueue.push("UNSUBSCRIBE",a);this._requestingUpdate||this._requestUpdate()};b.prototype.onSizeModeChange=function(a,b,d){if(2===a||2===b||2===d)this._requestRenderSize=this._renderSized=!0;a=this._node.getSize();this.onSizeChange(a[0],a[1])};b.prototype.getRenderSize=function(){return this._renderSize};b.prototype._requestUpdate=
function(){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0)};b.prototype.init=function(){this._changeQueue.push(c.INIT_DOM,this._tagName);this._initialized=!0;this.onTransformChange(d.get(this._node.getLocation()));var a=this._node.getSize();this.onSizeChange(a[0],a[1]);this._requestingUpdate||this._requestUpdate()};b.prototype.setId=function(a){this.setAttribute("id",a);return this};b.prototype.addClass=function(a){if(0>this._classes.indexOf(a))return this._initialized&&
this._changeQueue.push(c.ADD_CLASS,a),this._classes.push(a),this._requestingUpdate||this._requestUpdate(),this._renderSized&&(this._requestRenderSize=!0),this;this._inDraw&&(this._initialized&&this._changeQueue.push(c.ADD_CLASS,a),this._requestingUpdate||this._requestUpdate());return this};b.prototype.removeClass=function(a){var b=this._classes.indexOf(a);if(0>b)return this;this._changeQueue.push(c.REMOVE_CLASS,a);this._classes.splice(b,1);this._requestingUpdate||this._requestUpdate();return this};
b.prototype.hasClass=function(a){return-1!==this._classes.indexOf(a)};b.prototype.setAttribute=function(a,b){if(this._attributes[a]!==b||this._inDraw)this._attributes[a]=b,this._initialized&&this._changeQueue.push(c.CHANGE_ATTRIBUTE,a,b),this._requestUpdate||this._requestUpdate();return this};b.prototype.setProperty=function(a,b){if(this._styles[a]!==b||this._inDraw)this._styles[a]=b,this._initialized&&this._changeQueue.push(c.CHANGE_PROPERTY,a,b),this._requestingUpdate||this._requestUpdate(),this._renderSized&&
(this._requestRenderSize=!0);return this};b.prototype.setContent=function(a){if(this._content!==a||this._inDraw)this._content=a,this._initialized&&this._changeQueue.push(c.CHANGE_CONTENT,a),this._requestingUpdate||this._requestUpdate(),this._renderSized&&(this._requestRenderSize=!0);return this};b.prototype.on=function(a,b){return this._callbacks.on(a,b)};b.prototype.onReceive=function(a,b){"resize"===a&&(this._renderSize[0]=b.val[0],this._renderSize[1]=b.val[1],this._requestingUpdate||this._requestUpdate());
this._callbacks.trigger(a,b)};b.prototype.draw=function(){var a,b,d;this._inDraw=!0;this.init();b=0;for(d=this._classes.length;b<d;b++)this.addClass(this._classes[b]);this._content&&this.setContent(this._content);for(a in this._styles)null!=this._styles[a]&&this.setProperty(a,this._styles[a]);for(a in this._attributes)null!=this._attributes[a]&&this.setAttribute(a,this._attributes[a]);b=0;for(d=this._UIEvents.length;b<d;b++)this.onAddUIEvent(this._UIEvents[b]);this._inDraw=!1};Element.prototype.remove=
function(){this.parentElement.removeChild(this)};NodeList.prototype.remove=HTMLCollection.prototype.remove=function(){for(var a=this.length-1;0<=a;a--)this[a]&&this[a].parentElement&&this[a].parentElement.removeChild(this[a])};h.exports=b},{"../core/Commands":5,"../core/TransformSystem":16,"../utilities/CallbackStore":74}],18:[function(e,h,v){function b(b,d,c){var k=this;b.classList.add("famous-dom-renderer");g=g||f("transform");this._compositor=c;this._path=this._parent=this._target=null;this._children=
[];this._root=new a(b,d);this._boundTriggerEvent=function(a){return k._triggerEvent(a)};this._selector=d;this._elements={};this._elements[d]=this._root;this.perspectiveTransform=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this._VPtransform=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this._lastEv=null}var a=e("./ElementCache"),d=e("./Math"),c=e("../core/Path"),f=e("../utilities/vendorPrefix"),k=e("./events/EventMap"),g=null;b.prototype.subscribe=function(a){this._assertTargetLoaded();
this._listen(a);this._target.subscribe[a]=!0};b.prototype.preventDefault=function(a){this._assertTargetLoaded();this._listen(a);this._target.preventDefault[a]=!0};b.prototype.allowDefault=function(a){this._assertTargetLoaded();this._listen(a);this._target.preventDefault[a]=!1};b.prototype._listen=function(a){this._assertTargetLoaded();if(!this._target.listeners[a]&&!this._root.listeners[a]){var b=k[a][1]?this._root:this._target;b.listeners[a]=this._boundTriggerEvent;b.element.addEventListener(a,this._boundTriggerEvent)}};
b.prototype.unsubscribe=function(a){this._assertTargetLoaded();this._target.subscribe[a]=!1};b.prototype._triggerEvent=function(a){if(this._lastEv!==a){var b;if(a.path)b=a.path;else{b=[];for(var d=a.target;d!==document.body;)b.push(d),d=d.parentNode}for(d=0;d<b.length;d++)if(b[d].dataset){var c=b[d].dataset.faPath;if(c&&(this._elements[c].preventDefault[a.type]&&a.preventDefault(),this._elements[c]&&this._elements[c].subscribe[a.type])){this._lastEv=a;this._compositor.sendEvent(c,a.type,new k[a.type][0](a));
break}}}};b.prototype.getSizeOf=function(a){var b=this._elements[a];if(!b)return null;b={val:b.size};this._compositor.sendEvent(a,"resize",b);return b};b.prototype.draw=function(a){a.perspectiveDirty&&(this.perspectiveDirty=!0,this.perspectiveTransform[0]=a.perspectiveTransform[0],this.perspectiveTransform[1]=a.perspectiveTransform[1],this.perspectiveTransform[2]=a.perspectiveTransform[2],this.perspectiveTransform[3]=a.perspectiveTransform[3],this.perspectiveTransform[4]=a.perspectiveTransform[4],
this.perspectiveTransform[5]=a.perspectiveTransform[5],this.perspectiveTransform[6]=a.perspectiveTransform[6],this.perspectiveTransform[7]=a.perspectiveTransform[7],this.perspectiveTransform[8]=a.perspectiveTransform[8],this.perspectiveTransform[9]=a.perspectiveTransform[9],this.perspectiveTransform[10]=a.perspectiveTransform[10],this.perspectiveTransform[11]=a.perspectiveTransform[11],this.perspectiveTransform[12]=a.perspectiveTransform[12],this.perspectiveTransform[13]=a.perspectiveTransform[13],
this.perspectiveTransform[14]=a.perspectiveTransform[14],this.perspectiveTransform[15]=a.perspectiveTransform[15]);if(a.viewDirty||a.perspectiveDirty)d.multiply(this._VPtransform,this.perspectiveTransform,a.viewTransform),this._root.element.style[g]=this._stringifyMatrix(this._VPtransform)};b.prototype._assertPathLoaded=function(){if(!this._path)throw Error("path not loaded");};b.prototype._assertParentLoaded=function(){if(!this._parent)throw Error("parent not loaded");};b.prototype._assertChildrenLoaded=
function(){if(!this._children)throw Error("children not loaded");};b.prototype._assertTargetLoaded=function(){if(!this._target)throw Error("No target loaded");};b.prototype.findParent=function(){this._assertPathLoaded();for(var a=this._path,b;!b&&a.length;)a=a.substring(0,a.lastIndexOf("/")),b=this._elements[a];return this._parent=b};b.prototype.findTarget=function(){return this._target=this._elements[this._path]};b.prototype.loadPath=function(a){return this._path=a};b.prototype.resolveChildren=function(a,
b){for(var d=0,f,g=this._path,k;f=b.childNodes[d];)f.dataset?(k=f.dataset.faPath)?c.isDescendentOf(k,g)?a.appendChild(f):d++:d++:d++};b.prototype.insertEl=function(b){if(!this._target||this._target.element.tagName.toLowerCase()!==b.toLowerCase()){this.findParent();this._assertParentLoaded();if(this._parent["void"])throw Error(this._parent.path+" is a void element. Void elements are not allowed to have children.");this._target&&this._parent.element.removeChild(this._target.element);this._target=new a(document.createElement(b),
this._path);this.resolveChildren(this._target.element,this._parent.element);this._parent.element.appendChild(this._target.element);this._elements[this._path]=this._target}};b.prototype.setProperty=function(a,b){this._assertTargetLoaded();this._target.element.style[a]=b};b.prototype.setSize=function(a,b){this._assertTargetLoaded();this.setWidth(a);this.setHeight(b)};b.prototype.setWidth=function(a){this._assertTargetLoaded();var b=this._target.content;!1===a?(this._target.explicitWidth=!0,b&&(b.style.width=
""),a=b?b.offsetWidth:0):(this._target.explicitWidth=!1,b&&(b.style.width=a+"px"));this._target.element.style.width=a+"px";this._target.size[0]=a};b.prototype.setHeight=function(a){this._assertTargetLoaded();var b=this._target.content;!1===a?(this._target.explicitHeight=!0,b&&(b.style.height=""),a=b?b.offsetHeight:0):(this._target.explicitHeight=!1,b&&(b.style.height=a+"px"));this._target.element.style.height=a+"px";this._target.size[1]=a};b.prototype.setAttribute=function(a,b){this._assertTargetLoaded();
this._target.element.setAttribute(a,b)};b.prototype.setContent=function(a){this._assertTargetLoaded();this._target.formElement?this._target.element.value=a:(this._target.content||(this._target.content=document.createElement("div"),this._target.content.classList.add("famous-dom-element-content"),this._target.element.insertBefore(this._target.content,this._target.element.firstChild)),this._target.content.innerHTML=a);this.setSize(this._target.explicitWidth?!1:this._target.size[0],this._target.explicitHeight?
!1:this._target.size[1])};b.prototype.setMatrix=function(a){this._assertTargetLoaded();this._target.element.style[g]=this._stringifyMatrix(a)};b.prototype.addClass=function(a){this._assertTargetLoaded();this._target.element.classList.add(a)};b.prototype.removeClass=function(a){this._assertTargetLoaded();this._target.element.classList.remove(a)};b.prototype._stringifyMatrix=function(a){var b;b="matrix3d("+(1E-6>a[0]&&-1E-6<a[0]?"0,":a[0]+",");b+=1E-6>a[1]&&-1E-6<a[1]?"0,":a[1]+",";b+=1E-6>a[2]&&-1E-6<
a[2]?"0,":a[2]+",";b+=1E-6>a[3]&&-1E-6<a[3]?"0,":a[3]+",";b+=1E-6>a[4]&&-1E-6<a[4]?"0,":a[4]+",";b+=1E-6>a[5]&&-1E-6<a[5]?"0,":a[5]+",";b+=1E-6>a[6]&&-1E-6<a[6]?"0,":a[6]+",";b+=1E-6>a[7]&&-1E-6<a[7]?"0,":a[7]+",";b+=1E-6>a[8]&&-1E-6<a[8]?"0,":a[8]+",";b+=1E-6>a[9]&&-1E-6<a[9]?"0,":a[9]+",";b+=1E-6>a[10]&&-1E-6<a[10]?"0,":a[10]+",";b+=1E-6>a[11]&&-1E-6<a[11]?"0,":a[11]+",";b+=1E-6>a[12]&&-1E-6<a[12]?"0,":a[12]+",";b+=1E-6>a[13]&&-1E-6<a[13]?"0,":a[13]+",";b+=1E-6>a[14]&&-1E-6<a[14]?"0,":a[14]+",";
return b+=a[15]+")"};h.exports=b},{"../core/Path":10,"../utilities/vendorPrefix":78,"./ElementCache":19,"./Math":20,"./events/EventMap":24}],19:[function(e,h,v){var b=e("./VoidElements");h.exports=function(a,d){this.tagName=a.tagName.toLowerCase();this["void"]=b[this.tagName];var c=a.constructor;this.formElement=c===HTMLInputElement||c===HTMLTextAreaElement||c===HTMLSelectElement;this.element=a;this.path=d;this.content=null;this.size=new Int16Array(3);this.explicitWidth=this.explicitHeight=!1;this.postRenderSize=
new Float32Array(2);this.listeners={};this.preventDefault={};this.subscribe={}}},{"./VoidElements":21}],20:[function(e,h,v){h.exports={multiply:function(b,a,d){var c=a[0],f=a[1],k=a[2],g=a[3],q=a[4],l=a[5],n=a[6],p=a[7],t=a[8],m=a[9],e=a[10],r=a[11],u=a[12],L=a[13],y=a[14];a=a[15];var z=d[0],x=d[1],B=d[2],h=d[3],N=d[4],I=d[5],w=d[6],J=d[7],H=d[8],G=d[9],F=d[10],D=d[11],C=d[12],E=d[13],K=d[14];d=d[15];b[0]=z*c+x*q+B*t+h*u;b[1]=z*f+x*l+B*m+h*L;b[2]=z*k+x*n+B*e+h*y;b[3]=z*g+x*p+B*r+h*a;z=N;x=I;B=w;h=
J;b[4]=z*c+x*q+B*t+h*u;b[5]=z*f+x*l+B*m+h*L;b[6]=z*k+x*n+B*e+h*y;b[7]=z*g+x*p+B*r+h*a;z=H;x=G;B=F;h=D;b[8]=z*c+x*q+B*t+h*u;b[9]=z*f+x*l+B*m+h*L;b[10]=z*k+x*n+B*e+h*y;b[11]=z*g+x*p+B*r+h*a;z=C;x=E;B=K;h=d;b[12]=z*c+x*q+B*t+h*u;b[13]=z*f+x*l+B*m+h*L;b[14]=z*k+x*n+B*e+h*y;b[15]=z*g+x*p+B*r+h*a;return b},invert:function(b,a){var d=a[0],c=a[1],f=a[2],k=a[3],g=a[4],q=a[5],l=a[6],n=a[7],p=a[8],t=a[9],m=a[10],e=a[11],r=a[12],u=a[13],L=a[14],y=a[15],z=d*q-c*g,x=d*l-f*g,B=d*n-k*g,h=c*l-f*q,N=c*n-k*q,I=f*n-
k*l,w=p*u-t*r,J=p*L-m*r,H=p*y-e*r,G=t*L-m*u,F=t*y-e*u,D=m*y-e*L,C=z*D-x*F+B*G+h*H-N*J+I*w;if(!C)return null;C=1/C;b[0]=(q*D-l*F+n*G)*C;b[1]=(f*F-c*D-k*G)*C;b[2]=(u*I-L*N+y*h)*C;b[3]=(m*N-t*I-e*h)*C;b[4]=(l*H-g*D-n*J)*C;b[5]=(d*D-f*H+k*J)*C;b[6]=(L*B-r*I-y*x)*C;b[7]=(p*I-m*B+e*x)*C;b[8]=(g*F-q*H+n*w)*C;b[9]=(c*H-d*F-k*w)*C;b[10]=(r*N-u*B+y*z)*C;b[11]=(t*B-p*N-e*z)*C;b[12]=(q*J-g*G-l*w)*C;b[13]=(d*G-c*J+f*w)*C;b[14]=(u*x-r*h-L*z)*C;b[15]=(p*h-t*x+m*z)*C;return b}}},{}],21:[function(e,h,v){h.exports=
{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}},{}],22:[function(e,h,v){function b(b){a.call(this,b);this.data=b.data}var a=e("./UIEvent");b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.toString=function(){return"CompositionEvent"};h.exports=b},{"./UIEvent":30}],23:[function(e,h,v){function b(a){this.type=a.type;this.defaultPrevented=a.defaultPrevented;this.timeStamp=a.timeStamp;var b=a.target.constructor;
if(b===HTMLInputElement||b===HTMLTextAreaElement||b===HTMLSelectElement)this.value=a.target.value}b.prototype.toString=function(){return"Event"};h.exports=b},{}],24:[function(e,h,v){v=e("./CompositionEvent");var b=e("./Event"),a=e("./FocusEvent"),d=e("./InputEvent"),c=e("./KeyboardEvent"),f=e("./MouseEvent"),k=e("./TouchEvent"),g=e("./UIEvent");e=e("./WheelEvent");h.exports={change:[b,!0],submit:[b,!0],abort:[b,!1],beforeinput:[d,!0],blur:[a,!1],click:[f,!0],compositionend:[v,!0],compositionstart:[v,
!0],compositionupdate:[v,!0],dblclick:[f,!0],focus:[a,!1],focusin:[a,!0],focusout:[a,!0],input:[d,!0],keydown:[c,!0],keyup:[c,!0],load:[b,!1],mousedown:[f,!0],mouseenter:[f,!1],mouseleave:[f,!1],mousemove:[f,!1],mouseout:[f,!0],mouseover:[f,!0],mouseup:[f,!0],resize:[g,!1],scroll:[g,!1],select:[b,!0],unload:[b,!1],wheel:[e,!0],touchcancel:[k,!0],touchend:[k,!0],touchmove:[k,!0],touchstart:[k,!0]}},{"./CompositionEvent":22,"./Event":23,"./FocusEvent":25,"./InputEvent":26,"./KeyboardEvent":27,"./MouseEvent":28,
"./TouchEvent":29,"./UIEvent":30,"./WheelEvent":31}],25:[function(e,h,v){function b(b){a.call(this,b)}var a=e("./UIEvent");b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.toString=function(){return"FocusEvent"};h.exports=b},{"./UIEvent":30}],26:[function(e,h,v){function b(b){a.call(this,b);this.inputType=b.inputType;this.data=b.data;this.isComposing=b.isComposing;this.targetRange=b.targetRange}var a=e("./UIEvent");b.prototype=Object.create(a.prototype);b.prototype.constructor=
b;b.prototype.toString=function(){return"InputEvent"};h.exports=b},{"./UIEvent":30}],27:[function(e,h,v){function b(b){a.call(this,b);this.DOM_KEY_LOCATION_STANDARD=0;this.DOM_KEY_LOCATION_LEFT=1;this.DOM_KEY_LOCATION_RIGHT=2;this.DOM_KEY_LOCATION_NUMPAD=3;this.key=b.key;this.code=b.code;this.location=b.location;this.ctrlKey=b.ctrlKey;this.shiftKey=b.shiftKey;this.altKey=b.altKey;this.metaKey=b.metaKey;this.repeat=b.repeat;this.isComposing=b.isComposing;this.keyCode=b.keyCode}var a=e("./UIEvent");
b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.toString=function(){return"KeyboardEvent"};h.exports=b},{"./UIEvent":30}],28:[function(e,h,v){function b(b){a.call(this,b);this.screenX=b.screenX;this.screenY=b.screenY;this.clientX=b.clientX;this.clientY=b.clientY;this.ctrlKey=b.ctrlKey;this.shiftKey=b.shiftKey;this.altKey=b.altKey;this.metaKey=b.metaKey;this.button=b.button;this.buttons=b.buttons;this.pageX=b.pageX;this.pageY=b.pageY;this.x=b.x;this.y=b.y;this.offsetX=
b.offsetX;this.offsetY=b.offsetY}var a=e("./UIEvent");b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.toString=function(){return"MouseEvent"};h.exports=b},{"./UIEvent":30}],29:[function(e,h,v){function b(a){this.identifier=a.identifier;this.screenX=a.screenX;this.screenY=a.screenY;this.clientX=a.clientX;this.clientY=a.clientY;this.pageX=a.pageX;this.pageY=a.pageY}function a(a){if(!a)return f;for(var d=[],c=0;c<a.length;c++)d[c]=new b(a[c]);return d}function d(b){c.call(this,
b);this.touches=a(b.touches);this.targetTouches=a(b.targetTouches);this.changedTouches=a(b.changedTouches);this.altKey=b.altKey;this.metaKey=b.metaKey;this.ctrlKey=b.ctrlKey;this.shiftKey=b.shiftKey}var c=e("./UIEvent"),f=[];d.prototype=Object.create(c.prototype);d.prototype.constructor=d;d.prototype.toString=function(){return"TouchEvent"};h.exports=d},{"./UIEvent":30}],30:[function(e,h,v){function b(b){a.call(this,b);this.detail=b.detail}var a=e("./Event");b.prototype=Object.create(a.prototype);
b.prototype.constructor=b;b.prototype.toString=function(){return"UIEvent"};h.exports=b},{"./Event":23}],31:[function(e,h,v){function b(b){a.call(this,b);this.DOM_DELTA_PIXEL=0;this.DOM_DELTA_LINE=1;this.DOM_DELTA_PAGE=2;this.deltaX=b.deltaX;this.deltaY=b.deltaY;this.deltaZ=b.deltaZ;this.deltaMode=b.deltaMode}var a=e("./MouseEvent");b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.toString=function(){return"WheelEvent"};h.exports=b},{"./MouseEvent":28}],32:[function(e,h,
v){function b(a){this.values=a||[1,0,0,0,1,0,0,0,1]}b.prototype.get=function(){return this.values};b.prototype.set=function(a){this.values=a;return this};b.prototype.copy=function(a){var b=this.values;a=a.values;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return this};b.prototype.vectorMultiply=function(a,b){var c=this.values,f=a.x,k=a.y,g=a.z;b.x=c[0]*f+c[1]*k+c[2]*g;b.y=c[3]*f+c[4]*k+c[5]*g;b.z=c[6]*f+c[7]*k+c[8]*g;return b};b.prototype.multiply=function(a){var b=
this.values,c=a.values;a=b[0];var f=b[1],k=b[2],g=b[3],q=b[4],l=b[5],n=b[6],p=b[7],t=b[8],m=c[0],e=c[1],r=c[2],u=c[3],h=c[4],y=c[5],z=c[6],x=c[7],c=c[8];b[0]=a*m+f*u+k*z;b[1]=a*e+f*h+k*x;b[2]=a*r+f*y+k*c;b[3]=g*m+q*u+l*z;b[4]=g*e+q*h+l*x;b[5]=g*r+q*y+l*c;b[6]=n*m+p*u+t*z;b[7]=n*e+p*h+t*x;b[8]=n*r+p*y+t*c;return this};b.prototype.transpose=function(){var a=this.values,b=a[1],c=a[2],f=a[5],k=a[6],g=a[7];a[1]=a[3];a[2]=k;a[3]=b;a[5]=g;a[6]=c;a[7]=f;return this};b.prototype.getDeterminant=function(){var a=
this.values,b=a[3],c=a[4],f=a[5],k=a[6],g=a[7],q=a[8];return a[0]*(c*q-f*g)-a[1]*(b*q-f*k)+a[2]*(b*g-c*k)};b.prototype.inverse=function(){var a=this.values,b=a[0],c=a[1],f=a[2],k=a[3],g=a[4],q=a[5],l=a[6],n=a[7],p=a[8],t=b*(g*p-q*n)-c*(k*p-q*l)+f*(k*n-g*l);if(1E-40>Math.abs(t))return null;t=1/t;a[0]=(g*p-q*n)*t;a[3]=(-k*p+q*l)*t;a[6]=(k*n-g*l)*t;a[1]=(-c*p+f*n)*t;a[4]=(b*p-f*l)*t;a[7]=(-b*n+c*l)*t;a[2]=(c*q-f*g)*t;a[5]=(-b*q+f*k)*t;a[8]=(b*g-c*k)*t;return this};b.clone=function(a){return new b(a.values.slice())};
b.inverse=function(a,b){var c=a.values,f=b.values,k=c[0],g=c[1],q=c[2],l=c[3],n=c[4],p=c[5],t=c[6],m=c[7],c=c[8],e=k*(n*c-p*m)-g*(l*c-p*t)+q*(l*m-n*t);if(1E-40>Math.abs(e))return null;e=1/e;f[0]=(n*c-p*m)*e;f[3]=(-l*c+p*t)*e;f[6]=(l*m-n*t)*e;f[1]=(-g*c+q*m)*e;f[4]=(k*c-q*t)*e;f[7]=(-k*m+g*t)*e;f[2]=(g*p-q*n)*e;f[5]=(-k*p+q*l)*e;f[8]=(k*n-g*l)*e;return b};b.transpose=function(a,b){var c=a.values,f=b.values,k=c[1],g=c[2],q=c[3],l=c[4],n=c[5],p=c[6],t=c[7],m=c[8];f[0]=c[0];f[1]=q;f[2]=p;f[3]=k;f[4]=
l;f[5]=t;f[6]=g;f[7]=n;f[8]=m;return b};b.add=function(a,b,c){a=a.values;b=b.values;var f=c.values,k=a[1],g=a[2],q=a[3],l=a[4],n=a[5],p=a[6],t=a[7],m=a[8],e=b[1],r=b[2],u=b[3],h=b[4],y=b[5],z=b[6],x=b[7],B=b[8];f[0]=a[0]+b[0];f[1]=k+e;f[2]=g+r;f[3]=q+u;f[4]=l+h;f[5]=n+y;f[6]=p+z;f[7]=t+x;f[8]=m+B;return c};b.subtract=function(a,b,c){a=a.values;b=b.values;var f=c.values,k=a[1],g=a[2],q=a[3],l=a[4],n=a[5],p=a[6],t=a[7],m=a[8],e=b[1],r=b[2],u=b[3],h=b[4],y=b[5],z=b[6],x=b[7],B=b[8];f[0]=a[0]-b[0];f[1]=
k-e;f[2]=g-r;f[3]=q-u;f[4]=l-h;f[5]=n-y;f[6]=p-z;f[7]=t-x;f[8]=m-B;return c};b.multiply=function(a,b,c){var f=a.values,k=b.values;b=c.values;a=f[0];var g=f[1],q=f[2],l=f[3],n=f[4],p=f[5],t=f[6],m=f[7],f=f[8],e=k[0],r=k[1],u=k[2],h=k[3],y=k[4],z=k[5],x=k[6],B=k[7],k=k[8];b[0]=a*e+g*h+q*x;b[1]=a*r+g*y+q*B;b[2]=a*u+g*z+q*k;b[3]=l*e+n*h+p*x;b[4]=l*r+n*y+p*B;b[5]=l*u+n*z+p*k;b[6]=t*e+m*h+f*x;b[7]=t*r+m*y+f*B;b[8]=t*u+m*z+f*k;return c};h.exports=b},{}],33:[function(e,h,v){function b(a,b,d,c){this.w=a||
1;this.x=b||0;this.y=d||0;this.z=c||0}var a=Math.sin,d=Math.cos,c=Math.asin,f=Math.acos,k=Math.atan2,g=Math.sqrt;b.prototype.multiply=function(a){var b=this.x,d=this.y,c=this.z,f=this.w,g=a.x,k=a.y,e=a.z;a=a.w||0;this.w=f*a-b*g-d*k-c*e;this.x=b*a+g*f+k*c-d*e;this.y=d*a+k*f+b*e-g*c;this.z=c*a+e*f+g*d-b*k;return this};b.prototype.leftMultiply=function(a){var b=a.x,d=a.y,c=a.z;a=a.w||0;var f=this.x,g=this.y,k=this.z,e=this.w;this.w=a*e-b*f-d*g-c*k;this.x=b*e+f*a+g*c-d*k;this.y=d*e+g*a+b*k-f*c;this.z=
c*e+k*a+f*d-b*g;return this};b.prototype.rotateVector=function(a,b){var d=this.w,c=-this.x,f=-this.y,g=-this.z,k=a.x,e=a.y,u=a.z,h=-c*k-f*e-g*u,y=k*d+e*g-f*u,z=e*d+c*u-k*g,k=u*d+k*f-c*e,c=-c,f=-f,g=-g;b.x=y*d+c*h+f*k-z*g;b.y=z*d+f*h+y*g-c*k;b.z=k*d+g*h+c*z-y*f;return b};b.prototype.invert=function(){this.w=-this.w;this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};b.prototype.conjugate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};b.prototype.length=function(){var a=
this.w,b=this.x,d=this.y,c=this.z;return g(a*a+b*b+d*d+c*c)};b.prototype.normalize=function(){var a=this.w,b=this.x,d=this.y,c=this.z,a=g(a*a+b*b+d*d+c*c);if(0===a)return this;a=1/a;this.w*=a;this.x*=a;this.y*=a;this.z*=a;return this};b.prototype.set=function(a,b,d,c){null!=a&&(this.w=a);null!=b&&(this.x=b);null!=d&&(this.y=d);null!=c&&(this.z=c);return this};b.prototype.copy=function(a){this.w=a.w;this.x=a.x;this.y=a.y;this.z=a.z;return this};b.prototype.clear=function(){this.w=1;this.z=this.y=this.x=
0;return this};b.prototype.dot=function(a){return this.w*a.w+this.x*a.x+this.y*a.y+this.z*a.z};b.prototype.slerp=function(b,d,c){var g=this.w,k=this.x,m=this.y,e=this.z,r=b.w,u=b.x,h=b.y;b=b.z;var y,z,x;z=g*r+k*u+m*h+e*b;1E-5<1-z?(y=f(z),x=a(y),z=a((1-d)*y)/x,d=a(d*y)/x):z=1-d;c.w=g*z+r*d;c.x=k*z+u*d;c.y=m*z+h*d;c.z=e*z+b*d;return c};b.prototype.toMatrix=function(a){var b=this.w,d=this.x,c=this.y,f=this.z,g=d*d,k=c*c,e=f*f,u=d*c,h=d*f,y=c*f;return a.set([1-2*(k+e),2*(u-b*f),2*(h+b*c),2*(u+b*f),1-
2*(g+e),2*(y-b*d),2*(h-b*c),2*(y+b*d),1-2*(g+k)])};b.prototype.toEuler=function(a){var b=this.w,d=this.x,f=this.y,g=this.z,m=f*f,e=g*g,r=2*(d*g+f*b),r=-1>r?-1:1<r?1:r;a.x=k(2*(d*b-f*g),1-2*(d*d+m));a.y=c(r);a.z=k(2*(g*b-d*f),1-2*(m+e));return a};b.prototype.fromEuler=function(b,c,f){var g=.5*b,k=.5*c,m=.5*f;f=a(g);c=a(k);b=a(m);g=d(g);k=d(k);m=d(m);this.w=g*k*m-f*c*b;this.x=f*k*m+g*c*b;this.y=g*c*m-f*k*b;this.z=g*k*b+f*c*m;return this};b.prototype.fromAngleAxis=function(b,c,f,k){var e=g(c*c+f*f+k*
k);if(0===e)this.w=1,this.x=this.y=this.z=0;else{e=1/e;b*=.5;var m=a(b);this.w=d(b);this.x=m*c*e;this.y=m*f*e;this.z=m*k*e}return this};b.multiply=function(a,b,d){var c=a.w||0,f=a.x,g=a.y;a=a.z;var k=b.w||0,e=b.x,u=b.y;b=b.z;d.w=c*k-f*e-g*u-a*b;d.x=f*k+e*c+u*a-g*b;d.y=g*k+u*c+f*b-e*a;d.z=a*k+b*c+e*g-f*u;return d};b.normalize=function(a,b){var d=a.w,c=a.x,f=a.y,k=a.z,d=g(d*d+c*c+f*f+k*k);if(0===d)return this;d=1/d;b.w*=d;b.x*=d;b.y*=d;b.z*=d;return b};b.conjugate=function(a,b){b.w=a.w;b.x=-a.x;b.y=
-a.y;b.z=-a.z;return b};b.clone=function(a){return new b(a.w,a.x,a.y,a.z)};b.dot=function(a,b){return a.w*b.w+a.x*b.x+a.y*b.y+a.z*b.z};h.exports=b},{}],34:[function(e,h,v){var b=function(a,b){a instanceof Array||a instanceof Float32Array?(this.x=a[0]||0,this.y=a[1]||0):(this.x=a||0,this.y=b||0)};b.prototype.set=function(a,b){null!=a&&(this.x=a);null!=b&&(this.y=b);return this};b.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};b.prototype.subtract=function(a){this.x-=a.x;this.y-=a.y;
return this};b.prototype.scale=function(a){a instanceof b?(this.x*=a.x,this.y*=a.y):(this.x*=a,this.y*=a);return this};b.prototype.rotate=function(a){var b=this.x,c=this.y,f=Math.cos(a);a=Math.sin(a);this.x=b*f-c*a;this.y=b*a+c*f;return this};b.prototype.dot=function(a){return this.x*a.x+this.y*a.y};b.prototype.cross=function(a){return this.x*a.y-this.y*a.x};b.prototype.invert=function(){this.x*=-1;this.y*=-1;return this};b.prototype.map=function(a){this.x=a(this.x);this.y=a(this.y);return this};
b.prototype.length=function(){var a=this.x,b=this.y;return Math.sqrt(a*a+b*b)};b.prototype.copy=function(a){this.x=a.x;this.y=a.y;return this};b.prototype.clear=function(){this.y=this.x=0;return this};b.prototype.isZero=function(){return 0!==this.x||0!==this.y?!1:!0};b.prototype.toArray=function(){return[this.x,this.y]};b.normalize=function(a,b){var c=a.x,f=a.y,c=Math.sqrt(c*c+f*f)||1,c=1/c;b.x=a.x*c;b.y=a.y*c;return b};b.clone=function(a){return new b(a.x,a.y)};b.add=function(a,b,c){c.x=a.x+b.x;
c.y=a.y+b.y;return c};b.subtract=function(a,b,c){c.x=a.x-b.x;c.y=a.y-b.y;return c};b.scale=function(a,b,c){c.x=a.x*b;c.y=a.y*b;return c};b.dot=function(a,b){return a.x*b.x+a.y*b.y};b.cross=function(a,b){return a.x*b.y-a.y*b.x};h.exports=b},{}],35:[function(e,h,v){var b=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};b.prototype.set=function(a,b,c){null!=a&&(this.x=a);null!=b&&(this.y=b);null!=c&&(this.z=c);return this};b.prototype.add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this};
b.prototype.subtract=function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this};b.prototype.rotateX=function(a){var b=this.y,c=this.z,f=Math.cos(a);a=Math.sin(a);this.y=b*f-c*a;this.z=b*a+c*f;return this};b.prototype.rotateY=function(a){var b=this.x,c=this.z,f=Math.cos(a);a=Math.sin(a);this.x=c*a+b*f;this.z=c*f-b*a;return this};b.prototype.rotateZ=function(a){var b=this.x,c=this.y,f=Math.cos(a);a=Math.sin(a);this.x=b*f-c*a;this.y=b*a+c*f;return this};b.prototype.dot=function(a){return this.x*a.x+
this.y*a.y+this.z*a.z};b.prototype.cross=function(a){var b=this.x,c=this.y,f=this.z,k=a.x,g=a.y;a=a.z;this.x=c*a-f*g;this.y=f*k-b*a;this.z=b*g-c*k;return this};b.prototype.scale=function(a){this.x*=a;this.y*=a;this.z*=a;return this};b.prototype.invert=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};b.prototype.map=function(a){this.x=a(this.x);this.y=a(this.y);this.z=a(this.z);return this};b.prototype.length=function(){var a=this.x,b=this.y,c=this.z;return Math.sqrt(a*a+b*b+c*
c)};b.prototype.lengthSq=function(){var a=this.x,b=this.y,c=this.z;return a*a+b*b+c*c};b.prototype.copy=function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this};b.prototype.clear=function(){this.z=this.y=this.x=0;return this};b.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z};b.prototype.toArray=function(){return[this.x,this.y,this.z]};b.prototype.normalize=function(){var a=this.x,b=this.y,c=this.z,a=Math.sqrt(a*a+b*b+c*c)||1,a=1/a;this.x*=a;this.y*=a;this.z*=a;return this};
b.prototype.applyRotation=function(a){var b=a.w,c=-a.x,f=-a.y,k=-a.z,g=this.x,e=this.y,l=this.z;a=-c*g-f*e-k*l;var n=g*b+e*k-f*l,p=e*b+c*l-g*k,g=l*b+g*f-c*e,c=-c,f=-f,k=-k;this.x=n*b+c*a+f*g-p*k;this.y=p*b+f*a+n*k-c*g;this.z=g*b+k*a+c*p-n*f;return this};b.prototype.applyMatrix=function(a){a=a.get();var b=this.x,c=this.y,f=this.z;this.x=a[0]*b+a[1]*c+a[2]*f;this.y=a[3]*b+a[4]*c+a[5]*f;this.z=a[6]*b+a[7]*c+a[8]*f;return this};b.normalize=function(a,b){var c=a.x,f=a.y,k=a.z,g=Math.sqrt(c*c+f*f+k*k)||
1,g=1/g;b.x=c*g;b.y=f*g;b.z=k*g;return b};b.applyRotation=function(a,b,c){var f=b.w,k=-b.x,g=-b.y;b=-b.z;var e=a.x,l=a.y,n=a.z;a=-k*e-g*l-b*n;var p=e*f+l*b-g*n,t=l*f+k*n-e*b,e=n*f+e*g-k*l,k=-k,g=-g;b=-b;c.x=p*f+k*a+g*e-t*b;c.y=t*f+g*a+p*b-k*e;c.z=e*f+b*a+k*t-p*g;return c};b.clone=function(a){return new b(a.x,a.y,a.z)};b.add=function(a,b,c){c.x=a.x+b.x;c.y=a.y+b.y;c.z=a.z+b.z;return c};b.subtract=function(a,b,c){c.x=a.x-b.x;c.y=a.y-b.y;c.z=a.z-b.z;return c};b.scale=function(a,b,c){c.x=a.x*b;c.y=a.y*
b;c.z=a.z*b;return c};b.dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z};b.cross=function(a,b,c){var f=a.x,k=a.y;a=a.z;var g=b.x,e=b.y;b=b.z;c.x=k*b-a*e;c.y=a*g-f*b;c.z=f*e-k*g;return c};b.project=function(a,b,c){var f=b.x,k=b.y;b=b.z;a=a.x*f+a.y*k+a.z*b;a/=f*f+k*k+b*b;c.x=f*a;c.y=k*a;c.z=b*a;return c};h.exports=b},{}],36:[function(e,h,v){h.exports={Mat33:e("./Mat33"),Quaternion:e("./Quaternion"),Vec2:e("./Vec2"),Vec3:e("./Vec3")}},{"./Mat33":32,"./Quaternion":33,"./Vec2":34,"./Vec3":35}],37:[function(e,
h,v){function b(a,b,d){var c=p;g.cross(a,b,c);g.cross(c,d,c);return c}function a(a,b){for(var c,d=-Infinity,f,k,n,e=0;e<a.length;e++)k=a[e],f=g.dot(k,b),f>d&&(c=k,d=f,n=e);return{vertex:c,index:n}}function d(a,b,c){this.distance=a;this.normal=b;this.vertexIndices=c}function c(){this.vertices=[];this.numVertices=0;this.features=[];this.lastVertexIndex=this.numFeatures=0;this._IDPool={vertices:[],features:[]}}function f(a,b,c,d){for(var f=a[c].vertex,g=a[d].vertex,k=0,n=b.length;k<n;k++){var e=b[k];
if(e){var m=a[e[0]].vertex,e=a[e[1]].vertex;if(f===m&&g===e||f===e&&g===m){b[k]=null;return}}}b.push([c,d])}function k(a,b,c,d,f){var g=a+b;d[0]=g+c;var k=a*a,g=k+b*g;d[1]=g+c*d[0];d[2]=a*k+b*g+c*d[1];f[0]=d[1]+a*(d[0]+a);f[1]=d[1]+b*(d[0]+b);f[2]=d[1]+c*(d[0]+c)}var g=e("../math/Vec3"),q=e("../math/Mat33");e=e("../utilities/ObjectManager");e.register("DynamicGeometry",c);e.register("DynamicGeometryFeature",d);var l=e.requestDynamicGeometryFeature,n=e.freeDynamicGeometryFeature,p=new g,t=new g,m=
new g,A=new g,r=new g,u=new g,L=new g,y=new g,z=new g;d.prototype.reset=function(a,b,d){this.distance=a;this.normal=b;this.vertexIndices=d;return this};c.prototype.reset=function(){this.vertices=[];this.numVertices=0;this.features=[];this.lastVertexIndex=this.numFeatures=0;this._IDPool={vertices:[],features:[]};return this};c.prototype.addVertex=function(a){var b=this._IDPool.vertices.length?this._IDPool.vertices.pop():this.vertices.length;this.vertices[b]=a;this.lastVertexIndex=b;this.numVertices++};
c.prototype.removeVertex=function(a){var b=this.vertices[a];this.vertices[a]=null;this._IDPool.vertices.push(a);this.numVertices--;return b};c.prototype.addFeature=function(a,b,d){var c=this._IDPool.features.length?this._IDPool.features.pop():this.features.length;this.features[c]=l().reset(a,b,d);this.numFeatures++};c.prototype.removeFeature=function(a){var b=this.features[a];this.features[a]=null;this._IDPool.features.push(a);this.numFeatures--;n(b)};c.prototype.getLastVertex=function(){return this.vertices[this.lastVertexIndex]};
c.prototype.getFeatureClosestToOrigin=function(){for(var a=Infinity,b=null,d=this.features,c=0,f=d.length;c<f;c++){var g=d[c];g&&g.distance<a&&(a=g.distance,b=g)}return b};c.prototype.reshape=function(a){var b=this.vertices,d=this.getLastVertex().vertex,c=this.features,k,e,n,l,p=[];n=0;for(l=c.length;n<l;n++)c[n]&&(e=c[n].vertexIndices,k=b[e[0]].vertex,-.001<g.dot(c[n].normal,g.subtract(d,k,m))&&(f(b,p,e[0],e[1]),f(b,p,e[1],e[2]),f(b,p,e[2],e[0]),this.removeFeature(n)));k=this.lastVertexIndex;c=0;
for(l=p.length;c<l;c++)if(p[c]){e=p[c][0];n=p[c][1];var q=b[n].vertex,D=g.subtract(b[e].vertex,d,r),q=g.subtract(q,d,u),D=g.cross(D,q,new g);D.normalize();a?(q=g.subtract(a,d,t),-.001<g.dot(D,q)&&D.invert(),this.addFeature(null,D,[k,e,n])):(q=g.dot(D,d),0>q&&(D.invert(),q*=-1),this.addFeature(q,D,[k,e,n]))}};c.prototype.simplexContainsOrigin=function(a,c){var d=this.vertices.length,f=this.lastVertexIndex,k=f-1,e=f-2,n=f-3,k=0>k?k+d:k,e=0>e?e+d:e,n=0>n?n+d:n,m=this.vertices[f].vertex,l=this.vertices[k].vertex,
t=this.vertices[e].vertex,p=this.vertices[n].vertex,q=g.scale(m,-1,A),h=g.subtract(l,m,r),K,M,Q;if(4===d){K=g.subtract(t,m,u);M=g.subtract(p,m,L);m=g.cross(h,K,new g);d=g.cross(K,M,new g);Q=g.cross(h,M,new g);m.normalize();d.normalize();Q.normalize();0<g.dot(m,M)&&m.invert();0<g.dot(d,h)&&d.invert();0<g.dot(Q,K)&&Q.invert();K=g.dot(m,q);M=g.dot(d,q);q=g.dot(Q,q);if(.001>K&&.001>q&&.001>M)return t=g.subtract(t,l,y),p=g.subtract(p,l,z),p=g.cross(t,p,new g),p.normalize(),0>=g.dot(p,h)&&p.invert(),l=
-1*g.dot(p,l),this.addFeature(-K,m,[f,k,e]),this.addFeature(-M,d,[f,e,n]),this.addFeature(-q,Q,[f,n,k]),this.addFeature(-l,p,[k,e,n]),!0;.001<=K?(M=this.removeVertex(n),a.copy(m)):.001<=M?(M=this.removeVertex(k),a.copy(d)):(M=this.removeVertex(e),a.copy(Q))}else 3===d?(K=g.subtract(t,m,u),g.cross(h,K,a),0>=g.dot(a,q)&&a.invert()):a.copy(b(h,q,h));M&&c&&c(M);return!1};h.exports={DynamicGeometry:c,ConvexHull:function(d,f){var e=f||1E3,n=new c;n.addVertex(a(d,new g(1,0,0)));n.addVertex(a(d,new g(-1,
0,0)));var m=n.vertices[0].vertex,l=n.vertices[1].vertex,p=g.subtract(l,m,r),A,h,F,D,C,E=-Infinity;for(C=0;C<d.length;C++)if(h=d[C],h!==m&&h!==l){var K=g.subtract(h,m,t);A=g.dot(K,b(p,K,p));A=0>A?-1*A:A;A>E&&(E=A,F=h,D=C)}n.addVertex({vertex:F,index:D});var K=F,M=g.subtract(K,m,u),Q=g.cross(p,M,new g);Q.normalize();E=-Infinity;for(C=0;C<d.length;C++)h=d[C],h!==m&&h!==l&&h!==K&&(A=g.dot(g.subtract(h,m,t),Q),A=0>A?-1*A:A,A>E&&(E=A,F=h,D=C));n.addVertex({vertex:F,index:D});C=g.subtract(F,m,L);E=g.subtract(K,
l,y);A=g.subtract(F,l,z);D=g.cross(M,C,new g);h=g.cross(p,C,new g);E=g.cross(E,A,new g);D.normalize();h.normalize();E.normalize();0<g.dot(Q,C)&&Q.invert();0<g.dot(D,p)&&D.invert();0<g.dot(h,M)&&h.invert();0>g.dot(E,p)&&E.invert();n.addFeature(null,Q,[0,1,2]);n.addFeature(null,D,[0,2,3]);n.addFeature(null,h,[0,1,3]);n.addFeature(null,E,[1,2,3]);M={};C=0;for(p=n.vertices.length;C<p;C++)M[n.vertices[C].index]=!0;l=new g(m.x+l.x+K.x+F.x,m.y+l.y+K.y+F.y,m.z+l.z+K.z+F.z);l.scale(.25);K=n.features;for(Q=
0;Q++<e;){h=null;C=0;for(p=K.length;C<p;C++)K[C]&&!K[C].done&&(h=K[C],m=n.vertices[h.vertexIndices[0]].vertex,E=a(d,h.normal),F=E.vertex,D=E.index,.001>g.dot(g.subtract(F,m,t),h.normal)||M[D]?h.done=!0:(M[D]=!0,n.addVertex(E),n.reshape(l)));if(null===h)break}e=[];m=0;for(K=n.features.length;m<K;m++)(l=n.features[m])&&e.push(l.vertexIndices);l=n.vertices;m=[0,0,0,0,0,0,0,0,0,0];p=[];F=[];D=[];M=[];Q=[];h=[];C=0;for(K=e.length;C<K;C++){var S=l[e[C][0]].vertex,v=l[e[C][1]].vertex,E=l[e[C][2]].vertex;
A=g.subtract(v,S,r);var W=g.subtract(E,S,u),T=A.cross(W);0>g.dot(S,T)&&T.invert();A=T.x;var W=T.y,T=T.z,ha=S.x,X=S.y,S=S.z,Y=v.x,Z=v.y,v=v.z,ba=E.x,ca=E.y,E=E.z;k(ha,Y,ba,p,M);k(X,Z,ca,F,Q);k(S,v,E,D,h);m[0]+=A*p[0];m[1]+=A*p[1];m[2]+=W*F[1];m[3]+=T*D[1];m[4]+=A*p[2];m[5]+=W*F[2];m[6]+=T*D[2];m[7]+=A*(X*M[0]+Z*M[1]+ca*M[2]);m[8]+=W*(S*Q[0]+v*Q[1]+E*Q[2]);m[9]+=T*(ha*h[0]+Y*h[1]+ba*h[2])}m[0]/=6;m[1]/=24;m[2]/=24;m[3]/=24;m[4]/=60;m[5]/=60;m[6]/=60;m[7]/=120;m[8]/=120;m[9]/=120;p=Infinity;F=-Infinity;
D=Infinity;M=-Infinity;Q=Infinity;h=-Infinity;C=0;for(K=l.length;C<K;C++)E=l[C].vertex,E.x<p&&(p=E.x),E.x>F&&(F=E.x),E.y<D&&(D=E.y),E.y>M&&(M=E.y),E.z<Q&&(Q=E.z),E.z>h&&(h=E.z);l=[F-p,M-D,h-Q];C=m[0];K=new g(m[1],m[2],m[3]);K.scale(1/C);m=new q([m[4],m[7],m[9],m[7],m[5],m[8],m[9],m[8],m[6]]);l={size:l,volume:C,centroid:K,eulerTensor:m};p=l.centroid;C=[];m=0;for(K=n.vertices.length;m<K;m++)C.push(g.subtract(n.vertices[m].vertex,p,new g));n=[];m=0;for(K=C.length;m<K;m++)n.push(g.normalize(C[m],new g));
K={};p={};for(m=0;m<e.length;m++)F=e[m][0],D=e[m][1],M=e[m][2],p[F]=p[F]||{},p[D]=p[D]||{},p[M]=p[M]||{},K[F]=K[F]||[],K[D]=K[D]||[],K[M]=K[M]||[],p[F][D]||(p[F][D]=1,K[F].push(D)),p[F][M]||(p[F][M]=1,K[F].push(M)),p[D][F]||(p[D][F]=1,K[D].push(F)),p[D][M]||(p[D][M]=1,K[D].push(M)),p[M][F]||(p[M][F]=1,K[M].push(F)),p[M][D]||(p[M][D]=1,K[M].push(D));this.indices=e;this.vertices=C;this.normals=n;this.polyhedralProperties=l;this.graph=K}}},{"../math/Mat33":32,"../math/Vec3":35,"../utilities/ObjectManager":75}],
38:[function(e,h,v){function b(a){this.events=new g;a=a||{};this.bodies=[];this.forces=[];this.constraints=[];this.step=a.step||1E3/60;this.iterations=a.iterations||10;this._indexPools={bodies:[],forces:[],constraints:[]};this._entityMaps={bodies:{},forces:{},constraints:{}};this.speed=a.speed||1;this.delta=this.time=0;this.origin=a.origin||new q;this.orientation=a.orientation?a.orientation.normalize():new l;this.frameDependent=a.frameDependent||!1;this.transformBuffers={position:[0,0,0],rotation:[0,
0,0,1]}}function a(a,b,d){var c=a._entityMaps[d];if(null==c[b._ID]){var f=a[d];a=a._indexPools[d];c[b._ID]=a.length?a.pop():f.length;f[c[b._ID]]=b}}function d(a,b,d){var c=a._entityMaps[d],f=c[b._ID];null!=f&&(a._indexPools[d].push(f),a[d][f]=null,c[b._ID]=null)}var c=e("./bodies/Particle"),f=e("./constraints/Constraint"),k=e("./forces/Force"),g=e("../utilities/CallbackStore"),q=e("../math/Vec3"),l=e("../math/Quaternion"),n=new q,p=new l,t=new q;b.prototype.on=function(a,b){this.events.on(a,b);return this};
b.prototype.off=function(a,b){this.events.off(a,b);return this};b.prototype.trigger=function(a,b){this.events.trigger(a,b);return this};b.prototype.setOrigin=function(a,b,d){this.origin.set(a,b,d);return this};b.prototype.setOrientation=function(a,b,d,c){this.orientation.set(a,b,d,c).normalize();return this};b.prototype.add=function(){for(var a=0,b=arguments.length;a<b;a++){var d=arguments[a];if(d instanceof Array)for(var g=0,n=d.length;g<n;g++)this.add(d[g]);else d instanceof c?this.addBody(d):d instanceof
f?this.addConstraint(d):d instanceof k&&this.addForce(d)}return this};b.prototype.remove=function(){for(var a=0,b=arguments.length;a<b;a++){var d=arguments[a];if(d instanceof Array)for(var g=0,n=d.length;g<n;g++)this.add(d[g]);else d instanceof c?this.removeBody(d):d instanceof f?this.removeConstraint(d):d instanceof k&&this.removeForce(d)}return this};b.prototype.addBody=function(b){a(this,b,"bodies")};b.prototype.addForce=function(b){a(this,b,"forces")};b.prototype.addConstraint=function(b){a(this,
b,"constraints");return b};b.prototype.removeBody=function(a){d(this,a,"bodies")};b.prototype.removeForce=function(a){d(this,a,"forces")};b.prototype.removeConstraint=function(a){d(this,a,"constraints")};b.prototype.update=function(a){0===this.time&&(this.time=a);var b=this.bodies,d=this.forces,c=this.constraints,f=this.frameDependent,g=this.step,k=.001*g,n=this.delta,n=n+(a-this.time)*this.speed;this.time=a;for(var e,l,p;n>g;){this.events.trigger("prestep",a);for(e=0;e<d.length;e++)l=d[e],null!=
l&&l.update(a,k);for(e=0;e<b.length;e++)p=b[e],null!=p&&(l=p,p=k,l.momentum.add(q.scale(l.force,p,t)),l.angularMomentum.add(q.scale(l.torque,p,t)),q.scale(l.momentum,l.inverseMass,l.velocity),l.inverseInertia.vectorMultiply(l.angularMomentum,l.angularVelocity),l.force.clear(),l.torque.clear());for(e=0;e<c.length;e++)p=c[e],null!=p&&p.update(a,k);for(var h=0,w=this.iterations;h<w;h++)for(e=0,l=c.length;e<l;e++)p=c[e],null!==p&&p.resolve(a,k);e=0;for(l=b.length;e<l;e++)if(p=b[e],null!==p){h=k;if(0!==
p.restrictions){var w=p.restrictions,J=null,H=null,G=null,F=null,D=null,C=null;w&32&&(J=0);w&16&&(H=0);w&8&&(G=0);w&4&&(F=0);w&2&&(D=0);w&1&&(C=0);null===J&&null===H&&null===G||p.setVelocity(J,H,G);null===F&&null===D&&null===C||p.setAngularVelocity(F,D,C)}p.position.add(q.scale(p.velocity,h,t));var G=p.angularVelocity,w=p.orientation,J=G.x,H=G.y,G=G.z,F=w.w,D=w.x,C=w.y,E=w.z,h=.5*h;w.w+=(-J*D-H*C-G*E)*h;w.x+=(J*F+H*E-G*C)*h;w.y+=(H*F+G*D-J*E)*h;w.z+=(G*F+J*C-H*D)*h;w.normalize();p.updateInertia()}this.events.trigger("poststep",
a);n=f?0:n-g}this.delta=n};b.prototype.getTransform=function(a){var b=this.origin,d=this.orientation,c=this.transformBuffers,f=a.position,g=a=a.orientation,k=f;1!==d.w&&(g=l.multiply(a,d,p),k=d.rotateVector(f,n));c.position[0]=b.x+k.x;c.position[1]=b.y+k.y;c.position[2]=b.z+k.z;c.rotation[0]=g.x;c.rotation[1]=g.y;c.rotation[2]=g.z;c.rotation[3]=g.w;return c};h.exports=b},{"../math/Quaternion":33,"../math/Vec3":35,"../utilities/CallbackStore":74,"./bodies/Particle":40,"./constraints/Constraint":47,
"./forces/Force":58}],39:[function(e,h,v){function b(b){d.call(this,b);this.normals=[new a(0,1,0),new a(1,0,0),new a(0,0,1)];this.type=2}var a=e("../../math/Vec3"),d=e("./convexBodyFactory")([new a(-100,-100,-100),new a(100,-100,-100),new a(-100,-100,100),new a(100,-100,100),new a(-100,100,-100),new a(100,100,-100),new a(-100,100,100),new a(100,100,100)]);b.prototype=Object.create(d.prototype);b.prototype.constructor=b;h.exports=b},{"../../math/Vec3":35,"./convexBodyFactory":43}],40:[function(e,h,
v){function b(b){this.events=new f;b=b||{};this.position=b.position||new a;this.orientation=b.orientation||new d;this.velocity=new a;this.momentum=new a;this.angularVelocity=new a;this.angularMomentum=new a;this.mass=b.mass||1;this.inverseMass=1/this.mass;this.force=new a;this.torque=new a;this.restitution=null!=b.restitution?b.restitution:.4;this.friction=null!=b.friction?b.friction:.2;this.inverseInertia=new c([0,0,0,0,0,0,0,0,0]);this.localInertia=new c([0,0,0,0,0,0,0,0,0]);this.localInverseInertia=
new c([0,0,0,0,0,0,0,0,0]);this.size=b.size||[0,0,0];var g=b.velocity;g&&this.setVelocity(g.x,g.y,g.z);this.restrictions=0;this.setRestrictions.apply(this,b.restrictions||[]);this.collisionMask=b.collisionMask||1;this.collisionGroup=b.collisionGroup||1;this.type=1;this._ID=q++}var a=e("../../math/Vec3"),d=e("../../math/Quaternion"),c=e("../../math/Mat33"),f=e("../../utilities/CallbackStore"),k=new a,g=new c,q=0;b.prototype.on=function(a,b){this.events.on(a,b);return this};b.prototype.off=function(a,
b){this.events.off(a,b);return this};b.prototype.trigger=function(a,b){this.events.trigger(a,b);return this};b.prototype.getRestrictions=function(){var a="",b="",d=this.restrictions;d&32&&(a+="x");d&16&&(a+="y");d&8&&(a+="z");d&4&&(b+="x");d&2&&(b+="y");d&1&&(b+="z");return[a,b]};b.prototype.setRestrictions=function(a,b){a=a||"";b=b||"";this.restrictions=0;-1<a.indexOf("x")&&(this.restrictions|=32);-1<a.indexOf("y")&&(this.restrictions|=16);-1<a.indexOf("z")&&(this.restrictions|=8);-1<b.indexOf("x")&&
(this.restrictions|=4);-1<b.indexOf("y")&&(this.restrictions|=2);-1<b.indexOf("z")&&(this.restrictions|=1);return this};b.prototype.getMass=function(){return this.mass};b.prototype.setMass=function(a){this.mass=a;this.inverseMass=1/a;return this};b.prototype.getInverseMass=function(){return this.inverseMass};b.prototype.updateLocalInertia=function(){this.localInertia.set([0,0,0,0,0,0,0,0,0]);this.localInverseInertia.set([0,0,0,0,0,0,0,0,0]);return this};b.prototype.updateInertia=function(){var a=
this.localInverseInertia,b=this.orientation;if(a[0]===a[4]&&a[4]===a[8]||1===b.w)return this;a=b.toMatrix(g);c.multiply(a,this.inverseInertia,this.inverseInertia);c.multiply(this.localInverseInertia,a.transpose(),this.inverseInertia);return this};b.prototype.getPosition=function(){return this.position};b.prototype.setPosition=function(a,b,d){this.position.set(a,b,d);return this};b.prototype.getVelocity=function(){return this.velocity};b.prototype.setVelocity=function(b,d,c){this.velocity.set(b,d,
c);a.scale(this.velocity,this.mass,this.momentum);return this};b.prototype.getMomentum=function(){return this.momentum};b.prototype.setMomentum=function(b,d,c){this.momentum.set(b,d,c);a.scale(this.momentum,this.inverseMass,this.velocity);return this};b.prototype.getOrientation=function(){return this.orientation};b.prototype.setOrientation=function(a,b,d,c){this.orientation.set(a,b,d,c).normalize();this.updateInertia();return this};b.prototype.getAngularVelocity=function(){return this.angularVelocity};
b.prototype.setAngularVelocity=function(a,b,d){this.angularVelocity.set(a,b,d);(a=c.inverse(this.inverseInertia,g))?a.vectorMultiply(this.angularVelocity,this.angularMomentum):this.angularMomentum.clear();return this};b.prototype.getAngularMomentum=function(){return this.angularMomentum};b.prototype.setAngularMomentum=function(a,b,d){this.angularMomentum.set(a,b,d);this.inverseInertia.vectorMultiply(this.angularMomentum,this.angularVelocity);return this};b.prototype.getForce=function(){return this.force};
b.prototype.setForce=function(a,b,d){this.force.set(a,b,d);return this};b.prototype.getTorque=function(){return this.torque};b.prototype.setTorque=function(a,b,d){this.torque.set(a,b,d);return this};b.prototype.applyForce=function(a){this.force.add(a);return this};b.prototype.applyTorque=function(a){this.torque.add(a);return this};b.prototype.applyImpulse=function(b){this.momentum.add(b);a.scale(this.momentum,this.inverseMass,this.velocity);return this};b.prototype.applyAngularImpulse=function(a){this.angularMomentum.add(a);
this.inverseInertia.vectorMultiply(this.angularMomentum,this.angularVelocity);return this};b.prototype.support=function(){return k};b.prototype.updateShape=function(){};h.exports=b},{"../../math/Mat33":32,"../../math/Quaternion":33,"../../math/Vec3":35,"../../utilities/CallbackStore":74}],41:[function(e,h,v){function b(b){a.call(this,b);var d=b.radius||1;this.radius=d;this.size=[2*d,2*d,2*d];this.updateLocalInertia();this.inverseInertia.copy(this.localInverseInertia);(b=b.angularVelocity)&&this.setAngularVelocity(b.x,
b.y,b.z);this.type=4}var a=e("./Particle"),d=e("../../math/Vec3"),c=new d;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.getRadius=function(){return this.radius};b.prototype.setRadius=function(a){this.radius=a;this.size=[2*this.radius,2*this.radius,2*this.radius];return this};b.prototype.updateLocalInertia=function(){var a=this.radius,a=this.mass*a*a;this.localInertia.set([.4*a,0,0,0,.4*a,0,0,0,.4*a]);this.localInverseInertia.set([2.5/a,0,0,0,2.5/a,0,0,0,2.5/a])};b.prototype.support=
function(a){return d.scale(a,this.radius,c)};h.exports=b},{"../../math/Vec3":35,"./Particle":40}],42:[function(e,h,v){function b(c){a.call(this,c);var f=this.normal=new d;switch(this.direction=c.direction){case b.DOWN:f.set(0,1,0);break;case b.UP:f.set(0,-1,0);break;case b.LEFT:f.set(-1,0,0);break;case b.RIGHT:f.set(1,0,0);break;case b.FORWARD:f.set(0,0,-1);break;case b.BACKWARD:f.set(0,0,1)}this.invNormal=d.clone(f,new d).invert();this.mass=Infinity;this.inverseMass=0;this.type=8}var a=e("./Particle"),
d=e("../../math/Vec3"),b={DOWN:0,UP:1,LEFT:2,RIGHT:3,FORWARD:4,BACKWARD:5};b.prototype=Object.create(a.prototype);b.prototype.constructor=b;h.exports=b},{"../../math/Vec3":35,"./Particle":40}],43:[function(e,h,v){function b(a){var b=this.hull.polyhedralProperties,c=a.get(),c=c[0]*c[4]*c[8],f=b.eulerTensor,k=new d;d.multiply(a,f,k);d.multiply(k,a,k);var e=k.get(),m=e[0],h=e[4],r=e[8];a=b.volume*c;var f=this.mass/a,k=-e[1],u=-e[7],e=-e[2],L=b.centroid,b=h+r-a*(L.y*L.y+L.z*L.z),r=m+r-a*(L.z*L.z+L.x*
L.x),m=m+h-a*(L.x*L.x+L.y*L.y),k=k+a*L.x*L.y,u=u+a*L.y*L.z,e=e+a*L.z*L.x,b=b*f*c,r=r*f*c,m=m*f*c,k=k*f*c,u=u*f*c,e=e*f*c;this.localInertia.set([b,k,e,k,r,u,e,u,m]);d.inverse(this.localInertia,this.localInverseInertia)}var a=e("./Particle"),d=e("../../math/Mat33"),c=e("../../math/Vec3"),f=e("../Geometry").ConvexHull,k=new c;h.exports=function(g){function e(f){a.call(this,f);var k=g.polyhedralProperties.size,p=f.size||k,t=p[0]/k[0],m=p[1]/k[1],k=p[2]/k[2];this._scale=[t,m,k];t=new d([t,0,0,0,m,0,0,
0,k]);this.hull=g;this.vertices=[];m=0;for(k=g.vertices.length;m<k;m++)this.vertices.push(t.vectorMultiply(g.vertices[m],new c));b.call(this,t);this.inverseInertia.copy(this.localInverseInertia);this.updateInertia();(f=f.angularVelocity)&&this.setAngularVelocity(f.x,f.y,f.z)}if(!(g instanceof f))if(g instanceof Array)g=new f(g);else throw Error("convexBodyFactory requires a ConvexHull object or an array of Vec3's as input.");e.prototype=Object.create(a.prototype);e.prototype.constructor=e;e.prototype.setSize=
function(a,b,c){var f=g.polyhedralProperties.size;this.size[0]=a;this.size[1]=b;this.size[2]=c;a/=f[0];b/=f[1];c/=f[2];this._scale=[a,b,c];c=new d([a,0,0,0,b,0,0,0,c]);f=this.vertices;a=0;for(b=g.vertices.length;a<b;a++)c.vectorMultiply(g.vertices[a],f[a]);return this};e.prototype.updateLocalInertia=function(){var a=new d([this._scale[0],0,0,0,this._scale[1],0,0,0,this._scale[2]]);b.call(this,a);return this};e.prototype.support=function(a){for(var b=this.vertices,d,f,g,k=-Infinity,e=0,q=b.length;e<
q;e++)d=b[e],f=c.dot(d,a),f>k&&(g=d,k=f);return g};e.prototype.updateShape=function(){for(var a=this.vertices,b=this.orientation,d=this.hull.vertices,f=this._scale[0],g=this._scale[1],e=this._scale[2],q=0,u=a.length;q<u;q++)k.copy(d[q]),k.x*=f,k.y*=g,k.z*=e,c.applyRotation(k,b,a[q]);return this};return e}},{"../../math/Mat33":32,"../../math/Vec3":35,"../Geometry":37,"./Particle":40}],44:[function(e,h,v){function b(b,f,e){this.a=b;this.b=f;a.call(this,e);this.effectiveInertia=new c;this.angularImpulse=
new d;this.error=0}var a=e("./Constraint"),d=e("../../math/Vec3"),c=e("../../math/Mat33"),f=new d;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.init=function(){this.cosAngle=this.cosAngle||this.a.orientation.dot(this.b.orientation)};b.prototype.update=function(){var a=this.a,b=this.b;this.error=2*(a.orientation.dot(b.orientation)-this.cosAngle);var d=this.angularImpulse;b.applyAngularImpulse(d);a.applyAngularImpulse(d.invert());c.add(a.inverseInertia,b.inverseInertia,
this.effectiveInertia);this.effectiveInertia.inverse();d.clear()};b.prototype.resolve=function(){var a=this.a,b=this.b;d.subtract(a.angularVelocity,b.angularVelocity,f);f.scale(1+this.error);var c=f.applyMatrix(this.effectiveInertia);b.applyAngularImpulse(c);a.applyAngularImpulse(c.invert());c.invert();this.angularImpulse.add(c)};h.exports=b},{"../../math/Mat33":32,"../../math/Vec3":35,"./Constraint":47}],45:[function(e,h,v){function b(b,f,g){this.a=b;this.b=f;a.call(this,g);this.impulse=new d;this.angImpulseA=
new d;this.angImpulseB=new d;this.error=new d;this.effMassMatrix=new c}var a=e("./Constraint"),d=e("../../math/Vec3"),c=e("../../math/Mat33"),f=e("../../math/Quaternion"),k=new d,g=new d,q=new d,l=new d,n=new d;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.init=function(){var a=this.anchor,b=this.a,c=this.b,g=f.conjugate(b.orientation,new f),k=f.conjugate(c.orientation,new f);this.rA=d.subtract(a,b.position,new d);this.rB=d.subtract(a,c.position,new d);this.bodyRA=g.rotateVector(this.rA,
new d);this.bodyRB=k.rotateVector(this.rB,new d)};b.prototype.update=function(a,b){var f=this.a,k=this.b,e=f.orientation.rotateVector(this.bodyRA,this.rA),n=k.orientation.rotateVector(this.bodyRB,this.rB),e=new c([0,e.z,-e.y,-e.z,0,e.x,e.y,-e.x,0]),n=new c([0,n.z,-n.y,-n.z,0,n.x,n.y,-n.x,0]),e=c.multiply(e,f.inverseInertia,new c).multiply(e.transpose()),n=c.multiply(n,k.inverseInertia,new c).multiply(n.transpose()),n=c.add(e,n,e),e=d.add(f.position,this.rA,this.anchor),l=d.add(k.position,this.rB,
g);d.subtract(l,e,this.error);this.error.scale(.2/b);e=f.inverseMass;l=k.inverseMass;e=new c([e+l,0,0,0,e+l,0,0,0,e+l]);c.add(n,e,this.effMassMatrix);this.effMassMatrix.inverse();n=this.impulse;e=this.angImpulseA;l=this.angImpulseB;k.applyImpulse(n);k.applyAngularImpulse(l);n.invert();f.applyImpulse(n);f.applyAngularImpulse(e);n.clear();e.clear();l.clear()};b.prototype.resolve=function(){var a=this.a,b=this.b,c=this.rA,f=this.rB,e=d.add(a.velocity,d.cross(a.angularVelocity,c,n),q),h=d.add(b.velocity,
d.cross(b.angularVelocity,f,n),l),e=e.subtract(h).subtract(this.error).applyMatrix(this.effMassMatrix),f=d.cross(f,e,k),c=d.cross(c,e,g).invert();b.applyImpulse(e);b.applyAngularImpulse(f);e.invert();a.applyImpulse(e);a.applyAngularImpulse(c);e.invert();this.impulse.add(e);this.angImpulseA.add(c);this.angImpulseB.add(f)};h.exports=b},{"../../math/Mat33":32,"../../math/Quaternion":33,"../../math/Vec3":35,"./Constraint":47}],46:[function(e,h,v){function b(a,b,d){return a<b?b:a>d?d:a}function a(a,b,
d,c,f,g){this.penetration=a;this.normal=b;this.worldContactA=d;this.worldContactB=c;this.localContactA=f;this.localContactB=g}function d(a,b){this.targets=[];a&&(this.targets=this.targets.concat(a));g.call(this,b)}function c(a,b,d){var c=n(b,d);c&&(c=p(b,d,c),null!==c&&a.contactManifoldTable.registerContact(b,d,c))}function f(a,b,d){if(8===b.type){var c=d;d=b;b=c}var f=b.position,g=d.position,e=d.normal,c=d.invNormal,n=b.support(c),f=k.add(f,n,new k),g=k.subtract(f,g,A),g=k.dot(g,c);if(!(0>g)){var e=
k.scale(e,g,new k).add(f),p=k.subtract(e,d.position,new k),c=m().reset(g,c,f,e,n,p);a.contactManifoldTable.registerContact(b,d,c)}}var k=e("../../math/Vec3"),g=e("./Constraint"),q=e("./collision/SweepAndPrune");v=e("./collision/BruteForce");var l=e("./collision/ConvexCollisionDetection"),n=l.gjk,p=l.epa,t=e("./collision/ContactManifold");e=e("../../utilities/ObjectManager");e.register("CollisionData",a);var m=e.requestCollisionData,A=new k;a.prototype.reset=function(a,b,d,c,f,g){this.penetration=
a;this.normal=b;this.worldContactA=d;this.worldContactB=c;this.localContactA=f;this.localContactB=g;return this};d.prototype=Object.create(g.prototype);d.prototype.constructor=d;d.prototype.init=function(){if(this.broadPhase){var a=this.broadphase;a instanceof Function&&(this.broadPhase=new a(this.targets))}else this.broadPhase=new q(this.targets);this.contactManifoldTable=this.contactManifoldTable||new t};d.prototype.update=function(a,b){this.contactManifoldTable.update(b);if(0!==this.targets.length){var d,
c;d=0;for(c=this.targets.length;d<c;d++)this.targets[d].updateShape();var f=this.broadPhase.update(),g;d=0;for(c=f.length;d<c;d++)(g=f[d])&&this.applyNarrowPhase(g);this.contactManifoldTable.prepContacts(b)}};d.prototype.resolve=function(a,b){this.contactManifoldTable.resolveManifolds(b)};d.prototype.addTarget=function(a){this.targets.push(a);this.broadPhase.add(a)};d.prototype.removeTarget=function(a){var b=this.targets.indexOf(a);0>b||(this.targets.splice(b,1),this.broadPhase.remove(a))};var r=
{};r[1]=c;r[2]=c;r[3]=c;r[5]=c;r[4]=function(a,b,d){var c=b.position,f=d.position,g=k.subtract(f,c,new k),e=g.length(),n=b.radius+d.radius,g=g.scale(1/e),e=n-e;if(!(0>e)){var n=k.scale(g,b.radius,new k),p=k.scale(g,-d.radius,new k),c=k.add(c,n,new k),f=k.add(f,p,new k),f=m().reset(e,g,c,f,n,p);a.contactManifoldTable.registerContact(b,d,f)}};r[6]=function(a,d,c){if(4===d.type){var f=c;c=d;d=f}var g=d.position,f=c.position,e=k.subtract(f,g,A),n=d.orientation,p=c.radius,l=d.size,t=.5*l[0],q=.5*l[1],
h=.5*l[2],l=d.normals,r=n.rotateVector(l[1],new k),F=n.rotateVector(l[0],new k),D=n.rotateVector(l[2],new k),l=new k;l.x=b(k.dot(e,r),-t,t);l.y=b(k.dot(e,F),-q,q);l.z=b(k.dot(e,D),-h,h);l.applyRotation(n);e=k.add(g,l,new k);e=k.subtract(e,f,new k);n=e.length();0==n&&(n=.1);p-=n;0>p||(n=k.scale(e,-1/n,new k),g=k.add(g,l,new k),f=k.add(f,e,new k),f=m().reset(p,n,g,f,l,e),a.contactManifoldTable.registerContact(d,c,f))};r[9]=f;r[10]=f;r[12]=f;d.prototype.applyNarrowPhase=function(a){for(var b=0,d=a.length;b<
d;b++)for(var c=b+1;c<d;c++){var f=a[b],g=a[c];if(0!==(f.collisionMask&g.collisionGroup&&f.collisionGroup&g.collisionMask)){var e=f.type|g.type;if(r[e])r[e](this,f,g)}}};d.SweepAndPrune=q;d.BruteForce=v.BruteForce;d.BruteForceAABB=v.BruteForceAABB;h.exports=d},{"../../math/Vec3":35,"../../utilities/ObjectManager":75,"./Constraint":47,"./collision/BruteForce":53,"./collision/ContactManifold":54,"./collision/ConvexCollisionDetection":55,"./collision/SweepAndPrune":56}],47:[function(e,h,v){function b(b){b=
b||{};this.setOptions(b);this._ID=a++}var a=0;b.prototype.setOptions=function(a){for(var b in a)this[b]=a[b];this.init(a)};b.prototype.init=function(a){};b.prototype.update=function(a,b){};b.prototype.resolve=function(a,b){};h.exports=b},{}],48:[function(e,h,v){function b(b,d){this.targets=b?b instanceof Array?b:[b]:[];a.call(this,d);this.impulses={};this.normals={};this.velocityBiases={};this.divisors={}}var a=e("./Constraint"),d=e("../../math/Vec3"),c=new d,f=new d,k=Math.PI;b.prototype=Object.create(a.prototype);
b.prototype.constructor=b;b.prototype.init=function(){this.equation1=this.equation1||function(){return 0};this.equation2=this.equation2||function(a,b,d){return d};this.period=this.period||1;this.dampingRatio=this.dampingRatio||.5;this.stiffness=4*k*k/(this.period*this.period);this.damping=4*k*this.dampingRatio/this.period};b.prototype.update=function(a,b){for(var e=this.targets,k=this.normals,p=this.velocityBiases,t=this.divisors,m=this.impulses,h=this.equation1,r=this.equation2,u=this.damping,L=
this.stiffness,y=0,z=e.length;y<z;y++){var x=e[y],B=x._ID;if(!x.immune){var v=x.position,N=x.mass,I,w;if(0===this.period)I=0,w=1;else{w=u*N;var J=L*N;I=1/(b*(w+b*J));w=b*J/(w+b*J)}var J=v.x,H=v.y,G=v.z,v=h(J,H,G),F=(h(J+1E-7,H,G)-v)/1E-7,D=(h(J,H+1E-7,G)-v)/1E-7,C=(h(J,H,G+1E-7)-v)/1E-7,E=r(J,H,G),K=(r(J+1E-7,H,G)-E)/1E-7,M=(r(J,H+1E-7,G)-E)/1E-7,J=(r(J,H,G+1E-7)-E)/1E-7;f.set(F+K,D+M,C+J);f.normalize();w=w*(v+E)/b;N=I+1/N;d.scale(f,m[B]||0,c);x.applyImpulse(c);k[B]=k[B]||new d;k[B].copy(f);p[B]=
w;t[B]=N;m[B]=0}}};b.prototype.resolve=function(){for(var a=this.targets,b=this.normals,f=this.velocityBiases,e=this.divisors,k=this.impulses,t=0,m=a.length;t<m;t++){var h=a[t],r=h._ID;if(!h.immune){var u=b[r],L=-(d.dot(u,h.velocity)+f[r])/e[r];d.scale(u,L,c);h.applyImpulse(c);k[r]+=L}}};h.exports=b},{"../../math/Vec3":35,"./Constraint":47}],49:[function(e,h,v){function b(b,c,f){this.a=b;this.b=c;a.call(this,f);this.distance=this.impulse=0;this.normal=new d;this.divisor=this.velocityBias=0}var a=
e("./Constraint"),d=e("../../math/Vec3"),c=new d,f=new d,k=new d,g=new d,q=new d,l=Math.PI;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.init=function(){this.direction=this.direction||d.subtract(this.b.position,this.a.position,new d);this.direction.normalize();this.minLength=this.minLength||0;this.period=this.period||.2;this.dampingRatio=this.dampingRatio||.5;this.stiffness=4*l*l/(this.period*this.period);this.damping=4*l*this.dampingRatio/this.period};b.prototype.update=
function(a,b){var e=this.a,k=this.b,l=e.position,h=e.inverseMass,u=k.position,L=k.inverseMass,y=this.direction;d.subtract(u,l,g);d.scale(y,d.dot(y,g),q);l=q.add(l);d.subtract(u,l,c);u=c.length();c.normalize();h+=L;L=1/h;0===this.period?(L=0,l=1):(l=this.damping*L,y=this.stiffness*L,L=1/(b*(l+b*y)),l=b*y/(l+b*y));l=l*u/b;h=L+h;d.scale(c,this.impulse,f);k.applyImpulse(f);e.applyImpulse(f.invert());this.normal.copy(c);this.distance=u;this.velocityBias=l;this.divisor=h;this.impulse=0};b.prototype.resolve=
function(){var a=this.a,b=this.b;if(!(Math.abs(this.distance)<this.minLength)){var c=this.normal;d.subtract(b.velocity,a.velocity,k);var g=-(d.dot(c,k)+this.velocityBias)/this.divisor;d.scale(c,g,f);b.applyImpulse(f);a.applyImpulse(f.invert());this.impulse+=g}};h.exports=b},{"../../math/Vec3":35,"./Constraint":47}],50:[function(e,h,v){function b(b,c,f){this.a=b;this.b=c;a.call(this,f);this.distance=this.impulse=0;this.normal=new d;this.divisor=this.velocityBias=0}var a=e("./Constraint"),d=e("../../math/Vec3"),
c=new d,f=new d,k=new d,g=new d,q=Math.PI;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.init=function(){this.length=this.length||d.subtract(this.b.position,this.a.position,g).length();this.minLength=this.minLength||0;this.period=this.period||.2;this.dampingRatio=this.dampingRatio||.5;this.stiffness=4*q*q/(this.period*this.period);this.damping=4*q*this.dampingRatio/this.period};b.prototype.update=function(a,b){var e=this.a,k=this.b,m=this.length,h=e.inverseMass,q=k.inverseMass;
d.subtract(k.position,e.position,g);var u=g.length();d.scale(g,1/u,c);m=u-m;h+=q;q=1/h;if(0===this.period)q=0,u=1;else var u=this.damping*q,L=this.stiffness*q,q=1/(b*(u+b*L)),u=b*L/(u+b*L);u=u*m/b;h=q+h;d.scale(c,this.impulse,f);k.applyImpulse(f);e.applyImpulse(f.invert());this.normal.copy(c);this.distance=m;this.velocityBias=u;this.divisor=h;this.impulse=0};b.prototype.resolve=function(){var a=this.a,b=this.b;if(!(Math.abs(this.distance)<this.minLength)){var c=a.getVelocity(),g=b.getVelocity(),e=
this.normal;d.subtract(g,c,k);c=-(d.dot(e,k)+this.velocityBias)/this.divisor;d.scale(e,c,f);b.applyImpulse(f);a.applyImpulse(f.invert());this.impulse+=c}};h.exports=b},{"../../math/Vec3":35,"./Constraint":47}],51:[function(e,h,v){function b(b,f,g){this.a=b;this.b=f;a.call(this,g);this.impulse=new d;this.angImpulseA=new d;this.angImpulseB=new d;this.error=new d;this.errorRot=[0,0];this.effMassMatrix=new c;this.effMassMatrixRot=[]}var a=e("./Constraint"),d=e("../../math/Vec3"),c=e("../../math/Mat33"),
f=e("../../math/Quaternion"),k=new d,g=new d,q=new d,l=new d,n=new d,p=new d,t=new d,m=new d;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.init=function(){var a=this.anchor,b=this.axis.normalize(),c=this.a,g=this.b,e=f.conjugate(c.orientation,new f),k=f.conjugate(g.orientation,new f);this.rA=d.subtract(a,c.position,new d);this.rB=d.subtract(a,g.position,new d);this.bodyRA=e.rotateVector(this.rA,new d);this.bodyRB=k.rotateVector(this.rB,new d);this.axisA=d.clone(b);this.axisB=
d.clone(b);this.axisBTangent1=new d;this.axisBTangent2=new d;this.t1xA=new d;this.t2xA=new d;this.bodyAxisA=e.rotateVector(b,new d);this.bodyAxisB=k.rotateVector(b,new d)};b.prototype.update=function(a,b){var f=this.a,e=this.b,n=f.orientation.rotateVector(this.bodyAxisA,this.axisA),m=e.orientation.rotateVector(this.bodyAxisB,this.axisB);this.axis.copy(m);var p=this.axisBTangent1,t=this.axisBTangent2;.57735<=m.x?p.set(m.y,-m.x,0):p.set(0,m.z,-m.y);p.normalize();d.cross(m,p,t);var h=d.cross(p,n,this.t1xA),
m=d.cross(t,n,this.t2xA),v=f.orientation.rotateVector(this.bodyRA,this.rA),I=e.orientation.rotateVector(this.bodyRB,this.rB),v=new c([0,v.z,-v.y,-v.z,0,v.x,v.y,-v.x,0]),I=new c([0,I.z,-I.y,-I.z,0,I.x,I.y,-I.x,0]),v=c.multiply(v,f.inverseInertia,new c).multiply(v.transpose()),I=c.multiply(I,e.inverseInertia,new c).multiply(I.transpose()),v=c.add(v,I,v),w=d.add(f.position,this.rA,this.anchor),J=d.add(e.position,this.rB,k),I=1/b;d.subtract(J,w,this.error);this.error.scale(.2*I);w=f.inverseMass;J=e.inverseMass;
w=new c([w+J,0,0,0,w+J,0,0,0,w+J]);c.add(v,w,this.effMassMatrix);this.effMassMatrix.inverse();var H=f.inverseInertia.vectorMultiply(h,k),w=f.inverseInertia.vectorMultiply(m,g),G=e.inverseInertia.vectorMultiply(h,q),J=e.inverseInertia.vectorMultiply(m,l),v=d.dot(h,H)+d.dot(h,G),h=d.dot(h,w)+d.dot(h,J),H=d.dot(m,H)+d.dot(m,G),m=d.dot(m,w)+d.dot(m,J),w=1/(v*m-h*H);this.effMassMatrixRot[0]=m*w;this.effMassMatrixRot[1]=-H*w;this.effMassMatrixRot[2]=-h*w;this.effMassMatrixRot[3]=v*w;this.errorRot[0]=.2*
d.dot(n,p)*I;this.errorRot[1]=.2*d.dot(n,t)*I;n=this.impulse.scale(.5);p=this.angImpulseA.scale(.5);t=this.angImpulseB.scale(.5);e.applyImpulse(n);e.applyAngularImpulse(t);n.invert();f.applyImpulse(n);f.applyAngularImpulse(p);n.clear();p.clear();t.clear()};b.prototype.resolve=function(){var a=this.a,b=this.b,c=this.rA,f=this.rB,e=this.t1xA,h=this.t2xA,x=a.angularVelocity,B=b.angularVelocity,v=d.add(a.velocity,d.cross(x,c,t),n),N=d.add(b.velocity,d.cross(B,f,t),p),v=v.subtract(N).subtract(this.error).applyMatrix(this.effMassMatrix),
B=d.subtract(B,x,m),N=this.errorRot,x=d.dot(e,B)+N[0],B=d.dot(h,B)+N[1],N=this.effMassMatrixRot,I=-(N[2]*x+N[3]*B),e=d.scale(e,-(N[0]*x+N[1]*B),g).add(d.scale(h,I,q)),f=d.cross(f,v,k).add(e),c=d.cross(c,v,l).invert().subtract(e);b.applyImpulse(v);b.applyAngularImpulse(f);v.invert();a.applyImpulse(v);a.applyAngularImpulse(c);v.invert();this.impulse.add(v);this.angImpulseA.add(c);this.angImpulseB.add(f)};h.exports=b},{"../../math/Mat33":32,"../../math/Quaternion":33,"../../math/Vec3":35,"./Constraint":47}],
52:[function(e,h,v){function b(a){this._body=a;this._ID=a._ID;this.position=null;this.vertices={x:[],y:[],z:[]};this.update()}b.prototype.update=function(){var a=this._body,b=this.position=a.position,c=Infinity,f=-Infinity,e=Infinity,g=-Infinity,h=Infinity,l=-Infinity,n=a.type;if(4===n)f=g=l=a.radius,c=e=h=-a.radius;else if(8===n)switch(a=a.direction,f=g=l=1E6,c=e=h=-1E6,a){case 0:g=25;e=-1E3;break;case 1:g=1E3;e=-25;break;case 2:f=25;c=-1E3;break;case 3:f=1E3;c=-25;break;case 4:l=25;h=-1E3;break;
case 5:l=1E3,h=-25}else if(a.vertices)for(var a=a.vertices,n=0,p=a.length;n<p;n++){var t=a[n];t.x<c&&(c=t.x);t.x>f&&(f=t.x);t.y<e&&(e=t.y);t.y>g&&(g=t.y);t.z<h&&(h=t.z);t.z>l&&(l=t.z)}else f=g=l=25,c=e=h=-25;a=this.vertices;a.x[0]=c+b.x;a.x[1]=f+b.x;a.y[0]=e+b.y;a.y[1]=g+b.y;a.z[0]=h+b.z;a.z[1]=l+b.z};b.checkOverlap=function(a,b){var c=a.vertices,f=b.vertices,e=c.x[0],g=c.x[1],h=f.x[0],l=f.x[1];if(h<=e&&e<=l||e<=h&&h<=g)if(e=c.y[0],g=c.y[1],h=f.y[0],l=f.y[1],h<=e&&e<=l||e<=h&&h<=g)if(e=c.z[0],c=c.z[1],
g=f.z[0],f=f.z[1],g<=e&&e<=f||e<=g&&g<=c)return!0;return!1};b.vertexThreshold=100;h.exports=b},{}],53:[function(e,h,v){function b(a){this._volumes=[];this._entityRegistry={};for(var b=0;b<a.length;b++)this.add(a[b])}function a(a){this.targets=a}var d=e("./AABB");b.prototype.add=function(a){var b=new d(a);this._entityRegistry[a._ID]=a;this._volumes.push(b)};b.prototype.update=function(){for(var a=this._volumes,b=this._entityRegistry,e=0,g=a.length;e<g;e++)a[e].update();for(var e=[],g=0,h=a.length;g<
h;g++)for(var l=g+1;l<h;l++)d.checkOverlap(a[g],a[l])&&e.push([b[g],b[l]]);return e};a.prototype.add=function(a){this.targets.push(a)};a.prototype.update=function(){return[this.targets]};h.exports.BruteForceAABB=b;h.exports.BruteForce=a},{"./AABB":52}],54:[function(e,h,v){function b(){this.manifolds=[];this.collisionMatrix={};this._IDPool=[]}function a(a,b,d,c){this.lowID=a;this.highID=b;this.contacts=[];this.numContacts=0;this.bodyA=d;this.bodyB=c;this.lru=0}function d(a,b,d){this.bodyA=a;this.bodyB=
b;this.data=d;this.tangentImpulse2=this.tangentImpulse1=this.normalImpulse=0;this.impulse=new c;this.angImpulseA=new c;this.angImpulseB=new c;d&&this.init()}var c=e("../../../math/Vec3"),f=e("../../../utilities/ObjectManager");f.register("Manifold",a);f.register("Contact",d);var k=f.requestManifold,g=f.requestContact,q=f.freeManifold,l=f.freeContact,n=new c,p=new c,t=new c,m=new c,A=new c,r=new c,u=new c,L=new c,y=new c,z=new c,x=new c,B=new c,O=new c,N=new c,I=new c;b.prototype.addManifold=function(a,
b,d,c){var f=this.collisionMatrix;f[a]=f[a]||{};f=this._IDPool.length?this._IDPool.pop():this.manifolds.length;this.collisionMatrix[a][b]=f;a=k().reset(a,b,d,c);return this.manifolds[f]=a};b.prototype.removeManifold=function(a,b){var d=this.collisionMatrix;this.manifolds[b]=null;d[a.lowID][a.highID]=null;this._IDPool.push(b);q(a)};b.prototype.update=function(a){for(var b=this.manifolds,d=0,c=b.length;d<c;d++){var f=b[d];f&&!f.update(a)&&(this.removeManifold(f,d),f.bodyA.events.trigger("collision:end",
f),f.bodyB.events.trigger("collision:end",f))}};b.prototype.prepContacts=function(a){for(var b=this.manifolds,d=0,c=b.length;d<c;d++){var f=b[d];if(f)for(var f=f.contacts,e=0,g=f.length;e<g;e++){var k=f[e];k&&k.update(a)}}};b.prototype.resolveManifolds=function(){for(var a=this.manifolds,b=0,d=a.length;b<d;b++){var c=a[b];c&&c.resolveContacts()}};b.prototype.registerContact=function(a,b,d){var c,f;a._ID<b._ID?(c=a._ID,f=b._ID):(c=b._ID,f=a._ID);var e=this.manifolds,g=this.collisionMatrix;g[c]&&null!=
g[c][f]?(c=e[g[c][f]],c.contains(d),c.addContact(a,b,d)):(c=this.addManifold(c,f,a,b),c.addContact(a,b,d),a.events.trigger("collision:start",c),b.events.trigger("collision:start",c))};a.prototype.reset=function(a,b,d,c){this.lowID=a;this.highID=b;this.contacts=[];this.numContacts=0;this.bodyA=d;this.bodyB=c;this.lru=0;return this};a.prototype.addContact=function(a,b,d){var c=this.lru;this.contacts[c]&&this.removeContact(this.contacts[c],c);this.contacts[c]=g().reset(a,b,d);this.lru=(this.lru+1)%4;
this.numContacts++};a.prototype.removeContact=function(a,b){this.contacts[b]=null;this.numContacts--;f.freeCollisionData(a.data);a.data=null;l(a)};a.prototype.contains=function(a){var b=a.worldContactA;a=a.worldContactB;for(var d=this.contacts,f=0,e=d.length;f<e;f++){var g=d[f];if(g){var k=g.data,n=c.subtract(k.worldContactA,b,N).length(),k=c.subtract(k.worldContactB,a,I).length();if(10>n||10>k)return this.removeContact(g,f),!0}}return!1};a.prototype.update=function(){for(var a=this.contacts,b=this.bodyA.position,
d=this.bodyB.position,f=0,e=a.length;f<e;f++){var g=a[f];if(g){var k=g.data,n=k.normal,m=k.localContactB,p=k.worldContactA,l=k.worldContactB,k=c.add(b,k.localContactA,x),m=c.add(d,m,B),n=0<c.dot(c.subtract(m,k,O),n),p=c.subtract(p,k,N),l=c.subtract(l,m,I);(10<=p.length()||10<=l.length()||n)&&this.removeContact(g,f)}}return this.numContacts?!0:!1};a.prototype.resolveContacts=function(){for(var a=this.contacts,b=0,d=a.length;b<d;b++)a[b]&&a[b].resolve()};d.prototype.reset=function(a,b,d){this.bodyA=
a;this.bodyB=b;this.data=d;this.tangentImpulse2=this.tangentImpulse1=this.normalImpulse=0;this.impulse.clear();this.angImpulseA.clear();this.angImpulseB.clear();this.init();return this};d.prototype.init=function(){var a=this.data,b=a.normal,d=new c;.57735<=b.x?d.set(b.y,-b.x,0):d.set(0,b.z,-b.y);d.normalize();var f=c.cross(b,d,new c);this.tangent1=d;this.tangent2=f;var e=this.bodyA,g=this.bodyB,k=a.localContactA,m=a.localContactB,a=e.inverseMass+g.inverseMass,p=c.cross(k,b,r),b=c.cross(m,b,u);this.effNormalMass=
1/(a+c.dot(p,e.inverseInertia.vectorMultiply(p,n))+c.dot(b,g.inverseInertia.vectorMultiply(b,n)));b=c.cross(k,d,r);d=c.cross(m,d,u);this.effTangentialMass1=1/(a+c.dot(b,e.inverseInertia.vectorMultiply(b,n))+c.dot(d,g.inverseInertia.vectorMultiply(d,n)));k=c.cross(k,f,r);f=c.cross(m,f,u);this.effTangentialMass2=1/(a+c.dot(k,e.inverseInertia.vectorMultiply(k,n))+c.dot(f,g.inverseInertia.vectorMultiply(f,n)));this.restitution=Math.min(e.restitution,g.restitution);this.friction=e.friction*g.friction};
d.prototype.update=function(a){var b=this.data,d=this.bodyA,f=this.bodyB,e=b.localContactB,g=b.normal,k=c.add(d.velocity,c.cross(d.angularVelocity,b.localContactA,A),t),e=c.add(f.velocity,c.cross(f.angularVelocity,e,A),m).subtract(k),g=c.dot(e,g),e=20>Math.abs(g)?0:this.restitution;this.velocityBias=-.15*Math.max(b.penetration-1.5,0)/a;this.velocityBias+=e*g;a=this.impulse.scale(.25);b=this.angImpulseA.scale(.25);g=this.angImpulseB.scale(.25);f.applyImpulse(a);f.applyAngularImpulse(g);a.invert();
d.applyImpulse(a);d.applyAngularImpulse(b);this.tangentImpulse2=this.tangentImpulse1=this.normalImpulse=0;a.clear();b.clear();g.clear()};d.prototype.resolve=function(){var a=this.data,b=this.bodyA,d=this.bodyB,f=a.localContactA,e=a.localContactB,g=a.normal,k=this.tangent1,l=this.tangent2,a=c.add(b.velocity,c.cross(b.angularVelocity,f,A),t),h=c.add(d.velocity,c.cross(d.angularVelocity,e,A),m).subtract(a),q=-(c.dot(h,g)+this.velocityBias)*this.effNormalMass,a=Math.max(this.normalImpulse+q,0),q=a-this.normalImpulse,
r=this.friction*a,u=-c.dot(h,k)*this.effTangentialMass1,x;x=this.tangentImpulse1+u;u=-r;x=x<u?u:x>r?r:x;var u=x-this.tangentImpulse1,h=-c.dot(h,l)*this.effTangentialMass2,h=this.tangentImpulse2+h,v=-r,r=h<v?v:h>r?r:h,h=r-this.tangentImpulse2,g=c.scale(g,q,L),k=c.scale(k,u,y),l=c.scale(l,h,z);g.add(k).add(l);e=c.cross(e,g,n);f=c.cross(f,g,p).invert();d.applyImpulse(g);d.applyAngularImpulse(e);g.invert();b.applyImpulse(g);b.applyAngularImpulse(f);this.normalImpulse=a;this.tangentImpulse1=x;this.tangentImpulse2=
r;this.impulse.add(g);this.angImpulseA.add(f);this.angImpulseB.add(e)};h.exports=b},{"../../../math/Vec3":35,"../../../utilities/ObjectManager":75}],55:[function(e,h,v){function b(a,b,d){this.vertex=a;this.worldVertexA=b;this.worldVertexB=d}function a(a){var b=a.vertices,d;for(d=b.length;d--;){var c=b.pop();null!==c&&q(c)}a.numVertices=0;b=a.features;for(d=b.length;d--;)c=b.pop(),null!==c&&n(c);a.numFeatures=0;l(a)}function d(a,b,d){var f=c.scale(d,-1,u);a=c.add(a.support(d),a.position,new c);b=c.add(b.support(f),
b.position,new c);return k().reset(c.subtract(a,b,new c),a,b)}var c=e("../../../math/Vec3"),f=e("../../../utilities/ObjectManager");f.register("GJK_EPASupportPoint",b);var k=f.requestGJK_EPASupportPoint,g=f.requestDynamicGeometry,q=f.freeGJK_EPASupportPoint,l=f.freeDynamicGeometry,n=f.freeDynamicGeometryFeature,p=new c,t=new c,m=new c,A=new c,r=new c,u=new c;b.prototype.reset=function(a,b,d){this.vertex=a;this.worldVertexA=b;this.worldVertexB=d;return this};h.exports.gjk=function(b,f){var e=c.subtract(f.position,
b.position,r).normalize(),k=g();k.addVertex(d(b,f,e));e.invert();for(var n=0;1E3>n++&&(0!==e.x||0!==e.y||0!==e.z);){k.addVertex(d(b,f,e));if(0>c.dot(k.getLastVertex().vertex,e))break;if(k.simplexContainsOrigin(e,q))return k}a(k);return!1};h.exports.epa=function(b,e,g){for(var k=Infinity,n=0;1E3>n++;){var l=g.getFeatureClosestToOrigin();if(null===l)return null;var h=l.normal,r=d(b,e,h),k=Math.min(k,c.dot(r.vertex,h));if(.01>=k-l.distance){var k=g.vertices[l.vertexIndices[0]],n=g.vertices[l.vertexIndices[1]],
u=g.vertices[l.vertexIndices[2]],v=k.vertex,H=n.vertex,G=u.vertex,F=c.scale(h,l.distance,p),H=c.subtract(H,v,t),G=c.subtract(G,v,m),D=c.subtract(F,v,A),v=c.dot(H,H),F=c.dot(H,G),C=c.dot(G,G),H=c.dot(D,H),D=c.dot(D,G),E=v*C-F*F,G=(C*H-F*D)/E,F=(v*D-F*H)/E,H=1-G-F,v=k.worldVertexA.scale(H).add(n.worldVertexA.scale(G)).add(u.worldVertexA.scale(F)),k=k.worldVertexB.scale(H).add(n.worldVertexB.scale(G)).add(u.worldVertexB.scale(F));b=c.subtract(v,b.position,new c);e=c.subtract(k,e.position,new c);a(g);
q(r);return f.requestCollisionData().reset(l.distance,h,v,k,b,e)}g.addVertex(r);g.reshape()}throw Error("EPA failed to terminate in allotted iterations.");}},{"../../../math/Vec3":35,"../../../utilities/ObjectManager":75}],56:[function(e,h,v){function b(a){this._sweepVolumes=[];this._entityRegistry={};this._boundingVolumeRegistry={};this.endpoints={x:[],y:[],z:[]};this.overlaps=[];this.overlapsMatrix={};this._IDPool=[];a=a||[];for(var b=0;b<a.length;b++)this.add(a[b])}function a(a){this._boundingVolume=
a;this._ID=a._ID;this.points={x:[{_ID:a._ID,side:0,value:null},{_ID:a._ID,side:1,value:null}],y:[{_ID:a._ID,side:0,value:null},{_ID:a._ID,side:1,value:null}],z:[{_ID:a._ID,side:0,value:null},{_ID:a._ID,side:1,value:null}]};this.update()}var d=e("./AABB"),c=["x","y","z"];b.prototype.add=function(b){var e=new d(b),g=new a(e);this._entityRegistry[b._ID]=b;this._boundingVolumeRegistry[b._ID]=e;this._sweepVolumes.push(g);for(b=0;3>b;b++)e=c[b],this.endpoints[e].push(g.points[e][0]),this.endpoints[e].push(g.points[e][1])};
b.prototype.remove=function(a){this._entityRegistry[a._ID]=null;this._boundingVolumeRegistry[a._ID]=null;var b,d,c;b=0;for(d=this._sweepVolumes.length;b<d;b++)if(this._sweepVolumes[b]._ID===a._ID){c=b;break}this._sweepVolumes.splice(c,1);c=this.endpoints;var e,n=[];b=0;for(d=c.x.length;b<d;b++)e=c.x[b],e._ID!==a._ID&&n.push(e);var p=[];b=0;for(d=c.y.length;b<d;b++)e=c.y[b],e._ID!==a._ID&&p.push(e);var h=[];b=0;for(d=c.z.length;b<d;b++)e=c.z[b],e._ID!==a._ID&&h.push(e);c.x=n;c.y=p;c.z=h};b.prototype.update=
function(){var a=this._sweepVolumes,b=this._entityRegistry,e=this._boundingVolumeRegistry,h,l,n;h=0;for(n=a.length;h<n;h++)a[h].update();var p=this.endpoints,t=this.overlaps,m=this.overlapsMatrix,A=this._IDPool;for(l=0;3>l;l++){var r=p[c[l]];h=1;for(n=r.length;h<n;h++){for(var u=r[h],v=u.value,y,z,x,B,O,N,a=h-1;0<=a&&(y=r[a]).value>v;)x=u._ID,N=y._ID,x<N?(B=x,O=N):(B=N,O=x),~u.side&y.side?d.checkOverlap(e[x],e[N])&&(z=m[B]=m[B]||{},x=z[O]=A.length?A.pop():t.length,t[x]=[b[B],b[O]]):u.side&~y.side&&
(z=m[B])&&null!=z[O]&&(x=z[O],t[x]=null,z[O]=null,A.push(x)),r[a+1]=y,a--;r[a+1]=u}}return t};a.prototype.update=function(){var a=this._boundingVolume;a.update();for(var b=this.points,d=0;3>d;d++){var e=c[d];b[e][0].value=a.vertices[e][0];b[e][1].value=a.vertices[e][1]}};h.exports=b},{"./AABB":52}],57:[function(e,h,v){function b(b,d){a.call(this,b,d)}var a=e("./Force"),d=e("../../math/Vec3"),c=new d;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.QUADRATIC=function(a){return a*
a};b.LINEAR=function(a){return a};b.prototype.init=function(){this.max=this.max||Infinity;this.strength=this.strength||1;this.type=this.type||b.LINEAR};b.prototype.update=function(){for(var a=this.targets,b=this.type,e=this.max,h=this.strength,l=0,n=a.length;l<n;l++){var p=a[l],t=p.velocity,m=t.length(),A=m?1/m:0,m=-h*b(m);d.scale(t,(m<-e?-e:m)*A,c);p.applyForce(c)}};h.exports=b},{"../../math/Vec3":35,"./Force":58}],58:[function(e,h,v){function b(b,c){this.targets=b?b instanceof Array?b:[b]:[];c=
c||{};this.setOptions(c);this._ID=a++}var a=0;b.prototype.setOptions=function(a){for(var b in a)this[b]=a[b];this.init(a)};b.prototype.addTarget=function(a){this.targets.push(a)};b.prototype.removeTarget=function(a){a=this.targets.indexOf(a);0>a||this.targets.splice(a,1)};b.prototype.init=function(a){};b.prototype.update=function(a,b){};h.exports=b},{}],59:[function(e,h,v){function b(b,d){a.call(this,b,d)}var a=e("./Force"),d=e("../../math/Vec3"),c=new d;b.prototype=Object.create(a.prototype);b.prototype.constructor=
b;b.DOWN=0;b.UP=1;b.LEFT=2;b.RIGHT=3;b.FORWARD=4;b.BACKWARD=5;b.prototype.init=function(a){this.max=this.max||Infinity;if(a.acceleration)this.strength=this.acceleration.length(),this.direction=-1;else{a=this.acceleration=new d;var c=this.direction=this.direction||b.DOWN,e=this.strength=this.strength||200;switch(c){case b.DOWN:a.set(0,e,0);break;case b.UP:a.set(0,-1*e,0);break;case b.LEFT:a.set(-1*e,0,0);break;case b.RIGHT:a.set(e,0,0);break;case b.FORWARD:a.set(0,0,-1*e);break;case b.BACKWARD:a.set(0,
0,e)}}};b.prototype.update=function(){for(var a=this.targets,b=this.max,e=this.acceleration,h=e.length(),l=h?1/h:0,n=0,p=a.length;n<p;n++){var t=a[n],m=h*t.mass;d.scale(e,(m>b?b:m)*l,c);t.applyForce(c)}};h.exports=b},{"../../math/Vec3":35,"./Force":58}],60:[function(e,h,v){function b(b,d,c){this.source=b||null;a.call(this,d,c)}var a=e("./Force"),d=e("../../math/Vec3"),c=new d;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.init=function(){this.max=this.max||Infinity;this.strength=
this.strength||200};b.prototype.update=function(){for(var a=this.source,b=this.targets,e=this.strength,h=this.max,l=this.anchor||a.position,n=this.anchor?1:a.mass,p=0,t=b.length;p<t;p++){var m=b[p];d.subtract(l,m.position,c);var A=c.length(),A=A?1/A:0,r=e*n*m.mass*A*A,r=0>r?r<-h?-h:r:r>h?h:r;c.scale(r*A);m.applyForce(c);a&&a.applyForce(c.invert())}};h.exports=b},{"../../math/Vec3":35,"./Force":58}],61:[function(e,h,v){function b(b,d){a.call(this,b,d)}var a=e("./Force"),d=e("../../math/Vec3"),c=new d;
b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.QUADRATIC=function(a){return a.length()};b.LINEAR=function(){return 1};b.prototype.init=function(){this.max=this.max||Infinity;this.strength=this.strength||1;this.type=this.type||b.LINEAR};b.prototype.update=function(){for(var a=this.targets,b=this.type,e=this.max,h=this.strength,l=0,n=a.length;l<n;l++){var p=a[l],t=p.angularVelocity,m=-h*b(t);d.scale(t,m<-e?-e:m,c);p.applyTorque(c)}};h.exports=b},{"../../math/Vec3":35,"./Force":58}],
62:[function(e,h,v){function b(b,d,c){this.source=b||null;a.call(this,d,c)}var a=e("./Force"),d=e("../../math/Vec3"),c=e("../../math/Mat33"),f=e("../../math/Quaternion"),k=new f,g=new d,q=new d,l=new c,n=Math.PI;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.init=function(a){this.source||(this.anchor=this.anchor?this.anchor.normalize():new f(1,0,0,0));if(a.stiffness||a.damping)this.stiffness=this.stiffness||100,this.damping=this.damping||0,this.dampingRatio=this.period=
null;else if(a.period||a.dampingRatio)this.period=this.period||1,this.dampingRatio=this.dampingRatio||0,this.stiffness=2*n/this.period,this.stiffness*=this.stiffness,this.damping=4*n*this.dampingRatio/this.period};b.prototype.update=function(){for(var a=this.source,b=this.targets,e=this.max,n=this.stiffness,h=this.damping,u=this.anchor||a.orientation,v=this.anchor?null:a.inverseInertia,y=0,z=b.length;y<z;y++){var x=b[y];f.conjugate(x.orientation,k);k.multiply(u);if(!(1<=k.w)){var B=Math.acos(k.w),
O=Math.sqrt(1-k.w*k.w),B=q.copy(k).scale(2*B/O);B.scale(n);null!==v?c.add(v,x.inverseInertia,l).inverse():c.inverse(x.inverseInertia,l);0!==h&&(a?B.add(d.subtract(x.angularVelocity,a.angularVelocity,g).scale(-h)):B.add(d.scale(x.angularVelocity,-h,g)));B=B.applyMatrix(l);O=B.length();O>e&&B.scale(e/O);x.applyTorque(B);a&&a.applyTorque(B.invert())}}};h.exports=b},{"../../math/Mat33":32,"../../math/Quaternion":33,"../../math/Vec3":35,"./Force":58}],63:[function(e,h,v){function b(b,d,c){this.source=
b||null;a.call(this,d,c)}var a=e("./Force"),d=e("../../math/Vec3"),c=new d,f=new d;b.prototype=Object.create(a.prototype);b.prototype.constructor=b;var k=Math.PI;b.FENE=function(a,b){var d=.99*b,d=Math.max(Math.min(a,d),-d);return d/(1-d*d/(b*b))};b.HOOKE=function(a){return a};b.prototype.init=function(a){this.max=this.max||Infinity;this.length=this.length||0;this.type=this.type||b.HOOKE;this.maxLength=this.maxLength||Infinity;if(a.stiffness||a.damping)this.stiffness=this.stiffness||100,this.damping=
this.damping||0,this.dampingRatio=this.period=null;else if(a.period||a.dampingRatio)this.period=this.period||1,this.dampingRatio=this.dampingRatio||0,this.stiffness=2*k/this.period,this.stiffness*=this.stiffness,this.damping=4*k*this.dampingRatio/this.period};b.prototype.update=function(){for(var a=this.source,b=this.targets,e=this.max,k=this.stiffness,h=this.damping,t=this.length,m=this.maxLength,A=this.anchor||a.position,r=this.anchor?0:a.inverseMass,u=this.type,v=0,y=b.length;v<y;v++){var z=b[v];
d.subtract(A,z.position,c);var x=c.length()-t;if(!(1E-6>Math.abs(x))){var B=1/(z.inverseMass+r);null!==this.period&&(k*=B,h*=B);c.scale(k*u(x,m)/x);0!==h&&(a?c.add(d.subtract(z.velocity,a.velocity,f).scale(-h)):c.add(d.scale(z.velocity,-h,f)));x=c.length();d.scale(c,(x>e?e:x)*(x?1/x:0),c);z.applyForce(c);a&&a.applyForce(c.invert())}}};h.exports=b},{"../../math/Vec3":35,"./Force":58}],64:[function(e,h,v){h.exports={Particle:e("./bodies/Particle"),convexBodyFactory:e("./bodies/convexBodyFactory"),Box:e("./bodies/Box"),
Sphere:e("./bodies/Sphere"),Wall:e("./bodies/Wall"),Constraint:e("./constraints/Constraint"),Angle:e("./constraints/Angle"),Collision:e("./constraints/Collision"),Direction:e("./constraints/Direction"),Distance:e("./constraints/Distance"),Curve:e("./constraints/Curve"),Hinge:e("./constraints/Hinge"),BallAndSocket:e("./constraints/BallAndSocket"),Force:e("./forces/Force"),Drag:e("./forces/Drag"),RotationalDrag:e("./forces/RotationalDrag"),Gravity1D:e("./forces/Gravity1D"),Gravity3D:e("./forces/Gravity3D"),
Spring:e("./forces/Spring"),RotationalSpring:e("./forces/RotationalSpring"),PhysicsEngine:e("./PhysicsEngine"),Geometry:e("./Geometry")}},{"./Geometry":37,"./PhysicsEngine":38,"./bodies/Box":39,"./bodies/Particle":40,"./bodies/Sphere":41,"./bodies/Wall":42,"./bodies/convexBodyFactory":43,"./constraints/Angle":44,"./constraints/BallAndSocket":45,"./constraints/Collision":46,"./constraints/Constraint":47,"./constraints/Curve":48,"./constraints/Direction":49,"./constraints/Distance":50,"./constraints/Hinge":51,
"./forces/Drag":57,"./forces/Force":58,"./forces/Gravity1D":59,"./forces/Gravity3D":60,"./forces/RotationalDrag":61,"./forces/RotationalSpring":62,"./forces/Spring":63}],65:[function(e,h,v){var b=0;e=["ms","moz","webkit","o"];var a,d;if("object"===typeof window){a=window.requestAnimationFrame;d=window.cancelAnimationFrame||window.cancelRequestAnimationFrame;for(v=0;v<e.length&&!a;++v)a=window[e[v]+"RequestAnimationFrame"],d=window[e[v]+"CancelRequestAnimationFrame"]||window[e[v]+"CancelAnimationFrame"];
a&&!d&&(a=null)}if(!a){var c=Date.now?Date.now:function(){return(new Date).getTime()};a=function(a){var d=c(),e=Math.max(0,16-(d-b)),h=setTimeout(function(){a(d+e)},e);b=d+e;return h};d=function(a){clearTimeout(a)}}h.exports={requestAnimationFrame:a,cancelAnimationFrame:d}},{}],66:[function(e,h,v){h.exports={requestAnimationFrame:e("./animationFrame").requestAnimationFrame,cancelAnimationFrame:e("./animationFrame").cancelAnimationFrame}},{"./animationFrame":65}],67:[function(e,h,v){function b(){var a=
this;this._updates=[];this._looper=function(b){a.loop(b)};this._sleep=this._stoppedAt=this._time=0;this._startOnVisibilityChange=!0;this._rAF=null;this._sleepDiff=!0;this.start();c&&document.addEventListener(k,function(){a._onVisibilityChange()})}e=e("../polyfills");var a=e.requestAnimationFrame,d=e.cancelAnimationFrame,c="undefined"!==typeof document;if(c){var f,k;"undefined"!==typeof document.hidden?(f="hidden",k="visibilitychange"):"undefined"!==typeof document.mozHidden?(f="mozHidden",k="mozvisibilitychange"):
"undefined"!==typeof document.msHidden?(f="msHidden",k="msvisibilitychange"):"undefined"!==typeof document.webkitHidden&&(f="webkitHidden",k="webkitvisibilitychange")}b.prototype._onVisibilityChange=function(){document[f]?this._onUnfocus():this._onFocus()};b.prototype._onFocus=function(){this._startOnVisibilityChange&&this._start()};b.prototype._onUnfocus=function(){this._stop()};b.prototype.start=function(){this._running||(this._startOnVisibilityChange=!0,this._start());return this};b.prototype._start=
function(){this._sleepDiff=this._running=!0;this._rAF=a(this._looper)};b.prototype.stop=function(){this._running&&(this._startOnVisibilityChange=!1,this._stop());return this};b.prototype._stop=function(){this._running=!1;this._stoppedAt=this._time;d(this._rAF)};b.prototype.isRunning=function(){return this._running};b.prototype.step=function(a){this._time=a;this._sleepDiff&&(this._sleep+=a-this._stoppedAt,this._sleepDiff=!1);a-=this._sleep;for(var b=0,d=this._updates.length;b<d;b++)this._updates[b].update(a);
return this};b.prototype.loop=function(b){this.step(b);this._rAF=a(this._looper);return this};b.prototype.update=function(a){-1===this._updates.indexOf(a)&&this._updates.push(a);return this};b.prototype.noLongerUpdate=function(a){a=this._updates.indexOf(a);-1<a&&this._updates.splice(a,1);return this};h.exports=b},{"../polyfills":66}],68:[function(e,h,v){function b(){d();this._contexts={};this._outCommands=[];this._inCommands=[];this._time=null;this._resized=!1;var a=this;window.addEventListener("resize",
function(){a.onResize()})}var a=e("./Context"),d=e("./inject-css"),c=e("../core/Commands");b.prototype.onResize=function(){this._resized=!0;for(var a in this._contexts)this._contexts[a].updateSize()};b.prototype.getTime=function(){return this._time};b.prototype.sendEvent=function(a,b,d){this._outCommands.push(c.WITH,a,c.TRIGGER,b,d)};b.prototype.sendResize=function(a,b){this.sendEvent(a,"CONTEXT_RESIZE",b)};b.prototype.handleWith=function(a,b){var d=b[a],c=d.split("/");return this.getOrSetContext(c.shift()).receive(d,
b,a)};b.prototype.getOrSetContext=function(b){if(this._contexts[b])return this._contexts[b];var d=new a(b,this);return this._contexts[b]=d};b.prototype.getContext=function(a){if(this._contexts[a])return this._contexts[a]};b.prototype.drawCommands=function(){for(var a=this._inCommands,b=0,d=a[b];d;){switch(d){case c.TIME:this._time=a[++b];break;case c.WITH:b=this.handleWith(++b,a);break;case c.NEED_SIZE_FOR:this.giveSizeFor(++b,a)}d=a[++b]}for(var e in this._contexts)this._contexts[e].draw();this._resized&&
this.updateSize();return this._outCommands};b.prototype.updateSize=function(){for(var a in this._contexts)this._contexts[a].updateSize()};b.prototype.receiveCommands=function(a){for(var b=a.length,d=0;d<b;d++)this._inCommands.push(a[d]);for(var c in this._contexts)this._contexts[c].checkInit()};b.prototype.giveSizeFor=function(a,b){var d=b[a],c=this.getOrSetContext(d).getRootSize();this.sendResize(d,c)};b.prototype.clearCommands=function(){this._inCommands.length=0;this._outCommands.length=0;this._resized=
!1};h.exports=b},{"../core/Commands":5,"./Context":69,"./inject-css":71}],69:[function(e,h,v){function b(a,b){this._compositor=b;this._rootEl=document.querySelector(a);this._selector=a;if(null===this._rootEl)throw Error('Failed to create Context: No matches for "'+a+'" found.');this._selector=a;this._initDOMRenderer();this._webGLRenderer=null;this._domRenderer=new C(this._domRendererRootEl,a,b);this._canvasEl=null;this._renderState={projectionType:D.ORTHOGRAPHIC_PROJECTION,perspectiveTransform:new Float32Array([1,
0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),viewTransform:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),viewDirty:!1,perspectiveDirty:!1};this._size=[];this._meshTransform=new Float32Array(16);this._meshSize=[0,0,0];this._initDOM=!1;this._commandCallbacks=[];this.initCommandCallbacks();this.updateSize()}function a(a,b,d,c){a._webGLRenderer&&a._webGLRenderer.getOrSetCutout(b);a._domRenderer.preventDefault(d[++c]);return c}function d(a,b,d,c){a._webGLRenderer&&a._webGLRenderer.getOrSetCutout(b);a._domRenderer.allowDefault(d[++c]);
return c}function c(a,b,d,c){a._initDOM=!0;return c}function f(a,b,d,c){a._domRenderer.insertEl(d[++c]);return c}function k(a,b,d,c){a._domRenderer.getSizeOf(d[++c]);return c}function g(a,b,d,c){var f=a._meshTransform;f[0]=d[++c];f[1]=d[++c];f[2]=d[++c];f[3]=d[++c];f[4]=d[++c];f[5]=d[++c];f[6]=d[++c];f[7]=d[++c];f[8]=d[++c];f[9]=d[++c];f[10]=d[++c];f[11]=d[++c];f[12]=d[++c];f[13]=d[++c];f[14]=d[++c];f[15]=d[++c];a._domRenderer.setMatrix(f);a._webGLRenderer&&a._webGLRenderer.setCutoutUniform(b,"u_transform",
f);return c}function q(a,b,d,c){var f=d[++c];d=d[++c];a._domRenderer.setSize(f,d);a._webGLRenderer&&(a._meshSize[0]=f,a._meshSize[1]=d,a._webGLRenderer.setCutoutUniform(b,"u_size",a._meshSize));return c}function l(a,b,d,c){a._webGLRenderer&&a._webGLRenderer.getOrSetCutout(b);a._domRenderer.setProperty(d[++c],d[++c]);return c}function n(a,b,d,c){a._webGLRenderer&&a._webGLRenderer.getOrSetCutout(b);a._domRenderer.setContent(d[++c]);return c}function p(a,b,d,c){a._webGLRenderer&&a._webGLRenderer.getOrSetCutout(b);
a._domRenderer.setAttribute(d[++c],d[++c]);return c}function t(a,b,d,c){a._webGLRenderer&&a._webGLRenderer.getOrSetCutout(b);a._domRenderer.addClass(d[++c]);return c}function m(a,b,d,c){a._webGLRenderer&&a._webGLRenderer.getOrSetCutout(b);a._domRenderer.removeClass(d[++c]);return c}function A(a,b,d,c){a._webGLRenderer&&a._webGLRenderer.getOrSetCutout(b);a._domRenderer.subscribe(d[++c]);return c}function r(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.setMeshOptions(b,d[++c]);
return c}function u(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.setAmbientLightColor(b,d[++c],d[++c],d[++c]);return c}function L(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.setLightPosition(b,d[++c],d[++c],d[++c]);return c}function y(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.setLightColor(b,d[++c],d[++c],d[++c]);return c}function z(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.handleMaterialInput(b,d[++c],
d[++c]);return c}function x(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.setGeometry(b,d[++c],d[++c],d[++c]);return c}function B(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.setMeshUniform(b,d[++c],d[++c]);return c}function O(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.bufferData(b,d[++c],d[++c],d[++c],d[++c],d[++c]);return c}function N(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.setCutoutState(b,d[++c]);return c}
function I(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.setMeshVisibility(b,d[++c]);return c}function w(a,b,d,c){a._webGLRenderer||a._initWebGLRenderer();a._webGLRenderer.removeMesh(b);return c}function J(a,b,d,c){a._renderState.projectionType=D.PINHOLE_PROJECTION;a._renderState.perspectiveTransform[11]=-1/d[++c];a._renderState.perspectiveDirty=!0;return c}function H(a,b,d,c){a._renderState.projectionType=D.ORTHOGRAPHIC_PROJECTION;a._renderState.perspectiveTransform[11]=0;a._renderState.perspectiveDirty=
!0;return c}function G(a,b,d,c){a._renderState.viewTransform[0]=d[++c];a._renderState.viewTransform[1]=d[++c];a._renderState.viewTransform[2]=d[++c];a._renderState.viewTransform[3]=d[++c];a._renderState.viewTransform[4]=d[++c];a._renderState.viewTransform[5]=d[++c];a._renderState.viewTransform[6]=d[++c];a._renderState.viewTransform[7]=d[++c];a._renderState.viewTransform[8]=d[++c];a._renderState.viewTransform[9]=d[++c];a._renderState.viewTransform[10]=d[++c];a._renderState.viewTransform[11]=d[++c];
a._renderState.viewTransform[12]=d[++c];a._renderState.viewTransform[13]=d[++c];a._renderState.viewTransform[14]=d[++c];a._renderState.viewTransform[15]=d[++c];a._renderState.viewDirty=!0;return c}var F=e("../webgl-renderers/WebGLRenderer"),D=e("../components/Camera"),C=e("../dom-renderers/DOMRenderer"),E=e("../core/Commands");b.prototype.updateSize=function(){var a=this._rootEl.offsetWidth,b=this._rootEl.offsetHeight;this._size[0]=a;this._size[1]=b;this._size[2]=a>b?a:b;this._compositor.sendResize(this._selector,
this._size);this._webGLRenderer&&this._webGLRenderer.updateSize(this._size);return this};b.prototype.draw=function(){this._domRenderer.draw(this._renderState);this._webGLRenderer&&this._webGLRenderer.draw(this._renderState);this._renderState.perspectiveDirty&&(this._renderState.perspectiveDirty=!1);this._renderState.viewDirty&&(this._renderState.viewDirty=!1)};b.prototype._initDOMRenderer=function(){this._domRendererRootEl=document.createElement("div");this._rootEl.appendChild(this._domRendererRootEl);
this._domRendererRootEl.style.display="none";this._domRenderer=new C(this._domRendererRootEl,this._selector,this._compositor)};b.prototype.getRootSize=function(){return[this._rootEl.offsetWidth,this._rootEl.offsetHeight]};b.prototype.initCommandCallbacks=function(){this._commandCallbacks[E.INIT_DOM]=f;this._commandCallbacks[E.DOM_RENDER_SIZE]=k;this._commandCallbacks[E.CHANGE_TRANSFORM]=g;this._commandCallbacks[E.CHANGE_SIZE]=q;this._commandCallbacks[E.CHANGE_PROPERTY]=l;this._commandCallbacks[E.CHANGE_CONTENT]=
n;this._commandCallbacks[E.CHANGE_ATTRIBUTE]=p;this._commandCallbacks[E.ADD_CLASS]=t;this._commandCallbacks[E.REMOVE_CLASS]=m;this._commandCallbacks[E.SUBSCRIBE]=A;this._commandCallbacks[E.GL_SET_DRAW_OPTIONS]=r;this._commandCallbacks[E.GL_AMBIENT_LIGHT]=u;this._commandCallbacks[E.GL_LIGHT_POSITION]=L;this._commandCallbacks[E.GL_LIGHT_COLOR]=y;this._commandCallbacks[E.MATERIAL_INPUT]=z;this._commandCallbacks[E.GL_SET_GEOMETRY]=x;this._commandCallbacks[E.GL_UNIFORMS]=B;this._commandCallbacks[E.GL_BUFFER_DATA]=
O;this._commandCallbacks[E.GL_CUTOUT_STATE]=N;this._commandCallbacks[E.GL_MESH_VISIBILITY]=I;this._commandCallbacks[E.GL_REMOVE_MESH]=w;this._commandCallbacks[E.PINHOLE_PROJECTION]=J;this._commandCallbacks[E.ORTHOGRAPHIC_PROJECTION]=H;this._commandCallbacks[E.CHANGE_VIEW_TRANSFORM]=G;this._commandCallbacks[E.PREVENT_DEFAULT]=a;this._commandCallbacks[E.ALLOW_DEFAULT]=d;this._commandCallbacks[E.READY]=c};b.prototype._initWebGLRenderer=function(){this._webGLRendererRootEl=document.createElement("canvas");
this._rootEl.appendChild(this._webGLRendererRootEl);this._webGLRenderer=new F(this._webGLRendererRootEl,this._compositor);this._webGLRenderer.updateSize(this._size)};b.prototype.getRootSize=function(){return[this._rootEl.offsetWidth,this._rootEl.offsetHeight]};b.prototype.checkInit=function(){this._initDOM&&(this._domRendererRootEl.style.display="block",this._initDOM=!1)};b.prototype.receive=function(a,b,d){var c=b[++d];this._domRenderer.loadPath(a);for(this._domRenderer.findTarget();null!=c;){if(c===
E.WITH||c===E.TIME)return d-1;d=this._commandCallbacks[c](this,a,b,d)+1;c=b[d]}return d};b.prototype.getDOMRenderer=function(){return this._domRenderer};b.prototype.getWebGLRenderer=function(){return this._webGLRenderer};h.exports=b},{"../components/Camera":1,"../core/Commands":5,"../dom-renderers/DOMRenderer":18,"../webgl-renderers/WebGLRenderer":85}],70:[function(e,h,v){function b(b,c,f){this._thread=b;this._compositor=c;this._renderLoop=f;this._renderLoop.update(this);var e=this;this._thread.onmessage=
function(b){b=b.data?b.data:b;if(b[0]===a.ENGINE)switch(b[1]){case a.START:e._engine.start();break;case a.STOP:e._engine.stop();break;default:console.error('Unknown ENGINE command "'+b[1]+'"')}else e._compositor.receiveCommands(b)};this._thread.onerror=function(a){console.error(a)}}var a=e("../core/Commands");b.prototype.getThread=function(){return this._thread};b.prototype.getCompositor=function(){return this._compositor};b.prototype.getEngine=function(){return this._renderLoop};b.prototype.getRenderLoop=
function(){return this._renderLoop};b.prototype.update=function(b){this._thread.postMessage([a.FRAME,b]);b=this._compositor.drawCommands();this._thread.postMessage(b);this._compositor.clearCommands()};h.exports=b},{"../core/Commands":5}],71:[function(e,h,v){var b="undefined"===typeof document;h.exports=function(){if(!b)if(b=!0,document.createStyleSheet)document.createStyleSheet().cssText=".famous-dom-renderer {width:100%;height:100%;transform-style:preserve-3d;-webkit-transform-style:preserve-3d;}.famous-dom-element {-webkit-transform-origin:0% 0%;transform-origin:0% 0%;-webkit-backface-visibility:visible;backface-visibility:visible;-webkit-transform-style:preserve-3d;transform-style:preserve-3d;-webkit-tap-highlight-color:transparent;pointer-events:auto;z-index:1;}.famous-dom-element-content,.famous-dom-element {position:absolute;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;}.famous-webgl-renderer {-webkit-transform:translateZ(1000000px);transform:translateZ(1000000px);pointer-events:none;position:absolute;z-index:1;top:0;width:100%;height:100%;}";
else{var a=document.getElementsByTagName("head")[0],d=document.createElement("style");d.styleSheet?d.styleSheet.cssText=".famous-dom-renderer {width:100%;height:100%;transform-style:preserve-3d;-webkit-transform-style:preserve-3d;}.famous-dom-element {-webkit-transform-origin:0% 0%;transform-origin:0% 0%;-webkit-backface-visibility:visible;backface-visibility:visible;-webkit-transform-style:preserve-3d;transform-style:preserve-3d;-webkit-tap-highlight-color:transparent;pointer-events:auto;z-index:1;}.famous-dom-element-content,.famous-dom-element {position:absolute;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;}.famous-webgl-renderer {-webkit-transform:translateZ(1000000px);transform:translateZ(1000000px);pointer-events:none;position:absolute;z-index:1;top:0;width:100%;height:100%;}":
d.appendChild(document.createTextNode(".famous-dom-renderer {width:100%;height:100%;transform-style:preserve-3d;-webkit-transform-style:preserve-3d;}.famous-dom-element {-webkit-transform-origin:0% 0%;transform-origin:0% 0%;-webkit-backface-visibility:visible;backface-visibility:visible;-webkit-transform-style:preserve-3d;transform-style:preserve-3d;-webkit-tap-highlight-color:transparent;pointer-events:auto;z-index:1;}.famous-dom-element-content,.famous-dom-element {position:absolute;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;}.famous-webgl-renderer {-webkit-transform:translateZ(1000000px);transform:translateZ(1000000px);pointer-events:none;position:absolute;z-index:1;top:0;width:100%;height:100%;}"));
(a?a:document.documentElement).appendChild(d)}}},{}],72:[function(e,h,v){var b={linear:function(a){return a},easeIn:function(a){return a*a},easeOut:function(a){return a*(2-a)},easeInOut:function(a){return.5>=a?2*a*a:-2*a*a+4*a-1},easeOutBounce:function(a){return a*(3-2*a)},spring:function(a){return(1-a)*Math.sin(6*Math.PI*a)+a},inQuad:function(a){return a*a},outQuad:function(a){return- --a*a+1},inOutQuad:function(a){return 1>(a/=.5)?.5*a*a:-.5*(--a*(a-2)-1)},inCubic:function(a){return a*a*a},outCubic:function(a){return--a*
a*a+1},inOutCubic:function(a){return 1>(a/=.5)?.5*a*a*a:.5*((a-=2)*a*a+2)},inQuart:function(a){return a*a*a*a},outQuart:function(a){return-(--a*a*a*a-1)},inOutQuart:function(a){return 1>(a/=.5)?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)},inQuint:function(a){return a*a*a*a*a},outQuint:function(a){return--a*a*a*a*a+1},inOutQuint:function(a){return 1>(a/=.5)?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)},inSine:function(a){return-1*Math.cos(Math.PI/2*a)+1},outSine:function(a){return Math.sin(Math.PI/2*a)},inOutSine:function(a){return-.5*
(Math.cos(Math.PI*a)-1)},inExpo:function(a){return 0===a?0:Math.pow(2,10*(a-1))},outExpo:function(a){return 1===a?1:-Math.pow(2,-10*a)+1},inOutExpo:function(a){return 0===a?0:1===a?1:1>(a/=.5)?.5*Math.pow(2,10*(a-1)):.5*(-Math.pow(2,-10*--a)+2)},inCirc:function(a){return-(Math.sqrt(1-a*a)-1)},outCirc:function(a){return Math.sqrt(1- --a*a)},inOutCirc:function(a){return 1>(a/=.5)?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)},inElastic:function(a){var b=1.70158,c=0;if(0===a)return 0;if(1===
a)return 1;c||(c=.3);b=c/(2*Math.PI)*Math.asin(1);return-(1*Math.pow(2,10*--a)*Math.sin(2*(a-b)*Math.PI/c))},outElastic:function(a){var b=1.70158,c=0;if(0===a)return 0;if(1===a)return 1;c||(c=.3);b=c/(2*Math.PI)*Math.asin(1);return 1*Math.pow(2,-10*a)*Math.sin(2*(a-b)*Math.PI/c)+1},inOutElastic:function(a){var b=1.70158,c=0;if(0===a)return 0;if(2===(a/=.5))return 1;c||(c=.3*1.5);b=c/(2*Math.PI)*Math.asin(1);return 1>a?-.5*Math.pow(2,10*--a)*Math.sin(2*(a-b)*Math.PI/c):1*Math.pow(2,-10*--a)*Math.sin(2*
(a-b)*Math.PI/c)*.5+1},inBack:function(a,b){void 0===b&&(b=1.70158);return a*a*((b+1)*a-b)},outBack:function(a,b){void 0===b&&(b=1.70158);return--a*a*((b+1)*a+b)+1},inOutBack:function(a,b){void 0===b&&(b=1.70158);return 1>(a/=.5)?.5*a*a*(((b*=1.525)+1)*a-b):.5*((a-=2)*a*(((b*=1.525)+1)*a+b)+2)},inBounce:function(a){return 1-b.outBounce(1-a)},outBounce:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},
inOutBounce:function(a){return.5>a?.5*b.inBounce(2*a):.5*b.outBounce(2*a-1)+.5},flat:function(){return 0}};h.exports=b},{}],73:[function(e,h,v){function b(a){this._queue=[];this._pausedAt=this._startedAt=this._state=this._from=null;null!=a&&this.from(a)}var a=e("./Curves");e=e("../core/FamousEngine");b.Clock=e.getClock();b.prototype.to=function(b,c,f,e,g,h){c=null!=c&&c.constructor===String?a[c]:c;0===this._queue.length&&(this._startedAt=this.constructor.Clock.now(),this._pausedAt=null);this._queue.push(b,
null!=c?c:a.linear,null!=f?f:100,e,g,h);return this};b.prototype.from=function(a){this._state=a;this._from=this._sync(null,this._state);this._queue.length=0;this._startedAt=this.constructor.Clock.now();this._pausedAt=null;return this};b.prototype.delay=function(b,c){return this.to(0<this._queue.length?this._queue[this._queue.length-5]:this._state,a.flat,b,c)};b.prototype.override=function(b,c,f,e,g){0<this._queue.length&&(null!=b&&(this._queue[0]=b),null!=c&&(this._queue[1]=c.constructor===String?
a[c]:c),null!=f&&(this._queue[2]=f),null!=e&&(this._queue[3]=e),null!=g&&(this._queue[4]=g));return this};b.prototype._interpolate=function(a,b,f,e,g){if(f instanceof Object)if("slerp"===g){var h,l,n,p,t,m,A,r;g=b[0];h=b[1];l=b[2];b=b[3];n=f[0];p=f[1];t=f[2];f=f[3];if(1===e)return a[0]=n,a[1]=p,a[2]=t,a[3]=f,a;A=b*f+g*n+h*p+l*t;1E-5<1-A?(m=Math.acos(A),r=Math.sin(m),A=Math.sin((1-e)*m)/r,e=Math.sin(e*m)/r):A=1-e;a[0]=g*A+n*e;a[1]=h*A+p*e;a[2]=l*A+t*e;a[3]=b*A+f*e}else if(f instanceof Array)for(h=
0,l=f.length;h<l;h++)a[h]=this._interpolate(a[h],b[h],f[h],e,g);else for(h in f)a[h]=this._interpolate(a[h],b[h],f[h],e,g);else a=b+e*(f-b);return a};b.prototype._sync=function c(a,b){if("number"===typeof b)a=b;else if(b instanceof Array){null==a&&(a=[]);for(var e=0,h=b.length;e<h;e++)a[e]=c(a[e],b[e])}else if(b instanceof Object)for(e in null==a&&(a={}),b)a[e]=c(a[e],b[e]);return a};b.prototype.get=function(a){if(0===this._queue.length)return this._state;a=(a=this._pausedAt?this._pausedAt:a)?a:this.constructor.Clock.now();
a=(a-this._startedAt)/this._queue[2];var b=this._state=this._interpolate(this._state,this._from,this._queue[0],this._queue[1](1<a?1:a),this._queue[4]);if(1<=a){this._startedAt+=this._queue[2];this._from=this._sync(this._from,this._state);this._queue.shift();this._queue.shift();this._queue.shift();var e=this._queue.shift();this._queue.shift();var g=this._queue.shift();e&&g?e(g):e&&!g&&e()}return 1<a?this.get():b};b.prototype.isActive=function(){return 0<this._queue.length};b.prototype.halt=function(){return this.from(this.get())};
b.prototype.pause=function(){this._pausedAt=this.constructor.Clock.now();return this};b.prototype.isPaused=function(){return!!this._pausedAt};b.prototype.resume=function(){var a=this._pausedAt-this._startedAt;this._startedAt=this.constructor.Clock.now()-a;this._pausedAt=null;return this};b.prototype.reset=function(a){return this.from(a)};b.prototype.set=function(a,b,e){null==b?(this.from(a),e&&e()):this.to(a,b.curve,b.duration,e,b.method);return this};h.exports=b},{"../core/FamousEngine":8,"./Curves":72}],
74:[function(e,h,v){function b(){this._events={}}b.prototype.on=function(a,b){this._events[a]||(this._events[a]=[]);var c=this._events[a];c.push(b);return function(){c.splice(c.indexOf(b),1)}};b.prototype.off=function(a,b){var c=this._events[a];c&&c.splice(c.indexOf(b),1);return this};b.prototype.trigger=function(a,b){var c=this._events[a];if(c)for(var f=0,e=c.length;f<e;f++)c[f](b);return this};h.exports=b},{}],75:[function(e,h,v){function b(a,b){return function(){return 0!==a.length?a.pop():new b}}
function a(a){return function(b){a.push(b)}}h.exports={pools:{},register:function(d,c){var f=this.pools[d]=[];this["request"+d]=b(f,c);this["free"+d]=a(f)},disposeOf:function(a){a=this.pools[a];for(var b=a.length;b--;)a.pop()}}},{}],76:[function(e,h,v){h.exports=function a(d){var c;if("object"===typeof d){c=d instanceof Array?[]:{};for(var f in d)if("object"===typeof d[f]&&null!==d[f])if(d[f]instanceof Array){c[f]=Array(d[f].length);for(var e=0;e<d[f].length;e++)c[f][e]=a(d[f][e])}else c[f]=a(d[f]);
else c[f]=d[f]}else c=d;return c}},{}],77:[function(e,h,v){h.exports=function(b){var a=[],d=[],c=0,f;for(f in b)b.hasOwnProperty(f)&&(a[c]=f,d[c]=b[f],c++);return{keys:a,values:d}}},{}],78:[function(e,h,v){var b=["","-ms-","-webkit-","-moz-","-o-"];h.exports=function(a){for(var d=0;d<b.length;d++){var c=b[d]+a;if(""===document.documentElement.style[c])return c}return a}},{}],79:[function(e,h,v){function b(a,b,c){this.buffer=null;this.target=a;this.type=b;this.data=[];this.gl=c}b.prototype.subData=
function(){for(var a=this.gl,b=[],c=0;c<this.data.length;c+=1E4)b=Array.prototype.concat.apply(b,this.data.slice(c,c+1E4));this.buffer=this.buffer||a.createBuffer();a.bindBuffer(this.target,this.buffer);a.bufferData(this.target,new this.type(b),a.STATIC_DRAW)};h.exports=b},{}],80:[function(e,h,v){function b(a){this.gl=a;this.registry={};this._dynamicBuffers=[];this._staticBuffers=[];this._elementBufferMax=this._arrayBufferMax=3E4}var a=e("./Buffer");b.prototype.allocate=function(b,c,f,e,g){b=this.registry[b]||
(this.registry[b]={keys:[],values:[],spacing:[],offset:[],length:[]});var h=b.keys.indexOf(c),l="indices"===c,n=!1,p,t=0,m,A;if(-1===h){h=b.keys.length;m=l?f.length:Math.floor(f.length/e);if(g)A=new a(l?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,l?Uint16Array:Float32Array,this.gl),this._dynamicBuffers.push({buffer:A,offset:f.length,isIndex:l});else{for(g=0;g<this._staticBuffers.length;g++)if(l===this._staticBuffers[g].isIndex&&(p=this._staticBuffers[g].offset+f.length,!l&&p<this._arrayBufferMax||
l&&p<this._elementBufferMax)){A=this._staticBuffers[g].buffer;t=this._staticBuffers[g].offset;this._staticBuffers[g].offset+=f.length;n=!0;break}n||(A=new a(l?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,l?Uint16Array:Float32Array,this.gl),this._staticBuffers.push({buffer:A,offset:f.length,isIndex:l}))}b.keys.push(c);b.values.push(A);b.spacing.push(e);b.offset.push(t);b.length.push(m)}c=f.length;for(g=0;g<c;g++)b.values[h].data[t+g]=f[g];b.values[h].subData()};h.exports=b},{"./Buffer":79}],81:[function(e,
h,v){function b(a,b){return function(){var c=a.apply(this,arguments);b.apply(this,arguments);return c}}h.exports=function(){return b(this.gl.compileShader,function(a){if(!this.getShaderParameter(a,this.COMPILE_STATUS)){var b=this.getShaderInfoLog(a),c=this.getShaderSource(a);a=document.createElement("style");document.getElementsByTagName("head")[0].appendChild(a);a.textContent="body,html{background:#e3e3e3;font-family:monaco,monospace;font-size:14px;line-height:1.7em}#shaderReport{left:0;top:0;right:0;box-sizing:border-box;position:absolute;z-index:1000;color:#222;padding:15px;white-space:normal;list-style-type:none;margin:50px auto;max-width:1200px}#shaderReport li{background-color:#fff;margin:13px 0;box-shadow:0 1px 2px rgba(0,0,0,.15);padding:20px 30px;border-radius:2px;border-left:20px solid #e01111}span{color:#e01111;text-decoration:underline;font-weight:700}#shaderReport li p{padding:0;margin:0}#shaderReport li:nth-child(even){background-color:#f4f4f4}#shaderReport li p:first-child{margin-bottom:10px;color:#666}";
a=document.createElement("ul");a.setAttribute("id","shaderReport");document.body.appendChild(a);for(var f=/ERROR: [\d]+:([\d]+): (.+)/gmi,c=c.split("\n"),e;null!=(e=f.exec(b));){e.index===f.lastIndex&&f.lastIndex++;var g=document.createElement("li"),h='<p><span>ERROR</span> "'+e[2]+'" in line '+e[1]+"</p>",h=h+("<p><b>"+c[e[1]-1].replace(/^[ \t]+/g,"")+"</b></p>");g.innerHTML=h;a.appendChild(g)}}})}},{}],82:[function(e,h,v){function b(a,b){this.gl=a;this.textureSlots=1;this.options=b||{};this.registeredMaterials=
{};this.flaggedUniforms=[];this.cachedUniforms={};this.uniformTypes=[];this.definitionVec4=[];this.definitionVec3=[];this.definitionFloat=[];this.applicationVec3=[];this.applicationVec4=[];this.applicationFloat=[];this.applicationVert=[];this.definitionVert=[];this.resetProgram()}var a=e("../utilities/clone");v=e("../utilities/keyValueToArrays");var d=e("../webgl-shaders").vertex,c=e("../webgl-shaders").fragment,f=e("./Debug");e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var k={undefined:"float ",1:"float ",
2:"vec2 ",3:"vec3 ",4:"vec4 ",16:"mat4 "},g={u_baseColor:"vec4",u_normals:"vert",u_glossiness:"vec4",u_positionOffset:"vert"},q={vert:1,vec3:2,vec4:4,"float":8},l=v({u_perspective:e,u_view:e,u_resolution:[0,0,0],u_transform:e,u_size:[1,1,1],u_time:0,u_opacity:1,u_metalness:0,u_glossiness:[0,0,0,0],u_baseColor:[1,1,1,1],u_normals:[1,1,1],u_positionOffset:[0,0,0],u_lightPosition:e,u_lightColor:e,u_ambientLight:[0,0,0],u_flatShading:0,u_numLights:0}),n=v({a_pos:[0,0,0],a_texCoord:[0,0],a_normals:[0,
0,0]}),p=v({v_textureCoordinate:[0,0],v_normal:[0,0,0],v_position:[0,0,0],v_eyeVector:[0,0,0]});b.prototype.registerMaterial=function(a,b){var c=g[a],d=q[c];if((this.registeredMaterials[b._id]&d)===d)return this;for(var f in b.uniforms)-1===l.keys.indexOf(f)&&(l.keys.push(f),l.values.push(b.uniforms[f]));for(f in b.varyings)-1===p.keys.indexOf(f)&&(p.keys.push(f),p.values.push(b.varyings[f]));for(f in b.attributes)-1===n.keys.indexOf(f)&&(n.keys.push(f),n.values.push(b.attributes[f]));this.registeredMaterials[b._id]|=
d;"float"===c&&(this.definitionFloat.push(b.defines),this.definitionFloat.push("float fa_"+b._id+"() {\n "+b.glsl+" \n}"),this.applicationFloat.push("if (int(abs(ID)) == "+b._id+") return fa_"+b._id+"();"));"vec3"===c&&(this.definitionVec3.push(b.defines),this.definitionVec3.push("vec3 fa_"+b._id+"() {\n "+b.glsl+" \n}"),this.applicationVec3.push("if (int(abs(ID.x)) == "+b._id+") return fa_"+b._id+"();"));"vec4"===c&&(this.definitionVec4.push(b.defines),this.definitionVec4.push("vec4 fa_"+b._id+"() {\n "+
b.glsl+" \n}"),this.applicationVec4.push("if (int(abs(ID.x)) == "+b._id+") return fa_"+b._id+"();"));"vert"===c&&(this.definitionVert.push(b.defines),this.definitionVert.push("vec3 fa_"+b._id+"() {\n "+b.glsl+" \n}"),this.applicationVert.push("if (int(abs(ID.x)) == "+b._id+") return fa_"+b._id+"();"));return this.resetProgram()};b.prototype.resetProgram=function(){var b=["precision mediump float;\n"],f=["precision mediump float;\n"],e,g,h;this.uniformLocations=[];this.attributeLocations={};this.uniformTypes=
{};this.attributeNames=a(n.keys);this.attributeValues=a(n.values);this.varyingNames=a(p.keys);this.varyingValues=a(p.values);this.uniformNames=a(l.keys);this.uniformValues=a(l.values);this.flaggedUniforms=[];this.cachedUniforms={};f.push("uniform sampler2D u_textures[7];\n");this.applicationVert.length&&b.push("uniform sampler2D u_textures[7];\n");for(h=0;h<this.uniformNames.length;h++)e=this.uniformNames[h],g=this.uniformValues[h],b.push("uniform "+k[g.length]+e+";\n"),f.push("uniform "+k[g.length]+
e+";\n");for(h=0;h<this.attributeNames.length;h++)e=this.attributeNames[h],g=this.attributeValues[h],b.push("attribute "+k[g.length]+e+";\n");for(h=0;h<this.varyingNames.length;h++)e=this.varyingNames[h],g=this.varyingValues[h],b.push("varying "+k[g.length]+e+";\n"),f.push("varying "+k[g.length]+e+";\n");b=b.join("")+d.replace("#vert_definitions",this.definitionVert.join("\n")).replace("#vert_applications",this.applicationVert.join("\n"));f=f.join("")+c.replace("#vec3_definitions",this.definitionVec3.join("\n")).replace("#vec3_applications",
this.applicationVec3.join("\n")).replace("#vec4_definitions",this.definitionVec4.join("\n")).replace("#vec4_applications",this.applicationVec4.join("\n")).replace("#float_definitions",this.definitionFloat.join("\n")).replace("#float_applications",this.applicationFloat.join("\n"));e=this.gl.createProgram();this.gl.attachShader(e,this.compileShader(this.gl.createShader(35633),b));this.gl.attachShader(e,this.compileShader(this.gl.createShader(35632),f));this.gl.linkProgram(e);this.gl.getProgramParameter(e,
this.gl.LINK_STATUS)?(this.program=e,this.gl.useProgram(this.program)):(console.error("link error: "+this.gl.getProgramInfoLog(e)),this.program=null);this.setUniforms(this.uniformNames,this.uniformValues);f=this.gl.getUniformLocation(this.program,"u_textures[0]");this.gl.uniform1iv(f,[0,1,2,3,4,5,6]);return this};b.prototype.uniformIsCached=function(a,b){if(null==this.cachedUniforms[a])return this.cachedUniforms[a]=b.length?new Float32Array(b):b,!1;if(b.length)for(var c=b.length;c--;){if(b[c]!==this.cachedUniforms[a][c]){for(c=
b.length;c--;)this.cachedUniforms[a][c]=b[c];return!1}}else if(this.cachedUniforms[a]!==b)return this.cachedUniforms[a]=b,!1;return!0};b.prototype.setUniforms=function(a,b){var c=this.gl,d,f,e,g,k;if(!this.program)return this;g=a.length;for(k=0;k<g;k++)if(e=a[k],f=b[k],d=this.uniformLocations[e],null!==d&&(void 0===d&&(d=c.getUniformLocation(this.program,e),this.uniformLocations[e]=d),!this.uniformIsCached(e,f)))switch(this.uniformTypes[e]||(this.uniformTypes[e]=this.getUniformTypeFromValue(f)),this.uniformTypes[e]){case "uniform4fv":c.uniform4fv(d,
f);break;case "uniform3fv":c.uniform3fv(d,f);break;case "uniform2fv":c.uniform2fv(d,f);break;case "uniform1fv":c.uniform1fv(d,f);break;case "uniform1f":c.uniform1f(d,f);break;case "uniformMatrix3fv":c.uniformMatrix3fv(d,!1,f);break;case "uniformMatrix4fv":c.uniformMatrix4fv(d,!1,f)}return this};b.prototype.getUniformTypeFromValue=function(a){if(Array.isArray(a)||a instanceof Float32Array)switch(a.length){case 1:return"uniform1fv";case 2:return"uniform2fv";case 3:return"uniform3fv";case 4:return"uniform4fv";
case 9:return"uniformMatrix3fv";case 16:return"uniformMatrix4fv"}else if(!isNaN(parseFloat(a))&&isFinite(a))return"uniform1f";throw'cant load uniform "'+name+'" with value:'+JSON.stringify(a);};b.prototype.compileShader=function(a,b){var c=1;this.options.debug&&(this.gl.compileShader=f.call(this));this.gl.shaderSource(a,b);this.gl.compileShader(a);this.gl.getShaderParameter(a,this.gl.COMPILE_STATUS)||(console.error("compile error: "+this.gl.getShaderInfoLog(a)),console.error("1: "+b.replace(/\n/g,
function(){return"\n"+(c+=1)+": "})));return a};h.exports=b},{"../utilities/clone":76,"../utilities/keyValueToArrays":77,"../webgl-shaders":89,"./Debug":81}],83:[function(e,h,v){function b(a,b){b=b||{};this.id=a.createTexture();this.width=b.width||0;this.height=b.height||0;this.mipmap=b.mipmap;this.format=b.format||"RGBA";this.type=b.type||"UNSIGNED_BYTE";this.gl=a;this.bind();a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,b.flipYWebgl||!1);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultiplyAlphaWebgl||
!1);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a[b.magFilter]||a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a[b.minFilter]||a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a[b.wrapS]||a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a[b.wrapT]||a.CLAMP_TO_EDGE)}b.prototype.bind=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.id);return this};b.prototype.unbind=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,null);return this};b.prototype.setImage=
function(a){this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl[this.format],this.gl[this.format],this.gl[this.type],a);this.mipmap&&this.gl.generateMipmap(this.gl.TEXTURE_2D);return this};b.prototype.setArray=function(a){this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl[this.format],this.width,this.height,0,this.gl[this.format],this.gl[this.type],a);return this};b.prototype.readBack=function(a,b,c,f){var e=this.gl,g;a=a||0;b=b||0;c=c||this.width;f=f||this.height;var h=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,
h);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.id,0);e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE&&(g=new Uint8Array(c*f*4),e.readPixels(a,b,c,f,e.RGBA,e.UNSIGNED_BYTE,g));return g};h.exports=b},{}],84:[function(e,h,v){function b(a){this.registry=[];this._needsResample=[];this._activeTexture=0;this._boundTexture=null;this._checkerboard=c();this.gl=a}function a(a,b){var c=("string"===typeof a?new Image:a)||{};c.crossOrigin="anonymous";c.src||(c.src=
a);c.complete?b(c):c.onload=function(){b(c)};return c}var d=e("./Texture"),c=e("./createCheckerboard");b.prototype.update=function(a){for(var b=this.registry.length,c=1;c<b;c++){var d=this.registry[c];d&&d.isLoaded&&d.resampleRate&&(!d.lastResample||a-d.lastResample>d.resampleRate)&&!this._needsResample[d.id]&&(this._needsResample[d.id]=!0,d.lastResample=a)}};b.prototype.register=function(b,c){var e=this,h=b.data,l=b.id,n=b.options||{},p=this.registry[l],t;p||(p=new d(this.gl,n),p.setImage(this._checkerboard),
t=this.registry[l]={resampleRate:n.resampleRate||null,lastResample:null,isLoaded:!1,texture:p,source:h,id:l,slot:c},Array.isArray(h)||h instanceof Uint8Array||h instanceof Float32Array?(this.bindTexture(l),p.setArray(h),t.isLoaded=!0):h instanceof HTMLVideoElement?h.addEventListener("loadeddata",function(){e.bindTexture(l);p.setImage(h);t.isLoaded=!0;t.source=h}):"string"===typeof h&&a(h,function(a){e.bindTexture(l);p.setImage(a);t.isLoaded=!0;t.source=a}));return l};b.prototype.bindTexture=function(a){var b=
this.registry[a];this._activeTexture!==b.slot&&(this.gl.activeTexture(this.gl.TEXTURE0+b.slot),this._activeTexture=b.slot);this._boundTexture!==a&&(this._boundTexture=a,b.texture.bind());this._needsResample[b.id]&&(b.texture.setImage(b.source),this._needsResample[b.id]=!1)};h.exports=b},{"./Texture":83,"./createCheckerboard":87}],85:[function(e,h,v){function b(b,c){b.classList.add("famous-webgl-renderer");this.canvas=b;this.compositor=c;var e=this.gl=this.getWebGLContext(this.canvas);e.clearColor(0,
0,0,0);e.polygonOffset(.1,.1);e.enable(e.POLYGON_OFFSET_FILL);e.enable(e.DEPTH_TEST);e.enable(e.BLEND);e.depthFunc(e.LEQUAL);e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);e.enable(e.CULL_FACE);e.cullFace(e.BACK);this.meshRegistry={};this.meshRegistryKeys=[];this.cutoutRegistry={};this.cutoutRegistryKeys=[];this.numLights=0;this.ambientLightColor=[0,0,0];this.lightRegistry={};this.lightRegistryKeys=[];this.lightPositions=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.lightColors=[0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0];this.textureManager=new k(e);this.texCache={};this.bufferRegistry=new d(e);this.program=new a(e,{debug:!0});this.state={boundArrayBuffer:null,boundElementBuffer:null,lastDrawn:null,enabledAttributes:{},enabledAttributesKeys:[]};this.resolutionName=["u_resolution"];this.resolutionValues=[[0,0,0]];this.cachedSize=[];this.projectionTransform=[1,0,0,0,0,1,0,0,0,0,-1E-6,0,-1,1,0,1];e=this.cutoutGeometry={spec:{id:-1,bufferValues:[[-1,-1,0,1,-1,0,-1,1,0,1,1,0]],bufferNames:["a_pos"],type:"TRIANGLE_STRIP"}};
this.bufferRegistry.allocate(this.cutoutGeometry.spec.id,e.spec.bufferNames[0],e.spec.bufferValues[0],3)}var a=e("./Program"),d=e("./BufferRegistry"),c=e("./radixSort"),f=e("../utilities/keyValueToArrays"),k=e("./TextureManager"),g=e("./compileMaterial"),q=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],l=f({u_numLights:0,u_ambientLight:Array(3),u_lightPosition:Array(3),u_lightColor:Array(3),u_perspective:Array(16),u_time:0,u_view:Array(16)});b.prototype.getWebGLContext=function(a){for(var b=["webgl","experimental-webgl",
"webkit-3d","moz-webgl"],c,d=0,e=b.length;d<e;d++){try{c=a.getContext(b[d])}catch(f){console.error("Error creating WebGL context: "+f.toString())}if(c)break}return c?c:(console.error("Could not retrieve WebGL context. Please refer to https://www.khronos.org/webgl/ for requirements"),!1)};b.prototype.createLight=function(a){this.numLights++;this.lightRegistryKeys.push(a);this.lightRegistry[a]={color:[0,0,0],position:[0,0,0]};return this.lightRegistry[a]};b.prototype.createMesh=function(a){this.meshRegistryKeys.push(a);
var b=f({u_opacity:1,u_transform:q,u_size:[0,0,0],u_baseColor:[.5,.5,.5,1],u_positionOffset:[0,0,0],u_normals:[0,0,0],u_flatShading:0,u_glossiness:[0,0,0,0]});this.meshRegistry[a]={depth:null,uniformKeys:b.keys,uniformValues:b.values,buffers:{},geometry:null,drawType:null,textures:[],visible:!0};return this.meshRegistry[a]};b.prototype.setCutoutState=function(a,b){this.getOrSetCutout(a).visible=b};b.prototype.getOrSetCutout=function(a){if(!this.cutoutRegistry[a]){var b=f({u_opacity:0,u_transform:q.slice(),
u_size:[0,0,0],u_origin:[0,0,0],u_baseColor:[0,0,0,1]});this.cutoutRegistryKeys.push(a);this.cutoutRegistry[a]={uniformKeys:b.keys,uniformValues:b.values,geometry:this.cutoutGeometry.spec.id,drawType:this.cutoutGeometry.spec.type,visible:!0}}return this.cutoutRegistry[a]};b.prototype.setMeshVisibility=function(a,b){(this.meshRegistry[a]||this.createMesh(a)).visible=b};b.prototype.removeMesh=function(a){var b=this.meshRegistryKeys.indexOf(a);this.meshRegistryKeys.splice(b,1);this.meshRegistry[a]=null};
b.prototype.setCutoutUniform=function(a,b,c){a=this.getOrSetCutout(a);b=a.uniformKeys.indexOf(b);if(c.length)for(var d=0,e=c.length;d<e;d++)a.uniformValues[b][d]=c[d];else a.uniformValues[b]=c};b.prototype.setMeshOptions=function(a,b){(this.meshRegistry[a]||this.createMesh(a)).options=b;return this};b.prototype.setAmbientLightColor=function(a,b,c,d){this.ambientLightColor[0]=b;this.ambientLightColor[1]=c;this.ambientLightColor[2]=d;return this};b.prototype.setLightPosition=function(a,b,c,d){a=this.lightRegistry[a]||
this.createLight(a);a.position[0]=b;a.position[1]=c;a.position[2]=d;return this};b.prototype.setLightColor=function(a,b,c,d){a=this.lightRegistry[a]||this.createLight(a);a.color[0]=b;a.color[1]=c;a.color[2]=d;return this};b.prototype.handleMaterialInput=function(a,b,c){a=this.meshRegistry[a]||this.createMesh(a);c=g(c,a.textures.length);a.uniformValues[a.uniformKeys.indexOf(b)][0]=-c._id;for(var d=c.textures.length;d--;)a.textures.push(this.textureManager.register(c.textures[d],a.textures.length+d));
this.program.registerMaterial(b,c);return this.updateSize()};b.prototype.setGeometry=function(a,b,c,d){a=this.meshRegistry[a]||this.createMesh(a);a.geometry=b;a.drawType=c;a.dynamic=d;return this};b.prototype.setMeshUniform=function(a,b,c){a=this.meshRegistry[a]||this.createMesh(a);var d=a.uniformKeys.indexOf(b);-1===d?(a.uniformKeys.push(b),a.uniformValues.push(c)):a.uniformValues[d]=c};b.prototype.bufferData=function(a,b,c,d,e,f){this.bufferRegistry.allocate(b,c,d,e,f);return this};b.prototype.draw=
function(a){var b=this.compositor.getTime();this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);this.textureManager.update(b);this.meshRegistryKeys=c(this.meshRegistryKeys,this.meshRegistry);this.setGlobalUniforms(a);this.drawCutouts();this.drawMeshes()};b.prototype.drawMeshes=function(){for(var a=this.gl,b,c,d=0;d<this.meshRegistryKeys.length;d++)if(c=this.meshRegistry[this.meshRegistryKeys[d]],b=this.bufferRegistry.registry[c.geometry],c.visible&&(1>c.uniformValues[0]?(a.depthMask(!1),
a.enable(a.BLEND)):(a.depthMask(!0),a.disable(a.BLEND)),b)){for(var e=c.textures.length;e--;)this.textureManager.bindTexture(c.textures[e]);c.options&&this.handleOptions(c.options,c);this.program.setUniforms(c.uniformKeys,c.uniformValues);this.drawBuffers(b,c.drawType,c.geometry);c.options&&this.resetOptions(c.options)}};b.prototype.drawCutouts=function(){var a,b,c=this.cutoutRegistryKeys.length;if(c){this.gl.disable(this.gl.CULL_FACE);this.gl.enable(this.gl.BLEND);this.gl.depthMask(!0);for(var d=
0;d<c;d++)a=this.cutoutRegistry[this.cutoutRegistryKeys[d]],b=this.bufferRegistry.registry[a.geometry],a.visible&&(this.program.setUniforms(a.uniformKeys,a.uniformValues),this.drawBuffers(b,a.drawType,a.geometry));this.gl.enable(this.gl.CULL_FACE)}};b.prototype.setGlobalUniforms=function(a){for(var b,c,d=0,e=this.lightRegistryKeys.length;d<e;d++)b=this.lightRegistry[this.lightRegistryKeys[d]],c=4*d,this.lightPositions[0+c]=b.position[0],this.lightPositions[1+c]=b.position[1],this.lightPositions[2+
c]=b.position[2],this.lightColors[0+c]=b.color[0],this.lightColors[1+c]=b.color[1],this.lightColors[2+c]=b.color[2];l.values[0]=this.numLights;l.values[1]=this.ambientLightColor;l.values[2]=this.lightPositions;l.values[3]=this.lightColors;this.projectionTransform[0]=1/(.5*this.cachedSize[0]);this.projectionTransform[5]=-1/(.5*this.cachedSize[1]);this.projectionTransform[11]=a.perspectiveTransform[11];l.values[4]=this.projectionTransform;l.values[5]=.001*this.compositor.getTime();l.values[6]=a.viewTransform;
this.program.setUniforms(l.keys,l.values)};b.prototype.drawBuffers=function(a,b,c){var d=this.gl,e=0,f,g,k,h,l,q,v;l=a.keys.length;for(v=0;v<l;v++)if(f=a.keys[v],"indices"===f)q=v;else if(g=this.program.attributeLocations[f],-1!==g){if(void 0===g&&(g=d.getAttribLocation(this.program.program,f),this.program.attributeLocations[f]=g,-1===g))continue;this.state.enabledAttributes[f]||(d.enableVertexAttribArray(g),this.state.enabledAttributes[f]=!0,this.state.enabledAttributesKeys.push(f));h=a.values[v];
f=a.spacing[v];k=a.offset[v];e=a.length[v];this.state.boundArrayBuffer!==h&&(d.bindBuffer(h.target,h.buffer),this.state.boundArrayBuffer=h);this.state.lastDrawn!==c&&d.vertexAttribPointer(g,f,d.FLOAT,d.FALSE,0,4*k)}g=this.state.enabledAttributesKeys.length;for(v=0;v<g;v++)l=this.state.enabledAttributesKeys[v],this.state.enabledAttributes[l]&&-1===a.keys.indexOf(l)&&(d.disableVertexAttribArray(this.program.attributeLocations[l]),this.state.enabledAttributes[l]=!1);e&&(void 0!==q?(h=a.values[q],k=a.offset[q],
e=a.length[q],this.state.boundElementBuffer!==h&&(d.bindBuffer(h.target,h.buffer),this.state.boundElementBuffer=h),d.drawElements(d[b],e,d.UNSIGNED_SHORT,2*k)):d.drawArrays(d[b],0,e));this.state.lastDrawn=c};b.prototype.updateSize=function(a){if(a){var b=window.devicePixelRatio||1,c=~~(a[0]*b),b=~~(a[1]*b);this.canvas.width=c;this.canvas.height=b;this.gl.viewport(0,0,c,b);this.cachedSize[0]=a[0];this.cachedSize[1]=a[1];this.cachedSize[2]=a[0]>a[1]?a[0]:a[1];this.resolutionValues[0]=this.cachedSize}this.program.setUniforms(this.resolutionName,
this.resolutionValues);return this};b.prototype.handleOptions=function(a,b){var c=this.gl;a&&(a.blending&&c.enable(c.BLEND),"double"===a.side&&(this.gl.cullFace(this.gl.FRONT),this.drawBuffers(this.bufferRegistry.registry[b.geometry],b.drawType,b.geometry),this.gl.cullFace(this.gl.BACK)),"back"===a.side&&c.cullFace(c.FRONT))};b.prototype.resetOptions=function(a){var b=this.gl;a&&(a.blending&&b.disable(b.BLEND),"back"===a.side&&b.cullFace(b.BACK))};h.exports=b},{"../utilities/keyValueToArrays":77,
"./BufferRegistry":80,"./Program":82,"./TextureManager":84,"./compileMaterial":86,"./radixSort":88}],86:[function(e,h,v){function b(a,c){for(var d=a.inputs,e=d&&d.length,f=-1;++f<e;)b(d[f],c);c(a);return a}function a(b){if("number"===typeof b)return 1;if(Array.isArray(b))return b.length;var c=b.chunk.output;if("number"===typeof c)return c;b=b.inputs.map(function(b){return a(b)}).join(",");return c[b]}function d(a,b,d){return a.replace(/%\d/g,function(a){return c(b[a[1]-1])}).replace(/\$TEXTURE/,"u_textures["+
d+"]")}function c(a){return Array.isArray(a)?"vec"+a.length+"("+a.join(",")+")":"object"===typeof a?"fa_"+a._id:a.toFixed(6)}function f(a,b){for(var c in b)a[c]=b[c]}var k={1:"float ",2:"vec2 ",3:"vec3 ",4:"vec4 "};h.exports=function(e,h){var l="",n={},p={},t={},m=[],v=[];b(e,function(b,e){if(b.chunk){var g=k[a(b)],y=c(b),z=d(b.chunk.glsl,b.inputs,v.length+h);l+=g+y+" = "+z+"\n ";b.uniforms&&f(n,b.uniforms);b.varyings&&f(p,b.varyings);b.attributes&&f(t,b.attributes);b.chunk.defines&&m.push(b.chunk.defines);
b.texture&&v.push(b.texture)}});return{_id:e._id,glsl:l+"return "+c(e)+";",defines:m.join("\n"),uniforms:n,varyings:p,attributes:t,textures:v}}},{}],87:[function(e,h,v){h.exports=function(){var b=document.createElement("canvas").getContext("2d");b.canvas.width=b.canvas.height=128;for(var a=0;a<b.canvas.height;a+=16)for(var d=0;d<b.canvas.width;d+=16)b.fillStyle=(d^a)&16?"#FFF":"#DDD",b.fillRect(d,a,16,16);return b.canvas}},{}],88:[function(e,h,v){function b(a,b,c){a=a[c];c=b[a];return(c.depth?c.depth:
b[a].uniformValues[1][14])+g}function a(a){q[0]=a;return l[0]}function d(a){l[0]=a;return q[0]}var c=Array(2048*Math.ceil(64/11)),f=32/11+.999999999999999|0,k=2048*(f-1),g=Math.pow(20,6);e=new ArrayBuffer(4);var q=new Float32Array(e,0,1),l=new Int32Array(e,0,1);h.exports=function(e,h){var l=0,m=[],q,r,u,v,y;f=32/11+.999999999999999|0;q=0;for(v=2048*f;q<v;q++)c[q]=0;q=0;for(v=e.length;q<v;q++){y=a(b(e,h,q));y^=y>>31|2147483648;for(u=r=0;r<k;r+=2048,u+=11)c[r+(y>>>u&2047)]++;c[r+(y>>>u&1023)]++}for(r=
0;r<=k;r+=2048)for(q=r,v=0;q<r+2048;q++)y=c[q]+v,c[q]=v-1,v=y;if(--f){q=0;for(v=e.length;q<v;q++){y=a(b(e,h,q));r=m;u=++c[y&2047];var z=e[q];h[z].depth=d(y^(y>>31|2147483648))-g;r[u]=z}q=m;m=e;for(e=q;++l<f;){q=0;v=e.length;r=2048*l;for(u=11*l;q<v;q++)y=a(b(e,h,q)),m[++c[r+(y>>>u&2047)]]=e[q];q=m;m=e;e=q}}q=0;v=e.length;r=2048*l;for(u=11*l;q<v;q++){y=a(b(e,h,q));var l=m,z=++c[r+(y>>>u&1023)],x=e[q];h[x].depth=d(y^(~y>>31|2147483648))-g;l[z]=x;h[e[q]].depth=null}return m}},{}],89:[function(e,h,v){h.exports=
{vertex:'#define GLSLIFY 1\n/**\n * The MIT License (MIT)\n * \n * Copyright (c) 2015 Famous Industries Inc.\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the "Software"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/**\n * The MIT License (MIT)\n * \n * Copyright (c) 2015 Famous Industries Inc.\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the "Software"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/**\n * Calculates transpose inverse matrix from transform\n * \n * @method random\n * @private\n *\n *\n */\n\n\nmat3 getNormalMatrix_1_0(in mat4 t) {\n   mat3 matNorm;\n   mat4 a = t;\n\n   float a00 = a[0][0], a01 = a[0][1], a02 = a[0][2], a03 = a[0][3],\n   a10 = a[1][0], a11 = a[1][1], a12 = a[1][2], a13 = a[1][3],\n   a20 = a[2][0], a21 = a[2][1], a22 = a[2][2], a23 = a[2][3],\n   a30 = a[3][0], a31 = a[3][1], a32 = a[3][2], a33 = a[3][3],\n   b00 = a00 * a11 - a01 * a10,\n   b01 = a00 * a12 - a02 * a10,\n   b02 = a00 * a13 - a03 * a10,\n   b03 = a01 * a12 - a02 * a11,\n   b04 = a01 * a13 - a03 * a11,\n   b05 = a02 * a13 - a03 * a12,\n   b06 = a20 * a31 - a21 * a30,\n   b07 = a20 * a32 - a22 * a30,\n   b08 = a20 * a33 - a23 * a30,\n   b09 = a21 * a32 - a22 * a31,\n   b10 = a21 * a33 - a23 * a31,\n   b11 = a22 * a33 - a23 * a32,\n\n   det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n   det = 1.0 / det;\n\n   matNorm[0][0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n   matNorm[0][1] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n   matNorm[0][2] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n\n   matNorm[1][0] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n   matNorm[1][1] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n   matNorm[1][2] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n\n   matNorm[2][0] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n   matNorm[2][1] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n   matNorm[2][2] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n\n   return matNorm;\n}\n\n\n\n/**\n * The MIT License (MIT)\n * \n * Copyright (c) 2015 Famous Industries Inc.\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the "Software"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/**\n * Calculates a matrix that creates the identity when multiplied by m\n * \n * @method inverse\n * @private\n *\n *\n */\n\n\nfloat inverse_2_1(float m) {\n    return 1.0 / m;\n}\n\nmat2 inverse_2_1(mat2 m) {\n    return mat2(m[1][1],-m[0][1],\n               -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n}\n\nmat3 inverse_2_1(mat3 m) {\n    float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n    float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n    float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n    float b01 =  a22 * a11 - a12 * a21;\n    float b11 = -a22 * a10 + a12 * a20;\n    float b21 =  a21 * a10 - a11 * a20;\n\n    float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n    return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nmat4 inverse_2_1(mat4 m) {\n    float\n        a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n        a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n        a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n        a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n        b00 = a00 * a11 - a01 * a10,\n        b01 = a00 * a12 - a02 * a10,\n        b02 = a00 * a13 - a03 * a10,\n        b03 = a01 * a12 - a02 * a11,\n        b04 = a01 * a13 - a03 * a11,\n        b05 = a02 * a13 - a03 * a12,\n        b06 = a20 * a31 - a21 * a30,\n        b07 = a20 * a32 - a22 * a30,\n        b08 = a20 * a33 - a23 * a30,\n        b09 = a21 * a32 - a22 * a31,\n        b10 = a21 * a33 - a23 * a31,\n        b11 = a22 * a33 - a23 * a32,\n\n        det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n    return mat4(\n        a11 * b11 - a12 * b10 + a13 * b09,\n        a02 * b10 - a01 * b11 - a03 * b09,\n        a31 * b05 - a32 * b04 + a33 * b03,\n        a22 * b04 - a21 * b05 - a23 * b03,\n        a12 * b08 - a10 * b11 - a13 * b07,\n        a00 * b11 - a02 * b08 + a03 * b07,\n        a32 * b02 - a30 * b05 - a33 * b01,\n        a20 * b05 - a22 * b02 + a23 * b01,\n        a10 * b10 - a11 * b08 + a13 * b06,\n        a01 * b08 - a00 * b10 - a03 * b06,\n        a30 * b04 - a31 * b02 + a33 * b00,\n        a21 * b02 - a20 * b04 - a23 * b00,\n        a11 * b07 - a10 * b09 - a12 * b06,\n        a00 * b09 - a01 * b07 + a02 * b06,\n        a31 * b01 - a30 * b03 - a32 * b00,\n        a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n\n\n\n/**\n * The MIT License (MIT)\n * \n * Copyright (c) 2015 Famous Industries Inc.\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the "Software"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/**\n * Reflects a matrix over its main diagonal.\n * \n * @method transpose\n * @private\n *\n *\n */\n\n\nfloat transpose_3_2(float m) {\n    return m;\n}\n\nmat2 transpose_3_2(mat2 m) {\n    return mat2(m[0][0], m[1][0],\n                m[0][1], m[1][1]);\n}\n\nmat3 transpose_3_2(mat3 m) {\n    return mat3(m[0][0], m[1][0], m[2][0],\n                m[0][1], m[1][1], m[2][1],\n                m[0][2], m[1][2], m[2][2]);\n}\n\nmat4 transpose_3_2(mat4 m) {\n    return mat4(m[0][0], m[1][0], m[2][0], m[3][0],\n                m[0][1], m[1][1], m[2][1], m[3][1],\n                m[0][2], m[1][2], m[2][2], m[3][2],\n                m[0][3], m[1][3], m[2][3], m[3][3]);\n}\n\n\n\n\n/**\n * Converts vertex from modelspace to screenspace using transform\n * information from context.\n *\n * @method applyTransform\n * @private\n *\n *\n */\n\nvec4 applyTransform(vec4 pos) {\n    //TODO: move this multiplication to application code. \n\n    /**\n     * Currently multiplied in the vertex shader to avoid consuming the complexity of holding an additional\n     * transform as state on the mesh object in WebGLRenderer. Multiplies the object\'s transformation from object space\n     * to world space with its transformation from world space to eye space.\n     */\n    mat4 MVMatrix = u_view * u_transform;\n\n    //TODO: move the origin, sizeScale and y axis inversion to application code in order to amortize redundant per-vertex calculations.\n\n    /**\n     * The transform uniform should be changed to the result of the transformation chain:\n     *\n     * view * modelTransform * invertYAxis * sizeScale * origin\n     *\n     * which could be simplified to:\n     *\n     * view * modelTransform * convertToDOMSpace\n     *\n     * where convertToDOMSpace represents the transform matrix:\n     *\n     *                           size.x 0       0       size.x \n     *                           0      -size.y 0       size.y\n     *                           0      0       1       0\n     *                           0      0       0       1\n     *\n     */\n\n    /**\n     * Assuming a unit volume, moves the object space origin [0, 0, 0] to the "top left" [1, -1, 0], the DOM space origin.\n     * Later in the transformation chain, the projection transform negates the rigidbody translation.\n     * Equivalent to (but much faster than) multiplying a translation matrix "origin"\n     *\n     *                           1 0 0 1 \n     *                           0 1 0 -1\n     *                           0 0 1 0\n     *                           0 0 0 1\n     *\n     * in the transform chain: projection * view * modelTransform * invertYAxis * sizeScale * origin * positionVector.\n     */\n    pos.x += 1.0;\n    pos.y -= 1.0;\n\n    /**\n     * Assuming a unit volume, scales an object to the amount of pixels in the size uniform vector\'s specified dimensions.\n     * Later in the transformation chain, the projection transform transforms the point into clip space by scaling\n     * by the inverse of the canvas\' resolution.\n     * Equivalent to (but much faster than) multiplying a scale matrix "sizeScale"\n     *\n     *                           size.x 0      0      0 \n     *                           0      size.y 0      0\n     *                           0      0      size.z 0\n     *                           0      0      0      1\n     *\n     * in the transform chain: projection * view * modelTransform * invertYAxis * sizeScale * origin * positionVector.\n     */\n    pos.xyz *= u_size * 0.5;\n\n    /**\n     * Inverts the object space\'s y axis in order to match DOM space conventions. \n     * Later in the transformation chain, the projection transform reinverts the y axis to convert to clip space.\n     * Equivalent to (but much faster than) multiplying a scale matrix "invertYAxis"\n     *\n     *                           1 0 0 0 \n     *                           0 -1 0 0\n     *                           0 0 1 0\n     *                           0 0 0 1\n     *\n     * in the transform chain: projection * view * modelTransform * invertYAxis * sizeScale * origin * positionVector.\n     */\n    pos.y *= -1.0;\n\n    /**\n     * Exporting the vertex\'s position as a varying, in DOM space, to be used for lighting calculations. This has to be in DOM space\n     * since light position and direction is derived from the scene graph, calculated in DOM space.\n     */\n\n    v_position = (MVMatrix * pos).xyz;\n\n    /**\n    * Exporting the eye vector (a vector from the center of the screen) as a varying, to be used for lighting calculations.\n    * In clip space deriving the eye vector is a matter of simply taking the inverse of the position, as the position is a vector\n    * from the center of the screen. However, since our points are represented in DOM space,\n    * the position is a vector from the top left corner of the screen, so some additional math is needed (specifically, subtracting\n    * the position from the center of the screen, i.e. half the resolution of the canvas).\n    */\n\n    v_eyeVector = (u_resolution * 0.5) - v_position;\n\n    /**\n     * Transforming the position (currently represented in dom space) into view space (with our dom space view transform)\n     * and then projecting the point into raster both by applying a perspective transformation and converting to clip space\n     * (the perspective matrix is a combination of both transformations, therefore it\'s probably more apt to refer to it as a\n     * projection transform).\n     */\n\n    pos = u_perspective * MVMatrix * pos;\n\n    return pos;\n}\n\n/**\n * Placeholder for positionOffset chunks to be templated in.\n * Used for mesh deformation.\n *\n * @method calculateOffset\n * @private\n *\n *\n */\n#vert_definitions\nvec3 calculateOffset(vec3 ID) {\n    #vert_applications\n    return vec3(0.0);\n}\n\n/**\n * Writes the position of the vertex onto the screen.\n * Passes texture coordinate and normal attributes as varyings\n * and passes the position attribute through position pipeline.\n *\n * @method main\n * @private\n *\n *\n */\nvoid main() {\n    v_textureCoordinate = a_texCoord;\n    vec3 invertedNormals = a_normals + (u_normals.x < 0.0 ? calculateOffset(u_normals) * 2.0 - 1.0 : vec3(0.0));\n    invertedNormals.y *= -1.0;\n    v_normal = transpose_3_2(mat3(inverse_2_1(u_transform))) * invertedNormals;\n    vec3 offsetPos = a_pos + calculateOffset(u_positionOffset);\n    gl_Position = applyTransform(vec4(offsetPos, 1.0));\n}\n',
fragment:'#define GLSLIFY 1\n/**\n * The MIT License (MIT)\n * \n * Copyright (c) 2015 Famous Industries Inc.\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the "Software"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/**\n * The MIT License (MIT)\n * \n * Copyright (c) 2015 Famous Industries Inc.\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the "Software"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/**\n * Placeholder for fragmentShader  chunks to be templated in.\n * Used for normal mapping, gloss mapping and colors.\n * \n * @method applyMaterial\n * @private\n *\n *\n */\n\n#float_definitions\nfloat applyMaterial_2_0(float ID) {\n    #float_applications\n    return 1.;\n}\n\n#vec3_definitions\nvec3 applyMaterial_2_0(vec3 ID) {\n    #vec3_applications\n    return vec3(0);\n}\n\n#vec4_definitions\nvec4 applyMaterial_2_0(vec4 ID) {\n    #vec4_applications\n\n    return vec4(0);\n}\n\n\n\n/**\n * The MIT License (MIT)\n * \n * Copyright (c) 2015 Famous Industries Inc.\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the "Software"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/**\n * Calculates the intensity of light on a surface.\n *\n * @method applyLight\n * @private\n *\n */\nvec4 applyLight_1_1(in vec4 baseColor, in vec3 normal, in vec4 glossiness, int numLights, vec3 ambientColor, vec3 eyeVector, mat4 lightPosition, mat4 lightColor, vec3 v_position) {\n    vec3 diffuse = vec3(0.0);\n    bool hasGlossiness = glossiness.a > 0.0;\n    bool hasSpecularColor = length(glossiness.rgb) > 0.0;\n\n    for(int i = 0; i < 4; i++) {\n        if (i >= numLights) break;\n        vec3 lightDirection = normalize(lightPosition[i].xyz - v_position);\n        float lambertian = max(dot(lightDirection, normal), 0.0);\n\n        if (lambertian > 0.0) {\n            diffuse += lightColor[i].rgb * baseColor.rgb * lambertian;\n            if (hasGlossiness) {\n                vec3 halfVector = normalize(lightDirection + eyeVector);\n                float specularWeight = pow(max(dot(halfVector, normal), 0.0), glossiness.a);\n                vec3 specularColor = hasSpecularColor ? glossiness.rgb : lightColor[i].rgb;\n                diffuse += specularColor * specularWeight * lambertian;\n            }\n        }\n\n    }\n\n    return vec4(ambientColor + diffuse, baseColor.a);\n}\n\n\n\n\n\n/**\n * Writes the color of the pixel onto the screen\n *\n * @method main\n * @private\n *\n *\n */\nvoid main() {\n    vec4 material = u_baseColor.r >= 0.0 ? u_baseColor : applyMaterial_2_0(u_baseColor);\n\n    /**\n     * Apply lights only if flat shading is false\n     * and at least one light is added to the scene\n     */\n    bool lightsEnabled = (u_flatShading == 0.0) && (u_numLights > 0.0 || length(u_ambientLight) > 0.0);\n\n    vec3 normal = normalize(v_normal);\n    vec4 glossiness = u_glossiness.x < 0.0 ? applyMaterial_2_0(u_glossiness) : u_glossiness;\n\n    vec4 color = lightsEnabled ?\n    applyLight_1_1(material, normalize(v_normal), glossiness,\n               int(u_numLights),\n               u_ambientLight * u_baseColor.rgb,\n               normalize(v_eyeVector),\n               u_lightPosition,\n               u_lightColor,   \n               v_position)\n    : material;\n\n    gl_FragColor = color;\n    gl_FragColor.a *= u_opacity;   \n}\n'}},
{}],90:[function(e,h,v){function b(){}b.prototype.init=function(){var a=1/60*1E3;this.framedata={test_box:{sequence:{frames:[{x:0,y:0,ms:a},{x:160,y:0,ms:a},{x:320,y:0,ms:a},{x:480,y:0,ms:a},{x:640,y:0,ms:a},{x:800,y:0,ms:a},{x:960,y:0,ms:a},{x:1120,y:0,ms:a},{x:1280,y:0,ms:a},{x:1440,y:0,ms:a},{x:1600,y:0,ms:a},{x:0,y:160,ms:a},{x:160,y:160,ms:a},{x:320,y:160,ms:a},{x:480,y:160,ms:a},{x:640,y:160,ms:a},{x:800,y:160,ms:a},{x:960,y:160,ms:a},{x:1120,y:160,ms:a},{x:1280,y:160,ms:a},{x:1440,y:160,ms:a},
{x:1600,y:160,ms:a},{x:0,y:320,ms:a},{x:160,y:320,ms:a},{x:320,y:320,ms:a},{x:480,y:320,ms:a},{x:640,y:320,ms:a},{x:800,y:320,ms:a},{x:960,y:320,ms:a},{x:1120,y:320,ms:a},{x:1280,y:320,ms:a},{x:1440,y:320,ms:a},{x:1600,y:320,ms:a},{x:0,y:480,ms:a},{x:160,y:480,ms:a},{x:320,y:480,ms:a},{x:480,y:480,ms:a},{x:640,y:480,ms:a},{x:800,y:480,ms:a},{x:960,y:480,ms:a},{x:1120,y:480,ms:a},{x:1280,y:480,ms:a},{x:1440,y:480,ms:a},{x:1600,y:480,ms:a},{x:0,y:640,ms:a},{x:160,y:640,ms:a},{x:320,y:640,ms:a},{x:480,
y:640,ms:a},{x:640,y:640,ms:a},{x:800,y:640,ms:a},{x:960,y:640,ms:a},{x:1120,y:640,ms:a},{x:1280,y:640,ms:a},{x:1440,y:640,ms:a},{x:1600,y:640,ms:a},{x:0,y:800,ms:a},{x:160,y:800,ms:a},{x:320,y:800,ms:a},{x:480,y:800,ms:a},{x:640,y:800,ms:a}],frameIterator:0,msTimer:0},sequence_timed:{frames:[{x:0,y:0,ms:100},{x:160,y:0,ms:100},{x:320,y:0,ms:100},{x:480,y:0,ms:100},{x:640,y:0,ms:100},{x:800,y:0,ms:100},{x:960,y:0,ms:100},{x:1120,y:0,ms:100},{x:1280,y:0,ms:100},{x:1440,y:0,ms:100},{x:1600,y:0,ms:100},
{x:0,y:160,ms:100},{x:160,y:160,ms:100},{x:320,y:160,ms:100},{x:480,y:160,ms:100},{x:640,y:160,ms:100},{x:800,y:160,ms:100},{x:960,y:160,ms:100},{x:1120,y:160,ms:100},{x:1280,y:160,ms:100},{x:1440,y:160,ms:100},{x:1600,y:160,ms:100},{x:0,y:320,ms:100},{x:160,y:320,ms:100},{x:320,y:320,ms:100},{x:480,y:320,ms:100},{x:640,y:320,ms:100},{x:800,y:320,ms:100},{x:960,y:320,ms:100},{x:1120,y:320,ms:100},{x:1280,y:320,ms:100},{x:1440,y:320,ms:100},{x:1600,y:320,ms:100},{x:0,y:480,ms:100},{x:160,y:480,ms:100},
{x:320,y:480,ms:100},{x:480,y:480,ms:100},{x:640,y:480,ms:100},{x:800,y:480,ms:100},{x:960,y:480,ms:100},{x:1120,y:480,ms:100},{x:1280,y:480,ms:100},{x:1440,y:480,ms:100},{x:1600,y:480,ms:100},{x:0,y:640,ms:100},{x:160,y:640,ms:100},{x:320,y:640,ms:100},{x:480,y:640,ms:100},{x:640,y:640,ms:100},{x:800,y:640,ms:100},{x:960,y:640,ms:100},{x:1120,y:640,ms:100},{x:1280,y:640,ms:100},{x:1440,y:640,ms:100},{x:1600,y:640,ms:100},{x:0,y:800,ms:100},{x:160,y:800,ms:100},{x:320,y:800,ms:100},{x:480,y:800,ms:100},
{x:640,y:800,ms:100}],frameIterator:0,msTimer:0},reverseSequence:{frames:[{x:640,y:800,ms:a},{x:480,y:800,ms:a},{x:320,y:800,ms:a},{x:160,y:800,ms:a},{x:0,y:800,ms:a},{x:1600,y:640,ms:a},{x:1440,y:640,ms:a},{x:1280,y:640,ms:a},{x:1120,y:640,ms:a},{x:960,y:640,ms:a},{x:800,y:640,ms:a},{x:640,y:640,ms:a},{x:480,y:640,ms:a},{x:320,y:640,ms:a},{x:160,y:640,ms:a},{x:0,y:640,ms:a},{x:1600,y:480,ms:a},{x:1440,y:480,ms:a},{x:1280,y:480,ms:a},{x:1120,y:480,ms:a},{x:960,y:480,ms:a},{x:800,y:480,ms:a},{x:640,
y:480,ms:a},{x:480,y:480,ms:a},{x:320,y:480,ms:a},{x:160,y:480,ms:a},{x:0,y:480,ms:a},{x:1600,y:320,ms:a},{x:1440,y:320,ms:a}],frameIterator:0,msTimer:0}}};return this};h.exports=new b},{}],91:[function(e,h,v){function b(){I&&(I=null);I=new r.PhysicsEngine(N);I.game=w;w.world=I;w.over=!1;w.speed_reducer=5;w.teir_reducer=1;for(var a=J.getChildren(),b=a.length;b--;)null!=a[b]&&("scoreNode"!=a[b].name&&"startButtonNode"!=a[b].name&&"gameOverNode"!=a[b].name||J.removeChild(a[b]));document.body.style.cursor=
"none";G&&(G.dismount(),G={});G=w.addChild();w.activeEnemies=[];w.gameEnemies=G;G.name="gameEnemies";w.lives=1;G.createEnemiesComponent={id:null,node:null,active:!1,onMount:function(a){this.id=a.addComponent(this);this.node=a},onReceive:function(a,b){"createEnemies"==a&&this.node.requestUpdate(this.id)},onUpdate:function(){1!=this.active&&(p("start"),this.active=!0,n(),k(),w.emit("sequence_timed",{looping:!0}),f(G._children[0]),p("end"))}};G.addComponent(G.createEnemiesComponent);w.emit("createEnemies",
{});a=J.addChild();w.scoreNode=a;a.name="scoreNode";w.sizes=w.getSize();a.setSizeMode("absolute","absolute").setAbsoluteSize(w.sizes[0],100).setAlign(.5,.5).setPosition(-w.sizes[0]/2,-50);a.DOMElement=new t(a);a.DOMElement.setProperty("font-size","60px").setProperty("opacity","0.5").setProperty("text-align","center").setContent("0");w.score=0;l(w.boxNode.box);w.gameLivesNode=J.addChild();w.gameLivesNode.gameLivesComponent={id:null,node:null,life:null,onMount:function(a){this.id=a.addComponent(this);
this.node=a},onReceive:function(a,b){"manageLives"==a&&(this.life=b.life,this.node.requestUpdate(this.id))},onUpdate:function(a){a=this.life;w.lives+=a;if(1==a&&3>=w.lives){a=w.lives;var b=w.gameLivesNode.addChild();b.setSizeMode("absolute","absolute").setAbsoluteSize(40,40).setAlign(.5,.5).setPosition(-120+40*a,0,1);b.DOMElement=new t(b);b.DOMElement.setProperty("background-color","green").setProperty("opacity","0.4").setProperty("padding","5px 0px")}else-1==a&&null!=this.node._children[this.node._children.length-
1]&&(this.node._children[this.node._children.length-1].dismount(),this.node._children.splice(this.node._children.length-1,1));3<w.lives&&(w.lives=3)}};w.gameLivesNode.addComponent(w.gameLivesNode.gameLivesComponent)}function a(){var a=J.addChild();w.boxNode=a;a.name="boxNode";a.framedata=O.framedata.test_box;a.idle=!0;a.setSizeMode("absolute","absolute").setAbsoluteSize(40,40).setAlign(.5,.5).setPosition(-20,-20,1E4).setOrigin(.5,.5);a.size=80;a.DOMElement=new t(a);a.DOMElement.setProperty("background-image",
"url(./assets/grid.png)").setProperty("background-size","1100% 600%").setProperty("z-index","1000");var b=a.getPosition(),c=a.addComponent({id:null,node:null,onMount:function(a){this.id=a.addComponent(this);this.node=a},onUpdate:function(c){a.box||(a.box=new L({mass:1,size:[40,40,40],position:new y(b[0],b[1]),restitution:0,friction:0}),a.box.node=a,I.addBody(a.box));1==w.started&&a.setAlign(0,0);c=a.box.getPosition();a.setPosition(c.x,c.y,1E4);a.requestUpdate(this.id)}});d(a);a.requestUpdate(c)}function d(a){a.addComponent({id:null,
node:null,done:function(a){a.framedata.active.frameIterator=0;a.framedata.active.msTimer=0;a.framedata.active=null;a.animationTransitionable.halt()},onMount:function(a){this.id=a.addComponent(this);this.node=a},onReceive:function(a,b){var c=this.node.framedata;if(c[a]&&(c.active||(c.active=c[a],c.active.event=a,c.active.frameIterator=0,"undefined"!=typeof b.looping&&(c.active.looping=b.looping),"undefined"!=typeof b.interruptable&&(c.active.interruptable=b.interruptable)),"undefined"!=typeof c.active.interruptable&&
0==c.active.interruptable&&(b.interrupt=!1),1>c.active.frameIterator||b.interrupt)){b.interrupt&&(this.node.animationTransitionable&&this.node.animationTransitionable.halt(),c.active.frameIterator=0);c.active=c[a];c.active.event=a;"undefined"!=typeof b.interruptable&&(c.active.interruptable=b.interruptable);for(var d=c.active.frames,e=0,f=0;f<d.length;f++)e+=d[f].ms;c.active.duration=e;this.node.animationTransitionable=new A(0);this.node.requestUpdate(this.id);this.node.animationTransitionable.from(0).to(e,
"linear",e,null,this.done,this.node)}},onUpdate:function(){var a=this.node.framedata;if(a.active){var b=a.active,c=b.frames,d=this.node.animationTransitionable;1>d._state&&(b.frameIterator=0,b.msTimer=0);b.frameIterator<c.length?d._state<b.msTimer+c[b.frameIterator].ms+2&&d._state>=b.msTimer-2&&null!=b?(this.node.DOMElement.setProperty("background-position","-"+c[b.frameIterator].x/4+"px -"+c[b.frameIterator].y/4+"px"),b.msTimer+=c[b.frameIterator].ms,b.frameIterator++,d.get(),this.node.requestUpdate(this.id)):
d.isActive()&&(d.get(),this.node.requestUpdate(this.id)):b.frameIterator>=c.length&&(d.isActive()&&d.halt(),b.looping?(b.frameIterator=0,d.from(0).to(a.active.duration,"linear",a.active.duration,null,this.done,this.node),this.node.requestUpdate(this.id)):a.active=null)}}})}function c(a){a.newEnemyComponent={id:null,node:null,done:function(a){a in a._updater._updateQueue&&m._updateQueue.splice(a._updater._updateQueue.indexOf(a),1);a._updateQueue&&a._updateQueue.length&&(a._updateQueue=[]);a._nextUpdateQueue&&
a._nextUpdateQueue.length&&(a._nextUpdateQueue=[]);w.world.remove(a.collision);w.world.remove(a.sphere);w.activeEnemies.splice(w.activeEnemies.indexOf(a),1);w.inactive.push(a);a.dismount();l(w.boxNode.box)},onMount:function(a){this.id=a.addComponent(this);this.node=a},onUpdate:function(a){a=this.node.sphere.getPosition();-100!=a.z&&(a.x-65>H[0]||0>a.x+65||a.y-65>H[1]||0>a.y+65?null!=this.node._id&&this.done(this.node):(this.node.setPosition(a.x,a.y,3),this.node.requestUpdate(this.id)))}};a.addComponent(a.newEnemyComponent)}
function f(a,b,c){function d(b){if(b!=a)return b}w.activeEnemies.push(a);var e=[1,2,3,4],e=e[Math.floor(Math.random()*e.length)],f=a._size;1==e?(a.setPosition(H[0],Math.round(Math.random()*H[1]),3),a.sphere.setPosition(H[0],Math.round(Math.random()*H[1]),0),a.name="right"):2==e?(a.setPosition(-f,Math.round(Math.random()*H[1]),3),a.sphere.setPosition(-f,Math.round(Math.random()*H[1]),0),a.name="left"):3==e?(a.setPosition(Math.round(Math.random()*H[0]),H[1],3),a.sphere.setPosition(Math.round(Math.random()*
H[0]),H[1],0),a.name="bottom"):4==e&&(a.setPosition(Math.round(Math.random()*H[0]),-f,3),a.sphere.setPosition(Math.round(Math.random()*H[0]),-f,0),a.name="top");e=.5>Math.random()?!0:!1;f=a.getPosition();"left"==a.name?1==e?f[1]>H[1]/2?a.sphere.setVelocity(b,-b):a.sphere.setVelocity(b,b):a.sphere.setVelocity(b,0):"right"==a.name?1==e?f[1]>H[1]/2?a.sphere.setVelocity(-b,-b):a.sphere.setVelocity(-b,b):a.sphere.setVelocity(-b,0):"top"==a.name?1==e?f[0]>H[0]/2?a.sphere.setVelocity(-b,b):a.sphere.setVelocity(b,
b):a.sphere.setVelocity(0,b):"bottom"==a.name&&(1==e?f[0]>H[0]/2?a.sphere.setVelocity(-b,-b):a.sphere.setVelocity(b,-b):a.sphere.setVelocity(0,-b));w.inactive=w.inactive?w.inactive.filter(d):G._children.filter(d);a.requestUpdate(a.newEnemyComponent.id);var g=Math.floor(Math.random()*w.inactive.length);m.getClock().setTimeout(function(){k(w.inactive[g])},c)}function k(){var a="black red blue grey green yellow orange purple violet gainsboro".split(" "),b=Math.random(),d=92;699<w.score&&(d=100);d=Math.floor(b*
d);if(0==w.over){b=a[0];46<d&&93>d?b=a[1]:93==d?b=a[2]:94==d?b=a[3]:95==d?b=a[4]:96==d?b=a[5]:97==d?b=a[6]:98==d?b=a[7]:99==d?b=a[8]:100==d&&(b=a[9]);a=[200,300];a=Math.floor(Math.floor(Math.random()*(a[1]-a[0]))+a[0]+Math.floor(Math.random()*(w.score+1))/w.speed_reducer);w.timing_teir_i=0;200>w.score/w.teir_reducer?w.timing_teir_i=0:400>w.score/w.teir_reducer?w.timing_teir_i=1:800>w.score/w.teir_reducer?w.timing_teir_i=2:1600>w.score/w.teir_reducer?w.timing_teir_i=3:2400>w.score/w.teir_reducer?w.timing_teir_i=
4:2400<=w.score/w.teir_reducer&&(w.timing_teir_i=5);var d=[[500,1E3],[400,700],[300,500],[200,400],[100,250],[50,125]][w.timing_teir_i],d=Math.floor(Math.random()*(d[1]-d[0]))+d[0],e=G.addChild();e.name="";var g=[30,40,50,60],g=g[Math.floor(Math.random()*g.length)];e._size=g;e.setSizeMode("absolute","absolute").setAbsoluteSize(g,g).setPosition(-(g+5),-(g+5),3);e.DOMElement=new t(e);e.DOMElement.setProperty("background",b).setProperty("color","teal").setProperty("font-size","24px").setProperty("font-weight",
"bold").setProperty("word-wrap","break-word").setProperty("border-radius","100%").setProperty("text-align","center").setContent(e._id.substring(e._id.length-2,e._id.length));b=e.getPosition();e._position=b;e.sphere=new u({mass:1,radius:g/2,position:new y(b[0],b[1],-100),restitution:0,friction:0});e.sphere.node=e;I.addBody(e.sphere);e.collision=I.addConstraint(new B([w.boxNode.box,e.sphere],{restitution:0}));l(e.sphere);c(e);f(e,a,d)}}function g(){if(w.slowTime)w.slowTimeBarTimerNode.slowTimeBarTimerComponent.startTime=
m.getClock()._time;else{w.slowTime=!0;var a=J.addChild();w.slowTimeBarTimerNode=a;a.name="slowTimeBarTimerNode";a.setSizeMode("relative","absolute").setAbsoluteSize(null,10).setProportionalSize(.9,null).setAlign(.5,0);a.setPosition(-Math.floor(.9*H[0]/2),120,1);a.DOMElement=new t(a);a.DOMElement.setProperty("background-color","black").setProperty("opacity","0.5");a.slowTimeBarTimerComponent={id:null,node:null,startTime:null,done:function(a){a in a._updater._updateQueue&&m._updateQueue.splice(a._updater._updateQueue.indexOf(a),
1);a._updateQueue&&a._updateQueue.length&&(a._updateQueue=[]);a._nextUpdateQueue&&a._nextUpdateQueue.length&&(a._nextUpdateQueue=[]);a.dismount();delete w.slowTime;delete w.slowTimeBarTimerNode.DOMElement;for(a=0;a<G._children.length;a++)if(null!=G._children[a]){for(var b=G._children[a].sphere.velocity.toArray(),c=0;c<b.length;c++)b[c]=Math.floor(2*b[c]);G._children[a].sphere.setVelocity(b[0],b[1],b[2])}},onMount:function(a){this.id=a.addComponent(this);this.node=a},onUpdate:function(a){null==this.startTime?
this.startTime=a:(a-=this.startTime,3E3<a?this.done(this.node):(a=.9*(1-a/3E3),this.node.setProportionalSize(a,null)));for(a=0;a<G._children.length;a++)if(null!=G._children[a]&&!G._children[a].slowed){for(var b=G._children[a].sphere.velocity.toArray(),c=0;c<b.length;c++)b[c]=Math.floor(b[c]/2);G._children[a].sphere.setVelocity(b[0],b[1],b[2]);G._children[a].slowed=!0}this.node.requestUpdate(this.id)}};a.addComponent(a.slowTimeBarTimerComponent);a.requestUpdate(a.slowTimeBarTimerComponent.id)}}function q(){if(w.invincible)w.invincibleBarTimerNode.invincibleBarTimerComponent.startTime=
m.getClock()._time;else{w.invincible=!0;var a=J.addChild();w.invincibleBarTimerNode=a;a.name="invincibleBarTimerNode";a.setSizeMode("relative","absolute").setAbsoluteSize(null,10).setProportionalSize(.9,null).setAlign(.5,0);a.setPosition(-Math.floor(.9*H[0]/2),100,1);a.DOMElement=new t(a);a.DOMElement.setProperty("background-color","black").setProperty("opacity","0.5");a.invincibleBarTimerComponent={id:null,node:null,startTime:null,done:function(a){a.dismount();for(var b=0;b<m._updateQueue.length;b++)m._updateQueue[b]==
a&&(m._updateQueue.splice(b,1),b--);delete w.invincible;delete w.invincibleBarTimerNode.DOMElement},onMount:function(a){this.id=a.addComponent(this);this.node=a},onUpdate:function(a){null==this.startTime?this.startTime=a:(a-=this.startTime,3E3<a?this.done(this.node):(a=.9*(1-a/3E3),this.node.setProportionalSize(a,null)));this.node.requestUpdate(this.id)}};a.addComponent(a.invincibleBarTimerComponent);a.requestUpdate(a.invincibleBarTimerComponent.id)}}function l(a){a.angularMomentum=new y(0,0,0);a.angularVelocity=
new y(0,0,0);a.momentum=new y(0,0,0);a.orientation=new x(1,0,0,0);a.velocity=new y(0,0,0);a.torque=new y(0,0,0);a.inverseInertia=new z([1,0,0,0,1,0,0,0,1]);a.localInertia=new z([1,0,0,0,1,0,0,0,1]);a.localInverseInertia=new z([1,0,0,0,1,0,0,0,1]);a.restitution=0;a.friction=0}function n(){var a=w.gameEnemies,b={id:null,node:null,onMount:function(a){this.id=a.addComponent(this);this.node=a},onUpdate:function(a){for(var b=w.activeEnemies.map(function(a){return a.collision}),c=b.length,d,e,f,h=0;h<c;h++)if((d=
b[h])&&d.contactManifoldTable.collisionMatrix.hasOwnProperty(0)&&(l(w.boxNode.box),d.targets[1].node.DOMElement&&(e=d.targets[1].node,f=e.DOMElement._styles.background,e.newEnemyComponent.done(e),!d.detected)))if(d.detected=!0,"black"==f)w.score+=e._size,w.scoreNode.DOMElement.setContent(w.score);else if("red"==f){if(w.invincible||1!=w.lives)w.invincible||w.emit("manageLives",{life:-1})}else"blue"==f?q():"grey"==f?g():"green"==f?w.teir_reducer+=2:"yellow"==f?w.speed_reducer+=10:"orange"==f?(w.score+=
1E3,w.scoreNode.DOMElement.setContent(w.score)):"purple"==f&&w.emit("manageLives",{life:1});I.update(a);this.node.requestUpdate(this.id)}};a.collisionComponent=b;a.addComponent(b);a.requestUpdate(b.id)}function p(a){if("start"==a){a=J.addChild();a.setPosition(0,0,1E6).setSizeMode("relative","relative").setProportionalSize(1,1);a.DOMElement=new t(a);a.DOMElement.setProperty("background-color","white");var b=a.addChild();w.loading=a;b.name="loadingNode";b.setSizeMode("absolute","absolute").setAbsoluteSize(240,
60).setAlign(.5,.5).setPosition(-120,-30,1000002).setOrigin(.5,.5);b.DOMElement=new t(b);b.DOMElement.setProperty("z-index","1000").setProperty("font-size","24px").setProperty("color","black").setContent("Loading...");b.getPosition();b.addComponent({id:null,node:null,onMount:function(a){this.id=a.addComponent(this);this.node=a},onUpdate:function(a){}})}else"end"==a&&J.removeChild(w.loading)}var t=e("famous/dom-renderables/DOMElement"),m=e("famous/core/FamousEngine");h=e("famous/core/Dispatch");var A=
e("famous/transitions/Transitionable");e("famous/core/Node");e("famous/components/Position");e("famous/math");var r=e("famous/physics"),u=e("famous/physics/bodies/Sphere"),L=e("famous/physics/bodies/Box"),y=e("famous/math/Vec3"),z=e("famous/math/Mat33"),x=e("famous/math/Quaternion"),B=e("famous/physics/constraints/Collision");e=e("./framedata.js");m.init();var O=e.init();e=m.createScene();e.name="theScene";document.theScene=e;var N={},I=new r.PhysicsEngine(N),w=e.addChild();w.name="game";w.dispatch=
h;var J=w.addChild();J.name="gameUI";var H=w.getSize(),G;document.addEventListener("touchmove",function(a){a.preventDefault();w.onReceive(a.type,a)},!1);document.addEventListener("touchend",function(a){a.preventDefault();w.onReceive(a.type,a)},!1);document.addEventListener("keydown",function(a){w.onReceive(a.type,a)}.bind(void 0));document.addEventListener("mousemove",function(a){w.onReceive(a.type,a)});document.addEventListener("click",function(a){w.onReceive(a.type,a)});w.onReceive=function(b,c){if("keydown"==
b)66==c.keyCode?w.emit("sequence",c):67==c.keyCode?w.emit("reverseSequence",c):65==c.keyCode&&(c.interruptable=!1,w.emit("sequence_timed",c));else if("click"==b||"touchend"==b){if(c.target.attributes.getNamedItem("data-fa-path"))var d=c.target.attributes.getNamedItem("data-fa-path").value;else c.target.parentNode.attributes.getNamedItem("data-fa-path")&&(d=c.target.parentNode.attributes.getNamedItem("data-fa-path").value);(d=w.dispatch.getNode(d))&&"startButtonNode"==d.name?w.emit("startButton",c):
d&&"addEnemyButtonNode"==d.name?w.emit("addEnemyButton",c):d&&"boxNode"==d.name&&(c.interrupt=!0,w.emit("sequence",c))}else if(("mousemove"==b||"touchmove"==b)&&w.started&&1==w.started){w.boxNode.box||a();var e;"touchmove"==event.type?(d=event.touches[0].clientX-w.boxNode.size/2,e=event.touches[0].clientY-w.boxNode.size/2):(d=event.clientX-w.boxNode.size/2,e=event.clientY-w.boxNode.size/2);w.boxNode.box.setPosition(d,e,0)}};a();(function(a){var c=J.addChild();c.name="startButtonNode";c.setSizeMode("absolute",
"absolute").setAbsoluteSize(240,60).setAlign(.5,.8).setPosition(-120,-30);c.DOMElement=new t(c);c.DOMElement.setProperty("font-size","46px").setContent("Start Game 1");c.addComponent({id:null,node:null,gameOver:a,onMount:function(a){this.id=a.addComponent(this);this.node=a},onReceive:function(a,b){"startButton"==a&&this.node.requestUpdate(this.id)},onUpdate:function(){1==this.gameOver?location.reload():(w.started=!0,b())}})})();(function(a){try{var b=window[a];b.setItem("__storage_test__","__storage_test__");
b.removeItem("__storage_test__");return!0}catch(c){return!1}})("localStorage")?(window.localStorage.high_score||(window.localStorage.high_score=0),w.storage={available:!0}):w.storage={available:!1}},{"./framedata.js":90,"famous/components/Position":2,"famous/core/Dispatch":6,"famous/core/FamousEngine":8,"famous/core/Node":9,"famous/dom-renderables/DOMElement":17,"famous/math":36,"famous/math/Mat33":32,"famous/math/Quaternion":33,"famous/math/Vec3":35,"famous/physics":64,"famous/physics/bodies/Box":39,
"famous/physics/bodies/Sphere":41,"famous/physics/constraints/Collision":46,"famous/transitions/Transitionable":73}]},{},[91]);
