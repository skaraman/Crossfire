(function(d){"object"===typeof exports&&"undefined"!==typeof module?module.exports=d():"function"===typeof define&&define.amd?define([],d):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).Matter=d()})(function(){return function a(b,e,c){function f(g,k){if(!e[g]){if(!b[g]){var m="function"==typeof require&&require;if(!k&&m)return m(g,!0);if(h)return h(g,!0);m=Error("Cannot find module '"+g+"'");throw m.code="MODULE_NOT_FOUND",m;}m=e[g]={exports:{}};
b[g][0].call(m.exports,function(a){var c=b[g][1][a];return f(c?c:a)},m,m.exports,a,b,e,c)}return e[g].exports}for(var h="function"==typeof require&&require,k=0;k<c.length;k++)f(c[k]);return f}({1:[function(a,b,e){var c={};b.exports=c;var f=a("../geometry/Vertices"),h=a("../geometry/Vector"),k=a("../core/Sleeping");a("../render/Render");var g=a("../core/Common"),r=a("../geometry/Bounds"),m=a("../geometry/Axes");(function(){c._inertiaScale=4;c._nextCollidingGroupId=1;c._nextNonCollidingGroupId=-1;c._nextCategory=
1;c.create=function(a){var p={id:g.nextId(),type:"body",label:"Body",parts:[],angle:0,vertices:f.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,
timeScale:1,render:{visible:!0,opacity:1,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0},lineWidth:1.5}},p=g.extend(p,a);c.set(p,{bounds:p.bounds||r.create(p.vertices),positionPrev:p.positionPrev||h.clone(p.position),anglePrev:p.anglePrev||p.angle,vertices:p.vertices,parts:p.parts||[p],isStatic:p.isStatic,isSleeping:p.isSleeping,parent:p.parent||p});f.rotate(p.vertices,p.angle,p.position);m.rotate(p.axes,p.angle);r.update(p.bounds,p.vertices,p.velocity);c.set(p,{axes:a.axes||p.axes,area:a.area||p.area,
mass:a.mass||p.mass,inertia:a.inertia||p.inertia});a=p.isStatic?"#eeeeee":g.choose(["#556270","#4ECDC4","#C7F464","#FF6B6B","#C44D58"]);var b=g.shadeColor(a,-20);p.render.fillStyle=p.render.fillStyle||a;p.render.strokeStyle=p.render.strokeStyle||b;p.render.sprite.xOffset+=-(p.bounds.min.x-p.position.x)/(p.bounds.max.x-p.bounds.min.x);p.render.sprite.yOffset+=-(p.bounds.min.y-p.position.y)/(p.bounds.max.y-p.bounds.min.y);return p};c.nextGroup=function(a){return a?c._nextNonCollidingGroupId--:c._nextCollidingGroupId++};
c.nextCategory=function(){c._nextCategory<<=1;return c._nextCategory};c.set=function(a,p,b){var g;"string"===typeof p&&(g=p,p={},p[g]=b);for(g in p)if(b=p[g],p.hasOwnProperty(g))switch(g){case "isStatic":c.setStatic(a,b);break;case "isSleeping":k.set(a,b);break;case "mass":c.setMass(a,b);break;case "density":c.setDensity(a,b);break;case "inertia":c.setInertia(a,b);break;case "vertices":c.setVertices(a,b);break;case "position":c.setPosition(a,b);break;case "angle":c.setAngle(a,b);break;case "velocity":c.setVelocity(a,
b);break;case "angularVelocity":c.setAngularVelocity(a,b);break;case "parts":c.setParts(a,b);break;default:a[g]=b}};c.setStatic=function(a,c){for(var b=0;b<a.parts.length;b++){var g=a.parts[b];if(g.isStatic=c)g.restitution=0,g.friction=1,g.mass=g.inertia=g.density=Infinity,g.inverseMass=g.inverseInertia=0,g.positionPrev.x=g.position.x,g.positionPrev.y=g.position.y,g.anglePrev=g.angle,g.angularVelocity=0,g.speed=0,g.angularSpeed=0,g.motion=0}};c.setMass=function(a,c){a.mass=c;a.inverseMass=1/a.mass;
a.density=a.mass/a.area};c.setDensity=function(a,b){c.setMass(a,b*a.area);a.density=b};c.setInertia=function(a,c){a.inertia=c;a.inverseInertia=1/a.inertia};c.setVertices=function(a,b){a.vertices=b[0].body===a?b:f.create(b,a);a.axes=m.fromVertices(a.vertices);a.area=f.area(a.vertices);c.setMass(a,a.density*a.area);var g=f.centre(a.vertices);f.translate(a.vertices,g,-1);c.setInertia(a,c._inertiaScale*f.inertia(a.vertices,a.mass));f.translate(a.vertices,a.position);r.update(a.bounds,a.vertices,a.velocity)};
c.setParts=function(b,p,g){var m;p=p.slice(0);b.parts.length=0;b.parts.push(b);b.parent=b;for(m=0;m<p.length;m++){var k=p[m];k!==b&&(k.parent=b,b.parts.push(k))}if(1!==b.parts.length){if("undefined"!==typeof g?g:1){g=[];for(m=0;m<p.length;m++)g=g.concat(p[m].vertices);f.clockwiseSort(g);p=f.hull(g);m=f.centre(p);c.setVertices(b,p);f.translate(b.vertices,m)}p=a(b);b.area=p.area;b.parent=b;b.position.x=p.centre.x;b.position.y=p.centre.y;b.positionPrev.x=p.centre.x;b.positionPrev.y=p.centre.y;c.setMass(b,
p.mass);c.setInertia(b,p.inertia);c.setPosition(b,p.centre)}};c.setPosition=function(a,c){var b=h.sub(c,a.position);a.positionPrev.x+=b.x;a.positionPrev.y+=b.y;for(var g=0;g<a.parts.length;g++){var m=a.parts[g];m.position.x+=b.x;m.position.y+=b.y;f.translate(m.vertices,b);r.update(m.bounds,m.vertices,a.velocity)}};c.setAngle=function(a,c){var b=c-a.angle;a.anglePrev+=b;for(var g=0;g<a.parts.length;g++){var k=a.parts[g];k.angle+=b;f.rotate(k.vertices,b,a.position);m.rotate(k.axes,b);r.update(k.bounds,
k.vertices,a.velocity);0<g&&h.rotateAbout(k.position,b,a.position,k.position)}};c.setVelocity=function(a,c){a.positionPrev.x=a.position.x-c.x;a.positionPrev.y=a.position.y-c.y;a.velocity.x=c.x;a.velocity.y=c.y;a.speed=h.magnitude(a.velocity)};c.setAngularVelocity=function(a,c){a.anglePrev=a.angle-c;a.angularVelocity=c;a.angularSpeed=Math.abs(a.angularVelocity)};c.translate=function(a,b){c.setPosition(a,h.add(a.position,b))};c.rotate=function(a,b){c.setAngle(a,a.angle+b)};c.scale=function(b,g,q,k){for(k=
0;k<b.parts.length;k++){var h=b.parts[k];f.scale(h.vertices,g,q,b.position);h.axes=m.fromVertices(h.vertices);b.isStatic||(h.area=f.area(h.vertices),c.setMass(h,b.density*h.area),f.translate(h.vertices,{x:-h.position.x,y:-h.position.y}),c.setInertia(h,f.inertia(h.vertices,h.mass)),f.translate(h.vertices,{x:h.position.x,y:h.position.y}));r.update(h.bounds,h.vertices,b.velocity)}b.isStatic||(g=a(b),b.area=g.area,c.setMass(b,g.mass),c.setInertia(b,g.inertia))};c.update=function(a,c,b,g){c=Math.pow(c*
b*a.timeScale,2);b=1-a.frictionAir*b*a.timeScale;var k=a.position.y-a.positionPrev.y;a.velocity.x=(a.position.x-a.positionPrev.x)*b*g+a.force.x/a.mass*c;a.velocity.y=k*b*g+a.force.y/a.mass*c;a.positionPrev.x=a.position.x;a.positionPrev.y=a.position.y;a.position.x+=a.velocity.x;a.position.y+=a.velocity.y;a.angularVelocity=(a.angle-a.anglePrev)*b*g+a.torque/a.inertia*c;a.anglePrev=a.angle;a.angle+=a.angularVelocity;a.speed=h.magnitude(a.velocity);a.angularSpeed=Math.abs(a.angularVelocity);for(g=0;g<
a.parts.length;g++)c=a.parts[g],f.translate(c.vertices,a.velocity),0<g&&(c.position.x+=a.velocity.x,c.position.y+=a.velocity.y),0!==a.angularVelocity&&(f.rotate(c.vertices,a.angularVelocity,a.position),m.rotate(c.axes,a.angularVelocity),0<g&&h.rotateAbout(c.position,a.angularVelocity,a.position,c.position)),r.update(c.bounds,c.vertices,a.velocity)};c.applyForce=function(a,c,b){a.force.x+=b.x;a.force.y+=b.y;a.torque+=(c.x-a.position.x)*b.y-(c.y-a.position.y)*b.x};var a=function(a){for(var c={mass:0,
area:0,inertia:0,centre:{x:0,y:0}},b=1===a.parts.length?0:1;b<a.parts.length;b++){var g=a.parts[b];c.mass+=g.mass;c.area+=g.area;c.inertia+=g.inertia;c.centre=h.add(c.centre,h.mult(g.position,Infinity!==g.mass?g.mass:1))}c.centre=h.div(c.centre,Infinity!==c.mass?c.mass:a.parts.length);return c}})()},{"../core/Common":14,"../core/Sleeping":20,"../geometry/Axes":23,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27,"../render/Render":29}],2:[function(a,b,e){var c={};b.exports=
c;var f=a("../core/Events"),h=a("../core/Common"),k=a("./Body");(function(){c.create=function(a){return h.extend({id:h.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite"},a)};c.setModified=function(a,b,m,f){a.isModified=b;m&&a.parent&&c.setModified(a.parent,b,m,f);if(f)for(var k=0;k<a.composites.length;k++)c.setModified(a.composites[k],b,m,f)};c.add=function(a,b){var m=[].concat(b);f.trigger(a,"beforeAdd",{object:b});for(var k=0;k<m.length;k++){var u=
m[k];switch(u.type){case "body":if(u.parent!==u){h.log("Composite.add: skipped adding a compound body part (you must add its parent instead)","warn");break}c.addBody(a,u);break;case "constraint":c.addConstraint(a,u);break;case "composite":c.addComposite(a,u);break;case "mouseConstraint":c.addConstraint(a,u.constraint)}}f.trigger(a,"afterAdd",{object:b});return a};c.remove=function(a,b,m){var k=[].concat(b);f.trigger(a,"beforeRemove",{object:b});for(var h=0;h<k.length;h++){var p=k[h];switch(p.type){case "body":c.removeBody(a,
p,m);break;case "constraint":c.removeConstraint(a,p,m);break;case "composite":c.removeComposite(a,p,m);break;case "mouseConstraint":c.removeConstraint(a,p.constraint)}}f.trigger(a,"afterRemove",{object:b});return a};c.addComposite=function(a,b){a.composites.push(b);b.parent=a;c.setModified(a,!0,!0,!1);return a};c.removeComposite=function(a,b,m){var f=h.indexOf(a.composites,b);-1!==f&&(c.removeCompositeAt(a,f),c.setModified(a,!0,!0,!1));if(m)for(m=0;m<a.composites.length;m++)c.removeComposite(a.composites[m],
b,!0);return a};c.removeCompositeAt=function(a,b){a.composites.splice(b,1);c.setModified(a,!0,!0,!1);return a};c.addBody=function(a,b){a.bodies.push(b);c.setModified(a,!0,!0,!1);return a};c.removeBody=function(a,b,m){var f=h.indexOf(a.bodies,b);-1!==f&&(c.removeBodyAt(a,f),c.setModified(a,!0,!0,!1));if(m)for(m=0;m<a.composites.length;m++)c.removeBody(a.composites[m],b,!0);return a};c.removeBodyAt=function(a,b){a.bodies.splice(b,1);c.setModified(a,!0,!0,!1);return a};c.addConstraint=function(a,b){a.constraints.push(b);
c.setModified(a,!0,!0,!1);return a};c.removeConstraint=function(a,b,m){var f=h.indexOf(a.constraints,b);-1!==f&&c.removeConstraintAt(a,f);if(m)for(m=0;m<a.composites.length;m++)c.removeConstraint(a.composites[m],b,!0);return a};c.removeConstraintAt=function(a,b){a.constraints.splice(b,1);c.setModified(a,!0,!0,!1);return a};c.clear=function(a,b,m){if(m)for(m=0;m<a.composites.length;m++)c.clear(a.composites[m],b,!0);b?a.bodies=a.bodies.filter(function(a){return a.isStatic}):a.bodies.length=0;a.constraints.length=
0;a.composites.length=0;c.setModified(a,!0,!0,!1);return a};c.allBodies=function(a){for(var b=[].concat(a.bodies),m=0;m<a.composites.length;m++)b=b.concat(c.allBodies(a.composites[m]));return b};c.allConstraints=function(a){for(var b=[].concat(a.constraints),m=0;m<a.composites.length;m++)b=b.concat(c.allConstraints(a.composites[m]));return b};c.allComposites=function(a){for(var b=[].concat(a.composites),m=0;m<a.composites.length;m++)b=b.concat(c.allComposites(a.composites[m]));return b};c.get=function(a,
b,m){var f;switch(m){case "body":f=c.allBodies(a);break;case "constraint":f=c.allConstraints(a);break;case "composite":f=c.allComposites(a).concat(a)}if(!f)return null;a=f.filter(function(a){return a.id.toString()===b.toString()});return 0===a.length?null:a[0]};c.move=function(a,b,m){c.remove(a,b);c.add(m,b);return a};c.rebase=function(a){for(var b=c.allBodies(a).concat(c.allConstraints(a)).concat(c.allComposites(a)),m=0;m<b.length;m++)b[m].id=h.nextId();c.setModified(a,!0,!0,!1);return a};c.translate=
function(a,b,m){m=m?c.allBodies(a):a.bodies;for(var f=0;f<m.length;f++)k.translate(m[f],b);c.setModified(a,!0,!0,!1);return a};c.rotate=function(a,b,m,f){var h=Math.cos(b),p=Math.sin(b);f=f?c.allBodies(a):a.bodies;for(var q=0;q<f.length;q++){var e=f[q],x=e.position.x-m.x,t=e.position.y-m.y;k.setPosition(e,{x:m.x+(x*h-t*p),y:m.y+(x*p+t*h)});k.rotate(e,b)}c.setModified(a,!0,!0,!1);return a};c.scale=function(a,b,f,h,u){u=u?c.allBodies(a):a.bodies;for(var p=0;p<u.length;p++){var q=u[p];k.setPosition(q,
{x:h.x+(q.position.x-h.x)*b,y:h.y+(q.position.y-h.y)*f});k.scale(q,b,f)}c.setModified(a,!0,!0,!1);return a}})()},{"../core/Common":14,"../core/Events":16,"./Body":1}],3:[function(a,b,e){var c={};b.exports=c;var f=a("./Composite");a("../constraint/Constraint");var h=a("../core/Common");(function(){c.create=function(a){var b=f.create();return h.extend(b,{label:"World",gravity:{x:0,y:1,scale:.001},bounds:{min:{x:-Infinity,y:-Infinity},max:{x:Infinity,y:Infinity}}},a)}})()},{"../constraint/Constraint":12,
"../core/Common":14,"./Composite":2}],4:[function(a,b,e){var c={};b.exports=c;(function(){c.create=function(a){return{id:c.id(a),vertex:a,normalImpulse:0,tangentImpulse:0}};c.id=function(a){return a.body.id+"_"+a.index}})()},{}],5:[function(a,b,e){var c={};b.exports=c;var f=a("./SAT"),h=a("./Pair"),k=a("../geometry/Bounds");(function(){c.collisions=function(a,b){for(var m=[],w=b.pairs.table,u=0;u<a.length;u++){var p=a[u][0],q=a[u][1];if((!p.isStatic&&!p.isSleeping||!q.isStatic&&!q.isSleeping)&&c.canCollide(p.collisionFilter,
q.collisionFilter)&&k.overlaps(p.bounds,q.bounds))for(var e=1<p.parts.length?1:0;e<p.parts.length;e++)for(var x=p.parts[e],t=1<q.parts.length?1:0;t<q.parts.length;t++){var l=q.parts[t];if(x===p&&l===q||k.overlaps(x.bounds,l.bounds)){var v=h.id(x,l),v=w[v],l=f.collides(x,l,v&&v.isActive?v.collision:null);l.collided&&m.push(l)}}}return m};c.canCollide=function(a,b){return a.group===b.group&&0!==a.group?0<a.group:0!==(a.mask&b.category)&&0!==(b.mask&a.category)}})()},{"../geometry/Bounds":24,"./Pair":7,
"./SAT":11}],6:[function(a,b,e){var c={};b.exports=c;var f=a("./Pair"),h=a("./Detector"),k=a("../core/Common");(function(){c.create=function(a){return k.extend({controller:c,detector:h.collisions,buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48},a)};c.update=function(b,c,h,u){var p,q,e=h.world,x=b.buckets,t,l;p=!1;for(h=0;h<c.length;h++){var v=c[h];if(!(v.isSleeping&&!u||0>v.bounds.max.x||v.bounds.min.x>e.bounds.width||0>v.bounds.max.y||v.bounds.min.y>e.bounds.height)){var A;A=v.bounds;
A=a(Math.floor(A.min.x/b.bucketWidth),Math.floor(A.max.x/b.bucketWidth),Math.floor(A.min.y/b.bucketHeight),Math.floor(A.max.y/b.bucketHeight));if(!v.region||A.id!==v.region.id||u){if(!v.region||u)v.region=A;var y;p=v.region;y=a(Math.min(A.startCol,p.startCol),Math.max(A.endCol,p.endCol),Math.min(A.startRow,p.startRow),Math.max(A.endRow,p.endRow));for(p=y.startCol;p<=y.endCol;p++)for(q=y.startRow;q<=y.endRow;q++){l=p+","+q;t=x[l];var C=p>=A.startCol&&p<=A.endCol&&q>=A.startRow&&q<=A.endRow,F=p>=v.region.startCol&&
p<=v.region.endCol&&q>=v.region.startRow&&q<=v.region.endRow;if(!C&&F&&F&&t){var E=b,I=t,D=v;I.splice(k.indexOf(I,D),1);for(var B=0;B<I.length;B++){var G=f.id(D,I[B]);(G=E.pairs[G])&&--G[2]}}if(v.region===A||C&&!F||u){t||(t=x[l]=[]);l=b;C=v;for(F=0;F<t.length;F++)E=t[F],C.id===E.id||C.isStatic&&E.isStatic||(I=f.id(C,E),(D=l.pairs[I])?D[2]+=1:l.pairs[I]=[C,E,1]);t.push(C)}}v.region=A;p=!0}}}if(p){h=[];c=k.keys(b.pairs);for(e=0;e<c.length;e++)u=b.pairs[c[e]],0<u[2]?h.push(u):delete b.pairs[c[e]];b.pairsList=
h}};c.clear=function(a){a.buckets={};a.pairs={};a.pairsList=[]};var a=function(a,b,c,f){return{id:a+","+b+","+c+","+f,startCol:a,endCol:b,startRow:c,endRow:f}}})()},{"../core/Common":14,"./Detector":5,"./Pair":7}],7:[function(a,b,e){var c={};b.exports=c;var f=a("./Contact");(function(){c.create=function(a,b){var f=a.bodyA,e=a.bodyB,m=a.parentA,w=a.parentB,f={id:c.id(f,e),bodyA:f,bodyB:e,contacts:{},activeContacts:[],separation:0,isActive:!0,timeCreated:b,timeUpdated:b,inverseMass:m.inverseMass+w.inverseMass,
friction:Math.min(m.friction,w.friction),frictionStatic:Math.max(m.frictionStatic,w.frictionStatic),restitution:Math.max(m.restitution,w.restitution),slop:Math.max(m.slop,w.slop)};c.update(f,a,b);return f};c.update=function(a,b,g){var e=a.contacts,m=b.supports,w=a.activeContacts,u=b.parentA,p=b.parentB;a.collision=b;a.inverseMass=u.inverseMass+p.inverseMass;a.friction=Math.min(u.friction,p.friction);a.frictionStatic=Math.max(u.frictionStatic,p.frictionStatic);a.restitution=Math.max(u.restitution,
p.restitution);a.slop=Math.max(u.slop,p.slop);w.length=0;if(b.collided){for(u=0;u<m.length;u++){var p=m[u],q=f.id(p),z=e[q];z?w.push(z):w.push(e[q]=f.create(p))}a.separation=b.depth;c.setActive(a,!0,g)}else!0===a.isActive&&c.setActive(a,!1,g)};c.setActive=function(a,b,c){b?(a.isActive=!0,a.timeUpdated=c):(a.isActive=!1,a.activeContacts.length=0)};c.id=function(a,b){return a.id<b.id?a.id+"_"+b.id:b.id+"_"+a.id}})()},{"./Contact":4}],8:[function(a,b,e){var c={};b.exports=c;var f=a("./Pair"),h=a("../core/Common");
(function(){c.create=function(a){return h.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},a)};c.update=function(a,b,c){var m=a.list,w=a.table,u=a.collisionStart,p=a.collisionEnd;a=a.collisionActive;var q=[],e,x,t,l;u.length=0;p.length=0;for(l=a.length=0;l<b.length;l++)e=b[l],e.collided&&(x=f.id(e.bodyA,e.bodyB),q.push(x),(t=w[x])?(t.isActive?a.push(t):u.push(t),f.update(t,e,c)):(t=f.create(e,c),w[x]=t,u.push(t),m.push(t)));for(l=0;l<m.length;l++)t=m[l],t.isActive&&-1===
h.indexOf(q,t.id)&&(f.setActive(t,!1,c),p.push(t))};c.removeOld=function(a,b){var c=a.list,f=a.table,h=[],u,p,q;for(q=0;q<c.length;q++)u=c[q],p=u.collision,p.bodyA.isSleeping||p.bodyB.isSleeping?u.timeUpdated=b:1E3<b-u.timeUpdated&&h.push(q);for(q=0;q<h.length;q++)p=h[q]-q,u=c[p],delete f[u.id],c.splice(p,1)};c.clear=function(a){a.table={};a.list.length=0;a.collisionStart.length=0;a.collisionActive.length=0;a.collisionEnd.length=0;return a}})()},{"../core/Common":14,"./Pair":7}],9:[function(a,b,e){var c=
{};b.exports=c;var f=a("../geometry/Vector"),h=a("./SAT"),k=a("../geometry/Bounds"),g=a("../factory/Bodies"),r=a("../geometry/Vertices");(function(){c.ray=function(a,b,c,p){p=p||1E-100;var q=f.angle(b,c),e=f.magnitude(f.sub(b,c));b=g.rectangle(.5*(c.x+b.x),.5*(c.y+b.y),e,p,{angle:q});c=[];for(p=0;p<a.length;p++)if(q=a[p],k.overlaps(q.bounds,b.bounds))for(e=1===q.parts.length?0:1;e<q.parts.length;e++){var r=q.parts[e];if(k.overlaps(r.bounds,b.bounds)&&(r=h.collides(r,b),r.collided)){r.body=r.bodyA=
r.bodyB=q;c.push(r);break}}return c};c.region=function(a,b,c){for(var f=[],q=0;q<a.length;q++){var h=a[q],g=k.overlaps(h.bounds,b);(g&&!c||!g&&c)&&f.push(h)}return f};c.point=function(a,b){for(var c=[],f=0;f<a.length;f++){var q=a[f];if(k.contains(q.bounds,b))for(var h=1===q.parts.length?0:1;h<q.parts.length;h++){var g=q.parts[h];if(k.contains(g.bounds,b)&&r.contains(g.vertices,b)){c.push(q);break}}}return c}})()},{"../factory/Bodies":21,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27,
"./SAT":11}],10:[function(a,b,e){var c={};b.exports=c;var f=a("../geometry/Vertices"),h=a("../geometry/Vector"),k=a("../core/Common"),g=a("../geometry/Bounds");(function(){c._restingThresh=4;c._restingThreshTangent=6;c._positionDampen=.9;c._positionWarming=.8;c._frictionNormalMultiplier=5;c.preSolvePosition=function(a){var b,c,f;for(b=0;b<a.length;b++)c=a[b],c.isActive&&(f=c.activeContacts.length,c.collision.parentA.totalContacts+=f,c.collision.parentB.totalContacts+=f)};c.solvePosition=function(a,
b){var f,k,p,q,g,e,t;t=h._temp[0];var l=h._temp[1],v=h._temp[2],A=h._temp[3];for(f=0;f<a.length;f++)k=a[f],k.isActive&&(p=k.collision,q=p.parentA,g=p.parentB,e=p.normal,q=h.sub(h.add(g.positionImpulse,g.position,t),h.add(q.positionImpulse,h.sub(g.position,p.penetration,l),v),A),k.separation=h.dot(e,q));for(f=0;f<a.length;f++)if(k=a[f],k.isActive&&!(0>k.separation)){p=k.collision;q=p.parentA;g=p.parentB;e=p.normal;t=(k.separation-k.slop)*b;if(q.isStatic||g.isStatic)t*=2;q.isStatic||q.isSleeping||(k=
c._positionDampen/q.totalContacts,q.positionImpulse.x+=e.x*t*k,q.positionImpulse.y+=e.y*t*k);g.isStatic||g.isSleeping||(k=c._positionDampen/g.totalContacts,g.positionImpulse.x-=e.x*t*k,g.positionImpulse.y-=e.y*t*k)}};c.postSolvePosition=function(a){for(var b=0;b<a.length;b++){var k=a[b];k.totalContacts=0;if(0!==k.positionImpulse.x||0!==k.positionImpulse.y){for(var u=0;u<k.parts.length;u++){var p=k.parts[u];f.translate(p.vertices,k.positionImpulse);g.update(p.bounds,p.vertices,k.velocity);p.position.x+=
k.positionImpulse.x;p.position.y+=k.positionImpulse.y}k.positionPrev.x+=k.positionImpulse.x;k.positionPrev.y+=k.positionImpulse.y;0>h.dot(k.positionImpulse,k.velocity)?(k.positionImpulse.x=0,k.positionImpulse.y=0):(k.positionImpulse.x*=c._positionWarming,k.positionImpulse.y*=c._positionWarming)}}};c.preSolveVelocity=function(a){var b,c,f,p,q,k,g,e,l,v,A=h._temp[0],y=h._temp[1];for(b=0;b<a.length;b++)if(f=a[b],f.isActive)for(p=f.activeContacts,c=f.collision,f=c.parentA,q=c.parentB,k=c.normal,g=c.tangent,
c=0;c<p.length;c++)if(e=p[c],l=e.vertex,v=e.normalImpulse,e=e.tangentImpulse,0!==v||0!==e)A.x=k.x*v+g.x*e,A.y=k.y*v+g.y*e,f.isStatic||f.isSleeping||(v=h.sub(l,f.position,y),f.positionPrev.x+=A.x*f.inverseMass,f.positionPrev.y+=A.y*f.inverseMass,f.anglePrev+=h.cross(v,A)*f.inverseInertia),q.isStatic||q.isSleeping||(v=h.sub(l,q.position,y),q.positionPrev.x-=A.x*q.inverseMass,q.positionPrev.y-=A.y*q.inverseMass,q.anglePrev-=h.cross(v,A)*q.inverseInertia)};c.solveVelocity=function(a,b){for(var f=b*b,
g=h._temp[0],p=h._temp[1],q=h._temp[2],e=h._temp[3],x=h._temp[4],t=h._temp[5],l=0;l<a.length;l++){var v=a[l];if(v.isActive){var A=v.collision,y=A.parentA,C=A.parentB,F=A.normal,A=A.tangent,E=v.activeContacts,I=1/E.length;y.velocity.x=y.position.x-y.positionPrev.x;y.velocity.y=y.position.y-y.positionPrev.y;C.velocity.x=C.position.x-C.positionPrev.x;C.velocity.y=C.position.y-C.positionPrev.y;y.angularVelocity=y.angle-y.anglePrev;C.angularVelocity=C.angle-C.anglePrev;for(var D=0;D<E.length;D++){var B=
E[D],G=B.vertex,J=h.sub(G,y.position,p),G=h.sub(G,C.position,q),H=h.add(y.velocity,h.mult(h.perp(J),y.angularVelocity),e),K=h.add(C.velocity,h.mult(h.perp(G),C.angularVelocity),x),H=h.sub(H,K,t),M=h.dot(F,H),O=h.dot(A,H),N=Math.abs(O),L=k.sign(O),H=(1+v.restitution)*M,Q=k.clamp(v.separation+M,0,1)*c._frictionNormalMultiplier,K=O,P=Infinity;N>v.friction*v.frictionStatic*Q*f&&(P=N,K=k.clamp(v.friction*L*f,-P,P));N=h.cross(J,F);L=h.cross(G,F);N=I/(y.inverseMass+C.inverseMass+y.inverseInertia*N*N+C.inverseInertia*
L*L);H*=N;K*=N;0>M&&M*M>c._restingThresh*f?B.normalImpulse=0:(M=B.normalImpulse,B.normalImpulse=Math.min(B.normalImpulse+H,0),H=B.normalImpulse-M);O*O>c._restingThreshTangent*f?B.tangentImpulse=0:(M=B.tangentImpulse,B.tangentImpulse=k.clamp(B.tangentImpulse+K,-P,P),K=B.tangentImpulse-M);g.x=F.x*H+A.x*K;g.y=F.y*H+A.y*K;y.isStatic||y.isSleeping||(y.positionPrev.x+=g.x*y.inverseMass,y.positionPrev.y+=g.y*y.inverseMass,y.anglePrev+=h.cross(J,g)*y.inverseInertia);C.isStatic||C.isSleeping||(C.positionPrev.x-=
g.x*C.inverseMass,C.positionPrev.y-=g.y*C.inverseMass,C.anglePrev-=h.cross(G,g)*C.inverseInertia)}}}}})()},{"../core/Common":14,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27}],11:[function(a,b,e){var c={};b.exports=c;var f=a("../geometry/Vertices"),h=a("../geometry/Vector");(function(){c.collides=function(b,c,g){var p,q;p=!1;g?(q=b.parent,p=c.parent,q=q.speed*q.speed+q.angularSpeed*q.angularSpeed+p.speed*p.speed+p.angularSpeed*p.angularSpeed,p=g&&g.collided&&.2>q,q=g):
q={collided:!1,bodyA:b,bodyB:c};if(g&&p){if(p=q.axisBody,g=a(p.vertices,(p===b?c:b).vertices,[p.axes[g.axisNumber]]),q.reused=!0,0>=g.overlap)return q.collided=!1,q}else{g=a(b.vertices,c.vertices,b.axes);if(0>=g.overlap)return q.collided=!1,q;p=a(c.vertices,b.vertices,c.axes);if(0>=p.overlap)return q.collided=!1,q;g.overlap<p.overlap?q.axisBody=b:(g=p,q.axisBody=c);q.axisNumber=g.axisNumber}q.bodyA=b.id<c.id?b:c;q.bodyB=b.id<c.id?c:b;q.collided=!0;q.normal=g.axis;q.depth=g.overlap;q.parentA=q.bodyA.parent;
q.parentB=q.bodyB.parent;b=q.bodyA;c=q.bodyB;0<h.dot(q.normal,h.sub(c.position,b.position))&&(q.normal=h.neg(q.normal));q.tangent=h.perp(q.normal);q.penetration={x:q.normal.x*q.depth,y:q.normal.y*q.depth};g=e(b,c,q.normal);p=q.supports||[];p.length=0;f.contains(b.vertices,g[0])&&p.push(g[0]);f.contains(b.vertices,g[1])&&p.push(g[1]);2>p.length&&(b=e(c,b,h.neg(q.normal)),f.contains(c.vertices,b[0])&&p.push(b[0]),2>p.length&&f.contains(c.vertices,b[1])&&p.push(b[1]));1>p.length&&(p=[g[0]]);q.supports=
p;return q};var a=function(a,c,f){for(var p=h._temp[0],q=h._temp[1],k={overlap:Number.MAX_VALUE},e,r,l=0;l<f.length;l++){r=f[l];b(p,a,r);b(q,c,r);e=Math.min(p.max-q.min,q.max-p.min);if(0>=e){k.overlap=e;break}e<k.overlap&&(k.overlap=e,k.axis=r,k.axisNumber=l)}return k},b=function(a,b,c){for(var f=h.dot(b[0],c),q=f,k=1;k<b.length;k+=1){var g=h.dot(b[k],c);g>q?q=g:g<f&&(f=g)}a.min=f;a.max=q},e=function(a,b,c){var f=Number.MAX_VALUE,q=h._temp[0];b=b.vertices;a=a.position;var k,g,e,l;for(l=0;l<b.length;l++)g=
b[l],q.x=g.x-a.x,q.y=g.y-a.y,k=-h.dot(c,q),k<f&&(f=k,e=g);g=b[0<=e.index-1?e.index-1:b.length-1];q.x=g.x-a.x;q.y=g.y-a.y;f=-h.dot(c,q);l=g;g=b[(e.index+1)%b.length];q.x=g.x-a.x;q.y=g.y-a.y;k=-h.dot(c,q);k<f&&(l=g);return[e,l]}})()},{"../geometry/Vector":26,"../geometry/Vertices":27}],12:[function(a,b,e){var c={};b.exports=c;var f=a("../geometry/Vertices"),h=a("../geometry/Vector"),k=a("../core/Sleeping"),g=a("../geometry/Bounds"),r=a("../geometry/Axes"),m=a("../core/Common");(function(){c.create=
function(a){a.bodyA&&!a.pointA&&(a.pointA={x:0,y:0});a.bodyB&&!a.pointB&&(a.pointB={x:0,y:0});var b=a.bodyA?h.add(a.bodyA.position,a.pointA):a.pointA,c=a.bodyB?h.add(a.bodyB.position,a.pointB):a.pointB,b=h.magnitude(h.sub(b,c));a.length=a.length||b||1E-6;a.render=m.extend({visible:!0,lineWidth:2,strokeStyle:"#666"},a.render);a.id=a.id||m.nextId();a.label=a.label||"Constraint";a.type="constraint";a.stiffness=a.stiffness||1;a.angularStiffness=a.angularStiffness||0;a.angleA=a.bodyA?a.bodyA.angle:a.angleA;
a.angleB=a.bodyB?a.bodyB.angle:a.angleB;return a};c.solveAll=function(a,b){for(var f=0;f<a.length;f++)c.solve(a[f],b)};c.solve=function(a,b){var c=a.bodyA,f=a.bodyB,k=a.pointA,g=a.pointB;c&&!c.isStatic&&(a.pointA=h.rotate(k,c.angle-a.angleA),a.angleA=c.angle);f&&!f.isStatic&&(a.pointB=h.rotate(g,f.angle-a.angleB),a.angleB=f.angle);var m=k,l=g;c&&(m=h.add(c.position,k));f&&(l=h.add(f.position,g));if(m&&l){var g=h.sub(m,l),e=h.magnitude(g);0===e&&(e=1E-6);var r=(e-a.length)/e,k=h.div(g,e),g=h.mult(g,
.5*r*a.stiffness*b*b);if(!(Math.abs(1-e/a.length)<.001*b)){var y,C;c&&!c.isStatic?(y={x:m.x-c.position.x+g.x,y:m.y-c.position.y+g.y},c.velocity.x=c.position.x-c.positionPrev.x,c.velocity.y=c.position.y-c.positionPrev.y,c.angularVelocity=c.angle-c.anglePrev,m=h.add(c.velocity,h.mult(h.perp(y),c.angularVelocity)),e=h.dot(y,k),e=c.inverseMass+c.inverseInertia*e*e):(m={x:0,y:0},e=c?c.inverseMass:0);f&&!f.isStatic?(C={x:l.x-f.position.x-g.x,y:l.y-f.position.y-g.y},f.velocity.x=f.position.x-f.positionPrev.x,
f.velocity.y=f.position.y-f.positionPrev.y,f.angularVelocity=f.angle-f.anglePrev,l=h.add(f.velocity,h.mult(h.perp(C),f.angularVelocity)),r=h.dot(C,k),r=f.inverseMass+f.inverseInertia*r*r):(l={x:0,y:0},r=f?f.inverseMass:0);l=h.sub(l,m);l=h.dot(k,l)/(e+r);0<l&&(l=0);k={x:k.x*l,y:k.y*l};c&&!c.isStatic&&(y=h.cross(y,k)*c.inverseInertia*(1-a.angularStiffness),c.constraintImpulse.x-=g.x,c.constraintImpulse.y-=g.y,c.constraintImpulse.angle+=y,c.position.x-=g.x,c.position.y-=g.y,c.angle+=y);f&&!f.isStatic&&
(y=h.cross(C,k)*f.inverseInertia*(1-a.angularStiffness),f.constraintImpulse.x+=g.x,f.constraintImpulse.y+=g.y,f.constraintImpulse.angle-=y,f.position.x+=g.x,f.position.y+=g.y,f.angle-=y)}}};c.postSolveAll=function(a){for(var b=0;b<a.length;b++){var c=a[b],m=c.constraintImpulse;if(0!==m.x||0!==m.y||0!==m.angle){k.set(c,!1);for(var e=0;e<c.parts.length;e++){var x=c.parts[e];f.translate(x.vertices,m);0<e&&(x.position.x+=m.x,x.position.y+=m.y);0!==m.angle&&(f.rotate(x.vertices,m.angle,c.position),r.rotate(x.axes,
m.angle),0<e&&h.rotateAbout(x.position,m.angle,c.position,x.position));g.update(x.bounds,x.vertices,c.velocity)}m.angle=0;m.x=0;m.y=0}}}})()},{"../core/Common":14,"../core/Sleeping":20,"../geometry/Axes":23,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27}],13:[function(a,b,e){var c={};b.exports=c;var f=a("../geometry/Vertices"),h=a("../core/Sleeping"),k=a("../core/Mouse"),g=a("../core/Events"),r=a("../collision/Detector"),m=a("./Constraint"),w=a("../body/Composite"),u=a("../core/Common"),
p=a("../geometry/Bounds");(function(){c.create=function(a,b){var f=(a?a.mouse:null)||(b?b.mouse:null);f||(a&&a.render&&a.render.canvas?f=k.create(a.render.canvas):(f=k.create(),u.log("MouseConstraint.create: options.mouse was undefined, engine.render.canvas was undefined, may not function as expected","warn")));var h=m.create({label:"Mouse Constraint",pointA:f.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),p=u.extend({type:"mouseConstraint",
mouse:f,body:null,constraint:h,collisionFilter:{category:1,mask:4294967295,group:0}},b);g.on(a,"tick",function(){var b=w.allBodies(a.world);c.update(p,b);var b=p.mouse,f=b.sourceEvents;f.mousemove&&g.trigger(p,"mousemove",{mouse:b});f.mousedown&&g.trigger(p,"mousedown",{mouse:b});f.mouseup&&g.trigger(p,"mouseup",{mouse:b});k.clearSourceEvents(b)});return p};c.update=function(a,b){var c=a.mouse,k=a.constraint,m=a.body;if(0===c.button)if(k.bodyB)h.set(k.bodyB,!1),k.pointA=c.position;else for(var e=
0;e<b.length;e++){if(m=b[e],p.contains(m.bounds,c.position)&&r.canCollide(m.collisionFilter,a.collisionFilter))for(var u=1<m.parts.length?1:0;u<m.parts.length;u++)if(f.contains(m.parts[u].vertices,c.position)){k.pointA=c.position;k.bodyB=a.body=m;k.pointB={x:c.position.x-m.position.x,y:c.position.y-m.position.y};k.angleB=m.angle;h.set(m,!1);g.trigger(a,"startdrag",{mouse:c,body:m});break}}else k.bodyB=a.body=null,k.pointB=null,m&&g.trigger(a,"enddrag",{mouse:c,body:m})}})()},{"../body/Composite":2,
"../collision/Detector":5,"../core/Common":14,"../core/Events":16,"../core/Mouse":18,"../core/Sleeping":20,"../geometry/Bounds":24,"../geometry/Vertices":27,"./Constraint":12}],14:[function(a,b,e){var c={};b.exports=c;(function(){c._nextId=0;c._seed=0;c.extend=function(a,b){var k,g;"boolean"===typeof b?(k=2,g=b):(k=1,g=!0);k=Array.prototype.slice.call(arguments,k);for(var e=0;e<k.length;e++){var m=k[e];if(m)for(var w in m)g&&m[w]&&m[w].constructor===Object?a[w]&&a[w].constructor!==Object?a[w]=m[w]:
(a[w]=a[w]||{},c.extend(a[w],g,m[w])):a[w]=m[w]}return a};c.clone=function(a,b){return c.extend({},b,a)};c.keys=function(a){if(Object.keys)return Object.keys(a);var b=[],c;for(c in a)b.push(c);return b};c.values=function(a){var b=[];if(Object.keys){for(var c=Object.keys(a),g=0;g<c.length;g++)b.push(a[c[g]]);return b}for(c in a)b.push(a[c]);return b};c.shadeColor=function(a,b){var c=parseInt(a.slice(1),16),g=Math.round(2.55*b),e=(c>>16)+g,m=(c>>8&255)+g,c=(c&255)+g;return"#"+(16777216+65536*(255>e?
1>e?0:e:255)+256*(255>m?1>m?0:m:255)+(255>c?1>c?0:c:255)).toString(16).slice(1)};c.shuffle=function(a){for(var b=a.length-1;0<b;b--){var k=Math.floor(c.random()*(b+1)),g=a[b];a[b]=a[k];a[k]=g}return a};c.choose=function(a){return a[Math.floor(c.random()*a.length)]};c.isElement=function(a){try{return a instanceof HTMLElement}catch(b){return"object"===typeof a&&1===a.nodeType&&"object"===typeof a.style&&"object"===typeof a.ownerDocument}};c.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)};
c.clamp=function(a,b,c){return a<b?b:a>c?c:a};c.sign=function(a){return 0>a?-1:1};c.now=function(){var a=window.performance||{};a.now=function(){return a.now||a.webkitNow||a.msNow||a.oNow||a.mozNow||function(){return+new Date}}();return a.now()};c.random=function(a,b){a="undefined"!==typeof a?a:0;c._seed=(9301*c._seed+49297)%233280;return a+c._seed/233280*(("undefined"!==typeof b?b:1)-a)};c.colorToNumber=function(a){a=a.replace("#","");3==a.length&&(a=a.charAt(0)+a.charAt(0)+a.charAt(1)+a.charAt(1)+
a.charAt(2)+a.charAt(2));return parseInt(a,16)};c.log=function(a,b){if(console&&console.log&&console.warn)switch(b){case "warn":console.warn("Matter.js:",a);break;case "error":console.log("Matter.js:",a)}};c.nextId=function(){return c._nextId++};c.indexOf=function(a,b){if(a.indexOf)return a.indexOf(b);for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1}})()},{}],15:[function(a,b,e){var c={};b.exports=c;var f=a("../body/World"),h=a("./Sleeping"),k=a("../collision/Resolver"),g=a("../render/Render"),
r=a("../collision/Pairs");a("./Metrics");var m=a("../collision/Grid"),w=a("./Events"),u=a("../body/Composite"),p=a("../constraint/Constraint"),q=a("./Common"),z=a("../body/Body");(function(){c.create=function(a,b){b=q.isElement(a)?b:a;a=q.isElement(a)?a:null;var c=q.extend({positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],timing:{timestamp:0,timeScale:1},broadphase:{controller:m}},b);if(a||c.render)c.render=q.extend({element:a,controller:g},c.render);c.render&&
c.render.controller&&(c.render=c.render.controller.create(c.render));c.world=f.create(c.world);c.pairs=r.create();c.broadphase=c.broadphase.controller.create(c.broadphase);c.metrics=c.metrics||{extended:!1};return c};c.update=function(a,b,c){b=b||1E3/60;c=c||1;var f=a.world,g=a.timing,m=a.broadphase,e=[];g.timestamp+=b*g.timeScale;var q={timestamp:g.timestamp};w.trigger(a,"beforeUpdate",q);var E=u.allBodies(f),e=u.allConstraints(f);a.enableSleeping&&h.update(E,g.timeScale);var I=f.gravity,D="undefined"!==
typeof I.scale?I.scale:.001;if((0!==I.x||0!==I.y)&&0!==D)for(var B=0;B<E.length;B++){var G=E[B];if(!G.isStatic&&!G.isSleeping){if(!0===I.isPoint)var J=G.position,H=I.x-J.x,I=I.y-J.y,J=Math.sqrt(H*H+I*I),I={x:H/J,y:I/J};G.force.y+=G.mass*I.y*D;G.force.x+=G.mass*I.x*D}}D=g.timeScale;for(B=0;B<E.length;B++)G=E[B],G.isStatic||G.isSleeping||z.update(G,b,D,c);for(c=0;c<a.constraintIterations;c++)p.solveAll(e,g.timeScale);p.postSolveAll(E);m.controller?(f.isModified&&m.controller.clear(m),m.controller.update(m,
E,a,f.isModified),e=m.pairsList):e=E;e=m.detector(e,a);m=a.pairs;c=g.timestamp;r.update(m,e,c);r.removeOld(m,c);a.enableSleeping&&h.afterCollisions(m.list,g.timeScale);0<m.collisionStart.length&&w.trigger(a,"collisionStart",{pairs:m.collisionStart});k.preSolvePosition(m.list);for(c=0;c<a.positionIterations;c++)k.solvePosition(m.list,g.timeScale);k.postSolvePosition(E);k.preSolveVelocity(m.list);for(c=0;c<a.velocityIterations;c++)k.solveVelocity(m.list,g.timeScale);0<m.collisionActive.length&&w.trigger(a,
"collisionActive",{pairs:m.collisionActive});0<m.collisionEnd.length&&w.trigger(a,"collisionEnd",{pairs:m.collisionEnd});for(g=0;g<E.length;g++)m=E[g],m.force.x=0,m.force.y=0,m.torque=0;f.isModified&&u.setModified(f,!1,!1,!0);w.trigger(a,"afterUpdate",q);return a};c.merge=function(a,b){q.extend(a,b);if(b.world){a.world=b.world;c.clear(a);for(var f=u.allBodies(a.world),g=0;g<f.length;g++){var m=f[g];h.set(m,!1);m.id=q.nextId()}}};c.clear=function(a){var b=a.world;r.clear(a.pairs);var c=a.broadphase;
c.controller&&(b=u.allBodies(b),c.controller.clear(c),c.controller.update(c,b,a,!0))}})()},{"../body/Body":1,"../body/Composite":2,"../body/World":3,"../collision/Grid":6,"../collision/Pairs":8,"../collision/Resolver":10,"../constraint/Constraint":12,"../render/Render":29,"./Common":14,"./Events":16,"./Metrics":17,"./Sleeping":20}],16:[function(a,b,e){var c={};b.exports=c;var f=a("./Common");(function(){c.on=function(a,c,b){c=c.split(" ");for(var f,m=0;m<c.length;m++)f=c[m],a.events=a.events||{},
a.events[f]=a.events[f]||[],a.events[f].push(b);return b};c.off=function(a,c,b){if(c){"function"===typeof c&&(b=c,c=f.keys(a.events).join(" "));c=c.split(" ");for(var e=0;e<c.length;e++){var m=a.events[c[e]],w=[];if(b&&m)for(var u=0;u<m.length;u++)m[u]!==b&&w.push(m[u]);a.events[c[e]]=w}}else a.events={}};c.trigger=function(a,c,b){var e,m,w;if(a.events){b||(b={});c=c.split(" ");for(var u=0;u<c.length;u++)if(e=c[u],m=a.events[e])for(w=f.clone(b,!1),w.name=e,w.source=a,e=0;e<m.length;e++)m[e].apply(a,
[w])}}})()},{"./Common":14}],17:[function(a,b,e){},{"../body/Composite":2,"./Common":14}],18:[function(a,b,e){var c={};b.exports=c;var f=a("../core/Common");(function(){c.create=function(b){var g={};b||f.log("Mouse.create: element was undefined, defaulting to document.body","warn");g.element=b||document.body;g.absolute={x:0,y:0};g.position={x:0,y:0};g.mousedownPosition={x:0,y:0};g.mouseupPosition={x:0,y:0};g.offset={x:0,y:0};g.scale={x:1,y:1};g.wheelDelta=0;g.button=-1;g.pixelRatio=g.element.getAttribute("data-pixel-ratio")||
1;g.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null};g.mousemove=function(c){var b=a(c,g.element,g.pixelRatio);c.changedTouches&&(g.button=0,c.preventDefault());g.absolute.x=b.x;g.absolute.y=b.y;g.position.x=g.absolute.x*g.scale.x+g.offset.x;g.position.y=g.absolute.y*g.scale.y+g.offset.y;g.sourceEvents.mousemove=c};g.mousedown=function(c){var b=a(c,g.element,g.pixelRatio);c.changedTouches?(g.button=0,c.preventDefault()):g.button=c.button;g.absolute.x=b.x;g.absolute.y=b.y;
g.position.x=g.absolute.x*g.scale.x+g.offset.x;g.position.y=g.absolute.y*g.scale.y+g.offset.y;g.mousedownPosition.x=g.position.x;g.mousedownPosition.y=g.position.y;g.sourceEvents.mousedown=c};g.mouseup=function(c){var b=a(c,g.element,g.pixelRatio);c.changedTouches&&c.preventDefault();g.button=-1;g.absolute.x=b.x;g.absolute.y=b.y;g.position.x=g.absolute.x*g.scale.x+g.offset.x;g.position.y=g.absolute.y*g.scale.y+g.offset.y;g.mouseupPosition.x=g.position.x;g.mouseupPosition.y=g.position.y;g.sourceEvents.mouseup=
c};g.mousewheel=function(a){g.wheelDelta=Math.max(-1,Math.min(1,a.wheelDelta||-a.detail));a.preventDefault()};c.setElement(g,g.element);return g};c.setElement=function(a,c){a.element=c;c.addEventListener("mousemove",a.mousemove);c.addEventListener("mousedown",a.mousedown);c.addEventListener("mouseup",a.mouseup);c.addEventListener("mousewheel",a.mousewheel);c.addEventListener("DOMMouseScroll",a.mousewheel);c.addEventListener("touchmove",a.mousemove);c.addEventListener("touchstart",a.mousedown);c.addEventListener("touchend",
a.mouseup)};c.clearSourceEvents=function(a){a.sourceEvents.mousemove=null;a.sourceEvents.mousedown=null;a.sourceEvents.mouseup=null;a.sourceEvents.mousewheel=null;a.wheelDelta=0};c.setOffset=function(a,c){a.offset.x=c.x;a.offset.y=c.y;a.position.x=a.absolute.x*a.scale.x+a.offset.x;a.position.y=a.absolute.y*a.scale.y+a.offset.y};c.setScale=function(a,c){a.scale.x=c.x;a.scale.y=c.y;a.position.x=a.absolute.x*a.scale.x+a.offset.x;a.position.y=a.absolute.y*a.scale.y+a.offset.y};var a=function(a,c,b){var f=
c.getBoundingClientRect(),e=document.documentElement||document.body.parentNode||document.body,h=void 0!==window.pageXOffset?window.pageXOffset:e.scrollLeft,e=void 0!==window.pageYOffset?window.pageYOffset:e.scrollTop,p=a.changedTouches;p?(h=p[0].pageX-f.left-h,a=p[0].pageY-f.top-e):(h=a.pageX-f.left-h,a=a.pageY-f.top-e);return{x:h/(c.clientWidth/c.width*b),y:a/(c.clientHeight/c.height*b)}}})()},{"../core/Common":14}],19:[function(a,b,e){var c={};b.exports=c;var f=a("./Events"),h=a("./Engine"),k=a("./Common");
(function(){var a,b;"undefined"!==typeof window&&(a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(function(){a(k.now())},1E3/60)},b=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame);c.create=function(a){a=k.extend({fps:60,correction:1,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,
timeScalePrev:1,frameRequestId:null,isFixed:!1,enabled:!0},a);a.delta=a.delta||1E3/a.fps;a.deltaMin=a.deltaMin||1E3/a.fps;a.deltaMax=a.deltaMax||1E3/(.5*a.fps);a.fps=1E3/a.delta;return a};c.run=function(b,f){"undefined"!==typeof b.positionIterations&&(f=b,b=c.create());(function p(e){b.frameRequestId=a(p);e&&b.enabled&&c.tick(b,f,e)})();return b};c.tick=function(a,c,b){var g=c.timing,e=1,k,r={timestamp:g.timestamp};f.trigger(a,"beforeTick",r);f.trigger(c,"beforeTick",r);a.isFixed?k=a.delta:(k=b-a.timePrev||
a.delta,a.timePrev=b,a.deltaHistory.push(k),a.deltaHistory=a.deltaHistory.slice(-a.deltaSampleSize),k=Math.min.apply(null,a.deltaHistory),k=k<a.deltaMin?a.deltaMin:k,k=k>a.deltaMax?a.deltaMax:k,e=k/a.delta,a.delta=k);0!==a.timeScalePrev&&(e*=g.timeScale/a.timeScalePrev);0===g.timeScale&&(e=0);a.timeScalePrev=g.timeScale;a.correction=e;a.frameCounter+=1;1E3<=b-a.counterTimestamp&&(a.fps=(b-a.counterTimestamp)/1E3*a.frameCounter,a.counterTimestamp=b,a.frameCounter=0);f.trigger(a,"tick",r);f.trigger(c,
"tick",r);c.world.isModified&&c.render&&c.render.controller&&c.render.controller.clear&&c.render.controller.clear(c.render);f.trigger(a,"beforeUpdate",r);h.update(c,k,e);f.trigger(a,"afterUpdate",r);c.render&&c.render.controller&&(f.trigger(a,"beforeRender",r),f.trigger(c,"beforeRender",r),c.render.controller.world(c),f.trigger(a,"afterRender",r),f.trigger(c,"afterRender",r));f.trigger(a,"afterTick",r);f.trigger(c,"afterTick",r)};c.stop=function(a){b(a.frameRequestId)};c.start=function(a,b){c.run(a,
b)}})()},{"./Common":14,"./Engine":15,"./Events":16}],20:[function(a,b,e){var c={};b.exports=c;var f=a("./Events");(function(){c._motionWakeThreshold=.18;c._motionSleepThreshold=.08;c._minBias=.9;c.update=function(a,b){for(var f=b*b*b,e=0;e<a.length;e++){var m=a[e],w=m.speed*m.speed+m.angularSpeed*m.angularSpeed;0!==m.force.x||0!==m.force.y?c.set(m,!1):(m.motion=c._minBias*Math.min(m.motion,w)+(1-c._minBias)*Math.max(m.motion,w),0<m.sleepThreshold&&m.motion<c._motionSleepThreshold*f?(m.sleepCounter+=
1,m.sleepCounter>=m.sleepThreshold&&c.set(m,!0)):0<m.sleepCounter&&--m.sleepCounter)}};c.afterCollisions=function(a,b){for(var f=b*b*b,e=0;e<a.length;e++){var m=a[e];if(m.isActive){var w=m.collision,m=w.bodyA.parent,u=w.bodyB.parent;m.isSleeping&&u.isSleeping||m.isStatic||u.isStatic||!m.isSleeping&&!u.isSleeping||(w=m.isSleeping&&!m.isStatic?m:u,m=w===m?u:m,!w.isStatic&&m.motion>c._motionWakeThreshold*f&&c.set(w,!1))}}};c.set=function(a,c){var b=a.isSleeping;c?(a.isSleeping=!0,a.sleepCounter=a.sleepThreshold,
a.positionImpulse.x=0,a.positionImpulse.y=0,a.positionPrev.x=a.position.x,a.positionPrev.y=a.position.y,a.anglePrev=a.angle,a.speed=0,a.angularSpeed=0,a.motion=0,b||f.trigger(a,"sleepStart")):(a.isSleeping=!1,a.sleepCounter=0,b&&f.trigger(a,"sleepEnd"))}})()},{"./Events":16}],21:[function(a,b,e){var c={};b.exports=c;var f=a("../geometry/Vertices"),h=a("../core/Common"),k=a("../body/Body"),g=a("../geometry/Bounds"),r=a("../geometry/Vector");(function(){c.rectangle=function(a,c,b,g,e){e=e||{};a={label:"Rectangle Body",
position:{x:a,y:c},vertices:f.fromPath("L 0 0 L "+b+" 0 L "+b+" "+g+" L 0 "+g)};e.chamfer&&(c=e.chamfer,a.vertices=f.chamfer(a.vertices,c.radius,c.quality,c.qualityMin,c.qualityMax),delete e.chamfer);return k.create(h.extend({},a,e))};c.trapezoid=function(a,c,b,g,e,r){r=r||{};e*=.5;var x=b*e;b=x+(1-2*e)*b;var t=b+x;a={label:"Trapezoid Body",position:{x:a,y:c},vertices:f.fromPath(.5>e?"L 0 0 L "+x+" "+-g+" L "+b+" "+-g+" L "+t+" 0":"L 0 0 L "+b+" "+-g+" L "+t+" 0")};r.chamfer&&(c=r.chamfer,a.vertices=
f.chamfer(a.vertices,c.radius,c.quality,c.qualityMin,c.qualityMax),delete r.chamfer);return k.create(h.extend({},a,r))};c.circle=function(a,b,f,g,e){g=g||{};var k={label:"Circle Body",circleRadius:f};e=Math.ceil(Math.max(10,Math.min(e||25,f)));1===e%2&&(e+=1);return c.polygon(a,b,e,f,h.extend({},k,g))};c.polygon=function(a,b,g,e,q){q=q||{};if(3>g)return c.circle(a,b,e,q);for(var r=2*Math.PI/g,x="",t=.5*r,l=0;l<g;l+=1)var v=t+l*r,A=Math.sin(v)*e,x=x+("L "+(Math.cos(v)*e).toFixed(3)+" "+A.toFixed(3)+
" ");a={label:"Polygon Body",position:{x:a,y:b},vertices:f.fromPath(x)};q.chamfer&&(b=q.chamfer,a.vertices=f.chamfer(a.vertices,b.radius,b.quality,b.qualityMin,b.qualityMax),delete q.chamfer);return k.create(h.extend({},a,q))};c.fromVertices=function(a,c,b,e,q,z,x){var t,l,v,A;e=e||{};t=[];q="undefined"!==typeof q?q:!1;z="undefined"!==typeof z?z:.01;x="undefined"!==typeof x?x:10;window.decomp||h.log("Bodies.fromVertices: poly-decomp.js required. Could not decompose vertices. Fallback to convex hull.",
"warn");h.isArray(b[0])||(b=[b]);for(A=0;A<b.length;A+=1)if(v=b[A],(l=f.isConvex(v))||!window.decomp)v=l?f.clockwiseSort(v):f.hull(v),t.push({position:{x:a,y:c},vertices:v});else{var y=new decomp.Polygon;for(l=0;l<v.length;l++)y.vertices.push([v[l].x,v[l].y]);y.makeCCW();!1!==z&&y.removeCollinearPoints(z);y=y.quickDecomp();for(l=0;l<y.length;l++){var C=y[l],F=[];for(v=0;v<C.vertices.length;v++)F.push({x:C.vertices[v][0],y:C.vertices[v][1]});0<x&&f.area(F)<x||t.push({position:f.centre(F),vertices:F})}}for(l=
0;l<t.length;l++)t[l]=k.create(h.extend(t[l],e));if(q)for(l=0;l<t.length;l++)for(z=t[l],v=l+1;v<t.length;v++)if(x=t[v],g.overlaps(z.bounds,x.bounds))for(A=z.vertices,y=x.vertices,b=0;b<z.vertices.length;b++)for(q=0;q<x.vertices.length;q++)C=r.magnitudeSquared(r.sub(A[(b+1)%A.length],y[q])),F=r.magnitudeSquared(r.sub(A[b],y[(q+1)%y.length])),5>C&&5>F&&(A[b].isInternal=!0,y[q].isInternal=!0);return 1<t.length?(e=k.create(h.extend({parts:t.slice(0)},e)),k.setPosition(e,{x:a,y:c}),e):t[0]}})()},{"../body/Body":1,
"../core/Common":14,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27}],22:[function(a,b,e){var c={};b.exports=c;var f=a("../body/Composite"),h=a("../constraint/Constraint"),k=a("../core/Common"),g=a("../body/Body"),r=a("./Bodies");(function(){c.stack=function(a,c,b,e,k,h,r){for(var t=f.create({label:"Stack"}),l=a,v,A=0,y=0;y<e;y++){for(var C=0,F=0;F<b;F++){var E=r(l,c,F,y,v,A);E?(l=E.bounds.max.y-E.bounds.min.y,v=E.bounds.max.x-E.bounds.min.x,l>C&&(C=l),g.translate(E,{x:.5*
v,y:.5*l}),l=E.bounds.max.x+k,f.addBody(t,E),v=E,A+=1):l+=k}c+=C+h;l=a}return t};c.chain=function(a,c,b,e,g,r){for(var x=a.bodies,t=1;t<x.length;t++){var l=x[t-1],v=x[t],l=k.extend({bodyA:l,pointA:{x:(l.bounds.max.x-l.bounds.min.x)*c,y:(l.bounds.max.y-l.bounds.min.y)*b},bodyB:v,pointB:{x:(v.bounds.max.x-v.bounds.min.x)*e,y:(v.bounds.max.y-v.bounds.min.y)*g}},r);f.addConstraint(a,h.create(l))}a.label+=" Chain";return a};c.mesh=function(a,c,b,e,g){var r=a.bodies,x,t,l,v;for(x=0;x<b;x++){for(t=1;t<c;t++)l=
r[t-1+x*c],v=r[t+x*c],f.addConstraint(a,h.create(k.extend({bodyA:l,bodyB:v},g)));if(0<x)for(t=0;t<c;t++)l=r[t+(x-1)*c],v=r[t+x*c],f.addConstraint(a,h.create(k.extend({bodyA:l,bodyB:v},g))),e&&0<t&&(l=r[t-1+(x-1)*c],f.addConstraint(a,h.create(k.extend({bodyA:l,bodyB:v},g)))),e&&t<c-1&&(l=r[t+1+(x-1)*c],f.addConstraint(a,h.create(k.extend({bodyA:l,bodyB:v},g))))}a.label+=" Mesh";return a};c.pyramid=function(a,b,f,e,k,h,r){return c.stack(a,b,f,e,k,h,function(c,b,h,z,w,C){var F=Math.min(e,Math.ceil(f/
2));c=w?w.bounds.max.x-w.bounds.min.x:0;if(!(z>F||(z=F-z,F=f-1-z,h<z||h>F)))return 1===C&&g.translate(w,{x:(h+(1===f%2?1:-1))*c,y:0}),r(a+(w?h*c:0)+h*k,b,h,z,w,C)})};c.newtonsCradle=function(a,c,b,e,g){for(var k=f.create({label:"Newtons Cradle"}),x=0;x<b;x++){var t=r.circle(a+1.9*x*e,c+g,e,{inertia:Infinity,restitution:1,friction:0,frictionAir:1E-4,slop:1}),l=h.create({pointA:{x:a+1.9*x*e,y:c},bodyB:t});f.addBody(k,t);f.addConstraint(k,l)}return k};c.car=function(a,c,b,e,k){var z=g.nextGroup(!0),
x=.5*-b+-20,t=.5*b- -20,l=f.create({label:"Car"});b=r.trapezoid(a,c,b,e,.3,{collisionFilter:{group:z},friction:.01,chamfer:{radius:10}});e=r.circle(a+x,c+0,k,{collisionFilter:{group:z},friction:.8,density:.01});a=r.circle(a+t,c+0,k,{collisionFilter:{group:z},friction:.8,density:.01});x=h.create({bodyA:b,pointA:{x:x,y:0},bodyB:e,stiffness:.2});t=h.create({bodyA:b,pointA:{x:t,y:0},bodyB:a,stiffness:.2});f.addBody(l,b);f.addBody(l,e);f.addBody(l,a);f.addConstraint(l,x);f.addConstraint(l,t);return l};
c.softBody=function(a,b,f,e,g,h,x,t,l,v){l=k.extend({inertia:Infinity},l);v=k.extend({stiffness:.4},v);a=c.stack(a,b,f,e,g,h,function(a,c){return r.circle(a,c,t,l)});c.mesh(a,f,e,x,v);a.label="Soft Body";return a}})()},{"../body/Body":1,"../body/Composite":2,"../constraint/Constraint":12,"../core/Common":14,"./Bodies":21}],23:[function(a,b,e){var c={};b.exports=c;var f=a("../geometry/Vector"),h=a("../core/Common");(function(){c.fromVertices=function(a){for(var c={},b=0;b<a.length;b++){var e=(b+1)%
a.length,e=f.normalise({x:a[e].y-a[b].y,y:a[b].x-a[e].x}),w=0===e.y?Infinity:e.x/e.y,w=w.toFixed(3).toString();c[w]=e}return h.values(c)};c.rotate=function(a,c){if(0!==c)for(var b=Math.cos(c),f=Math.sin(c),e=0;e<a.length;e++){var h=a[e],p;p=h.x*b-h.y*f;h.y=h.x*f+h.y*b;h.x=p}}})()},{"../core/Common":14,"../geometry/Vector":26}],24:[function(a,b,e){var c={};b.exports=c;(function(){c.create=function(a){var b={min:{x:0,y:0},max:{x:0,y:0}};a&&c.update(b,a);return b};c.update=function(a,c,b){a.min.x=Infinity;
a.max.x=-Infinity;a.min.y=Infinity;a.max.y=-Infinity;for(var e=0;e<c.length;e++){var r=c[e];r.x>a.max.x&&(a.max.x=r.x);r.x<a.min.x&&(a.min.x=r.x);r.y>a.max.y&&(a.max.y=r.y);r.y<a.min.y&&(a.min.y=r.y)}b&&(0<b.x?a.max.x+=b.x:a.min.x+=b.x,0<b.y?a.max.y+=b.y:a.min.y+=b.y)};c.contains=function(a,c){return c.x>=a.min.x&&c.x<=a.max.x&&c.y>=a.min.y&&c.y<=a.max.y};c.overlaps=function(a,c){return a.min.x<=c.max.x&&a.max.x>=c.min.x&&a.max.y>=c.min.y&&a.min.y<=c.max.y};c.translate=function(a,c){a.min.x+=c.x;
a.max.x+=c.x;a.min.y+=c.y;a.max.y+=c.y};c.shift=function(a,c){var b=a.max.x-a.min.x,e=a.max.y-a.min.y;a.min.x=c.x;a.max.x=c.x+b;a.min.y=c.y;a.max.y=c.y+e}})()},{}],25:[function(a,b,e){var c={};b.exports=c;a("../geometry/Bounds");(function(){c.pathToVertices=function(c,b){var e,r,m,w,u,p,q=[],z,x,t=0,l=0,v=0;b=b||15;var A=function(a,c,b){b=1===b%2&&1<b;if(!p||a!=p.x||c!=p.y){p&&b?(z=p.x,x=p.y):x=z=0;var e={x:z+a,y:x+c};if(b||!p)p=e;q.push(e);l=z+a;v=x+c}},y=function(a){var c=a.pathSegTypeAsLetter.toUpperCase();
if("Z"!==c){switch(c){case "M":case "L":case "T":case "C":case "S":case "Q":l=a.x;v=a.y;break;case "H":l=a.x;break;case "V":v=a.y}A(l,v,a.pathSegType)}};a(c);r=c.getTotalLength();m=[];for(e=0;e<c.pathSegList.numberOfItems;e+=1)m.push(c.pathSegList.getItem(e));for(w=m.concat();t<r;){e=c.getPathSegAtLength(t);e=m[e];if(e!=u){for(;w.length&&w[0]!=e;)y(w.shift());u=e}switch(e.pathSegTypeAsLetter.toUpperCase()){case "C":case "T":case "S":case "Q":case "A":e=c.getPointAtLength(t),A(e.x,e.y,0)}t+=b}e=0;
for(r=w.length;e<r;++e)y(w[e]);return q};var a=function(a){for(var c,b,e,f,w,u,p=a.pathSegList,q=0,z=0,x=p.numberOfItems,t=0;t<x;++t){var l=p.getItem(t),v=l.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(v))"x"in l&&(q=l.x),"y"in l&&(z=l.y);else switch("x1"in l&&(e=q+l.x1),"x2"in l&&(w=q+l.x2),"y1"in l&&(f=z+l.y1),"y2"in l&&(u=z+l.y2),"x"in l&&(q+=l.x),"y"in l&&(z+=l.y),v){case "m":p.replaceItem(a.createSVGPathSegMovetoAbs(q,z),t);break;case "l":p.replaceItem(a.createSVGPathSegLinetoAbs(q,z),t);break;
case "h":p.replaceItem(a.createSVGPathSegLinetoHorizontalAbs(q),t);break;case "v":p.replaceItem(a.createSVGPathSegLinetoVerticalAbs(z),t);break;case "c":p.replaceItem(a.createSVGPathSegCurvetoCubicAbs(q,z,e,f,w,u),t);break;case "s":p.replaceItem(a.createSVGPathSegCurvetoCubicSmoothAbs(q,z,w,u),t);break;case "q":p.replaceItem(a.createSVGPathSegCurvetoQuadraticAbs(q,z,e,f),t);break;case "t":p.replaceItem(a.createSVGPathSegCurvetoQuadraticSmoothAbs(q,z),t);break;case "a":p.replaceItem(a.createSVGPathSegArcAbs(q,
z,l.r1,l.r2,l.angle,l.largeArcFlag,l.sweepFlag),t);break;case "z":case "Z":q=c,z=b}if("M"==v||"m"==v)c=q,b=z}}})()},{"../geometry/Bounds":24}],26:[function(a,b,e){var c={};b.exports=c;(function(){c.create=function(a,c){return{x:a||0,y:c||0}};c.clone=function(a){return{x:a.x,y:a.y}};c.magnitude=function(a){return Math.sqrt(a.x*a.x+a.y*a.y)};c.magnitudeSquared=function(a){return a.x*a.x+a.y*a.y};c.rotate=function(a,c){var b=Math.cos(c),e=Math.sin(c);return{x:a.x*b-a.y*e,y:a.x*e+a.y*b}};c.rotateAbout=
function(a,c,b,e){var r=Math.cos(c);c=Math.sin(c);e||(e={});var m=b.x+((a.x-b.x)*r-(a.y-b.y)*c);e.y=b.y+((a.x-b.x)*c+(a.y-b.y)*r);e.x=m;return e};c.normalise=function(a){var b=c.magnitude(a);return 0===b?{x:0,y:0}:{x:a.x/b,y:a.y/b}};c.dot=function(a,c){return a.x*c.x+a.y*c.y};c.cross=function(a,c){return a.x*c.y-a.y*c.x};c.cross3=function(a,c,b){return(c.x-a.x)*(b.y-a.y)-(c.y-a.y)*(b.x-a.x)};c.add=function(a,c,b){b||(b={});b.x=a.x+c.x;b.y=a.y+c.y;return b};c.sub=function(a,c,b){b||(b={});b.x=a.x-
c.x;b.y=a.y-c.y;return b};c.mult=function(a,c){return{x:a.x*c,y:a.y*c}};c.div=function(a,c){return{x:a.x/c,y:a.y/c}};c.perp=function(a,c){c=!0===c?-1:1;return{x:c*-a.y,y:c*a.x}};c.neg=function(a){return{x:-a.x,y:-a.y}};c.angle=function(a,c){return Math.atan2(c.y-a.y,c.x-a.x)};c._temp=[c.create(),c.create(),c.create(),c.create(),c.create(),c.create()]})()},{}],27:[function(a,b,e){var c={};b.exports=c;var f=a("../geometry/Vector"),h=a("../core/Common");(function(){c.create=function(a,c){for(var b=[],
e=0;e<a.length;e++){var f=a[e];b.push({x:f.x,y:f.y,index:e,body:c,isInternal:!1})}return b};c.fromPath=function(a,b){var e=[];a.replace(/L?\s*([\-\d\.e]+)[\s,]*([\-\d\.e]+)*/ig,function(a,c,b){e.push({x:parseFloat(c),y:parseFloat(b)})});return c.create(e,b)};c.centre=function(a){for(var b=c.area(a,!0),e={x:0,y:0},m,h,u=0;u<a.length;u++)h=(u+1)%a.length,m=f.cross(a[u],a[h]),m=f.mult(f.add(a[u],a[h]),m),e=f.add(e,m);return f.div(e,6*b)};c.mean=function(a){for(var c={x:0,y:0},b=0;b<a.length;b++)c.x+=
a[b].x,c.y+=a[b].y;return f.div(c,a.length)};c.area=function(a,c){for(var b=0,e=a.length-1,f=0;f<a.length;f++)b+=(a[e].x-a[f].x)*(a[e].y+a[f].y),e=f;return c?b/2:Math.abs(b)/2};c.inertia=function(a,c){for(var b=0,e=0,h,u,p=0;p<a.length;p++)u=(p+1)%a.length,h=Math.abs(f.cross(a[u],a[p])),b+=h*(f.dot(a[u],a[u])+f.dot(a[u],a[p])+f.dot(a[p],a[p])),e+=h;return c/6*(b/e)};c.translate=function(a,c,b){var e;if(b)for(e=0;e<a.length;e++)a[e].x+=c.x*b,a[e].y+=c.y*b;else for(e=0;e<a.length;e++)a[e].x+=c.x,a[e].y+=
c.y;return a};c.rotate=function(a,c,b){if(0!==c){var e=Math.cos(c);c=Math.sin(c);for(var f=0;f<a.length;f++){var h=a[f],p=h.x-b.x,q=h.y-b.y;h.x=b.x+(p*e-q*c);h.y=b.y+(p*c+q*e)}return a}};c.contains=function(a,c){for(var b=0;b<a.length;b++){var e=a[b],f=a[(b+1)%a.length];if(0<(c.x-e.x)*(f.y-e.y)+(c.y-e.y)*(e.x-f.x))return!1}return!0};c.scale=function(a,b,e,h){if(1===b&&1===e)return a;h=h||c.centre(a);for(var w,u=0;u<a.length;u++)w=a[u],w=f.sub(w,h),a[u].x=h.x+w.x*b,a[u].y=h.y+w.y*e;return a};c.chamfer=
function(a,c,b,e,w){c=c||[8];c.length||(c=[c]);b="undefined"!==typeof b?b:-1;e=e||2;w=w||14;for(var u=[],p=0;p<a.length;p++){var q=a[0<=p-1?p-1:a.length-1],z=a[p],x=a[(p+1)%a.length],t=c[p<c.length?p:c.length-1];if(0===t)u.push(z);else{var q=f.normalise({x:z.y-q.y,y:q.x-z.x}),l=f.normalise({x:x.y-z.y,y:z.x-x.x}),v=Math.sqrt(2*Math.pow(t,2)),x=f.mult(h.clone(q),t),A=f.normalise(f.mult(f.add(q,l),.5)),z=f.sub(z,f.mult(A,v)),v=b;-1===b&&(v=1.75*Math.pow(t,.32));v=h.clamp(v,e,w);1===v%2&&(v+=1);t=Math.acos(f.dot(q,
l))/v;for(q=0;q<v;q++)u.push(f.add(f.rotate(x,t*q),z))}}return u};c.clockwiseSort=function(a){var b=c.mean(a);a.sort(function(a,c){return f.angle(b,a)-f.angle(b,c)});return a};c.isConvex=function(a){var c=0,b=a.length,e,f,h,p;if(3>b)return null;for(e=0;e<b;e++)if(f=(e+1)%b,h=(e+2)%b,p=(a[f].x-a[e].x)*(a[h].y-a[f].y),p-=(a[f].y-a[e].y)*(a[h].x-a[f].x),0>p?c|=1:0<p&&(c|=2),3===c)return!1;return 0!==c?!0:null};c.hull=function(a){var c=[],b=[],e,h;a=a.slice(0);a.sort(function(a,c){var b=a.x-c.x;return 0!==
b?b:a.y-c.y});for(h=0;h<a.length;h++){for(e=a[h];2<=b.length&&0>=f.cross3(b[b.length-2],b[b.length-1],e);)b.pop();b.push(e)}for(h=a.length-1;0<=h;h--){for(e=a[h];2<=c.length&&0>=f.cross3(c[c.length-2],c[c.length-1],e);)c.pop();c.push(e)}c.pop();b.pop();return c.concat(b)}})()},{"../core/Common":14,"../geometry/Vector":26}],28:[function(a,b,e){b=b.exports={};b.version="master";b.Body=a("../body/Body");b.Composite=a("../body/Composite");b.World=a("../body/World");b.Contact=a("../collision/Contact");
b.Detector=a("../collision/Detector");b.Grid=a("../collision/Grid");b.Pairs=a("../collision/Pairs");b.Pair=a("../collision/Pair");b.Query=a("../collision/Query");b.Resolver=a("../collision/Resolver");b.SAT=a("../collision/SAT");b.Constraint=a("../constraint/Constraint");b.MouseConstraint=a("../constraint/MouseConstraint");b.Common=a("../core/Common");b.Engine=a("../core/Engine");b.Events=a("../core/Events");b.Mouse=a("../core/Mouse");b.Runner=a("../core/Runner");b.Sleeping=a("../core/Sleeping");b.Bodies=
a("../factory/Bodies");b.Composites=a("../factory/Composites");b.Axes=a("../geometry/Axes");b.Bounds=a("../geometry/Bounds");b.Svg=a("../geometry/Svg");b.Vector=a("../geometry/Vector");b.Vertices=a("../geometry/Vertices");b.Render=a("../render/Render");b.RenderPixi=a("../render/RenderPixi");b.World.add=b.Composite.add;b.World.remove=b.Composite.remove;b.World.addComposite=b.Composite.addComposite;b.World.addBody=b.Composite.addBody;b.World.addConstraint=b.Composite.addConstraint;b.World.clear=b.Composite.clear;
b.Engine.run=b.Runner.run},{"../body/Body":1,"../body/Composite":2,"../body/World":3,"../collision/Contact":4,"../collision/Detector":5,"../collision/Grid":6,"../collision/Pair":7,"../collision/Pairs":8,"../collision/Query":9,"../collision/Resolver":10,"../collision/SAT":11,"../constraint/Constraint":12,"../constraint/MouseConstraint":13,"../core/Common":14,"../core/Engine":15,"../core/Events":16,"../core/Metrics":17,"../core/Mouse":18,"../core/Runner":19,"../core/Sleeping":20,"../factory/Bodies":21,
"../factory/Composites":22,"../geometry/Axes":23,"../geometry/Bounds":24,"../geometry/Svg":25,"../geometry/Vector":26,"../geometry/Vertices":27,"../render/Render":29,"../render/RenderPixi":30}],29:[function(a,b,e){var c={};b.exports=c;var f=a("../core/Common"),h=a("../body/Composite"),k=a("../geometry/Bounds"),g=a("../core/Events"),r=a("../collision/Grid"),m=a("../geometry/Vector");(function(){c.create=function(b){b=f.extend({controller:c,element:null,canvas:null,mouse:null,options:{width:800,height:600,
pixelRatio:1,background:"#fafafa",wireframeBackground:"#222",hasBounds:!1,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},b);b.canvas&&(b.canvas.width=b.options.width||b.canvas.width,b.canvas.height=b.options.height||b.canvas.height);b.canvas=b.canvas||
a(b.options.width,b.options.height);b.context=b.canvas.getContext("2d");b.textures={};b.bounds=b.bounds||{min:{x:0,y:0},max:{x:b.canvas.width,y:b.canvas.height}};1!==b.options.pixelRatio&&c.setPixelRatio(b,b.options.pixelRatio);f.isElement(b.element)?b.element.appendChild(b.canvas):f.log("Render.create: options.element was undefined, render.canvas was created but not appended","warn");return b};c.setPixelRatio=function(a,c){var b=a.options,e=a.canvas;if("auto"===c){var f=e.getContext("2d");c=(window.devicePixelRatio||
1)/(f.webkitBackingStorePixelRatio||f.mozBackingStorePixelRatio||f.msBackingStorePixelRatio||f.oBackingStorePixelRatio||f.backingStorePixelRatio||1)}b.pixelRatio=c;e.setAttribute("data-pixel-ratio",c);e.width=b.width*c;e.height=b.height*c;e.style.width=b.width+"px";e.style.height=b.height+"px";a.context.scale(c,c)};c.world=function(a){var b=a.render,e=a.world,f=b.canvas,x=b.context,t=b.options,l=h.allBodies(e),e=h.allConstraints(e),v=t.wireframes?t.wireframeBackground:t.background,w=[],y=[],C={timestamp:a.timing.timestamp};
g.trigger(b,"beforeRender",C);if(b.currentBackground!==v){var F=v;/(jpg|gif|png)$/.test(v)&&(F="url("+v+")");b.canvas.style.background=F;b.canvas.style.backgroundSize="100%";b.currentBackground=v}x.globalCompositeOperation="source-in";x.fillStyle="transparent";x.fillRect(0,0,f.width,f.height);x.globalCompositeOperation="source-over";if(t.hasBounds){v=(b.bounds.max.x-b.bounds.min.x)/t.width;F=(b.bounds.max.y-b.bounds.min.y)/t.height;for(f=0;f<l.length;f++){var E=l[f];k.overlaps(E.bounds,b.bounds)&&
w.push(E)}for(f=0;f<e.length;f++){var l=e[f],E=l.bodyA,I=l.bodyB,D=l.pointA,B=l.pointB;E&&(D=m.add(E.position,l.pointA));I&&(B=m.add(I.position,l.pointB));D&&B&&(k.contains(b.bounds,D)||k.contains(b.bounds,B))&&y.push(l)}x.scale(1/v,1/F);x.translate(-b.bounds.min.x,-b.bounds.min.y)}else y=e,w=l;!t.wireframes||a.enableSleeping&&t.showSleeping?c.bodies(a,w,x):(t.showConvexHulls&&c.bodyConvexHulls(a,w,x),c.bodyWireframes(a,w,x));t.showBounds&&c.bodyBounds(a,w,x);(t.showAxes||t.showAngleIndicator)&&c.bodyAxes(a,
w,x);t.showPositions&&c.bodyPositions(a,w,x);t.showVelocity&&c.bodyVelocity(a,w,x);t.showIds&&c.bodyIds(a,w,x);t.showSeparations&&c.separations(a,a.pairs.list,x);t.showCollisions&&c.collisions(a,a.pairs.list,x);t.showVertexNumbers&&c.vertexNumbers(a,w,x);t.showMousePosition&&c.mousePosition(a,b.mouse,x);c.constraints(y,x);t.showBroadphase&&a.broadphase.controller===r&&c.grid(a,a.broadphase,x);t.showDebug&&c.debug(a,x);t.hasBounds&&x.setTransform(t.pixelRatio,0,0,t.pixelRatio,0,0);g.trigger(b,"afterRender",
C)};c.debug=function(a,b){var c=a.render,e=a.metrics,f=c.options;h.allBodies(a.world);if(500<=a.timing.timestamp-(c.debugTimestamp||0)){var g="";e.timing&&(g+="fps: "+Math.round(e.timing.fps)+"    ");c.debugString=g;c.debugTimestamp=a.timing.timestamp}if(c.debugString)for(b.font="12px Arial",b.fillStyle=f.wireframes?"rgba(255,255,255,0.5)":"rgba(0,0,0,0.5)",c=c.debugString.split("\n"),e=0;e<c.length;e++)b.fillText(c[e],50,50+18*e)};c.constraints=function(a,b){for(var c=0;c<a.length;c++){var e=a[c];
if(e.render.visible&&e.pointA&&e.pointB){var f=e.bodyA,g=e.bodyB;f?(b.beginPath(),b.moveTo(f.position.x+e.pointA.x,f.position.y+e.pointA.y)):(b.beginPath(),b.moveTo(e.pointA.x,e.pointA.y));g?b.lineTo(g.position.x+e.pointB.x,g.position.y+e.pointB.y):b.lineTo(e.pointB.x,e.pointB.y);b.lineWidth=e.render.lineWidth;b.strokeStyle=e.render.strokeStyle;b.stroke()}}};c.bodyShadows=function(a,b,c){a=a.render;for(var e=0;e<b.length;e++){var f=b[e];if(f.render.visible){if(f.circleRadius)c.beginPath(),c.arc(f.position.x,
f.position.y,f.circleRadius,0,2*Math.PI);else{c.beginPath();c.moveTo(f.vertices[0].x,f.vertices[0].y);for(var g=1;g<f.vertices.length;g++)c.lineTo(f.vertices[g].x,f.vertices[g].y)}c.closePath();var g=f.position.x-.5*a.options.width,f=f.position.y-.2*a.options.height,l=Math.abs(g)+Math.abs(f);c.shadowColor="rgba(0,0,0,0.15)";c.shadowOffsetX=.05*g;c.shadowOffsetY=.05*f;c.shadowBlur=1+12*Math.min(1,l/1E3);c.fill();c.shadowColor=null;c.shadowOffsetX=null;c.shadowOffsetY=null;c.shadowBlur=null}}};c.bodies=
function(a,b,c){a=a.render;var e=a.options,f=e.showInternalEdges||!e.wireframes,g,l,h,k;for(h=0;h<b.length;h++)if(g=b[h],g.render.visible)for(k=1<g.parts.length?1:0;k<g.parts.length;k++)if(l=g.parts[k],l.render.visible){e.showSleeping&&g.isSleeping?c.globalAlpha=.5*l.render.opacity:1!==l.render.opacity&&(c.globalAlpha=l.render.opacity);if(l.render.sprite&&l.render.sprite.texture&&!e.wireframes){var m=l.render.sprite,r;r=m.texture;var w=a.textures[r];w||(w=a.textures[r]=new Image,w.src=r);r=w;c.translate(l.position.x,
l.position.y);c.rotate(l.angle);c.drawImage(r,r.width*-m.xOffset*m.xScale,r.height*-m.yOffset*m.yScale,r.width*m.xScale,r.height*m.yScale);c.rotate(-l.angle);c.translate(-l.position.x,-l.position.y)}else{if(l.circleRadius)c.beginPath(),c.arc(l.position.x,l.position.y,l.circleRadius,0,2*Math.PI);else{c.beginPath();c.moveTo(l.vertices[0].x,l.vertices[0].y);for(m=1;m<l.vertices.length;m++)!l.vertices[m-1].isInternal||f?c.lineTo(l.vertices[m].x,l.vertices[m].y):c.moveTo(l.vertices[m].x,l.vertices[m].y),
l.vertices[m].isInternal&&!f&&c.moveTo(l.vertices[(m+1)%l.vertices.length].x,l.vertices[(m+1)%l.vertices.length].y);c.lineTo(l.vertices[0].x,l.vertices[0].y);c.closePath()}e.wireframes?(c.lineWidth=1,c.strokeStyle="#bbb"):(c.fillStyle=l.render.fillStyle,c.lineWidth=l.render.lineWidth,c.strokeStyle=l.render.strokeStyle,c.fill());c.stroke()}c.globalAlpha=1}};c.bodyWireframes=function(a,c,b){a=a.render.options.showInternalEdges;var e,f,g,l,h;b.beginPath();for(g=0;g<c.length;g++)if(e=c[g],e.render.visible)for(h=
1<e.parts.length?1:0;h<e.parts.length;h++){f=e.parts[h];b.moveTo(f.vertices[0].x,f.vertices[0].y);for(l=1;l<f.vertices.length;l++)!f.vertices[l-1].isInternal||a?b.lineTo(f.vertices[l].x,f.vertices[l].y):b.moveTo(f.vertices[l].x,f.vertices[l].y),f.vertices[l].isInternal&&!a&&b.moveTo(f.vertices[(l+1)%f.vertices.length].x,f.vertices[(l+1)%f.vertices.length].y);b.lineTo(f.vertices[0].x,f.vertices[0].y)}b.lineWidth=1;b.strokeStyle="#bbb";b.stroke()};c.bodyConvexHulls=function(a,c,b){var e,f;b.beginPath();
for(e=0;e<c.length;e++)if(a=c[e],a.render.visible&&1!==a.parts.length){b.moveTo(a.vertices[0].x,a.vertices[0].y);for(f=1;f<a.vertices.length;f++)b.lineTo(a.vertices[f].x,a.vertices[f].y);b.lineTo(a.vertices[0].x,a.vertices[0].y)}b.lineWidth=1;b.strokeStyle="rgba(255,255,255,0.2)";b.stroke()};c.vertexNumbers=function(a,c,b){var e,f;for(a=0;a<c.length;a++){var g=c[a].parts;for(f=1<g.length?1:0;f<g.length;f++){var h=g[f];for(e=0;e<h.vertices.length;e++)b.fillStyle="rgba(255,255,255,0.2)",b.fillText(a+
"_"+e,h.position.x+.8*(h.vertices[e].x-h.position.x),h.position.y+.8*(h.vertices[e].y-h.position.y))}}};c.mousePosition=function(a,c,b){b.fillStyle="rgba(255,255,255,0.8)";b.fillText(c.position.x+"  "+c.position.y,c.position.x+5,c.position.y-5)};c.bodyBounds=function(a,c,b){a=a.render.options;b.beginPath();for(var e=0;e<c.length;e++)if(c[e].render.visible)for(var f=c[e].parts,g=1<f.length?1:0;g<f.length;g++){var h=f[g];b.rect(h.bounds.min.x,h.bounds.min.y,h.bounds.max.x-h.bounds.min.x,h.bounds.max.y-
h.bounds.min.y)}b.strokeStyle=a.wireframes?"rgba(255,255,255,0.08)":"rgba(0,0,0,0.1)";b.lineWidth=1;b.stroke()};c.bodyAxes=function(a,c,b){a=a.render.options;var e,f,g,h;b.beginPath();for(f=0;f<c.length;f++){e=c[f];var m=e.parts;if(e.render.visible)if(a.showAxes)for(g=1<m.length?1:0;g<m.length;g++)for(e=m[g],h=0;h<e.axes.length;h++){var k=e.axes[h];b.moveTo(e.position.x,e.position.y);b.lineTo(e.position.x+20*k.x,e.position.y+20*k.y)}else for(g=1<m.length?1:0;g<m.length;g++)for(e=m[g],h=0;h<e.axes.length;h++)b.moveTo(e.position.x,
e.position.y),b.lineTo((e.vertices[0].x+e.vertices[e.vertices.length-1].x)/2,(e.vertices[0].y+e.vertices[e.vertices.length-1].y)/2)}a.wireframes?b.strokeStyle="indianred":(b.strokeStyle="rgba(0,0,0,0.8)",b.globalCompositeOperation="overlay");b.lineWidth=1;b.stroke();b.globalCompositeOperation="source-over"};c.bodyPositions=function(a,b,c){a=a.render.options;var e,f,g,h;c.beginPath();for(g=0;g<b.length;g++)if(e=b[g],e.render.visible)for(h=0;h<e.parts.length;h++)f=e.parts[h],c.arc(f.position.x,f.position.y,
3,0,2*Math.PI,!1),c.closePath();c.fillStyle=a.wireframes?"indianred":"rgba(0,0,0,0.5)";c.fill();c.beginPath();for(g=0;g<b.length;g++)e=b[g],e.render.visible&&(c.arc(e.positionPrev.x,e.positionPrev.y,2,0,2*Math.PI,!1),c.closePath());c.fillStyle="rgba(255,165,0,0.8)";c.fill()};c.bodyVelocity=function(a,c,b){b.beginPath();for(a=0;a<c.length;a++){var e=c[a];e.render.visible&&(b.moveTo(e.position.x,e.position.y),b.lineTo(e.position.x+2*(e.position.x-e.positionPrev.x),e.position.y+2*(e.position.y-e.positionPrev.y)))}b.lineWidth=
3;b.strokeStyle="cornflowerblue";b.stroke()};c.bodyIds=function(a,c,b){var e;for(a=0;a<c.length;a++)if(c[a].render.visible){var f=c[a].parts;for(e=1<f.length?1:0;e<f.length;e++){var g=f[e];b.font="12px Arial";b.fillStyle="rgba(255,255,255,0.5)";b.fillText(g.id,g.position.x+10,g.position.y-10)}}};c.collisions=function(a,c,b){a=a.render.options;var e,f,g;b.beginPath();for(g=0;g<c.length;g++)if(e=c[g],e.isActive)for(f=0;f<e.activeContacts.length;f++){var h=e.activeContacts[f].vertex;b.rect(h.x-1.5,h.y-
1.5,3.5,3.5)}b.fillStyle=a.wireframes?"rgba(255,255,255,0.7)":"orange";b.fill();b.beginPath();for(g=0;g<c.length;g++)if(e=c[g],e.isActive&&(f=e.collision,0<e.activeContacts.length)){var h=e.activeContacts[0].vertex.x,m=e.activeContacts[0].vertex.y;2===e.activeContacts.length&&(h=(e.activeContacts[0].vertex.x+e.activeContacts[1].vertex.x)/2,m=(e.activeContacts[0].vertex.y+e.activeContacts[1].vertex.y)/2);f.bodyB===f.supports[0].body||!0===f.bodyA.isStatic?b.moveTo(h-8*f.normal.x,m-8*f.normal.y):b.moveTo(h+
8*f.normal.x,m+8*f.normal.y);b.lineTo(h,m)}b.strokeStyle=a.wireframes?"rgba(255,165,0,0.7)":"orange";b.lineWidth=1;b.stroke()};c.separations=function(a,b,c){a=a.render.options;var e,f,g,h;c.beginPath();for(h=0;h<b.length;h++)if(e=b[h],e.isActive){e=e.collision;f=e.bodyA;g=e.bodyB;var m=1;g.isStatic||f.isStatic||(m=.5);g.isStatic&&(m=0);c.moveTo(g.position.x,g.position.y);c.lineTo(g.position.x-e.penetration.x*m,g.position.y-e.penetration.y*m);m=1;g.isStatic||f.isStatic||(m=.5);f.isStatic&&(m=0);c.moveTo(f.position.x,
f.position.y);c.lineTo(f.position.x+e.penetration.x*m,f.position.y+e.penetration.y*m)}c.strokeStyle=a.wireframes?"rgba(255,165,0,0.5)":"orange";c.stroke()};c.grid=function(a,b,c){c.strokeStyle=a.render.options.wireframes?"rgba(255,180,0,0.1)":"rgba(255,180,0,0.5)";c.beginPath();a=f.keys(b.buckets);for(var e=0;e<a.length;e++){var g=a[e];2>b.buckets[g].length||(g=g.split(","),c.rect(.5+parseInt(g[0],10)*b.bucketWidth,.5+parseInt(g[1],10)*b.bucketHeight,b.bucketWidth,b.bucketHeight))}c.lineWidth=1;c.stroke()};
c.inspector=function(a,b){var c=a.selected,e=a.engine.render,f=e.options,g;f.hasBounds&&(b.scale(1/((e.bounds.max.x-e.bounds.min.x)/e.options.width),1/((e.bounds.max.y-e.bounds.min.y)/e.options.height)),b.translate(-e.bounds.min.x,-e.bounds.min.y));for(e=0;e<c.length;e++){g=c[e].data;b.translate(.5,.5);b.lineWidth=1;b.strokeStyle="rgba(255,165,0,0.9)";b.setLineDash([1,2]);switch(g.type){case "body":g=g.bounds;b.beginPath();b.rect(Math.floor(g.min.x-3),Math.floor(g.min.y-3),Math.floor(g.max.x-g.min.x+
6),Math.floor(g.max.y-g.min.y+6));b.closePath();b.stroke();break;case "constraint":var h=g.pointA;g.bodyA&&(h=g.pointB);b.beginPath();b.arc(h.x,h.y,10,0,2*Math.PI);b.closePath();b.stroke()}b.setLineDash([]);b.translate(-.5,-.5)}null!==a.selectStart&&(b.translate(.5,.5),b.lineWidth=1,b.strokeStyle="rgba(255,165,0,0.6)",b.fillStyle="rgba(255,165,0,0.1)",g=a.selectBounds,b.beginPath(),b.rect(Math.floor(g.min.x),Math.floor(g.min.y),Math.floor(g.max.x-g.min.x),Math.floor(g.max.y-g.min.y)),b.closePath(),
b.stroke(),b.fill(),b.translate(-.5,-.5));f.hasBounds&&b.setTransform(1,0,0,1,0,0)};var a=function(a,b){var c=document.createElement("canvas");c.width=a;c.height=b;c.oncontextmenu=function(){return!1};c.onselectstart=function(){return!1};return c}})()},{"../body/Composite":2,"../collision/Grid":6,"../core/Common":14,"../core/Events":16,"../geometry/Bounds":24,"../geometry/Vector":26}],30:[function(a,b,e){var c={};b.exports=c;var f=a("../body/Composite"),h=a("../core/Common");(function(){c.create=
function(a){var b=h.extend({controller:c,element:null,canvas:null,renderer:null,container:null,spriteContainer:null,pixiOptions:null,options:{width:800,height:600,background:"#fafafa",wireframeBackground:"#222",hasBounds:!1,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1}},a),e=!b.options.wireframes&&"transparent"===b.options.background;b.pixiOptions=
b.pixiOptions||{view:b.canvas,transparent:e,antialias:!0,backgroundColor:a.options.background};b.renderer=b.renderer||new PIXI.WebGLRenderer(b.options.width,b.options.height,b.pixiOptions);b.container=b.container||new PIXI.Container;b.spriteContainer=b.spriteContainer||new PIXI.Container;b.canvas=b.canvas||b.renderer.view;b.bounds=b.bounds||{min:{x:0,y:0},max:{x:b.options.width,y:b.options.height}};b.textures={};b.sprites={};b.primitives={};b.container.addChild(b.spriteContainer);h.isElement(b.element)?
b.element.appendChild(b.canvas):h.log('No "render.element" passed, "render.canvas" was not inserted into document.',"warn");b.canvas.oncontextmenu=function(){return!1};b.canvas.onselectstart=function(){return!1};return b};c.clear=function(a){for(var b=a.container,c=a.spriteContainer;b.children[0];)b.removeChild(b.children[0]);for(;c.children[0];)c.removeChild(c.children[0]);c=a.sprites["bg-0"];a.textures={};a.sprites={};a.primitives={};(a.sprites["bg-0"]=c)&&b.addChildAt(c,0);a.container.addChild(a.spriteContainer);
a.currentBackground=null;b.scale.set(1,1);b.position.set(0,0)};c.setBackground=function(b,c){if(b.currentBackground!==c){var e=c.indexOf&&-1!==c.indexOf("#"),f=b.sprites["bg-0"];e?(e=h.colorToNumber(c),b.renderer.backgroundColor=e,f&&b.container.removeChild(f)):f||(f=a(b,c),f=b.sprites["bg-0"]=new PIXI.Sprite(f),f.position.x=0,f.position.y=0,b.container.addChildAt(f,0));b.currentBackground=c}};c.world=function(a){var b=a.render,e=a.world,h=b.renderer,k=b.container,p=b.options,q=f.allBodies(e),e=f.allConstraints(e),
z=[];p.wireframes?c.setBackground(b,p.wireframeBackground):c.setBackground(b,p.background);var x=(b.bounds.max.x-b.bounds.min.x)/b.options.width,t=(b.bounds.max.y-b.bounds.min.y)/b.options.height;if(p.hasBounds){for(p=0;p<q.length;p++){var l=q[p];l.render.sprite.visible=Bounds.overlaps(l.bounds,b.bounds)}for(p=0;p<e.length;p++){var l=e[p],v=l.bodyA,A=l.bodyB,y=l.pointA,C=l.pointB;v&&(y=Vector.add(v.position,l.pointA));A&&(C=Vector.add(A.position,l.pointB));y&&C&&(Bounds.contains(b.bounds,y)||Bounds.contains(b.bounds,
C))&&z.push(l)}k.scale.set(1/x,1/t);k.position.set(1/x*-b.bounds.min.x,1/t*-b.bounds.min.y)}else z=e;for(p=0;p<q.length;p++)c.body(a,q[p]);for(p=0;p<z.length;p++)c.constraint(a,z[p]);h.render(k)};c.constraint=function(a,b){var c=a.render,e=b.bodyA,f=b.bodyB,k=b.pointA,q=b.pointB,z=c.container,x=b.render,t="c-"+b.id,l=c.primitives[t];l||(l=c.primitives[t]=new PIXI.Graphics);x.visible&&b.pointA&&b.pointB?(-1===h.indexOf(z.children,l)&&z.addChild(l),l.clear(),l.beginFill(0,0),l.lineStyle(x.lineWidth,
h.colorToNumber(x.strokeStyle),1),e?l.moveTo(e.position.x+k.x,e.position.y+k.y):l.moveTo(k.x,k.y),f?l.lineTo(f.position.x+q.x,f.position.y+q.y):l.lineTo(q.x,q.y),l.endFill()):l.clear()};c.body=function(b,c){var e=b.render,f=c.render;if(f.visible)if(f.sprite&&f.sprite.texture){var u="b-"+c.id,p=e.sprites[u],q=e.spriteContainer;p||(p=e.sprites,e=a(e,c.render.sprite.texture),e=new PIXI.Sprite(e),e.anchor.x=c.render.sprite.xOffset,e.anchor.y=c.render.sprite.yOffset,p=p[u]=e);-1===h.indexOf(q.children,
p)&&q.addChild(p);p.position.x=c.position.x;p.position.y=c.position.y;p.rotation=c.angle;p.scale.x=f.sprite.xScale||1;p.scale.y=f.sprite.yScale||1}else{f="b-"+c.id;q=e.primitives[f];u=e.container;if(!q){var q=e.primitives,p=c.render,e=e.options,z=new PIXI.Graphics,x=h.colorToNumber(p.fillStyle),t=h.colorToNumber(p.strokeStyle),l=h.colorToNumber(p.strokeStyle),v=h.colorToNumber("#bbb"),A=h.colorToNumber("#CD5C5C"),y;z.clear();for(var C=1<c.parts.length?1:0;C<c.parts.length;C++){y=c.parts[C];e.wireframes?
(z.beginFill(0,0),z.lineStyle(1,v,1)):(z.beginFill(x,1),z.lineStyle(p.lineWidth,t,1));z.moveTo(y.vertices[0].x-c.position.x,y.vertices[0].y-c.position.y);for(var F=1;F<y.vertices.length;F++)z.lineTo(y.vertices[F].x-c.position.x,y.vertices[F].y-c.position.y);z.lineTo(y.vertices[0].x-c.position.x,y.vertices[0].y-c.position.y);z.endFill();if(e.showAngleIndicator||e.showAxes)z.beginFill(0,0),e.wireframes?z.lineStyle(1,A,1):z.lineStyle(1,l),z.moveTo(y.position.x-c.position.x,y.position.y-c.position.y),
z.lineTo((y.vertices[0].x+y.vertices[y.vertices.length-1].x)/2-c.position.x,(y.vertices[0].y+y.vertices[y.vertices.length-1].y)/2-c.position.y),z.endFill()}q=q[f]=z;q.initialAngle=c.angle}-1===h.indexOf(u.children,q)&&u.addChild(q);q.position.x=c.position.x;q.position.y=c.position.y;q.rotation=c.angle-q.initialAngle}};var a=function(a,b){var c=a.textures[b];c||(c=a.textures[b]=PIXI.Texture.fromImage(b));return c}})()},{"../body/Composite":2,"../core/Common":14}]},{},[28])(28)});
window._requestAF=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(d,a){window.setTimeout(d,1E3/60)}}();function Point(d,a){d||(d=0);a||(a=0);this.x=d;this.y=a}Point.prototype.add=function(d){return new Point(this.x+d.x,this.y+d.y)};Point.prototype.clone=function(){return new Point(this.x,this.y)};Point.prototype.copyFrom=function(d){this.x=d.x;this.y=d.y};
Point.prototype.equals=function(d){return this.x==d.x&&this.y==d.y};Point.prototype.normalize=function(d){var a=Math.sqrt(this.x*this.x+this.y*this.y);this.x*=d/a;this.y*=d/a};Point.prototype.offset=function(d,a){this.x+=d;this.y+=a};Point.prototype.setTo=function(d,a){this.x=d;this.y=a};Point.prototype.subtract=function(d){return new Point(this.x-d.x,this.y-d.y)};Point.distance=function(d,a){return Point._distance(d.x,d.y,a.x,a.y)};
Point.interpolate=function(d,a,b){return new Point(d.x+b*(a.x-d.x),d.y+b*(a.y-d.y))};Point.polar=function(d,a){return new Point(d*Math.cos(a),d*Math.sin(a))};Point._distance=function(d,a,b,e){return Math.sqrt((b-d)*(b-d)+(e-a)*(e-a))};Point._v4={};Point._m4={};Point._v4.create=function(){return new Float32Array(4)};Point._m4.create=function(d){var a=new Float32Array(16);a[0]=a[5]=a[10]=a[15]=1;d&&Point._m4.set(d,a);return a};
Point._v4.add=function(d,a,b){b[0]=d[0]+a[0];b[1]=d[1]+a[1];b[2]=d[2]+a[2];b[3]=d[3]+a[3]};Point._v4.set=function(d,a){a[0]=d[0];a[1]=d[1];a[2]=d[2];a[3]=d[3]};Point._m4.set=function(d,a){a[0]=d[0];a[1]=d[1];a[2]=d[2];a[3]=d[3];a[4]=d[4];a[5]=d[5];a[6]=d[6];a[7]=d[7];a[8]=d[8];a[9]=d[9];a[10]=d[10];a[11]=d[11];a[12]=d[12];a[13]=d[13];a[14]=d[14];a[15]=d[15]};
Point._m4.multiply=function(d,a,b){var e=d[0],c=d[1],f=d[2],h=d[3],k=d[4],g=d[5],r=d[6],m=d[7],w=d[8],u=d[9],p=d[10],q=d[11],z=d[12],x=d[13],t=d[14];d=d[15];var l=a[0],v=a[1],A=a[2],y=a[3];b[0]=l*e+v*k+A*w+y*z;b[1]=l*c+v*g+A*u+y*x;b[2]=l*f+v*r+A*p+y*t;b[3]=l*h+v*m+A*q+y*d;l=a[4];v=a[5];A=a[6];y=a[7];b[4]=l*e+v*k+A*w+y*z;b[5]=l*c+v*g+A*u+y*x;b[6]=l*f+v*r+A*p+y*t;b[7]=l*h+v*m+A*q+y*d;l=a[8];v=a[9];A=a[10];y=a[11];b[8]=l*e+v*k+A*w+y*z;b[9]=l*c+v*g+A*u+y*x;b[10]=l*f+v*r+A*p+y*t;b[11]=l*h+v*m+A*q+y*d;
l=a[12];v=a[13];A=a[14];y=a[15];b[12]=l*e+v*k+A*w+y*z;b[13]=l*c+v*g+A*u+y*x;b[14]=l*f+v*r+A*p+y*t;b[15]=l*h+v*m+A*q+y*d;return b};
Point._m4.inverse=function(d,a){var b=d[0],e=d[1],c=d[2],f=d[3],h=d[4],k=d[5],g=d[6],r=d[7],m=d[8],w=d[9],u=d[10],p=d[11],q=d[12],z=d[13],x=d[14],t=d[15],l=b*k-e*h,v=b*g-c*h,A=b*r-f*h,y=e*g-c*k,C=e*r-f*k,F=c*r-f*g,E=m*z-w*q,I=m*x-u*q,D=m*t-p*q,B=w*x-u*z,G=w*t-p*z,J=u*t-p*x,H=l*J-v*G+A*B+y*D-C*I+F*E;if(!H)return null;H=1/H;a[0]=(k*J-g*G+r*B)*H;a[1]=(c*G-e*J-f*B)*H;a[2]=(z*F-x*C+t*y)*H;a[3]=(u*C-w*F-p*y)*H;a[4]=(g*D-h*J-r*I)*H;a[5]=(b*J-c*D+f*I)*H;a[6]=(x*A-q*F-t*v)*H;a[7]=(m*F-u*A+p*v)*H;a[8]=(h*G-
k*D+r*E)*H;a[9]=(e*D-b*G-f*E)*H;a[10]=(q*C-z*A+t*l)*H;a[11]=(w*A-m*C-p*l)*H;a[12]=(k*I-h*B-g*E)*H;a[13]=(b*B-e*I+c*E)*H;a[14]=(z*v-q*y-x*l)*H;a[15]=(m*y-w*v+u*l)*H;return a};Point._m4.multiplyVec2=function(d,a,b){var e=a[0];a=a[1];b[0]=e*d[0]+a*d[4]+d[12];b[1]=e*d[1]+a*d[5]+d[13]};Point._m4.multiplyVec4=function(d,a,b){var e=a[0],c=a[1],f=a[2];a=a[3];b[0]=d[0]*e+d[4]*c+d[8]*f+d[12]*a;b[1]=d[1]*e+d[5]*c+d[9]*f+d[13]*a;b[2]=d[2]*e+d[6]*c+d[10]*f+d[14]*a;b[3]=d[3]*e+d[7]*c+d[11]*f+d[15]*a};
function Rectangle(d,a,b,e){d||(d=0);a||(a=0);b||(b=0);e||(e=0);this.x=d;this.y=a;this.width=b;this.height=e}Rectangle.prototype.clone=function(){return new Rectangle(this.x,this.y,this.width,this.height)};Rectangle.prototype.contains=function(d,a){return d>=this.x&&d<=this.x+this.width&&a>=this.y&&a<=this.y+this.height};Rectangle.prototype.containsPoint=function(d){return this.contains(d.x,d.y)};
Rectangle.prototype.containsRect=function(d){return this.x<=d.x&&this.y<=d.y&&d.x+d.width<=this.x+this.width&&d.y+d.height<=this.y+this.height};Rectangle.prototype.copyFrom=function(d){this.x=d.x;this.y=d.y;this.width=d.width;this.height=d.height};Rectangle.prototype.equals=function(d){return this.x==d.x&&this.y==d.y&&this.width==d.width&&this.height==d.height};Rectangle.prototype.inflate=function(d,a){this.x-=d;this.y-=a;this.width+=2*d;this.height+=2*a};
Rectangle.prototype.inflatePoint=function(d){this.inflate(d.x,d.y)};Rectangle.prototype.intersection=function(d){var a=Math.max(this.x,d.x),b=Math.max(this.y,d.y),e=Math.min(this.x+this.width,d.x+d.width);d=Math.min(this.y+this.height,d.y+d.height);return e<a||d<b?new Rectangle:new Rectangle(a,b,e-a,d-b)};Rectangle.prototype.intersects=function(d){return d.y+d.height<this.y||d.x>this.x+this.width||d.y>this.y+this.height||d.x+d.width<this.x?!1:!0};
Rectangle.prototype.isEmpty=function(){return 0>=this.width||0>=this.height};Rectangle.prototype.offset=function(d,a){this.x+=d;this.y+=a};Rectangle.prototype.offsetPoint=function(d){this.offset(d.x,d.y)};Rectangle.prototype.setEmpty=function(){this.x=this.y=this.width=this.height=0};Rectangle.prototype.setTo=function(d,a,b,e){this.x=d;this.y=a;this.width=b;this.height=e};
Rectangle.prototype.union=function(d){if(this.isEmpty())return d.clone();if(d.isEmpty())return this.clone();var a=this.clone();a._unionWith(d);return a};Rectangle._temp=new Float32Array(2);Rectangle.prototype._unionWith=function(d){d.isEmpty()||(this.isEmpty()?this.copyFrom(d):(this._unionWP(d.x,d.y),this._unionWP(d.x+d.width,d.y+d.height)))};
Rectangle.prototype._unionWP=function(d,a){var b=Math.min(this.x,d),e=Math.min(this.y,a);this.width=Math.max(this.x+this.width,d)-b;this.height=Math.max(this.y+this.height,a)-e;this.x=b;this.y=e};Rectangle.prototype._unionWL=function(d,a,b,e){0==this.width&&0==this.height?this._setP(d,a):this._unionWP(d,a);this._unionWP(b,e)};Rectangle.prototype._setP=function(d,a){this.x=d;this.y=a;this.width=this.height=0};
function Transform(){this._obj=null;this._vdirty=this._mdirty=!1;this._tmat=Point._m4.create();this._imat=Point._m4.create();this._atmat=Point._m4.create();this._aimat=Point._m4.create();this._pscal=Point._m4.create();this._cmat=Point._m4.create();this._cvec=Point._v4.create();this._cID=!0;this._scaleZ=this._scaleY=this._scaleX=1;this._rotationZ=this._rotationY=this._rotationX=0}Transform.prototype._getTMat=function(){var d=this._obj,a=this._tmat;this._checkMat();a[12]=d.x;a[13]=d.y;a[14]=d.z;return a};
Transform.prototype._getIMat=function(){Point._m4.inverse(this._getTMat(),this._imat);return this._imat};Transform.prototype._postScale=function(d,a){this._checkMat();var b=this._pscal;b[10]=b[15]=1;b[0]=d;b[5]=a;Point._m4.multiply(b,this._tmat,this._tmat);this._vdirty=!0};
Transform.prototype._valsToMat=function(){var d=this._tmat,a=this._scaleX,b=this._scaleY,e=this._scaleZ,c=-.01745329252*this._rotationX,f=-.01745329252*this._rotationY,h=-.01745329252*this._rotationZ,k=Math.cos(c),g=Math.cos(f),r=Math.cos(h),c=Math.sin(c),f=Math.sin(f),h=Math.sin(h);d[0]=g*r*a;d[1]=-g*h*a;d[2]=f*a;d[4]=(k*h+c*f*r)*b;d[5]=(k*r-c*f*h)*b;d[6]=-c*g*b;d[8]=(c*h-k*f*r)*e;d[9]=(c*r+k*f*h)*e;d[10]=k*g*e};
Transform.prototype._matToVals=function(){var d=this._tmat,a=d[0],b=d[1],e=d[2],c=d[4],f=d[5],h=d[6],k=d[8],g=d[9],d=d[10];this._scaleX=Math.sqrt(a*a+b*b+e*e);this._scaleY=Math.sqrt(c*c+f*f+h*h);this._scaleZ=Math.sqrt(k*k+g*g+d*d);c=1/this._scaleX;f=1/this._scaleY;k=1/this._scaleZ;h*=f;d*=k;this._rotationX=-57.29577951308*Math.atan2(-h,d);this._rotationY=-57.29577951308*Math.atan2(e*c,Math.sqrt(h*h+d*d));this._rotationZ=-57.29577951308*Math.atan2(-(b*c),a*c)};
Transform.prototype._checkVals=function(){this._vdirty&&(this._matToVals(),this._vdirty=!1)};Transform.prototype._checkMat=function(){this._mdirty&&(this._valsToMat(),this._mdirty=!1)};Transform.prototype._setOPos=function(d){d=this._tmat;this._obj.x=d[12];this._obj.y=d[13];this._obj.z=d[14]};
Transform.prototype._checkColorID=function(){var d=this._cmat,a=this._cvec;this._cID=1==d[15]&&1==d[0]&&0==d[1]&&0==d[2]&&0==d[3]&&0==d[4]&&1==d[5]&&0==d[6]&&0==d[7]&&0==d[8]&&0==d[9]&&1==d[10]&&0==d[11]&&0==d[12]&&0==d[13]&&0==d[14]&&1==d[15]&&0==a[0]&&0==a[1]&&0==a[2]&&0==a[3]};Transform.prototype._setMat3=function(d){var a=this._tmat;a[0]=d[0];a[1]=d[1];a[4]=d[3];a[5]=d[4];a[12]=d[6];a[13]=d[7]};
Transform.prototype._getMat3=function(d){var a=this._tmat;d[0]=a[0];d[1]=a[1];d[3]=a[4];d[4]=a[5];d[6]=a[12];d[7]=a[13]};Transform.prototype._setCMat5=function(d){for(var a=this._cmat,b=this._cvec,e=0;4>e;e++){b[e]=d[20+e];for(var c=0;4>c;c++)a[4*e+c]=d[5*e+c]}};Transform.prototype._getCMat5=function(d){var a=this._cmat,b=this._cvec;d[24]=1;for(var e=0;4>e;e++){d[20+e]=b[e];for(var c=0;4>c;c++)d[5*e+c]=a[4*e+c]}};
Transform.prototype.__defineSetter__("matrix",function(d){this._checkMat();this._setMat3(d);this._setOPos();this._vdirty=!0});Transform.prototype.__defineGetter__("matrix",function(){this._checkMat();var d=new Float32Array(9);this._getMat3(d);return d});Transform.prototype.__defineSetter__("matrix3D",function(d){this._checkMat();Point._m4.set(d,this._tmat);this._setOPos();this._vdirty=!0});Transform.prototype.__defineGetter__("matrix3D",function(){this._checkMat();return Point._m4.create(this._getTMat())});
Transform.prototype.__defineSetter__("colorTransform",function(d){this._setCMat5(d);this._checkColorID()});Transform.prototype.__defineGetter__("colorTransform",function(){var d=new Float32Array(25);this._getCMat5(d);return d});function EventDispatcher(){this.lsrs={};this.cals={}}EventDispatcher.efbc=[];EventDispatcher.prototype.hasEventListener=function(d){d=this.lsrs[d];return null==d?!1:0<d.length};EventDispatcher.prototype.addEventListener=function(d,a){this.addEventListener2(d,a,null)};
EventDispatcher.prototype.addEventListener2=function(d,a,b){null==this.lsrs[d]&&(this.lsrs[d]=[],this.cals[d]=[]);this.lsrs[d].push(a);this.cals[d].push(b);d==Event.ENTER_FRAME&&(d=EventDispatcher.efbc,0>d.indexOf(this)&&d.push(this))};EventDispatcher.prototype.removeEventListener=function(d,a){var b=this.lsrs[d];if(null!=b){var e=b.indexOf(a);if(!(0>e)){var c=this.cals[d];b.splice(e,1);c.splice(e,1);d==Event.ENTER_FRAME&&0==b.length&&(b=EventDispatcher.efbc,b.splice(b.indexOf(this),1))}}};
EventDispatcher.prototype.dispatchEvent=function(d){d.currentTarget=this;null==d.target&&(d.target=this);var a=this.lsrs[d.type];if(null!=a)for(var b=this.cals[d.type],e=0;e<a.length;e++)if(null==b[e])a[e](d);else a[e].call(b[e],d)};function Event(d,a){a||(a=!1);this.type=d;this.currentTarget=this.target=null;this.bubbles=a}Event.ENTER_FRAME="enterFrame";Event.RESIZE="resize";Event.ADDED_TO_STAGE="addedToStage";Event.REMOVED_FROM_STAGE="removedFromStage";Event.CHANGE="change";Event.OPEN="open";
Event.PROGRESS="progress";Event.COMPLETE="complete";function MouseEvent(d,a){Event.call(this,d,a);this.movementY=this.movementX=0}MouseEvent.prototype=new Event;MouseEvent.CLICK="click";MouseEvent.MOUSE_DOWN="mouseDown";MouseEvent.MOUSE_UP="mouseUp";MouseEvent.MIDDLE_CLICK="middleClick";MouseEvent.MIDDLE_MOUSE_DOWN="middleMouseDown";MouseEvent.MIDDLE_MOUSE_UP="middleMouseUp";MouseEvent.RIGHT_CLICK="rightClick";MouseEvent.RIGHT_MOUSE_DOWN="rightMouseDown";MouseEvent.RIGHT_MOUSE_UP="rightMouseUp";
MouseEvent.MOUSE_MOVE="mouseMove";MouseEvent.MOUSE_OVER="mouseOver";MouseEvent.MOUSE_OUT="mouseOut";function TouchEvent(d,a){Event.call(this,d,a);this.stageY=this.stageX=0;this.touchPointID=-1}TouchEvent.prototype=new Event;TouchEvent.prototype._setFromDom=function(d){var a=window.devicePixelRatio||1;this.stageX=d.clientX*a;this.stageY=d.clientY*a;this.touchPointID=d.identifier};TouchEvent.TOUCH_BEGIN="touchBegin";TouchEvent.TOUCH_END="touchEnd";TouchEvent.TOUCH_MOVE="touchMove";
TouchEvent.TOUCH_OUT="touchOut";TouchEvent.TOUCH_OVER="touchOver";TouchEvent.TOUCH_TAP="touchTap";function KeyboardEvent(d,a){Event.call(this,d,a);this.shiftKey=this.ctrlKey=this.altKey=!1;this.charCode=this.keyCode=0}KeyboardEvent.prototype=new Event;KeyboardEvent.prototype._setFromDom=function(d){this.altKey=d.altKey;this.ctrlKey=d.ctrlKey;this.shiftKey=d.shiftKey;this.keyCode=d.keyCode;this.charCode=d.charCode};KeyboardEvent.KEY_DOWN="keyDown";KeyboardEvent.KEY_UP="keyUp";
var BlendMode={NORMAL:"normal",ADD:"add",SUBTRACT:"subtract",MULTIPLY:"multiply",SCREEN:"screen",ERASE:"erase",ALPHA:"alpha"};
function DisplayObject(){EventDispatcher.call(this);this.visible=!0;this.stage=this.parent=null;this.transform=new Transform;this.transform._obj=this;this.blendMode=BlendMode.NORMAL;this.z=this.y=this.x=0;this._trect=new Rectangle;this._tempP=new Point;this._torg=Point._v4.create();this._tvec4_0=Point._v4.create();this._tvec4_1=Point._v4.create();this._tempm=Point._m4.create();this._atsEv=new Event(Event.ADDED_TO_STAGE);this._rfsEv=new Event(Event.REMOVED_FROM_STAGE);this._atsEv.target=this._rfsEv.target=
this}DisplayObject.prototype=new EventDispatcher;DisplayObject.prototype.dispatchEvent=function(d){EventDispatcher.prototype.dispatchEvent.call(this,d);d.bubbles&&null!=this.parent&&this.parent.dispatchEvent(d)};DisplayObject.prototype._globalToLocal=function(d,a){var b=this._torg;Stage._main._getOrigin(b);Point._m4.multiplyVec4(this._getAIMat(),b,b);var e=this._tvec4_1;e[0]=d.x;e[1]=d.y;e[2]=0;e[3]=1;Point._m4.multiplyVec4(this._getAIMat(),e,e);this._lineIsc(b,e,a)};
DisplayObject.prototype.globalToLocal=function(d){var a=new Point;this._globalToLocal(d,a);return a};DisplayObject.prototype.localToGlobal=function(d){var a=this._torg;Stage._main._getOrigin(a);var b=this._tvec4_1;b[0]=d.x;b[1]=d.y;b[2]=0;b[3]=1;Point._m4.multiplyVec4(this._getATMat(),b,b);d=new Point;this._lineIsc(a,b,d);return d};DisplayObject.prototype._lineIsc=function(d,a,b){var e=a[0]-d[0],c=a[1]-d[1],f=a[2]-d[2];a=Math.sqrt(e*e+c*c+f*f);f=-d[2]/(f/a);b.x=d[0]+e/a*f;b.y=d[1]+c/a*f};
DisplayObject.prototype._transfRect=function(d,a,b,e){var c=this._tvec4_0,f=this._tvec4_1,h=new Point,k=Infinity,g=Infinity,r=-Infinity,m=-Infinity;c[0]=b.x;c[1]=b.y;c[2]=0;c[3]=1;Point._m4.multiplyVec4(d,c,f);this._lineIsc(a,f,h);k=Math.min(k,h.x);g=Math.min(g,h.y);r=Math.max(r,h.x);m=Math.max(m,h.y);c[0]=b.x+b.width;c[1]=b.y;c[2]=0;c[3]=1;Point._m4.multiplyVec4(d,c,f);this._lineIsc(a,f,h);k=Math.min(k,h.x);g=Math.min(g,h.y);r=Math.max(r,h.x);m=Math.max(m,h.y);c[0]=b.x;c[1]=b.y+b.height;c[2]=0;c[3]=
1;Point._m4.multiplyVec4(d,c,f);this._lineIsc(a,f,h);k=Math.min(k,h.x);g=Math.min(g,h.y);r=Math.max(r,h.x);m=Math.max(m,h.y);c[0]=b.x+b.width;c[1]=b.y+b.height;c[2]=0;c[3]=1;Point._m4.multiplyVec4(d,c,f);this._lineIsc(a,f,h);k=Math.min(k,h.x);g=Math.min(g,h.y);r=Math.max(r,h.x);m=Math.max(m,h.y);e.x=k;e.y=g;e.width=r-k;e.height=m-g};DisplayObject.prototype._getLocRect=function(){};
DisplayObject.prototype._getRect=function(d,a,b){Point._m4.multiply(d,this._getATMat(),this._tempm);this._transfRect(this._tempm,a,this._getLocRect(),this._trect);return this._trect};DisplayObject.prototype._getR=function(d,a){Stage._main._getOrigin(this._torg);Point._m4.multiplyVec4(d._getAIMat(),this._torg,this._torg);return this._getRect(d._getAIMat(),this._torg,a)};
DisplayObject.prototype._getParR=function(d,a){null==DisplayObject._tdo&&(DisplayObject._tdo=new DisplayObject);var b=null==this.parent;b&&(this.parent=DisplayObject._tdo);var e=this._getR(this.parent,a);b&&(this.parent=null);return e};DisplayObject.prototype.getRect=function(d){return this._getR(d,!1).clone()};DisplayObject.prototype.getBounds=function(d){return this._getR(d,!0).clone()};
DisplayObject.prototype._htpLocal=function(d,a){var b=this._tempP;this._lineIsc(d,a,b);return this._getLocRect().contains(b.x,b.y)};DisplayObject.prototype.hitTestPoint=function(d,a,b){null==b&&(b=!1);var e=this._torg;Stage._main._getOrigin(e);Point._m4.multiplyVec4(this._getAIMat(),e,e);var c=this._tvec4_1;c[0]=d;c[1]=a;c[2]=0;c[3]=1;Point._m4.multiplyVec4(this._getAIMat(),c,c);return b?this._htpLocal(e,c):this._getR(Stage._main,!1).contains(d,a)};
DisplayObject.prototype.hitTestObject=function(d){var a=this._getR(Stage._main,!1);d=d._getR(Stage._main,!1);return a.intersects(d)};DisplayObject.prototype._loseFocus=function(){};DisplayObject.prototype._getTarget=function(d,a){return null};DisplayObject.prototype._setStage=function(d){var a=this.stage;this.stage=d;null==a&&null!=d&&this.dispatchEvent(this._atsEv);null!=a&&null==d&&this.dispatchEvent(this._rfsEv)};
DisplayObject.prototype._preRender=function(d){var a=this.transform._getTMat();d._mstack.push(a);d._cmstack.push(this.transform._cmat,this.transform._cvec,this.transform._cID,this.blendMode)};DisplayObject.prototype._render=function(d){};DisplayObject.prototype._renderAll=function(d){this.visible&&(this._preRender(d),this._render(d),d._mstack.pop(),d._cmstack.pop())};
DisplayObject.prototype._getATMat=function(){if(null==this.parent)return this.transform._getTMat();Point._m4.multiply(this.parent._getATMat(),this.transform._getTMat(),this.transform._atmat);return this.transform._atmat};DisplayObject.prototype._getAIMat=function(){if(null==this.parent)return this.transform._getIMat();Point._m4.multiply(this.transform._getIMat(),this.parent._getAIMat(),this.transform._aimat);return this.transform._aimat};
DisplayObject.prototype._getMouse=function(){var d=this._tempP;d.setTo(Stage._mouseX,Stage._mouseY);this._globalToLocal(d,d);return d};this.dp=DisplayObject.prototype;dp.ds=dp.__defineSetter__;dp.dg=dp.__defineGetter__;dp.ds("scaleX",function(d){this.transform._checkVals();this.transform._scaleX=d;this.transform._mdirty=!0});dp.ds("scaleY",function(d){this.transform._checkVals();this.transform._scaleY=d;this.transform._mdirty=!0});
dp.ds("scaleZ",function(d){this.transform._checkVals();this.transform._scaleZ=d;this.transform._mdirty=!0});dp.dg("scaleX",function(){this.transform._checkVals();return this.transform._scaleX});dp.dg("scaleY",function(){this.transform._checkVals();return this.transform._scaleY});dp.dg("scaleZ",function(){this.transform._checkVals();return this.transform._scaleZ});dp.ds("rotationX",function(d){this.transform._checkVals();this.transform._rotationX=d;this.transform._mdirty=!0});
dp.ds("rotationY",function(d){this.transform._checkVals();this.transform._rotationY=d;this.transform._mdirty=!0});dp.ds("rotationZ",function(d){this.transform._checkVals();this.transform._rotationZ=d;this.transform._mdirty=!0});dp.ds("rotation",function(d){this.transform._checkVals();this.transform._rotationZ=d;this.transform._mdirty=!0});dp.dg("rotationX",function(){this.transform._checkVals();return this.transform._rotationX});dp.dg("rotationY",function(){this.transform._checkVals();return this.transform._rotationY});
dp.dg("rotationZ",function(){this.transform._checkVals();return this.transform._rotationZ});dp.dg("rotation",function(){this.transform._checkVals();return this.transform._rotationZ});dp.ds("width",function(d){this.transform._postScale(d/this.width,1)});dp.ds("height",function(d){this.transform._postScale(1,d/this.height)});dp.dg("width",function(){this.transform._checkVals();return this._getParR(this,!0).width});dp.dg("height",function(){this.transform._checkVals();return this._getParR(this,!0).height});
dp.ds("alpha",function(d){this.transform._cmat[15]=d;this.transform._checkColorID()});dp.dg("alpha",function(){return this.transform._cmat[15]});dp.dg("mouseX",function(){return this._getMouse().x});dp.dg("mouseY",function(){return this._getMouse().y});delete dp.ds;delete dp.dg;delete this.dp;function InteractiveObject(){DisplayObject.call(this);this.buttonMode=!1;this.mouseChildren=this.mouseEnabled=!0}InteractiveObject.prototype=new DisplayObject;
InteractiveObject.prototype._getTarget=function(d,a){if(!this.visible||!this.mouseEnabled)return null;var b=this._getLocRect();if(null==b)return null;var e=this._tvec4_0,c=this._tvec4_1;Point._m4.multiplyVec4(this.transform._getIMat(),d,e);Point._m4.multiplyVec4(this.transform._getIMat(),a,c);var f=this._tempP;this._lineIsc(e,c,f);return b.contains(f.x,f.y)?this:null};function DisplayObjectContainer(){InteractiveObject.call(this);this._tempR=new Rectangle;this.numChildren=0;this._children=[]}
DisplayObjectContainer.prototype=new InteractiveObject;DisplayObjectContainer.prototype._getRect=function(d,a,b){var e=this._trect;e.setEmpty();for(var c=0;c<this.numChildren;c++){var f=this._children[c];f.visible&&e._unionWith(f._getRect(d,a,b))}return e};
DisplayObjectContainer.prototype._htpLocal=function(d,a){for(var b=this._children.length,e=0;e<b;e++){var c=this._children[e];if(c.visible){var b=c._tvec4_0,e=c._tvec4_1,f=c.transform._getIMat();Point._m4.multiplyVec4(f,d,b);Point._m4.multiplyVec4(f,a,e);return c._htpLocal(b,e)}}return!1};DisplayObjectContainer.prototype.addChild=function(d){this._children.push(d);d.parent=this;d._setStage(this.stage);++this.numChildren};
DisplayObjectContainer.prototype.removeChild=function(d){var a=this._children.indexOf(d);0>a||(this._children.splice(a,1),d.parent=null,d._setStage(null),--this.numChildren)};DisplayObjectContainer.prototype.removeChildAt=function(d){this.removeChild(this._children[d])};DisplayObjectContainer.prototype.contains=function(d){return 0<=this._children.indexOf(d)};DisplayObjectContainer.prototype.getChildIndex=function(d){return this._children.indexOf(d)};
DisplayObjectContainer.prototype.setChildIndex=function(d,a){var b=this._children.indexOf(d);if(a>b){for(b+=1;b<=a;b++)this._children[b-1]=this._children[b];this._children[a]=d}else if(a<b){for(--b;b>=a;b--)this._children[b+1]=this._children[b];this._children[a]=d}};DisplayObjectContainer.prototype.getChildAt=function(d){return this._children[d]};DisplayObjectContainer.prototype._render=function(d){for(var a=0;a<this.numChildren;a++)this._children[a]._renderAll(d)};
DisplayObjectContainer.prototype._getTarget=function(d,a){if(!this.visible||!this.mouseChildren&&!this.mouseEnabled)return null;var b=this._tvec4_0,e=this._tvec4_1,c=this.transform._getIMat();Point._m4.multiplyVec4(c,d,b);Point._m4.multiplyVec4(c,a,e);for(var c=null,f=this.numChildren-1;-1<f;f--){var h=this._children[f]._getTarget(b,e);if(null!=h){c=h;break}}return this.mouseChildren||null==c?c:this};
DisplayObjectContainer.prototype._setStage=function(d){InteractiveObject.prototype._setStage.call(this,d);for(var a=0;a<this.numChildren;a++)this._children[a]._setStage(d)};
function BitmapData(d){this.height=this.width=0;this.rect=new Rectangle;this.loader=new EventDispatcher;this.loader.bitmapData=this;this._rheight=this._rwidth=0;this._vBuffer=this._tcBuffer=this._texture=this._rrect=null;this._loaded=!1;this._dirty=!0;this._gpuAllocated=!1;this._ubuffer=this._buffer=null;if(null!=d){var a=document.createElement("img");a.crossOrigin="Anonymous";a.onload=function(b){this._initFromImg(a,a.width,a.height);b=new Event(Event.COMPLETE);this.loader.dispatchEvent(b)}.bind(this);
a.src=d}}BitmapData.empty=function(d,a,b){null==b&&(b=4294967295);var e=new BitmapData(null);e._initFromImg(null,d,a,b);return e};BitmapData.prototype.setPixel=function(d,a,b){d=a*this.width+d;a=this._ubuffer;a[d]=(a[d]&4278190080)+b;this._dirty=!0};BitmapData.prototype.setPixel32=function(d,a,b){this._ubuffer[a*this.width+d]=b;this._dirty=!0};BitmapData.prototype.setPixels=function(d,a){this._copyRectBuff(a,d,this._buffer,this.rect);this._dirty=!0};
BitmapData.prototype.getPixel=function(d,a){return this._ubuffer[a*this.width+d]&16777215};BitmapData.prototype.getPixel32=function(d,a){return this._ubuffer[a*this.width+d]};BitmapData.prototype.getPixels=function(d,a){a||(a=new Uint8Array(d.width*d.height*4));this._copyRectBuff(this._buffer,this.rect,a,d);return a};
BitmapData.prototype.draw=function(d){this._dirty&&this._syncWithGPU();this._setTexAsFB();Stage._setTEX(null);d._render(Stage._main);d=this.rect;gl.readPixels(d.x,d.y,d.width,d.height,gl.RGBA,gl.UNSIGNED_BYTE,this._buffer);Stage._main._setFramebuffer(null,Stage._main.stageWidth,Stage._main.stageHeight,!1);Stage._setTEX(this._texture);gl.generateMipmap(gl.TEXTURE_2D)};
BitmapData.prototype._syncWithGPU=function(){var d=this.rect,a=this._buffer;if(!this._gpuAllocated){var b=d.width,e=d.height,c=b/this._rwidth,f=e/this._rheight;this._texture=gl.createTexture();this._tcBuffer=gl.createBuffer();this._vBuffer=gl.createBuffer();Stage._setBF(this._tcBuffer);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([0,0,c,0,0,f,c,f]),gl.STATIC_DRAW);Stage._setBF(this._vBuffer);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([0,0,0,b,0,0,0,e,0,b,e,0]),gl.STATIC_DRAW);b=new Uint8Array(this._rwidth*
this._rheight*4);e=new Uint32Array(b.buffer);for(c=0;c<e.length;c++)e[c]=16777215;Stage._setTEX(this._texture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,this._rwidth,this._rheight,0,gl.RGBA,gl.UNSIGNED_BYTE,b);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_LINEAR);this._gpuAllocated=!0}Stage._setTEX(this._texture);gl.texSubImage2D(gl.TEXTURE_2D,0,d.x,d.y,d.width,d.height,gl.RGBA,gl.UNSIGNED_BYTE,a);gl.generateMipmap(gl.TEXTURE_2D);
this._dirty=!1};BitmapData.prototype._setTexAsFB=function(){if(null==BitmapData._fbo){BitmapData._fbo=gl.createFramebuffer();var d=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,d);gl.bindFramebuffer(gl.FRAMEBUFFER,BitmapData._fbo);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,d)}Stage._main._setFramebuffer(BitmapData._fbo,this._rwidth,this._rheight,!0);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this._texture,0)};
BitmapData.prototype._initFromImg=function(d,a,b,e){this._loaded=!0;this.width=a;this.height=b;this.rect=new Rectangle(0,0,a,b);this._rwidth=BitmapData._nhpot(a);this._rheight=BitmapData._nhpot(b);this._rrect=new Rectangle(0,0,this._rwidth,this._rheight);var c=BitmapData._canv;c.width=a;c.height=b;c=BitmapData._ctx;null!=d&&c.drawImage(d,0,0);a=c.getImageData(0,0,a,b);this._buffer=window.CanvasPixelArray&&a.data instanceof CanvasPixelArray?new Uint8Array(a.data):new Uint8Array(a.data.buffer);this._ubuffer=
new Uint32Array(this._buffer.buffer);if(null==d)for(d=0,a=this._ubuffer;d<a.length;d++)a[d]=e};BitmapData.prototype._copyRectBuff=function(d,a,b,e){d=new Uint32Array(d.buffer);b=new Uint32Array(b.buffer);for(var c=a.intersection(e),f=Math.max(0,c.x-a.x),h=Math.max(0,c.x-e.x),k=Math.max(0,c.y-a.y),g=Math.max(0,c.y-e.y),r=c.width,c=c.height,m=0;m<c;m++)for(var w=(k+m)*a.width+f,u=(g+m)*e.width+h,p=0;p<r;p++)b[u++]=d[w++]};BitmapData._canv=document.createElement("canvas");BitmapData._ctx=BitmapData._canv.getContext("2d");
BitmapData._ipot=function(d){return 0==(d&d-1)};BitmapData._nhpot=function(d){--d;for(var a=1;32>a;a<<=1)d|=d>>a;return d+1};function Bitmap(d){DisplayObject.call(this);this.bitmapData=d}Bitmap.prototype=new InteractiveObject;Bitmap.prototype._getLocRect=function(){return this.bitmapData.rect};
Bitmap.prototype._render=function(d){var a=this.bitmapData;a._loaded&&(a._dirty&&a._syncWithGPU(),gl.uniformMatrix4fv(d._sprg.tMatUniform,!1,d._mstack.top()),d._cmstack.update(),Stage._setVC(a._vBuffer),Stage._setTC(a._tcBuffer),Stage._setUT(1),Stage._setTEX(a._texture),Stage._setEBF(d._unitIBuffer),gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0))};var gl;
function Stage(d,a){DisplayObjectContainer.call(this);document.body.setAttribute("style","margin:0; overflow:hidden");var b=document.createElement("meta");b.setAttribute("name","viewport");b.setAttribute("content","width=device-width, minimum-scale=1.0, maximum-scale=1.0, initial-scale=1.0");document.getElementsByTagName("head")[0].appendChild(b);this.stage=this;this.stageHeight=this.stageWidth=0;this.focus=null;this._focii=[null,null,null];this._mousefocus=null;this._knM=!1;this._mstack=new Stage._MStack;
this._cmstack=new Stage._CMStack;this._sprg=null;this._svec4_0=Point._v4.create();this._svec4_1=Point._v4.create();this._pmat=Point._m4.create([1,0,0,0,0,1,0,0,0,0,1,1,0,0,0,1]);this._umat=Point._m4.create([2,0,0,0,0,-2,0,0,0,0,2,0,-1,1,0,1]);this._smat=Point._m4.create([0,0,0,0,0,0,0,0,0,0,.001,0,0,0,0,1]);this._mcEvs=[new MouseEvent(MouseEvent.CLICK,!0),new MouseEvent(MouseEvent.MIDDLE_CLICK,!0),new MouseEvent(MouseEvent.RIGHT_CLICK,!0)];this._mdEvs=[new MouseEvent(MouseEvent.MOUSE_DOWN,!0),new MouseEvent(MouseEvent.MIDDLE_MOUSE_DOWN,
!0),new MouseEvent(MouseEvent.RIGHT_MOUSE_DOWN,!0)];this._muEvs=[new MouseEvent(MouseEvent.MOUSE_UP,!0),new MouseEvent(MouseEvent.MIDDLE_MOUSE_UP,!0),new MouseEvent(MouseEvent.RIGHT_MOUSE_UP,!0)];this._smd=[!1,!1,!1];this._smu=[!1,!1,!1];this._srs=this._smm=!1;this._touches={};this._canvas=this.canvas=document.getElementById(d);Stage._main=this;var e={alpha:!0,antialias:!0,depth:!0,premultipliedAlpha:!0},b=this.canvas;(gl=b.getContext("webgl",e))||(gl=b.getContext("experimental-webgl",e));gl||alert("Could not initialize WebGL. Try to update your browser or graphic drivers.");
gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);e=document;e.addEventListener("contextmenu",Stage._ctxt,!1);e.addEventListener("dragstart",Stage._blck,!1);b.addEventListener("touchstart",Stage._onTD,!1);b.addEventListener("touchmove",Stage._onTM,!1);b.addEventListener("touchend",Stage._onTU,!1);e.addEventListener("touchstart",Stage._blck,!1);b.addEventListener("touchmove",Stage._blck,!1);b.addEventListener("touchend",Stage._blck,!1);b.addEventListener("mousedown",Stage._onMD,!1);b.addEventListener("mousemove",
Stage._onMM,!1);b.addEventListener("mouseup",Stage._onMU,!1);b.addEventListener("mousemove",Stage._blck,!1);b.addEventListener("mouseup",Stage._blck,!1);e.addEventListener("keydown",Stage._onKD,!1);e.addEventListener("keyup",Stage._onKU,!1);e.addEventListener("keydown",Stage._blck,!1);e.addEventListener("keyup",Stage._blck,!1);window.addEventListener("resize",Stage._onRS,!1);this._initShaders();this._initBuffers();gl.clearColor(0,0,0,0);gl.enable(gl.BLEND);gl.blendEquation(gl.FUNC_ADD);gl.blendFunc(gl.ONE,
gl.ONE_MINUS_SRC_ALPHA);gl.enable(gl.DEPTH_TEST);gl.depthFunc(gl.LEQUAL);this._resize(a);this._srs=!0;_requestAF(Stage._tick)}Stage.prototype=new DisplayObjectContainer;Stage.prototype._getOrigin=function(d){d[0]=this.stageWidth/2;d[1]=this.stageHeight/2;d[2]=-500;d[3]=1};Stage._mouseX=0;Stage._mouseY=0;Stage._curBF=-1;Stage._curEBF=-1;Stage._curVC=-1;Stage._curTC=-1;Stage._curUT=-1;Stage._curTEX=-1;Stage._curBMD="normal";
Stage._setBF=function(d){Stage._curBF!=d&&(gl.bindBuffer(gl.ARRAY_BUFFER,d),Stage._curBF=d)};Stage._setEBF=function(d){Stage._curEBF!=d&&(gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,d),Stage._curEBF=d)};Stage._setVC=function(d){Stage._curVC!=d&&(gl.bindBuffer(gl.ARRAY_BUFFER,d),gl.vertexAttribPointer(Stage._main._sprg.vpa,3,gl.FLOAT,!1,0,0),Stage._curVC=Stage._curBF=d)};
Stage._setTC=function(d){Stage._curTC!=d&&(gl.bindBuffer(gl.ARRAY_BUFFER,d),gl.vertexAttribPointer(Stage._main._sprg.tca,2,gl.FLOAT,!1,0,0),Stage._curTC=Stage._curBF=d)};Stage._setUT=function(d){Stage._curUT!=d&&(gl.uniform1i(Stage._main._sprg.useTex,d),Stage._curUT=d)};Stage._setTEX=function(d){Stage._curTEX!=d&&(gl.bindTexture(gl.TEXTURE_2D,d),Stage._curTEX=d)};
Stage._setBMD=function(d){Stage._curBMD!=d&&(d==BlendMode.NORMAL?(gl.blendEquation(gl.FUNC_ADD),gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA)):d==BlendMode.MULTIPLY?(gl.blendEquation(gl.FUNC_ADD),gl.blendFunc(gl.DST_COLOR,gl.ONE_MINUS_SRC_ALPHA)):d==BlendMode.ADD?(gl.blendEquation(gl.FUNC_ADD),gl.blendFunc(gl.ONE,gl.ONE)):d==BlendMode.SUBTRACT?(gl.blendEquationSeparate(gl.FUNC_REVERSE_SUBTRACT,gl.FUNC_ADD),gl.blendFunc(gl.ONE,gl.ONE)):d==BlendMode.SCREEN?(gl.blendEquation(gl.FUNC_ADD),gl.blendFunc(gl.ONE,
gl.ONE_MINUS_SRC_COLOR)):d==BlendMode.ERASE?(gl.blendEquation(gl.FUNC_ADD),gl.blendFunc(gl.ZERO,gl.ONE_MINUS_SRC_ALPHA)):d==BlendMode.ALPHA&&(gl.blendEquation(gl.FUNC_ADD),gl.blendFunc(gl.ZERO,gl.SRC_ALPHA)),Stage._curBMD=d)};Stage._okKeys=[112,113,114,115,116,117,118,119,120,121,122,123,13,16,18,27];Stage._isTD=function(){return!!("ontouchstart"in window)};Stage._ctxt=function(d){Stage._main.hasEventListener(MouseEvent.RIGHT_CLICK)&&d.preventDefault()};
Stage.prototype._getMakeTouch=function(d){var a=this._touches["t"+d];null==a&&(a={touch:null,target:null,act:0},this._touches["t"+d]=a);return a};Stage._onTD=function(d){Stage._setStageMouse(d.touches.item(0));Stage._main._smd[0]=!0;Stage._main._knM=!0;for(var a=Stage._main,b=0;b<d.changedTouches.length;b++){var e=d.changedTouches.item(b),c=a._getMakeTouch(e.identifier);c.touch=e;c.act=1}a._processMouseTouch()};
Stage._onTM=function(d){Stage._setStageMouse(d.touches.item(0));Stage._main._smm=!0;Stage._main._knM=!0;for(var a=Stage._main,b=0;b<d.changedTouches.length;b++){var e=d.changedTouches.item(b),c=a._getMakeTouch(e.identifier);c.touch=e;c.act=2}a._processMouseTouch()};Stage._onTU=function(d){Stage._main._smu[0]=!0;Stage._main._knM=!0;for(var a=Stage._main,b=0;b<d.changedTouches.length;b++){var e=d.changedTouches.item(b),c=a._getMakeTouch(e.identifier);c.touch=e;c.act=3}a._processMouseTouch()};
Stage._onMD=function(d){Stage._setStageMouse(d);Stage._main._smd[d.button]=!0;Stage._main._knM=!0;Stage._main._processMouseTouch()};Stage._onMM=function(d){Stage._setStageMouse(d);Stage._main._smm=!0;Stage._main._knM=!0;Stage._main._processMouseTouch()};Stage._onMU=function(d){Stage._main._smu[d.button]=!0;Stage._main._knM=!0;Stage._main._processMouseTouch()};
Stage._onKD=function(d){var a=Stage._main,b=new KeyboardEvent(KeyboardEvent.KEY_DOWN,!0);b._setFromDom(d);a.focus&&a.focus.stage?a.focus.dispatchEvent(b):a.dispatchEvent(b)};Stage._onKU=function(d){var a=Stage._main,b=new KeyboardEvent(KeyboardEvent.KEY_UP,!0);b._setFromDom(d);a.focus&&a.focus.stage?a.focus.dispatchEvent(b):a.dispatchEvent(b)};Stage._blck=function(d){null!=d.keyCode?"textarea"!=d.target.tagName.toLowerCase()&&-1==Stage._okKeys.indexOf(d.keyCode)&&d.preventDefault():d.preventDefault()};
Stage._onRS=function(d){Stage._main._srs=!0};Stage._getDPR=function(){return window.devicePixelRatio||1};
Stage.prototype._resize=function(d){this.options=this.options||d||null;var a;this.options?(d=Math.round(this.options.w),a=Math.round(this.options.h)):(d=window.innerWidth,a=window.innerHeight);var b=window.devicePixelRatio||1,e=d*b,b=a*b;this._canvas.style.width=d+"px";this._canvas.style.height=a+"px";this.stageWidth=e;this.stageHeight=b;this._canvas.width=e;this._canvas.height=b;this._setFramebuffer(null,e,b,!1)};
Stage.prototype._getShader=function(d,a,b){b=b?d.createShader(d.FRAGMENT_SHADER):d.createShader(d.VERTEX_SHADER);d.shaderSource(b,a);d.compileShader(b);return d.getShaderParameter(b,d.COMPILE_STATUS)?b:(alert(d.getShaderInfoLog(b)),null)};
Stage.prototype._initShaders=function(){var d=this._getShader(gl,"\r\n\t\t\tprecision mediump float;\r\n\t\t\tvarying vec2 texCoord;\r\n\t\t\t\r\n\t\t\tuniform sampler2D uSampler;\r\n\t\t\tuniform vec4 color;\r\n\t\t\tuniform bool useTex;\r\n\t\t\t\r\n\t\t\tuniform mat4 cMat;\r\n\t\t\tuniform vec4 cVec;\r\n\t\t\t\r\n\t\t\tvoid main(void) {\r\n\t\t\t\tvec4 c;\r\n\t\t\t\tif(useTex) { c = texture2D(uSampler, texCoord);  c.xyz *= (1.0/c.w); }\r\n\t\t\t\telse c = color;\r\n\t\t\t\tc = (cMat*c)+cVec;\n\r\n\t\t\t\tc.xyz *= min(c.w, 1.0);\n\r\n\t\t\t\tgl_FragColor = c;\r\n\t\t\t}",!0),
a=this._getShader(gl,"\r\n\t\t\tattribute vec3 verPos;\r\n\t\t\tattribute vec2 texPos;\r\n\t\t\t\r\n\t\t\tuniform mat4 tMat;\r\n\t\t\t\r\n\t\t\tvarying vec2 texCoord;\r\n\t\t\t\r\n\t\t\tvoid main(void) {\r\n\t\t\t\tgl_Position = tMat * vec4(verPos, 1.0);\r\n\t\t\t\ttexCoord = texPos;\r\n\t\t\t}",!1);this._sprg=gl.createProgram();gl.attachShader(this._sprg,a);gl.attachShader(this._sprg,d);gl.linkProgram(this._sprg);gl.getProgramParameter(this._sprg,gl.LINK_STATUS)||alert("Could not initialise shaders");
gl.useProgram(this._sprg);this._sprg.vpa=gl.getAttribLocation(this._sprg,"verPos");this._sprg.tca=gl.getAttribLocation(this._sprg,"texPos");gl.enableVertexAttribArray(this._sprg.tca);gl.enableVertexAttribArray(this._sprg.vpa);this._sprg.tMatUniform=gl.getUniformLocation(this._sprg,"tMat");this._sprg.cMatUniform=gl.getUniformLocation(this._sprg,"cMat");this._sprg.cVecUniform=gl.getUniformLocation(this._sprg,"cVec");this._sprg.samplerUniform=gl.getUniformLocation(this._sprg,"uSampler");this._sprg.useTex=
gl.getUniformLocation(this._sprg,"useTex");this._sprg.color=gl.getUniformLocation(this._sprg,"color")};Stage.prototype._initBuffers=function(){this._unitIBuffer=gl.createBuffer();Stage._setEBF(this._unitIBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,2,3]),gl.STATIC_DRAW)};
Stage.prototype._setFramebuffer=function(d,a,b,e){this._mstack.clear();this._mstack.push(this._pmat,0);e?(this._umat[5]=2,this._umat[13]=-1):(this._umat[5]=-2,this._umat[13]=1);this._mstack.push(this._umat);this._smat[0]=1/a;this._smat[5]=1/b;this._mstack.push(this._smat);gl.bindFramebuffer(gl.FRAMEBUFFER,d);d&&gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_COMPONENT16,a,b);gl.viewport(0,0,a,b)};
Stage._setStageMouse=function(d){var a=Stage._getDPR();Stage._mouseX=d.clientX*a;Stage._mouseY=d.clientY*a};Stage.prototype._drawScene=function(){this._srs&&(this._resize(),this.dispatchEvent(new Event(Event.RESIZE)),this._srs=!1);gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);for(var d=EventDispatcher.efbc,a=new Event(Event.ENTER_FRAME,!1),b=0;b<d.length;b++)a.target=d[b],d[b].dispatchEvent(a);this._renderAll(this)};
Stage.prototype._processMouseTouch=function(){if(this._knM){var d=this._svec4_0;this._getOrigin(d);var a=this._svec4_1;a[0]=Stage._mouseX;a[1]=Stage._mouseY;a[2]=0;a[3]=1;var a=this._getTarget(d,a),b=this._mousefocus||this,d=a||this;if(a!=this._mousefocus){if(b!=this){var e=new MouseEvent(MouseEvent.MOUSE_OUT,!0);e.target=b;b.dispatchEvent(e)}d!=this&&(e=new MouseEvent(MouseEvent.MOUSE_OVER,!0),e.target=d,d.dispatchEvent(e))}this._smd[0]&&this.focus&&a!=this.focus&&this.focus._loseFocus();for(var c=
0;3>c;c++)this._mcEvs[c].target=this._mdEvs[c].target=this._muEvs[c].target=d,this._smd[c]&&(d.dispatchEvent(this._mdEvs[c]),this._focii[c]=this.focus=a),this._smu[c]&&(d.dispatchEvent(this._muEvs[c]),a==this._focii[c]&&d.dispatchEvent(this._mcEvs[c])),this._smd[c]=this._smu[c]=!1;this._smm&&(e=new MouseEvent(MouseEvent.MOUSE_MOVE,!0),e.target=d,d.dispatchEvent(e),this._smm=!1);this._mousefocus=a;for(var c=!1,f=d;null!=f.parent;)c|=f.buttonMode,f=f.parent;c=c?"pointer":"default";d instanceof TextField&&
d.selectable&&(c="text");this._canvas.style.cursor=c}var c=Stage._getDPR(),h;for(h in this._touches)f=this._touches[h],0!=f.act&&(d=this._svec4_0,this._getOrigin(d),a=this._svec4_1,a[0]=f.touch.clientX*c,a[1]=f.touch.clientY*c,a[2]=0,a[3]=1,a=this._getTarget(d,a),b=f.target||this,d=a||this,a!=f.target&&(b!=this&&(e=new TouchEvent(TouchEvent.TOUCH_OUT,!0),e._setFromDom(f.touch),e.target=b,b.dispatchEvent(e)),d!=this&&(e=new TouchEvent(TouchEvent.TOUCH_OVER,!0),e._setFromDom(f.touch),e.target=d,d.dispatchEvent(e))),
1==f.act&&(e=new TouchEvent(TouchEvent.TOUCH_BEGIN,!0)),2==f.act&&(e=new TouchEvent(TouchEvent.TOUCH_MOVE,!0)),3==f.act&&(e=new TouchEvent(TouchEvent.TOUCH_END,!0)),e._setFromDom(f.touch),e.target=d,d.dispatchEvent(e),3==f.act&&a==f.target&&(e=new TouchEvent(TouchEvent.TOUCH_TAP,!0),e._setFromDom(f.touch),e.target=d,d.dispatchEvent(e)),f.act=0,f.target=3==f.act?null:a)};Stage._tick=function(){_requestAF(Stage._tick);Stage.prototype._drawScene.call(Stage._main)};
Stage._MStack=function(){this.mats=[];this.size=1;for(var d=0;30>d;d++)this.mats.push(Point._m4.create())};Stage._MStack.prototype.clear=function(){this.size=1};Stage._MStack.prototype.push=function(d){var a=this.size++;Point._m4.multiply(this.mats[a-1],d,this.mats[a])};Stage._MStack.prototype.pop=function(){this.size--};Stage._MStack.prototype.top=function(){return this.mats[this.size-1]};
Stage._CMStack=function(){this.mats=[];this.vecs=[];this.isID=[];this.bmds=[];this.lnnm=[];this.size=1;this.dirty=!0;for(var d=0;30>d;d++)this.mats.push(Point._m4.create()),this.vecs.push(new Float32Array(4)),this.isID.push(!0),this.bmds.push(BlendMode.NORMAL),this.lnnm.push(0)};
Stage._CMStack.prototype.push=function(d,a,b,e){var c=this.size++;(this.isID[c]=b)?(Point._m4.set(this.mats[c-1],this.mats[c]),Point._v4.set(this.vecs[c-1],this.vecs[c])):(Point._m4.multiply(this.mats[c-1],d,this.mats[c]),Point._m4.multiplyVec4(this.mats[c-1],a,this.vecs[c]),Point._v4.add(this.vecs[c-1],this.vecs[c],this.vecs[c]));b||(this.dirty=!0);this.bmds[c]=e;this.lnnm[c]=e==BlendMode.NORMAL?this.lnnm[c-1]:c};
Stage._CMStack.prototype.update=function(){if(this.dirty){var d=Stage._main,a=this.size-1;gl.uniformMatrix4fv(d._sprg.cMatUniform,!1,this.mats[a]);gl.uniform4fv(d._sprg.cVecUniform,this.vecs[a]);this.dirty=!1}Stage._setBMD(this.bmds[this.lnnm[this.size-1]])};Stage._CMStack.prototype.pop=function(){this.isID[this.size-1]||(this.dirty=!0);this.size--};
function Graphics(){this._conf={ftype:0,fbdata:null,fcolor:null,lwidth:0,lcolor:null};this._points=[0,0];this._fills=[];this._afills=[];this._lfill=null;this._rect=new Rectangle(0,0,0,0);this._srect=new Rectangle(0,0,0,0);this._startNewFill()}Graphics._delTgs={};Graphics._delNum=0;Graphics.prototype._startNewFill=function(){this._endLine();var d=new Graphics.Fill(this._points.length/2-1,this._conf);this._fills.push(d);this._afills.push(d);this._lfill=d};
Graphics.prototype._startLine=function(){var d=this._points.length/2,a=this._fills[this._fills.length-1],b=a.lines.length;0<b&&a.lines[b-1].isEmpty()?a.lines[b-1].Set(d-1,this._conf):a.lines.push(new Graphics.Line(d-1,this._conf))};Graphics.prototype._endLine=function(){if(0!=this._fills.length){var d=this._points.length/2,a=this._fills[this._fills.length-1];0!=a.lines.length&&(a.lines[a.lines.length-1].end=d-1)}};
Graphics.prototype._render=function(d){this._endLine();gl.uniformMatrix4fv(d._sprg.tMatUniform,!1,d._mstack.top());d._cmstack.update();for(var a=0;a<this._afills.length;a++)this._afills[a].render(d,this._points,this._rect)};Graphics.prototype.lineStyle=function(d,a,b){a||(a=0);b||(b=1);this._conf.lwidth=d;this._conf.lcolor=Graphics.makeColor(a,b);this._endLine();this._startLine()};
Graphics.prototype.beginFill=function(d,a){null==a&&(a=1);this._conf.ftype=1;this._conf.fcolor=Graphics.makeColor(d,a);this._startNewFill()};Graphics.prototype.beginBitmapFill=function(d){this._conf.ftype=2;this._conf.fbdata=d;this._startNewFill()};Graphics.prototype.endFill=function(){this._conf.ftype=0;this._startNewFill()};Graphics.prototype.moveTo=function(d,a){this._endLine();this._points.push(d,a);this._startLine()};
Graphics.prototype.lineTo=function(d,a){var b=this._points;if(d!=b[b.length-2]||a!=b[b.length-1])0<b.length&&0<this._conf.ftype&&this._rect._unionWL(b[b.length-2],b[b.length-1],d,a),0<this._conf.lwidth&&this._srect._unionWL(b[b.length-2],b[b.length-1],d,a),b.push(d,a)};Graphics.prototype.curveTo=function(d,a,b,e){var c=this._points,f=c[c.length-2],c=c[c.length-1],h=2/3;this.cubicCurveTo(f+h*(d-f),c+h*(a-c),b+h*(d-b),e+h*(a-e),b,e)};
Graphics.prototype.cubicCurveTo=function(d,a,b,e,c,f,h){h||(h=40);for(var k=this._points,g=k[k.length-2],k=k[k.length-1],r=d-g,m=a-k,w=b-d,u=e-a,p=c-b,q=f-e,z=1/h,x=1;x<h;x++){var t=x*z,l=g+t*r,v=k+t*m,A=d+t*w,y=a+t*u,l=l+t*(A-l),v=v+t*(y-v);this.lineTo(l+t*(A+t*(b+t*p-A)-l),v+t*(y+t*(e+t*q-y)-v))}this.lineTo(c,f)};Graphics.prototype.drawCircle=function(d,a,b){this.drawEllipse(d,a,2*b,2*b)};
Graphics.prototype.drawEllipse=function(d,a,b,e){b/=2;e/=2;this.moveTo(d,a-e);this.cubicCurveTo(d+.553*b,a-e,d+b,a-.553*e,d+b,a,16);this.cubicCurveTo(d+b,a+.553*e,d+.553*b,a+e,d,a+e,16);this.cubicCurveTo(d-.553*b,a+e,d-b,a+.553*e,d-b,a,16);this.cubicCurveTo(d-b,a-.553*e,d-.553*b,a-e,d,a-e,16)};Graphics.prototype.drawRect=function(d,a,b,e){this.moveTo(d,a);this.lineTo(d+b,a);this.lineTo(d+b,a+e);this.lineTo(d,a+e);this.lineTo(d,a)};
Graphics.prototype.drawRoundRect=function(d,a,b,e,c,f){c/=2;f/=2;var h=d+c,k=d+b-c,g=a+f,r=a+e-f;this.moveTo(h,a);this.lineTo(k,a);this.cubicCurveTo(k+.553*c,a,d+b,g-.553*f,d+b,g,16);this.lineTo(d+b,r);this.cubicCurveTo(d+b,r+.553*f,k+.553*c,a+e,k,a+e,16);this.lineTo(h,a+e);this.cubicCurveTo(h-.553*c,a+e,d,r+.553*f,d,r,16);this.lineTo(d,g);this.cubicCurveTo(d,g-.553*f,h-.553*c,a,h,a,16)};
Graphics.prototype.drawTriangles=function(d,a,b){Graphics.Fill.updateRect(d,this._rect);for(var e=[],c=0;c<d.length;c+=2)e.push(d[c],d[c+1],0);d=Graphics._makeTgs(e,a,b,this._conf.fcolor,this._conf.fbdata);this._afills.push(d);this._lfill=d};Graphics.prototype.drawTriangles3D=function(d,a,b){d=Graphics._makeTgs(d,a,b,this._conf.fcolor,this._conf.fbdata);this._afills.push(d);this._lfill=d};
Graphics.prototype.clear=function(){this._conf.ftype=0;this._conf.bdata=null;this._conf.fcolor=null;this._conf.lwidth=0;this._points=[0,0];this._fills=[];for(var d=0;d<this._afills.length;d++){var a=this._afills[d];if(a instanceof Graphics.Fill){a.tgs&&Graphics._freeTgs(a.tgs);for(var b=0;b<a.lineTGS.length;b++)Graphics._freeTgs(a.lineTGS[b])}else Graphics._freeTgs(a)}this._afills=[];this._lfill=null;this._rect.setEmpty();this._startNewFill()};
Graphics.prototype._getLocRect=function(d){return 0==d?this._rect:this._rect.union(this._srect)};Graphics.prototype._hits=function(d,a){return this._rect.contains(d,a)};Graphics.makeColor=function(d,a){var b=new Float32Array(4);b[0]=.0039215686*(d>>16&255);b[1]=.0039215686*(d>>8&255);b[2]=.0039215686*(d&255);b[3]=a;return b};Graphics.equalColor=function(d,a){return d[0]==a[0]&&d[1]==a[1]&&d[2]==a[2]&&d[3]==a[3]};Graphics.len=function(d,a){return Math.sqrt(d*d+a*a)};
Graphics.Fill=function(d,a){this.type=a.ftype;this.color=a.fcolor;this.bdata=a.fbdata;this.lines=[new Graphics.Line(d,a)];this.lineTGS=[];this.dirty=!0;this.tgs=null};
Graphics.Fill.prototype.Build=function(d,a){for(var b=[],e=[],c=[],f=null,h=-1,k=null,g=0;g<this.lines.length;g++){var r=this.lines[g];if(r.begin!=r.end){var m=2*r.begin,w=2*r.end,u=d[m]==d[w]&&d[m+1]==d[w+1];u&&(w-=2);0<r.width&&(null!=f&&r.width==h&&Graphics.equalColor(k,r.color)||(f={vrt:[],ind:[],color:r.color},c.push(f),h=r.width,k=r.color),Graphics.Line.GetTriangles(d,m,w,r,0!=this.type||u,f.ind,f.vrt));if(0!=this.type&&2<w-m){r=d.slice(2*r.begin,2*r.end+2);u&&(r.pop(),r.pop());0>Graphics.PolyK.GetArea(r)&&
(r=Graphics.PolyK.Reverse(r));u=b.length/3;m=Graphics.PolyK.Triangulate(r);for(w=0;w<m.length;w++)e.push(m[w]+u);for(w=0;w<r.length/2;w++)b.push(r[2*w],r[2*w+1],0)}}}for(w=0;w<c.length;w++)this.lineTGS.push(Graphics._makeTgs(c[w].vrt,c[w].ind,null,c[w].color));0<b.length&&(this.tgs=Graphics._makeTgs(b,e,null,this.color,this.bdata))};Graphics.Fill.prototype.isEmpty=function(){return 0==this.lines.length?!0:this.lines[0].isEmpty()};
Graphics.Fill.prototype.render=function(d,a,b){this.dirty&&(this.Build(a,b),this.dirty=!1);this.tgs&&this.tgs.render(d);for(a=0;a<this.lineTGS.length;a++)this.lineTGS[a].render(d)};Graphics.Fill.updateRect=function(d,a){var b=Infinity,e=Infinity,c=-Infinity,f=-Infinity;a.isEmpty()||(b=a.x,e=a.y,c=a.x+a.width,f=a.y+a.height);for(var h=0;h<d.length;h+=2)b=Math.min(b,d[h]),e=Math.min(e,d[h+1]),c=Math.max(c,d[h]),f=Math.max(f,d[h+1]);a.x=b;a.y=e;a.width=c-b;a.height=f-e};
Graphics.Line=function(d,a){this.begin=d;this.end=-1;this.width=a.lwidth;this.color=a.lcolor};Graphics.Line.prototype.Set=function(d,a){this.begin=d;this.end=-1;this.width=a.lwidth;this.color=a.lcolor};Graphics.Line.prototype.isEmpty=function(){return this.begin==this.end};
Graphics.Line.GetTriangles=function(d,a,b,e,c,f,h){var k=h.length/3,g=b-a-2;c?Graphics.Line.AddJoint(d,b,a,a+2,e.width,h):Graphics.Line.AddEnd(d,a,a+2,!0,e.width,h);for(b=0;b<g;b+=2)Graphics.Line.AddJoint(d,a+b,a+b+2,a+b+4,e.width,h),f.push(k+b+0,k+b+1,k+b+2,k+b+1,k+b+2,k+b+3);c?(Graphics.Line.AddJoint(d,a+g,a+g+2,a,e.width,h),f.push(k+g+0,k+g+1,k+g+2,k+g+1,k+g+2,k+g+3),f.push(k+g+2,k+g+3,k+0,k+g+3,k+0,k+1)):(Graphics.Line.AddEnd(d,a+g,a+g+2,!1,e.width,h),f.push(k+0+g,k+1+g,k+2+g,k+1+g,k+2+g,k+3+
g))};Graphics.Line.AddEnd=function(d,a,b,e,c,f){var h=d[a];a=d[a+1];var k=d[b];d=d[b+1];c=.5*c/Graphics.len(h-k,a-d);b=c*(a-d);dy=-c*(h-k);e?f.push(h+b,a+dy,0,h-b,a-dy,0):f.push(k+b,d+dy,0,k-b,d-dy,0)};
Graphics.Line.AddJoint=function(d,a,b,e,c,f){var h=new Point,k=new Point,g=new Point,r=new Point,m=new Point,w=d[a];a=d[a+1];var u=d[b];b=d[b+1];var p=d[e];d=d[e+1];var q=.5*c/Graphics.len(w-u,a-b);e=.5*c/Graphics.len(u-p,b-d);c=q*(a-b);var q=-q*(w-u),z=e*(b-d);e=-e*(u-p);1E-7>Math.abs(c-z)+Math.abs(q-e)?(f.push(u+c,b+q,0),f.push(u-c,b-q,0)):(h.setTo(w+c,a+q),k.setTo(u+c,b+q),g.setTo(u+z,b+e),r.setTo(p+z,d+e),Graphics.PolyK._GetLineIntersection(h,k,g,r,m),f.push(m.x,m.y,0),h.setTo(w-c,a-q),k.setTo(u-
c,b-q),g.setTo(u-z,b-e),r.setTo(p-z,d-e),Graphics.PolyK._GetLineIntersection(h,k,g,r,m),f.push(m.x,m.y,0))};Graphics._makeTgs=function(d,a,b,e,c){var f=Graphics._delTgs["t_"+d.length+"_"+a.length];if(null==f||0==f.length)return new Graphics.Tgs(d,a,b,e,c);f=f.pop();Graphics._delNum--;f.Set(d,a,b,e,c);return f};Graphics._freeTgs=function(d){var a=Graphics._delTgs[d.name];null==a&&(a=[]);a.push(d);Graphics._delNum++;Graphics._delTgs[d.name]=a};
Graphics.Tgs=function(d,a,b,e,c){this.color=e;this.bdata=c;this.name="t_"+d.length+"_"+a.length;this.useTex=null!=c;this.dirtyUVT=!0;this.emptyUVT=null==b;(this.useIndex=65536>=d.length/3)?(this.ind=new Uint16Array(a),this.vrt=new Float32Array(d),this.uvt=b?new Float32Array(b):new Float32Array(2*d.length/3),this.ibuf=gl.createBuffer(),Stage._setEBF(this.ibuf),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this.ind,gl.STATIC_DRAW)):(this.vrt=new Float32Array(3*a.length),Graphics.Tgs.unwrapF32(a,d,3,this.vrt),
this.uvt=new Float32Array(2*a.length),b&&Graphics.Tgs.unwrapF32(a,b,2,this.uvt));this.vbuf=gl.createBuffer();Stage._setBF(this.vbuf);gl.bufferData(gl.ARRAY_BUFFER,this.vrt,gl.STATIC_DRAW);this.tbuf=gl.createBuffer();Stage._setBF(this.tbuf);gl.bufferData(gl.ARRAY_BUFFER,this.uvt,gl.STATIC_DRAW)};
Graphics.Tgs.prototype.Set=function(d,a,b,e,c){this.color=e;this.bdata=c;this.useTex=null!=c;this.dirtyUVT=!0;this.emptyUVT=null==b;if(this.useIndex){e=a.length;c=d.length;for(var f=0;f<e;f++)this.ind[f]=a[f];for(f=0;f<c;f++)this.vrt[f]=d[f];if(b)for(f=0;f<b.length;f++)this.uvt[f]=b[f];Stage._setEBF(this.ibuf);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this.ind,gl.STATIC_DRAW)}else Graphics.Tgs.unwrapF32(a,d,3,this.vrt),b&&Graphics.Tgs.unwrapF32(a,b,2,this.uvt);Stage._setBF(this.vbuf);gl.bufferData(gl.ARRAY_BUFFER,
this.vrt,gl.STATIC_DRAW);Stage._setBF(this.tbuf);gl.bufferData(gl.ARRAY_BUFFER,this.uvt,gl.STATIC_DRAW)};
Graphics.Tgs.prototype.render=function(d){if(this.useTex){d=this.bdata;if(0==d._loaded)return;d._dirty&&d._syncWithGPU();if(this.dirtyUVT){this.dirtyUVT=!1;if(this.emptyUVT){this.emptyUVT=!1;for(var a=1/d._rwidth,b=1/d._rheight,e=0;e<this.uvt.length;e++)this.uvt[2*e]=a*this.vrt[3*e],this.uvt[2*e+1]=b*this.vrt[3*e+1]}else if(d.width!=d._rwidth||d.height!=d._rheight)for(a=d.width/d._rwidth,b=d.height/d._rheight,e=0;e<this.uvt.length;e++)this.uvt[2*e]*=a,this.uvt[2*e+1]*=b;Stage._setBF(this.tbuf);gl.bufferSubData(gl.ARRAY_BUFFER,
0,this.uvt)}Stage._setUT(1);Stage._setTEX(d._texture)}else Stage._setUT(0),gl.uniform4fv(d._sprg.color,this.color);Stage._setTC(this.tbuf);Stage._setVC(this.vbuf);this.useIndex?(Stage._setEBF(this.ibuf),gl.drawElements(gl.TRIANGLES,this.ind.length,gl.UNSIGNED_SHORT,0)):gl.drawArrays(gl.TRIANGLES,0,this.vrt.length/3)};Graphics.Tgs.unwrapF32=function(d,a,b,e){for(var c=d.length,f=0;f<c;f++)for(var h=0;h<b;h++)e[f*b+h]=a[d[f]*b+h]};Graphics.PolyK={};
Graphics.PolyK.Triangulate=function(d){var a=d.length>>1;if(3>a)return[];var b=[];if(Graphics.PolyK.IsConvex(d)){for(var e=1;e<a-1;e++)b.push(0,e,e+1);return b}for(var c=[],e=0;e<a;e++)c.push(e);for(e=0;3<a;){var f=c[(e+0)%a],h=c[(e+1)%a],k=c[(e+2)%a],g=d[2*f],r=d[2*f+1],m=d[2*h],w=d[2*h+1],u=d[2*k],p=d[2*k+1],q=!1;if(Graphics.PolyK._convex(g,r,m,w,u,p))for(var q=!0,z=0;z<a;z++){var x=c[z];if(x!=f&&x!=h&&x!=k&&Graphics.PolyK._PointInTriangle(d[2*x],d[2*x+1],g,r,m,w,u,p)){q=!1;break}}if(q)b.push(f,
h,k),c.splice((e+1)%a,1),a--,e=0;else if(e++>3*a)break}b.push(c[0],c[1],c[2]);return b};Graphics.PolyK.IsConvex=function(d){if(6>d.length)return!0;for(var a=d.length-4,b=0;b<a;b+=2)if(!Graphics.PolyK._convex(d[b],d[b+1],d[b+2],d[b+3],d[b+4],d[b+5]))return!1;return Graphics.PolyK._convex(d[a],d[a+1],d[a+2],d[a+3],d[0],d[1])&&Graphics.PolyK._convex(d[a+2],d[a+3],d[0],d[1],d[2],d[3])?!0:!1};Graphics.PolyK._convex=function(d,a,b,e,c,f){return 0<=(a-e)*(c-b)+(b-d)*(f-e)};
Graphics.PolyK._PointInTriangle=function(d,a,b,e,c,f,h,k){h-=b;k-=e;c-=b;f-=e;d-=b;b=a-e;a=h*h+k*k;e=h*c+k*f;h=h*d+k*b;k=c*c+f*f;c=c*d+f*b;f=1/(a*k-e*e);k=(k*h-e*c)*f;h=(a*c-e*h)*f;return 0<=k&&0<=h&&1>k+h};Graphics.PolyK._GetLineIntersection=function(d,a,b,e,c){var f=d.x-a.x,h=b.x-e.x,k=d.y-a.y,g=b.y-e.y,r=f*g-k*h;if(0==r)return null;d=d.x*a.y-d.y*a.x;b=b.x*e.y-b.y*e.x;c.x=(d*h-f*b)/r;c.y=(d*g-k*b)/r};
Graphics.PolyK.GetArea=function(d){if(6>d.length)return 0;for(var a=d.length-2,b=0,e=0;e<a;e+=2)b+=(d[e+2]-d[e])*(d[e+1]+d[e+3]);b+=(d[0]-d[a])*(d[a+1]+d[1]);return.5*-b};Graphics.PolyK.Reverse=function(d){for(var a=[],b=d.length-2;0<=b;b-=2)a.push(d[b],d[b+1]);return a};function Sprite(){DisplayObjectContainer.call(this);this._trect2=new Rectangle;this.graphics=new Graphics}Sprite.prototype=new DisplayObjectContainer;
Sprite.prototype._getRect=function(d,a,b){var e=DisplayObjectContainer.prototype._getRect.call(this,d,a,b);b=this.graphics._getLocRect(b);Point._m4.multiply(d,this._getATMat(),this._tempm);this._transfRect(this._tempm,a,b,this._trect2);return e.union(this._trect2)};Sprite.prototype._render=function(d){this.graphics._render(d);DisplayObjectContainer.prototype._render.call(this,d)};
Sprite.prototype._getTarget=function(d,a){if(!this.visible||!this.mouseChildren&&!this.mouseEnabled)return null;var b=DisplayObjectContainer.prototype._getTarget.call(this,d,a);if(null!=b)return b;if(!this.mouseEnabled)return null;var b=this._tvec4_0,e=this._tvec4_1,c=this.transform._getIMat();Point._m4.multiplyVec4(c,d,b);Point._m4.multiplyVec4(c,a,e);c=this._tempP;this._lineIsc(b,e,c);return this.graphics._hits(c.x,c.y)?this:null};
Sprite.prototype._htpLocal=function(d,a){var b=this._tempP;this._lineIsc(d,a,b);return this.graphics._hits(b.x,b.y)?!0:DisplayObjectContainer.prototype._htpLocal.call(this,d,a)};var TextFormatAlign={LEFT:"left",CENTER:"center",RIGHT:"right",JUSTIFY:"justify"};
function TextFormat(d,a,b,e,c,f,h){this.font=d?d:"Times New Roman";this.size=a?a:12;this.color=b?b:0;this.bold=e?e:!1;this.italic=c?c:!1;this.align=f?f:TextFormatAlign.LEFT;this.leading=h?h:0;this.maxW=0;this.data={image:null,tw:0,th:0,rw:0,rh:0}}TextFormat.prototype.clone=function(){return new TextFormat(this.font,this.size,this.color,this.bold,this.italic,this.align,this.leading)};
TextFormat.prototype.set=function(d){this.font=d.font;this.size=d.size;this.color=d.color;this.bold=d.bold;this.italic=d.italic;this.align=d.align;this.leading=d.leading};TextFormat.prototype.setContext=function(d){var a=this.color;d.textBaseline="top";d.fillStyle=d.strokeStyle="rgb("+(a>>16&255)+","+(a>>8&255)+","+(a&255)+")";d.font=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.size+"px "+this.font};
TextFormat.prototype.getImageData=function(d,a){var b=TextFormat._canvas,e=TextFormat._ctxext,c=this.data;b.width=c.rw=this._nhpt(a._areaW);b.height=c.rh=this._nhpt(a._areaH);a._background&&(e.fillStyle="rgba(255,255,255,1)",e.fillRect(0,0,a._areaW,a._areaH));a._border&&(e.strokeStyle="rgb(0,0,0)",e.beginPath(),e.rect(.5,.5,a._areaW-1,a._areaH-1),e.stroke());this.setContext(e);var f=[];this.maxW=0;for(var h=d.split("\n"),k=0,g=0,r=1.25*this.size,m=0,w=0;w<h.length;w++)var u=this.renderPar(h[w],g,
r,e,a,m,f),k=k+u,g=g+u*(r+this.leading),m=m+(h[w].length+1);this.align==TextFormatAlign.JUSTIFY&&(this.maxW=Math.max(this.maxW,a._areaW));c.tw=this.maxW;c.th=(r+this.leading)*k-this.leading;a._metrics=f;if(a._selectable&&a._select&&a._select.from<a._select.to)if(r=a._select,k=a.getLineIndexOfChar(r.from),h=a.getLineIndexOfChar(r.to-1),g=a.getCharBoundaries(r.from),r=a.getCharBoundaries(r.to-1),e.fillStyle="rgba(0,0,0,0.25)",k==h)e.fillRect(g.x,g.y,r.x+r.width-g.x,r.y+r.height-g.y);else{e.fillRect(g.x,
g.y,f[k].x+f[k].width-g.x,f[k].y+f[k].height-g.y);for(k+=1;k<h;k++)e.fillRect(f[k].x,f[k].y,f[k].width,f[k].height);e.fillRect(f[h].x,f[h].y,r.x+r.width-f[h].x,r.y+r.height-f[h].y)}else"input"==a._type&&-1<a._curPos&&(g=a.getCharBoundaries(a._curPos),e.beginPath(),e.moveTo(Math.round(g.x)+.5,g.y),e.lineTo(Math.round(g.x)+.5,g.y+g.height),e.stroke());c.canvas=b;b=e.getImageData(0,0,c.rw,c.rh);c.ui8buff=window.CanvasPixelArray&&b.data instanceof CanvasPixelArray?new Uint8Array(b.data):new Uint8Array(b.data.buffer);
return c};
TextFormat.prototype.renderPar=function(d,a,b,e,c,f,h){var k;k=c._wordWrap?d.split(" "):[d];d=e.measureText(" ").width;var g=0;c=c._areaW;for(var r=0,m=[[]],w=[],u=0;u<k.length;u++){var p=k[u],q=e.measureText(p).width;g+q<=c||0==g?(m[r].push(p),g+=q+d):(w.push(c-g+d),m.push([]),r++,g=0,u--)}w.push(c-g+d);for(u=0;u<m.length;u++){k={x:0,y:0,width:0,height:0,charOffset:f,words:[]};k.height=1.25*this.size+this.leading;var z=m[u];this.maxW=Math.max(this.maxW,c-w[u]);var x,t=a+(b+this.leading)*u,g=0;x=
d;this.align==TextFormatAlign.CENTER&&(g=.5*w[u]);this.align==TextFormatAlign.RIGHT&&(g=w[u]);this.align==TextFormatAlign.JUSTIFY&&(x=d+w[u]/(z.length-1));k.x=g;k.y=t;for(var l=0;l<z.length;l++)p=z[l],e.fillText(p,g,t),q=e.measureText(p).width,k.words.push({x:g,y:t,width:q,height:k.height,charOffset:f,word:p}),g=u<m.length-1?g+(q+x):g+(q+d),f+=p.length+1;k.width=g-k.x;u==m.length-1&&(k.width-=d);h.push(k)}return r+1};
TextFormat.prototype._nhpt=function(d){--d;for(var a=1;32>a;a<<=1)d|=d>>a;return d+1};TextFormat._canvas=document.createElement("canvas");TextFormat._ctxext=TextFormat._canvas.getContext("2d");
function TextField(){InteractiveObject.call(this);this._tarea=document.createElement("textarea");this._tareaAdded=!1;this._tarea.setAttribute("style","font-family:Times New Roman; font-size:12px; z-index:-1; \r\n\t\t\t\t\t\t\t\t\t\t\tposition:absolute; top:0px; left:0px; opacity:0; pointer-events:none; user-select:none; width:100px; height:100px;");this._tarea.addEventListener("input",this._tfInput.bind(this),!1);this._stage=null;this._type="dynamic";this._selectable=!0;this._mdown=!1;this._curPos=
-1;this._metrics=this._select=null;this._wordWrap=!1;this._textH=this._textW=0;this._areaH=this._areaW=100;this._text="";this._tForm=new TextFormat;this._rheight=this._rwidth=0;this._border=this._background=!1;this._texture=gl.createTexture();this._tcArray=new Float32Array([0,0,0,0,0,0,0,0]);this._tcBuffer=gl.createBuffer();Stage._setBF(this._tcBuffer);gl.bufferData(gl.ARRAY_BUFFER,this._tcArray,gl.STATIC_DRAW);this._fArray=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0]);this._vBuffer=gl.createBuffer();
Stage._setBF(this._vBuffer);gl.bufferData(gl.ARRAY_BUFFER,this._fArray,gl.STATIC_DRAW);this.addEventListener2(Event.ADDED_TO_STAGE,this._tfATS,this);this.addEventListener2(Event.REMOVED_FROM_STAGE,this._tfRFS,this);this.addEventListener2(MouseEvent.MOUSE_DOWN,this._tfMD,this);this.addEventListener2(KeyboardEvent.KEY_UP,this._tfKU,this);this._brect=new Rectangle}TextField.prototype=new InteractiveObject;TextField.prototype._getLocRect=function(){return this._brect};
TextField.prototype._loseFocus=function(){this._tareaAdded&&document.body.removeChild(this._tarea);this._tareaAdded=!1;this._curPos=-1;this._update()};TextField.prototype._tfKU=function(d){this._tfInput(null)};TextField.prototype._tfInput=function(d){"input"==this._type&&(this._text=this._tarea.value,this._select=null,this._curPos=this._tarea.selectionStart,this.setSelection(this._tarea.selectionStart,this._tarea.selectionEnd))};TextField.prototype._tfATS=function(d){this._stage=this.stage};
TextField.prototype._tfRFS=function(d){this._loseFocus()};TextField.prototype._tfMD=function(d){this._selectable&&("input"==this._type&&(this._tareaAdded=!0,document.body.appendChild(this._tarea),this._tarea.value=this._text,this._tarea.focus()),d=this.getCharIndexAtPoint(this.mouseX,this.mouseY),this._mdown=!0,this._curPos=d,this.setSelection(d,d),this._update(),this.stage.addEventListener2(MouseEvent.MOUSE_MOVE,this._tfMM,this),this.stage.addEventListener2(MouseEvent.MOUSE_UP,this._tfMU,this))};
TextField.prototype._tfMM=function(d){this._selectable&&this._mdown&&(d=this.getCharIndexAtPoint(this.mouseX,this.mouseY),this.setSelection(this._curPos,d))};TextField.prototype._tfMU=function(d){this._selectable&&(this._mdown=!1,"input"==this._type&&this._tarea.focus(),this._stage.removeEventListener(MouseEvent.MOUSE_MOVE,this._tfMM),this._stage.removeEventListener(MouseEvent.MOUSE_UP,this._tfMU))};TextField.prototype.appendText=function(d){this._text+=d;this._update()};
TextField.prototype.getCharBoundaries=function(d){var a=TextFormat._ctxext;this._tForm.setContext(a);var b=this._metrics,e=this.getLineIndexOfChar(d);if(0==b[e].words.length)return new Rectangle(b[e].x,b[e].y,b[e].width,b[e].height);for(var c=0;c+1<b[e].words.length&&b[e].words[c+1].charOffset<=d;)c++;var f=b[e].words[c],h=f.word.substring(0,d-f.charOffset),f=new Rectangle(f.x+a.measureText(h).width,f.y,0,f.height);f.width=a.measureText(this._text.charAt(d)).width;(a=b[e].words[c+1])&&a.charOffset==
d+1&&(f.width=a.x-f.x);return f};TextField.prototype.getCharIndexAtPoint=function(d,a){if(0==this._text.length)return 0;var b=TextFormat._ctxext;this._tForm.setContext(b);var e=this._metrics,c=this.getLineIndexAtPoint(d,a);d=Math.max(e[c].x,Math.min(e[c].x+e[c].width,d));for(var f=0;f+1<e[c].words.length&&e[c].words[f+1].x<=d;)f++;c=e[c].words[f];e=c.charOffset;for(c=c.x;;)if(f=b.measureText(this._text.charAt(e)).width,c+.5*f<d&&0!=f)c+=f,e++;else break;return e};
TextField.prototype.getLineIndexAtPoint=function(d,a){for(var b=this._metrics,e=0;e+1<b.length&&b[e+1].y<=a;)e++;return e};TextField.prototype.getLineIndexOfChar=function(d){for(var a=this._metrics,b=0;b+1<a.length&&a[b+1].charOffset<=d;)b++;return b};TextField.prototype.getTextFormat=function(d){return this._tForm.clone()};
TextField.prototype.setTextFormat=function(d){this._tForm.set(d);this._tarea.style.fontFamily=d.font;this._tarea.style.fontSize=d.size+"px";this._tarea.style.textAlign=d.align;this._update()};TextField.prototype.setSelection=function(d,a){var b=Math.min(d,a),e=Math.max(d,a),c=this._select;if(null==c||c.from!=b||c.to!=e)this._select={from:b,to:e},this._tarea.selectionStart=b,this._tarea.selectionEnd=e,this._update()};
TextField.prototype._update=function(){var d=this._brect.width=this._areaW,a=this._brect.height=this._areaH;if(0!=d&&0!=a){var b=this._tForm.getImageData(this._text,this);this._textW=b.tw;this._textH=b.th;if(b.rw!=this._rwidth||b.rh!=this._rheight)gl.deleteTexture(this._texture),this._texture=gl.createTexture();Stage._setTEX(this._texture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,b.rw,b.rh,0,gl.RGBA,gl.UNSIGNED_BYTE,b.ui8buff);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,
gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_LINEAR);gl.generateMipmap(gl.TEXTURE_2D);this._rwidth=b.rw;this._rheight=b.rh;var e=a/b.rh,c=this._tcArray;c[2]=c[6]=d/b.rw;c[5]=c[7]=e;Stage._setBF(this._tcBuffer);gl.vertexAttribPointer(Stage._main._sprg.tca,2,gl.FLOAT,!1,0,0);gl.bufferSubData(gl.ARRAY_BUFFER,0,c);b=this._fArray;b[3]=b[9]=d;b[7]=b[10]=a;Stage._setBF(this._vBuffer);gl.vertexAttribPointer(Stage._main._sprg.vpa,3,gl.FLOAT,!1,0,0);gl.bufferSubData(gl.ARRAY_BUFFER,0,b)}};
TextField.prototype._render=function(d){0!=this._areaW&&0!=this._areaH&&(gl.uniformMatrix4fv(d._sprg.tMatUniform,!1,d._mstack.top()),d._cmstack.update(),Stage._setVC(this._vBuffer),Stage._setTC(this._tcBuffer),Stage._setUT(1),Stage._setTEX(this._texture),Stage._setEBF(d._unitIBuffer),gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0))};this.tp=TextField.prototype;tp.ds=tp.__defineSetter__;tp.dg=tp.__defineGetter__;tp.dg("textWidth",function(){return this._textW});tp.dg("textHeight",function(){return this._textH});
tp.ds("wordWrap",function(d){this._wordWrap=d;this._update()});tp.dg("wordWrap",function(){return this._wordWrap});tp.ds("width",function(d){this._areaW=Math.max(0,d);this._tarea.style.width=this._areaW+"px";this._update()});tp.dg("width",function(){return this._areaW});tp.ds("height",function(d){this._areaH=Math.max(0,d);this._tarea.style.height=this._areaH+"px";this._update()});tp.dg("height",function(){return this._areaH});tp.ds("text",function(d){this._text=d+"";this._update()});
tp.dg("text",function(){return this._text});tp.ds("selectable",function(d){this._selectable=d;this._update()});tp.dg("selectable",function(){return this._selectable});tp.ds("type",function(d){this._type=d;this._update()});tp.dg("type",function(){return this._type});tp.ds("background",function(d){this._background=d;this._update()});tp.dg("background",function(){return this._background});tp.ds("border",function(d){this._border=d;this._update()});tp.dg("border",function(){return this._border});delete tp.ds;
delete tp.dg;delete this.tp;var world,gameVars={bodies:[],actors:[],"char":{},fontLoader:0,circles:[]};
function Start(){function d(){this.callbacks=[r]}function a(){b(1)}function b(a){gameVars.score+=Math.round(a);G.addCallback(function(){gameVars.scoreView.text=gameVars.score;gameVars.scoreView.x=(B.w/2-gameVars.scoreView._textW/l/1.5)*l;gameVars.scoreView.width=gameVars.scoreView._textW;gameVars.scoreView.height=gameVars.scoreView._textH;G.destroyCallback(this)})}function e(){gameVars.speed=Math.floor(Math.floor(Math.random()*(gameVars.speed_range[1]-gameVars.speed_range[0]))+gameVars.speed_range[0]+
Math.floor(Math.random()*(gameVars.score/100+1))/gameVars.speed_reducer);var a=0;200>gameVars.score/gameVars.teir_reducer?a=0:400>gameVars.score/gameVars.teir_reducer?a=1:800>gameVars.score/gameVars.teir_reducer?a=2:1600>gameVars.score/gameVars.teir_reducer?a=3:2400>gameVars.score/gameVars.teir_reducer?a=4:2400<=gameVars.score/gameVars.teir_reducer&&(a=5);a=gameVars.timings_teirs[a];c(gameVars.speed,Math.floor(Math.random()*(a[1]-a[0]))+a[0])}function c(a,b){if(!gameVars.over){var c={};c.body=h(c,
gameVars.sidesOps[Math.floor(Math.random()*gameVars.sidesOps.length)],a);c.sprite=f(c,K);gameVars.actors.push(c);A.add(E.world,c.body);setTimeout(function(){e()},b)}}function f(a,b){var c=[],d=Math.floor(100*Math.random());gameVars.texture=new BitmapData("./images/rock.png");var e=105,f=105;if(699>gameVars.score){var g="red";50<d&&(g="black",gameVars.texture=new BitmapData("./images/star.png"),f=e=105)}else c="red black blue grey green yellow orange purple violet gainsboro".split(" "),g=c[0],46<d&&
92>d?(g=c[1],gameVars.texture=new BitmapData("./images/star.png"),f=e=105):93==d?(g=c[8],gameVars.texture=new BitmapData("./images/star_v.png"),f=e=105):94==d?(g=c[9],gameVars.texture=new BitmapData("./images/star_gb.png"),f=e=105):95==d?(g=c[2],gameVars.texture=new BitmapData("./images/star_b.png"),f=e=105):96==d?(g=c[3],gameVars.texture=new BitmapData("./images/star_g.png"),f=e=105):97==d?(g=c[4],gameVars.texture=new BitmapData("./images/star_grn.png"),f=e=105):98==d?(g=c[5],gameVars.texture=new BitmapData("./images/star_y.png"),
f=e=105):99==d?(g=c[6],gameVars.texture=new BitmapData("./images/star_oj.png"),f=e=105):100==d&&(g=c[7],gameVars.texture=new BitmapData("./images/star_p.png"),f=e=105);c=new Bitmap(gameVars.texture);d=new Sprite;a.sprite=d;d.color=g;d.ss=b;d.addChild(c);d.x=(a.body.position.x-b)*l;d.y=(a.body.position.y-b)*l;d.scaleX=b/(e/l);d.scaleY=b/(f/l);d.zIndex=98;D.addChild(d);D.updateLayersOrder();return d}function h(a,b,c){var d,e,f=.5>Math.random()?!0:!1;c/=100;switch(b){case 1:b=B.w+K/2;d=(Math.round(Math.random()*
B.h)+K)/2;e=gameVars.circles.pop();Matter.Body.setPosition(e,{x:b,y:d});e.name="right";1==f?d>B.h/2?Matter.Body.setVelocity(e,{x:-c,y:-c}):Matter.Body.setVelocity(e,{x:-c,y:c}):Matter.Body.setVelocity(e,{x:-c,y:0});break;case 2:b=0-K/2;d=(Math.round(Math.random()*B.h)+K)/2;e=gameVars.circles.pop();Matter.Body.setPosition(e,{x:b,y:d});e.name="left";1==f?d>B.h/2?Matter.Body.setVelocity(e,{x:c,y:-c}):Matter.Body.setVelocity(e,{x:c,y:c}):Matter.Body.setVelocity(e,{x:c,y:0});break;case 3:b=(Math.round(Math.random()*
B.w)+K)/2;d=B.h+K/2;e=gameVars.circles.pop();Matter.Body.setPosition(e,{x:b,y:d});e.name="bottom";1==f?b>B.w/2?Matter.Body.setVelocity(e,{x:-c,y:-c}):Matter.Body.setVelocity(e,{x:c,y:-c}):Matter.Body.setVelocity(e,{x:0,y:-c});break;case 4:b=(Math.round(Math.random()*B.w)+K)/2,d=0-K/2,e=gameVars.circles.pop(),Matter.Body.setPosition(e,{x:b,y:d}),e.name="top",1==f?b>B.w/2?Matter.Body.setVelocity(e,{x:-c,y:c}):Matter.Body.setVelocity(e,{x:c,y:c}):Matter.Body.setVelocity(e,{x:0,y:c})}e.friction=0;e.frictionAir=
0;e.collisionFilter.category=2;e.collisionFilter.mask=1;gameVars.bodies.push(e);return a.body=e}function k(a){D.removeChild(gameVars.actors[a].sprite);gameVars.circles.unshift(gameVars.bodies[a]);Matter.Body.setPosition(gameVars.bodies[a],{x:-100,y:-100});Matter.Body.setVelocity(gameVars.bodies[a],{x:0,y:0});A.remove(E.world,gameVars.bodies[a]);gameVars.bodies.splice(a,1);gameVars.actors.splice(a,1)}function g(){3>=gameVars.fontLoader&&(b(0),gameVars.fontLoader++);for(n in gameVars.bodies){var a=
gameVars.bodies[n];(a.position.x-100>B.w||a.position.y-100>B.h||0>a.position.x+100||0>a.position.y+100)&&k(n)}}function r(){for(var a=0;a<gameVars.actors.length;a++){var b=gameVars.bodies[a],c=gameVars.actors[a].sprite,d=b.position,e=b.circleRadius;c.x=(d.x-e)*l;c.y=(d.y-e)*l;c.rotation=180*b.angle/Math.PI}}function m(a){if(gameVars.warp||0==gameVars.firstTouch)0==gameVars.firstTouch&&(gameVars.firstTouch=!0,gameVars.previousTouch={x:a.mouse.position.x,y:a.mouse.position.y}),Matter.Body.setPosition(gameVars["char"].body,
Matter.Vector.create(a.mouse.position.x/l,a.mouse.position.y/l)),gameVars["char"].sprite.x=a.mouse.position.x-gameVars["char"].sprite.w/2,gameVars["char"].sprite.y=a.mouse.position.y-gameVars["char"].sprite.h/2;else if(!gameVars.warp&&1==gameVars.firstTouch){var b=Math.abs(gameVars.previousTouch.y-a.mouse.position.y);if(100<Math.abs(gameVars.previousTouch.x-a.mouse.position.x)||100<b)return;Matter.Body.setPosition(gameVars["char"].body,Matter.Vector.create(a.mouse.position.x/l,a.mouse.position.y/
l));gameVars["char"].sprite.x=a.mouse.position.x-gameVars["char"].sprite.w/2;gameVars["char"].sprite.y=a.mouse.position.y-gameVars["char"].sprite.h/2;gameVars.previousTouch={x:a.mouse.position.x,y:a.mouse.position.y}}E.world.gravity=gameVars.magnetic?{x:a.mouse.position.x,y:a.mouse.position.y,isPoint:!0,scale:5E-4}:{scale:.001,x:0,y:0,isPoint:!1}}function w(){D.removeChild(gameVars.s);D.removeChild(gameVars.howToView);D.removeChild(gameVars.xView);D.removeChild(gameVars.rulesView);gameVars.startButton.x+=
1E3;gameVars.howToButton.x+=1E3;gameVars.scoreView.x+=1E3;gameVars["char"].sprite.x=(B.w/2-gameVars["char"].sprite.w/2/l)*l;gameVars["char"].sprite.y=(B.h/2-gameVars["char"].sprite.h/2/l)*l}function u(){gameVars.over?location.reload():(gameVars.startTime=(new Date).getTime(),gameVars.firstTouch=!1,D.removeChild(gameVars.startButton),gameVars.scoreView.alpha=.5,e(),G.addCallback(g),F.on(I,"mousemove",m),G.addCallback(a),gameVars["char"].sprite.gotoAndLoop(9,22,5),gameVars.howToButton.x+=-1E3)}function p(a){if(1==
a&&1==gameVars.lives){gameVars.gameLives=new Sprite;var c=new BitmapData("./images/life.png");a=25*gameVars.lives;c=new Bitmap(c);gameVars.gameLives.addChild(c);gameVars.gameLives.x=(B.w/2-10)*l;gameVars.gameLives.y=20*l;gameVars.gameLives.scaleX=20/(a/l);gameVars.gameLives.scaleY=20/(26/l);gameVars.gameLives.zIndex=10;D.addChild(gameVars.gameLives);D.updateLayersOrder();gameVars.lives=2}else-1==a?(D.removeChild(gameVars.gameLives),gameVars.lives=1):1==a&&2==gameVars.lives&&b(1E3)}function q(){if(gameVars.slow)gameVars.sBT.start=
(new Date).getTime();else{gameVars.slow=!0;var a=new Sprite;gameVars.sBT=a;a.graphics.lineStyle(10*l,8947848,.5);a.graphics.moveTo(40*l,65*l);a.graphics.lineTo((B.w-40)*l,65*l);D.addChild(a);var b=(new Date).getTime();a.start||(a.start=b);G.addCallback(function L(){var b=(new Date).getTime()-a.start;if(3E3<b)for(D.removeChild(a),G.destroyCallback(L),gameVars.slow=!1,b=0;b<gameVars.actors.length;b++){if(null!=gameVars.actors[b]){for(var c=toArray(gameVars.actors[b].body.velocity),d=0;d<c.length;d++)c[d]=
Math.floor(2*c[d]);c={x:c[0],y:c[1]};C.setVelocity(gameVars.actors[b].body,c);gameVars.actors[b].slowed=!1}}else for(b=(100-b/3E3*100)/100,b*=B.w-80,a.graphics.clear(),a.graphics.lineStyle(10*l,8947848,.5),a.graphics.moveTo(40*l,65*l),a.graphics.lineTo((40+b)*l,65*l),b=0;b<gameVars.actors.length;b++)if(null!=gameVars.actors[b]&&!gameVars.actors[b].slowed){c=toArray(gameVars.actors[b].body.velocity);for(d=0;d<c.length;d++)c[d]=Math.floor(c[d]/2);c={x:c[0],y:c[1]};C.setVelocity(gameVars.actors[b].body,
c);gameVars.actors[b].slowed=!0}})}}function z(){if(gameVars.invincible)gameVars.iBT.start=(new Date).getTime();else{gameVars.invincible=!0;var a=new Sprite;gameVars.iBT=a;a.graphics.lineStyle(10*l,1982068,.5);a.graphics.moveTo(40*l,40*l);a.graphics.lineTo((B.w-40)*l,40*l);D.addChild(a);var b=(new Date).getTime();a.start||(a.start=b);G.addCallback(function L(){var b=(new Date).getTime()-a.start;3E3<b?(D.removeChild(a),G.destroyCallback(L),gameVars.invincible=!1):(b=(100-b/3E3*100)/100,b*=B.w-80,a.graphics.clear(),
a.graphics.lineStyle(10*l,1982068,.5),a.graphics.moveTo(40*l,40*l),a.graphics.lineTo((40+b)*l,40*l))})}}function x(){if(gameVars.magnetic)gameVars.mBT.start=(new Date).getTime();else{gameVars.magnetic=!0;var a=new Sprite;gameVars.mBT=a;a.graphics.lineStyle(10*l,7602363,.5);a.graphics.moveTo(40*l,(B.h-40)*l);a.graphics.lineTo((B.w-40)*l,(B.h-40)*l);D.addChild(a);var b=(new Date).getTime();a.start||(a.start=b);G.addCallback(function L(){var b=(new Date).getTime()-a.start;5E3<b?(E.world.gravity={scale:.001,
x:0,y:0},D.removeChild(a),G.destroyCallback(L),gameVars.magnetic=!1):(b=(100-b/5E3*100)/100,b*=B.w-80,a.graphics.clear(),a.graphics.lineStyle(10*l,7602363,.5),a.graphics.moveTo(40*l,(B.h-40)*l),a.graphics.lineTo((40+b)*l,(B.h-40)*l))})}}function t(){if(gameVars.warp)gameVars.wBT.start=(new Date).getTime();else{gameVars.warp=!0;var a=new Sprite;gameVars.wBT=a;a.graphics.lineStyle(10*l,10950666,.5);a.graphics.moveTo(40*l,(B.h-65)*l);a.graphics.lineTo((B.w-40)*l,(B.h-65)*l);D.addChild(a);var b=(new Date).getTime();
a.start||(a.start=b);G.addCallback(function L(){var b=(new Date).getTime()-a.start;5E3<b?(D.removeChild(a),G.destroyCallback(L),gameVars.warp=!1):(b=(100-b/5E3*100)/100,b*=B.w-80,a.graphics.clear(),a.graphics.lineStyle(10*l,10950666,.5),a.graphics.moveTo(40*l,(B.h-65)*l),a.graphics.lineTo((40+b)*l,(B.h-65)*l))})}}d.prototype.animate=function(a){if(G.callbacks)for(var b in G.callbacks)G.callbacks[b]()};d.prototype.addCallback=function(a){this.callbacks.push(a)};d.prototype.destroyCallback=function(a){this.callbacks.splice(this.callbacks.indexOf(a),
1)};var l=window.devicePixelRatio,v=Matter.Engine,A=Matter.World,y=Matter.Bodies,C=Matter.Body,F=Matter.Events,E=v.create();E.enableSleeping=!0;var I=Matter.MouseConstraint.create(E,{mouse:Matter.Mouse.create(document.getElementById("c"))});E.world.gravity={scale:.001,x:0,y:0};var D=new Stage("c",{w:window.innerWidth,h:window.innerHeight});D.updateLayersOrder=function(){D._children.sort(function(a,b){a.zIndex=a.zIndex||0;b.zIndex=b.zIndex||0;return b.zIndex-a.zIndex})};document.stage=D;var B={h:document.stage.stageHeight/
l,w:document.stage.stageWidth/l},G=new d;D.addEventListener(Event.ENTER_FRAME,G.animate);var J=new BitmapData("./images/space.png"),H=new Sprite;gameVars.bg=H;H.graphics.beginBitmapFill(J);H.graphics.drawRect(0,0,2*B.w,2*B.h);H.scaleY=2*B.h/300*(l/2);H.scaleX=2*B.w/300*(l/2);H.zIndex=100;D.addChild(H);D.updateLayersOrder();gameVars["char"].body=y.rectangle(B.w/2,B.h/2,20,50,{isStatic:!0});gameVars["char"].sprite=function(){var a=new BitmapData("./images/astro_loop.png"),a=new MBitmap(a,3,8);a.x=(gameVars["char"].body.vertices[0].x-
7)*l;a.y=gameVars["char"].body.vertices[0].y*l;a.scaleX=30/(80/l);a.scaleY=60/(120/l);a.w=30*l;a.h=60*l;return a}();gameVars["char"].sprite.zIndex=1;gameVars["char"].body.sleepThreshold=-1;gameVars["char"].sprite.x=(B.w/2-gameVars["char"].sprite.w/2/l)*l;gameVars["char"].sprite.y=(B.h/2-gameVars["char"].sprite.h/2/l)*l;A.add(E.world,gameVars["char"].body);D.addChild(gameVars["char"].sprite);D.updateLayersOrder();J=new TextFormat("Conductive",30*l,16777215,!1,!1,"center");gameVars.scoreView=new TextField;
gameVars.scoreView.selectable=!1;gameVars.scoreView.setTextFormat(J);gameVars.scoreView.text="0";gameVars.scoreView.x=(B.w/2-gameVars.scoreView._textW/l/1.5)*l;gameVars.scoreView.y=(B.h/2-100)*l;gameVars.scoreView.alpha=1;gameVars.scoreView.width=gameVars.scoreView._textW;gameVars.scoreView.height=gameVars.scoreView._textH;gameVars.score=0;gameVars.scoreView.zIndex=98;D.addChild(gameVars.scoreView);D.updateLayersOrder();gameVars.teir_reducer=1;gameVars.speed_reducer=1;gameVars.score=0;gameVars.invincible=
!1;gameVars.lives=1;gameVars.timings_teirs=[[500,1E3],[400,700],[300,500],[200,400],[100,250],[50,125]];gameVars.speed_range=[250,300];gameVars.speed=0;gameVars.sizes=[30,40,50,60];gameVars.sidesOps=[1,2,3,4];v.run(E);(function(){var a=new TextFormat("Conductive",30*l,16777215,!1,!1,"left");gameVars.startButtonView=new TextField;gameVars.startButtonView.selectable=!1;gameVars.startButtonView.setTextFormat(a);gameVars.startButtonView.text=0<arguments.length?"Restart":"Start Game";gameVars.startButtonView.x=
(B.w/2-gameVars.startButtonView._textW/l/2)*l;gameVars.startButtonView.y=(B.h/2+100)*l;gameVars.startButtonView.width=gameVars.startButtonView._textW;gameVars.startButtonView.height=gameVars.startButtonView._textH;gameVars.startButton=new Sprite;gameVars.startButton.addChild(gameVars.startButtonView);gameVars.startButton.zIndex=98;gameVars.startButton.addEventListener(MouseEvent.CLICK,u);D.addChild(gameVars.startButton);D.updateLayersOrder()})();v=new TextFormat("Conductive",30*l,16777215,!1,!1,"left");
gameVars.howToView=new TextField;gameVars.howToView.selectable=!1;gameVars.howToView.setTextFormat(v);gameVars.howToView.text="How to Play";gameVars.howToView.x=(B.w/2-gameVars.howToView._textW/l/2)*l;gameVars.howToView.y=(B.h/2+150)*l;gameVars.howToView.width=gameVars.howToView._textW;gameVars.howToView.height=gameVars.howToView._textH;gameVars.howToButton=new Sprite;gameVars.howToButton.addChild(gameVars.howToView);gameVars.howToButton.zIndex=98;gameVars.howToButton.addEventListener(MouseEvent.CLICK,
function(){gameVars["char"].sprite.x=10;gameVars["char"].sprite.y=B.h/2;gameVars.s=new Sprite;gameVars.s.graphics.beginFill(0,.5);gameVars.s.graphics.drawRect(20*l,20*l,(B.w-40)*l,(B.h-40)*l);gameVars.s.graphics.endFill();gameVars.s.zIndex=99;D.addChild(gameVars.s);D.updateLayersOrder();var a=new TextFormat("Conductive",16*l,16777215,!1,!1,"left");gameVars.rulesText=new TextField;gameVars.rulesText.selectable=!1;gameVars.rulesText.setTextFormat(a);gameVars.rulesText.text="Collect the Stars and avoid the Rocks!\n The key to a high score\nis to collect powerups and use them to\n your advantage!\n\nBlue - makes you invincible for 3 seconds!\nGrey - slows down time by 1/2 for 3 seconds!\nGreen - reduces how often objects are spawned!\nBright Yellow - reduces how fast\n objects are launched!\nOrange - gives you a thousand points instantly!\nPink - gives you another chance! \nAny more give you a thousand points\n instantly!\nRed - makes you master of warp holes!\nPurple - makes things crazy!";
gameVars.rulesText.x=45*l;gameVars.rulesText.y=30*l;gameVars.rulesText.width=(B.w-40)*l;gameVars.rulesText.wordWrap=!0;gameVars.rulesText.height=gameVars.rulesText._textH;gameVars.rulesView=new Sprite;gameVars.rulesView.addChild(gameVars.rulesText);gameVars.rulesView.zIndex=98;D.addChild(gameVars.rulesView);D.updateLayersOrder();gameVars.startButton.x+=-1E3;gameVars.howToButton.x+=-1E3;gameVars.scoreView.x+=-1E3;new TextFormat("Conductive",24*l,16777215,!1,!1,"left");gameVars.howToX=new TextField;
gameVars.howToX.selectable=!1;gameVars.howToX.setTextFormat(a);gameVars.howToX.text="X";gameVars.howToX.x=(B.w-gameVars.howToX._textW-20)*l;gameVars.howToX.y=30*l;gameVars.howToX.width=gameVars.howToX._textW;gameVars.howToX.height=gameVars.howToX._textH;gameVars.xView=new Sprite;gameVars.xView.addChild(gameVars.howToX);gameVars.xView.zIndex=98;gameVars.xView.addEventListener(MouseEvent.CLICK,w);D.addChild(gameVars.xView);D.updateLayersOrder()});D.addChild(gameVars.howToButton);D.updateLayersOrder();
gameVars.storage.high_score&&(v=new TextFormat("Conductive",24*l,16777215,!1,!1,"center"),gameVars.highScoreView=new TextField,gameVars.highScoreView.selectable=!1,gameVars.highScoreView.setTextFormat(v),gameVars.highScoreView.text=gameVars.storage.high_score,gameVars.highScoreView.x=(B.w-gameVars.highScoreView._textW/l-10)*l,gameVars.highScoreView.y=10*l,gameVars.highScoreView.alpha=.5,gameVars.highScoreView.width=gameVars.highScoreView._textW,gameVars.highScoreView.height=gameVars.highScoreView._textH,
gameVars.highScoreView.zIndex=97,D.addChild(gameVars.highScoreView),D.updateLayersOrder());for(v=0;50>v;v++){var K=gameVars.sizes[Math.floor(Math.random()*gameVars.sizes.length)],J=y.circle(-100,-100,K/2);gameVars.circles.push(J)}F.on(E,"collisionStart",function(a){a=a.pairs;for(n in a){var c=gameVars.bodies.indexOf(a[n].bodyB);if(-1!=c){var d=gameVars.actors[c].sprite.color,e=gameVars.actors[c].sprite.ss;if("black"==d)k(c),b(e);else if("red"==d){if(k(c),gameVars.invincible||1!=gameVars.lives)gameVars.invincible||
p(-1)}else"blue"==d?(k(c),z()):"grey"==d?(k(c),q()):"green"==d?(k(c),gameVars.teir_reducer+=2):"yellow"==d?(k(c),gameVars.speed_reducer+=10):"orange"==d?(k(c),b(1E3)):"purple"==d?(k(c),p(1)):"violet"==d?(k(c),x()):"gainsboro"==d&&(k(c),t())}}})}function toArray(d){var a=[];for(property in d)a.push(d[property]);return a}
var fps={startTime:0,frameNumber:0,getFPS:function(){this.frameNumber++;var d=((new Date).getTime()-this.startTime)/1E3,a=Math.floor(this.frameNumber/d);1<d&&(this.startTime=(new Date).getTime(),this.frameNumber=0);return a}};
function MBitmap(d,a,b){Sprite.call(this);this.bitmapData=d;this.totalFrames=a*b;this.currentFrame=0;this.loop=this.isPlaying=!1;this.loopStart=this.loopEnd=0;this._rows=a;this._cols=b;this._frames=[];this._time=0;this._step=1;0==d.width?d.loader.addEventListener2(Event.COMPLETE,this._init,this):this._init()}MBitmap.prototype=new Sprite;
MBitmap.prototype._init=function(d){d=1/this._cols;for(var a=1/this._rows,b=this.bitmapData.width*d,e=this.bitmapData.height*a,c=0;c<this._rows;c++)for(var f=0;f<this._cols;f++){var h=new Graphics;h.beginBitmapFill(this.bitmapData);h.drawTriangles([0,0,b,0,0,e,b,e],[0,1,2,1,2,3],[f*d,c*a,(f+1)*d,c*a,f*d,(c+1)*a,(f+1)*d,(c+1)*a]);this._frames.push(h)}this.graphics=this._frames[this.currentFrame]};
MBitmap.prototype.gotoAndStop=function(d){this.currentFrame=(d+this.totalFrames)%this.totalFrames;this.bitmapData.width&&(this.graphics=this._frames[d%this.totalFrames])};MBitmap.prototype.nextFrame=function(){this.gotoAndStop(this.currentFrame+1)};MBitmap.prototype.prevFrame=function(){this.gotoAndStop(this.currentFrame-1)};MBitmap.prototype.gotoAndPlay=function(d,a){this.gotoAndStop(d);this.play(a)};
MBitmap.prototype.gotoAndLoop=function(d,a,b){this.loop=!0;this.loopEnd=a;this.loopStart=d;this.loopStep=b;if(this.currentFrame>=a||this.currentFrame<d)this.gotoAndStop(d),this.play(b)};MBitmap.prototype.play=function(d){this._step=d?d:1;this.isPlaying=!0;this.addEventListener2(Event.ENTER_FRAME,this._ef,this)};
MBitmap.prototype.stop=function(){this.isPlaying=!1;this.removeEventListener(Event.ENTER_FRAME,this._ef);this.loop&&this.currentFrame==this.loopEnd&&this.gotoAndLoop(this.loopStart,this.loopEnd,this.loopStep)};MBitmap.prototype._ef=function(d){this.loop&&this.currentFrame==this.loopEnd?this.stop():0==this._time++%this._step&&this.nextFrame()};
function storageAvailable(d){try{var a=window[d];a.setItem("__storage_test__","__storage_test__");a.removeItem("__storage_test__");return!0}catch(b){return!1}}storageAvailable("localStorage")?(window.localStorage.high_score||(window.localStorage.high_score=0),gameVars.storage={available:!0,high_score:window.localStorage.high_score}):game.storage={available:!1};setTimeout(function(){Start()},300);
